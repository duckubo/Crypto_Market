/*!
    *
    * Wijmo Library 5.20242.21
    * https://developer.mescius.com/wijmo
    *
    * Copyright(c) MESCIUS inc. All rights reserved.
    *
    * Licensed under the End-User License Agreement For MESCIUS Wijmo Software.
    * us.sales@mescius.com
    * https://developer.mescius.com/wijmo/licensing
    *
    */

"use strict";var __extends=this&&this.__extends||function(){var extendStatics=function(e,t){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=null===t?Object.create(t):(__.prototype=t.prototype,new __)}}(),__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e}).apply(this,arguments)},__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);t.default=e;return t};Object.defineProperty(exports,"__esModule",{value:!0});var react_1=require("react"),wijmo_react_base_1=require("@mescius/wijmo.react.base"),wijmo_1=require("@mescius/wijmo"),React=__importStar(require("react")),wjcGrid=__importStar(require("@mescius/wijmo.grid")),wjcInteropGrid=__importStar(require("@mescius/wijmo.interop.grid"));exports.CellTemplateType=wjcInteropGrid.GridCellTemplateType;exports.FlexGridMeta={inputs:wijmo_react_base_1.ControlBaseMeta.inputs.concat(["allowAddNew","allowDelete","allowDragging","allowMerging","allowPinning","allowResizing","allowSorting","alternatingRowStep","anchorCursor","ariaLabel","autoClipboard","autoGenerateColumns","autoRowHeights","autoScroll","autoSearch","autoSizeMode","bigCheckboxes","caseSensitiveSearch","cellFactory","childItemsPath","cloneFrozenCells","columns","columnGroups","columnLayout","commitEmptyEdits","copyHeaders","deferResizing","editColumnIndex","errorTip","expandSelectionOnCopyPaste","frozenCells","frozenColumns","frozenRows","groupHeaderFormat","groupSummaryPosition","headersFocusability","headersVisibility","imeEnabled","isReadOnly","itemFormatter","itemValidator","itemsSource","keyActionEnter","keyActionTab","lazyRender","maxContent","mergeManager","newRowAtTop","pasteEmptyCells","preserveOutlineState","preserveSelectedState","preserveWhiteSpace","quickAutoSize","refreshOnEdit","rowHeaderPath","scrollPosition","scrollSize","selectedItems","selectedRanges","selectedRows","selection","selectionMode","showDropDown","showErrors","showGroups","showMarquee","showPlaceholders","showSelectedHeaders","showSort","skipMerged","sortRowIndex","stickyHeaders","treeIndent","validateEdits","virtualizationThreshold"]),events:wijmo_react_base_1.ControlBaseMeta.events.concat(["autoSizedColumn","autoSizedRow","autoSizingColumn","autoSizingRow","beginningEdit","cellEditEnded","cellEditEnding","columnGroupCollapsedChanged","columnGroupCollapsedChanging","copied","copying","deletedRow","deletingRow","draggedColumn","draggedRow","draggingColumn","draggingColumnOver","draggingRow","draggingRowOver","formatItem","groupCollapsedChanged","groupCollapsedChanging","itemsSourceChanged","itemsSourceChanging","loadedRows","loadingRows","pasted","pastedCell","pasting","pastingCell","pinnedColumn","pinningColumn","prepareCellForEdit","resizedColumn","resizedRow","resizingColumn","resizingRow","rowAdded","rowEditEnded","rowEditEnding","rowEditStarted","rowEditStarting","scrollPositionChanged","selectionChanged","selectionChanging","sortedColumn","sortingColumn","starSizedColumns","updatedLayout","updatedView","updatingLayout","updatingView"])};exports.FlexGrid=react_1.forwardRef((function(e,t){return wijmo_react_base_1.useWjComponentBase({ref:t,properties:exports.FlexGridMeta.inputs,events:exports.FlexGridMeta.events,props:e,constructor:wjcGrid.FlexGrid,initControl:function(e){e.cellFactory=new DirectiveCellFactory(e)}}).renderResult}));exports.RowColMeta={inputs:["align","allowDragging","allowMerging","allowResizing","binding","cssClass","cssClassAll","dataMap","dataMapEditor","dataType","dropDownCssClass","format","inputType","isContentHtml","isReadOnly","isRequired","isSelected","isVisible","mask","maxLength","multiLine","size","sortMemberPath","visible","wordWrap"],events:["gridChanged"]};exports.FlexGridColumnMeta={inputs:exports.RowColMeta.inputs.concat(["aggregate","allowSorting","cellTemplate","describedById","editor","header","maxWidth","minWidth","name","quickAutoSize","width"]),events:exports.RowColMeta.events.slice()};exports.FlexGridColumn=react_1.forwardRef((function(e,t){var r=wijmo_react_base_1.useWjComponentChildBase({ref:t,properties:exports.FlexGridColumnMeta.inputs,events:exports.FlexGridColumnMeta.events,props:e,constructor:wjcGrid.Column,customConstructor:function(e,t){e.autoGenerateColumns=!1;return new wjcGrid.Column(t)},needParentInstance:!1,parentProp:"columns",isParentPropArray:!0,assignedToParent:!0});return __assign({$_wjComponent:!0},r)}));exports.FlexGridColumnGroupMeta={inputs:exports.FlexGridColumnMeta.inputs.concat(["collapseTo","columns","height","isCollapsed"]),events:exports.FlexGridColumnMeta.events.slice()};exports.FlexGridColumnGroup=react_1.forwardRef((function(e,t){var r=wijmo_react_base_1.useWjComponentChildBase({ref:t,properties:exports.FlexGridColumnGroupMeta.inputs,events:exports.FlexGridColumnGroupMeta.events,props:e,constructor:wjcGrid.ColumnGroup,customConstructor:function(e,t){e.autoGenerateColumns=!1;return new wjcGrid.ColumnGroup(t)},needParentInstance:!1,parentProp:"columnGroups",isParentPropArray:!0,assignedToParent:!0});return __assign({$_wjComponent:!0},r)}));exports.FlexGridCellTemplateMeta={inputs:["cellType","template","autoSizeRows"],events:[]};exports.FlexGridCellTemplate=react_1.forwardRef((function(e,t){var r=wijmo_react_base_1.useWjComponentChildBase({ref:t,properties:exports.FlexGridCellTemplateMeta.inputs,events:exports.FlexGridCellTemplateMeta.events,props:e,constructor:ReactFlexGridCellTemplate,needParentInstance:!0,parentProp:"",isParentPropArray:!1,assignedToParent:!1});return __assign({$_wjComponent:!0},r)}));var ReactFlexGridCellTemplate=function(){function ReactFlexGridCellTemplate(e,t){this.autoSizeRows=!0;this.parent=e;this.cellType=wijmo_1.asEnum(t.cellType,wjcInteropGrid.GridCellTemplateType,!1);var r=wjcInteropGrid.DirectiveCellFactoryBase.getTemplContextProp(this.cellType);this.template=wijmo_1.asFunction(t.template,!0);e[r]=this}ReactFlexGridCellTemplate.prototype.initialize=function(e){this.removeBinding();this.cellType=wijmo_1.asEnum(null==e.cellType?this.cellType:e.cellType,wjcInteropGrid.GridCellTemplateType,!1);this.template=void 0===e.template?this.template:wijmo_1.asFunction(e.template,!0);var t=wjcInteropGrid.DirectiveCellFactoryBase.getTemplContextProp(this.cellType);this.parent[t]=this;this.autoSizeRows=void 0===e.autoSizeRows?this.autoSizeRows:wijmo_1.asBoolean(e.autoSizeRows,!0)||!1;void 0!==e.template&&this.parent&&(this.parent.grid?this.parent.grid.invalidate():this.parent.invalidate&&this.parent.invalidate());this.parent&&this.parent instanceof wjcGrid.Column&&this.parent._setFlag(wjcGrid.RowColFlags.HasTemplate,!0,!0)};ReactFlexGridCellTemplate.prototype.removeBinding=function(){var e=wjcInteropGrid.DirectiveCellFactoryBase.getTemplContextProp(this.cellType);delete this.parent[e];this.parent&&this.parent instanceof wjcGrid.Column&&this.parent._setFlag(wjcGrid.RowColFlags.HasTemplate,!1,!0)};ReactFlexGridCellTemplate.prototype.dispose=function(){this.removeBinding();this.parent&&this.parent.grid?this.parent.grid.invalidate():this.parent&&this.parent.invalidate&&this.parent.invalidate()};return ReactFlexGridCellTemplate}();exports.ReactFlexGridCellTemplate=ReactFlexGridCellTemplate;var DirectiveCellFactory=function(e){__extends(DirectiveCellFactory,e);function DirectiveCellFactory(t){var r=e.call(this,t)||this;r._renderedCells=[];t.updatedView.addHandler((function(e){queueMicrotask((function(){return r._reRenderCells()}))}),r);return r}DirectiveCellFactory.prototype.shouldInstantiate=function(e){var t=e.templateCache;return null==t||t.column!==e.column||t.templateContextProperty!==e.templateContextProperty||e.cell.firstChild!=t.rootElement};DirectiveCellFactory.prototype.renderTemplate=function(e,t){var r=e.row,i=e.templateContext,o=e.cell;e.cellBindingsData=this.setBindingsData({},r,e.column,r.dataItem,e.cellValue,i.valuePaths);e.cellBindingsData.localVars.valueFormatted=e.cellValueFormatted;this._renderCell(o,e);if(t){this._addRenderedCell(o);var n=e.templateCache={column:e.column,rootElement:o.firstElementChild,templateContextProperty:e.templateContextProperty};o[e.templateContextProperty]=n}};DirectiveCellFactory.prototype.flushPendingUpdates=function(){wijmo_react_base_1.baseFlushSync()};DirectiveCellFactory.prototype.applyImmediately=function(e){};DirectiveCellFactory.prototype.flushPendingEvents=function(e){};DirectiveCellFactory.prototype.getEditorFocusFlag=function(){return!0};DirectiveCellFactory.prototype.setEditorFocusFlag=function(e){};DirectiveCellFactory.prototype.disposeTemplate=function(t,r,i){if(r){wijmo_react_base_1.selectiveDomUnmount(t);this._removeRenderedCell(t);e.prototype.disposeTemplate.call(this,t,r,i)}};DirectiveCellFactory.prototype.clearCell=function(e){wijmo_react_base_1.selectiveDomUnmount(e)};DirectiveCellFactory.prototype.canRender=function(e){return!(!e||!e.template)};DirectiveCellFactory.prototype._renderCell=function(e,t){var r=t||e.__wjCellLastRenderedProp;if(r){var i=r&&r.templateContext.template,o=r.cellBindingsData.localVars;o.row&&!o.row.grid&&(o.row=r.panel.grid.rows[o.row.index]);if(!o.row)return;wijmo_react_base_1.selectiveDomRender(React.createElement("div",{},i&&i(o)),e);e.__wjCellLastRenderedProp=r}};DirectiveCellFactory.prototype._addRenderedCell=function(e){var t=this._renderedCells;t.indexOf(e)<0&&t.push(e)};DirectiveCellFactory.prototype._removeRenderedCell=function(e){var t=this._renderedCells,r=t.indexOf(e);r>-1&&t.splice(r,1)};DirectiveCellFactory.prototype._reRenderCells=function(){var e=this;this._renderedCells.forEach((function(t){return e._renderCell(t)}))};DirectiveCellFactory.prototype.checkHeight=function(e){var t=this;"$__cellTemplGroupHeader"!==e.templateContextProperty&&(this._isCheckingHeight||setTimeout((function(){if(!t._isCheckingHeight){var r=e.panel.rows,i=e.row.index;if(r[i]){var o=e.cell,n=o.style.height;o.style.height="0";var l=o.scrollHeight>7?o.scrollHeight:r[i].renderHeight;o.style.height=n;if(e.cellStamp===o[wjcInteropGrid.DirectiveCellFactoryBase._cellStampProp]){var a=e.rng,s=a&&a.rowSpan||1,p=e.isEdit;null!=r.maxSize&&(l=Math.min(l,r.maxSize));if(i<r.length&&r[i].renderHeight<l-1||r[i].renderHeight>l+1&&!p&&e.panel.cellType===wjcGrid.CellType.Cell&&1===s){var c=l/s;!e.row.resizedManually&&(null==e.row.height||e.row.height<c)&&(e.row.height=c);if(p){var d=t._isFullEdit(),u=t.grid;t._backupHeight=e.row.height;e.row.height=c;t._cacheRow=e.row;t._isCheckingHeight=!0;u.refresh();u.startEditing(d);t._isCheckingHeight=!1;e.isImeInput?t._initImeEditInput(e.cell,e.templateContext):t._initEditInput(e.cell,e.templateContext,null);return}}else p&&(e.isImeInput?t._initImeEditInput(e.cell,e.templateContext):t._initEditInput(e.cell,e.templateContext,null))}}}}),2))};return DirectiveCellFactory}(wjcInteropGrid.DirectiveCellFactoryBase);exports.DirectiveCellFactory=DirectiveCellFactory;