/*!
    *
    * Wijmo Library 5.20242.21
    * https://developer.mescius.com/wijmo
    *
    * Copyright(c) MESCIUS inc. All rights reserved.
    *
    * Licensed under the End-User License Agreement For MESCIUS Wijmo Software.
    * us.sales@mescius.com
    * https://developer.mescius.com/wijmo/licensing
    *
    */

var __extends=this&&this.__extends||function(){var extendStatics=function(e,t){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=null===t?Object.create(t):(__.prototype=t.prototype,new __)}}(),__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e}).apply(this,arguments)};import{forwardRef}from"react";import{ControlBaseMeta,baseFlushSync,selectiveDomRender,selectiveDomUnmount,useWjComponentBase,useWjComponentChildBase}from"@mescius/wijmo.react.base";import{asBoolean,asEnum,asFunction}from"@mescius/wijmo";import*as React from"react";import*as wjcGrid from"@mescius/wijmo.grid";import*as wjcInteropGrid from"@mescius/wijmo.interop.grid";export var CellTemplateType=wjcInteropGrid.GridCellTemplateType;export var FlexGridMeta={inputs:ControlBaseMeta.inputs.concat(["allowAddNew","allowDelete","allowDragging","allowMerging","allowPinning","allowResizing","allowSorting","alternatingRowStep","anchorCursor","ariaLabel","autoClipboard","autoGenerateColumns","autoRowHeights","autoScroll","autoSearch","autoSizeMode","bigCheckboxes","caseSensitiveSearch","cellFactory","childItemsPath","cloneFrozenCells","columns","columnGroups","columnLayout","commitEmptyEdits","copyHeaders","deferResizing","editColumnIndex","errorTip","expandSelectionOnCopyPaste","frozenCells","frozenColumns","frozenRows","groupHeaderFormat","groupSummaryPosition","headersFocusability","headersVisibility","imeEnabled","isReadOnly","itemFormatter","itemValidator","itemsSource","keyActionEnter","keyActionTab","lazyRender","maxContent","mergeManager","newRowAtTop","pasteEmptyCells","preserveOutlineState","preserveSelectedState","preserveWhiteSpace","quickAutoSize","refreshOnEdit","rowHeaderPath","scrollPosition","scrollSize","selectedItems","selectedRanges","selectedRows","selection","selectionMode","showDropDown","showErrors","showGroups","showMarquee","showPlaceholders","showSelectedHeaders","showSort","skipMerged","sortRowIndex","stickyHeaders","treeIndent","validateEdits","virtualizationThreshold"]),events:ControlBaseMeta.events.concat(["autoSizedColumn","autoSizedRow","autoSizingColumn","autoSizingRow","beginningEdit","cellEditEnded","cellEditEnding","columnGroupCollapsedChanged","columnGroupCollapsedChanging","copied","copying","deletedRow","deletingRow","draggedColumn","draggedRow","draggingColumn","draggingColumnOver","draggingRow","draggingRowOver","formatItem","groupCollapsedChanged","groupCollapsedChanging","itemsSourceChanged","itemsSourceChanging","loadedRows","loadingRows","pasted","pastedCell","pasting","pastingCell","pinnedColumn","pinningColumn","prepareCellForEdit","resizedColumn","resizedRow","resizingColumn","resizingRow","rowAdded","rowEditEnded","rowEditEnding","rowEditStarted","rowEditStarting","scrollPositionChanged","selectionChanged","selectionChanging","sortedColumn","sortingColumn","starSizedColumns","updatedLayout","updatedView","updatingLayout","updatingView"])};export var FlexGrid=forwardRef((function(e,t){return useWjComponentBase({ref:t,properties:FlexGridMeta.inputs,events:FlexGridMeta.events,props:e,constructor:wjcGrid.FlexGrid,initControl:function(e){e.cellFactory=new DirectiveCellFactory(e)}}).renderResult}));export var RowColMeta={inputs:["align","allowDragging","allowMerging","allowResizing","binding","cssClass","cssClassAll","dataMap","dataMapEditor","dataType","dropDownCssClass","format","inputType","isContentHtml","isReadOnly","isRequired","isSelected","isVisible","mask","maxLength","multiLine","size","sortMemberPath","visible","wordWrap"],events:["gridChanged"]};export var FlexGridColumnMeta={inputs:RowColMeta.inputs.concat(["aggregate","allowSorting","cellTemplate","describedById","editor","header","maxWidth","minWidth","name","quickAutoSize","width"]),events:RowColMeta.events.slice()};export var FlexGridColumn=forwardRef((function(e,t){var r=useWjComponentChildBase({ref:t,properties:FlexGridColumnMeta.inputs,events:FlexGridColumnMeta.events,props:e,constructor:wjcGrid.Column,customConstructor:function(e,t){e.autoGenerateColumns=!1;return new wjcGrid.Column(t)},needParentInstance:!1,parentProp:"columns",isParentPropArray:!0,assignedToParent:!0});return __assign({$_wjComponent:!0},r)}));export var FlexGridColumnGroupMeta={inputs:FlexGridColumnMeta.inputs.concat(["collapseTo","columns","height","isCollapsed"]),events:FlexGridColumnMeta.events.slice()};export var FlexGridColumnGroup=forwardRef((function(e,t){var r=useWjComponentChildBase({ref:t,properties:FlexGridColumnGroupMeta.inputs,events:FlexGridColumnGroupMeta.events,props:e,constructor:wjcGrid.ColumnGroup,customConstructor:function(e,t){e.autoGenerateColumns=!1;return new wjcGrid.ColumnGroup(t)},needParentInstance:!1,parentProp:"columnGroups",isParentPropArray:!0,assignedToParent:!0});return __assign({$_wjComponent:!0},r)}));export var FlexGridCellTemplateMeta={inputs:["cellType","template","autoSizeRows"],events:[]};export var FlexGridCellTemplate=forwardRef((function(e,t){var r=useWjComponentChildBase({ref:t,properties:FlexGridCellTemplateMeta.inputs,events:FlexGridCellTemplateMeta.events,props:e,constructor:ReactFlexGridCellTemplate,needParentInstance:!0,parentProp:"",isParentPropArray:!1,assignedToParent:!1});return __assign({$_wjComponent:!0},r)}));var ReactFlexGridCellTemplate=function(){function ReactFlexGridCellTemplate(e,t){this.autoSizeRows=!0;this.parent=e;this.cellType=asEnum(t.cellType,wjcInteropGrid.GridCellTemplateType,!1);var r=wjcInteropGrid.DirectiveCellFactoryBase.getTemplContextProp(this.cellType);this.template=asFunction(t.template,!0);e[r]=this}ReactFlexGridCellTemplate.prototype.initialize=function(e){this.removeBinding();this.cellType=asEnum(null==e.cellType?this.cellType:e.cellType,wjcInteropGrid.GridCellTemplateType,!1);this.template=void 0===e.template?this.template:asFunction(e.template,!0);var t=wjcInteropGrid.DirectiveCellFactoryBase.getTemplContextProp(this.cellType);this.parent[t]=this;this.autoSizeRows=void 0===e.autoSizeRows?this.autoSizeRows:asBoolean(e.autoSizeRows,!0)||!1;void 0!==e.template&&this.parent&&(this.parent.grid?this.parent.grid.invalidate():this.parent.invalidate&&this.parent.invalidate());this.parent&&this.parent instanceof wjcGrid.Column&&this.parent._setFlag(wjcGrid.RowColFlags.HasTemplate,!0,!0)};ReactFlexGridCellTemplate.prototype.removeBinding=function(){var e=wjcInteropGrid.DirectiveCellFactoryBase.getTemplContextProp(this.cellType);delete this.parent[e];this.parent&&this.parent instanceof wjcGrid.Column&&this.parent._setFlag(wjcGrid.RowColFlags.HasTemplate,!1,!0)};ReactFlexGridCellTemplate.prototype.dispose=function(){this.removeBinding();this.parent&&this.parent.grid?this.parent.grid.invalidate():this.parent&&this.parent.invalidate&&this.parent.invalidate()};return ReactFlexGridCellTemplate}();export{ReactFlexGridCellTemplate};var DirectiveCellFactory=function(e){__extends(DirectiveCellFactory,e);function DirectiveCellFactory(t){var r=e.call(this,t)||this;r._renderedCells=[];t.updatedView.addHandler((function(e){queueMicrotask((function(){return r._reRenderCells()}))}),r);return r}DirectiveCellFactory.prototype.shouldInstantiate=function(e){var t=e.templateCache;return null==t||t.column!==e.column||t.templateContextProperty!==e.templateContextProperty||e.cell.firstChild!=t.rootElement};DirectiveCellFactory.prototype.renderTemplate=function(e,t){var r=e.row,o=e.templateContext,i=e.cell;e.cellBindingsData=this.setBindingsData({},r,e.column,r.dataItem,e.cellValue,o.valuePaths);e.cellBindingsData.localVars.valueFormatted=e.cellValueFormatted;this._renderCell(i,e);if(t){this._addRenderedCell(i);var n=e.templateCache={column:e.column,rootElement:i.firstElementChild,templateContextProperty:e.templateContextProperty};i[e.templateContextProperty]=n}};DirectiveCellFactory.prototype.flushPendingUpdates=function(){baseFlushSync()};DirectiveCellFactory.prototype.applyImmediately=function(e){};DirectiveCellFactory.prototype.flushPendingEvents=function(e){};DirectiveCellFactory.prototype.getEditorFocusFlag=function(){return!0};DirectiveCellFactory.prototype.setEditorFocusFlag=function(e){};DirectiveCellFactory.prototype.disposeTemplate=function(t,r,o){if(r){selectiveDomUnmount(t);this._removeRenderedCell(t);e.prototype.disposeTemplate.call(this,t,r,o)}};DirectiveCellFactory.prototype.clearCell=function(e){selectiveDomUnmount(e)};DirectiveCellFactory.prototype.canRender=function(e){return!(!e||!e.template)};DirectiveCellFactory.prototype._renderCell=function(e,t){var r=t||e.__wjCellLastRenderedProp;if(r){var o=r&&r.templateContext.template,i=r.cellBindingsData.localVars;i.row&&!i.row.grid&&(i.row=r.panel.grid.rows[i.row.index]);if(!i.row)return;selectiveDomRender(React.createElement("div",{},o&&o(i)),e);e.__wjCellLastRenderedProp=r}};DirectiveCellFactory.prototype._addRenderedCell=function(e){var t=this._renderedCells;t.indexOf(e)<0&&t.push(e)};DirectiveCellFactory.prototype._removeRenderedCell=function(e){var t=this._renderedCells,r=t.indexOf(e);r>-1&&t.splice(r,1)};DirectiveCellFactory.prototype._reRenderCells=function(){var e=this;this._renderedCells.forEach((function(t){return e._renderCell(t)}))};DirectiveCellFactory.prototype.checkHeight=function(e){var t=this;"$__cellTemplGroupHeader"!==e.templateContextProperty&&(this._isCheckingHeight||setTimeout((function(){if(!t._isCheckingHeight){var r=e.panel.rows,o=e.row.index;if(r[o]){var i=e.cell,n=i.style.height;i.style.height="0";var l=i.scrollHeight>7?i.scrollHeight:r[o].renderHeight;i.style.height=n;if(e.cellStamp===i[wjcInteropGrid.DirectiveCellFactoryBase._cellStampProp]){var a=e.rng,s=a&&a.rowSpan||1,p=e.isEdit;null!=r.maxSize&&(l=Math.min(l,r.maxSize));if(o<r.length&&r[o].renderHeight<l-1||r[o].renderHeight>l+1&&!p&&e.panel.cellType===wjcGrid.CellType.Cell&&1===s){var c=l/s;!e.row.resizedManually&&(null==e.row.height||e.row.height<c)&&(e.row.height=c);if(p){var d=t._isFullEdit(),u=t.grid;t._backupHeight=e.row.height;e.row.height=c;t._cacheRow=e.row;t._isCheckingHeight=!0;u.refresh();u.startEditing(d);t._isCheckingHeight=!1;e.isImeInput?t._initImeEditInput(e.cell,e.templateContext):t._initEditInput(e.cell,e.templateContext,null);return}}else p&&(e.isImeInput?t._initImeEditInput(e.cell,e.templateContext):t._initEditInput(e.cell,e.templateContext,null))}}}}),2))};return DirectiveCellFactory}(wjcInteropGrid.DirectiveCellFactoryBase);export{DirectiveCellFactory};