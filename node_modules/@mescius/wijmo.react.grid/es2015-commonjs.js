/*!
    *
    * Wijmo Library 5.20242.21
    * https://developer.mescius.com/wijmo
    *
    * Copyright(c) MESCIUS inc. All rights reserved.
    *
    * Licensed under the End-User License Agreement For MESCIUS Wijmo Software.
    * us.sales@mescius.com
    * https://developer.mescius.com/wijmo/licensing
    *
    */

"use strict";var __importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);t.default=e;return t};Object.defineProperty(exports,"__esModule",{value:!0});const react_1=require("react"),wijmo_react_base_1=require("@mescius/wijmo.react.base"),wijmo_1=require("@mescius/wijmo"),React=__importStar(require("react")),wjcGrid=__importStar(require("@mescius/wijmo.grid")),wjcInteropGrid=__importStar(require("@mescius/wijmo.interop.grid"));exports.CellTemplateType=wjcInteropGrid.GridCellTemplateType;exports.FlexGridMeta={inputs:[...wijmo_react_base_1.ControlBaseMeta.inputs,"allowAddNew","allowDelete","allowDragging","allowMerging","allowPinning","allowResizing","allowSorting","alternatingRowStep","anchorCursor","ariaLabel","autoClipboard","autoGenerateColumns","autoRowHeights","autoScroll","autoSearch","autoSizeMode","bigCheckboxes","caseSensitiveSearch","cellFactory","childItemsPath","cloneFrozenCells","columns","columnGroups","columnLayout","commitEmptyEdits","copyHeaders","deferResizing","editColumnIndex","errorTip","expandSelectionOnCopyPaste","frozenCells","frozenColumns","frozenRows","groupHeaderFormat","groupSummaryPosition","headersFocusability","headersVisibility","imeEnabled","isReadOnly","itemFormatter","itemValidator","itemsSource","keyActionEnter","keyActionTab","lazyRender","maxContent","mergeManager","newRowAtTop","pasteEmptyCells","preserveOutlineState","preserveSelectedState","preserveWhiteSpace","quickAutoSize","refreshOnEdit","rowHeaderPath","scrollPosition","scrollSize","selectedItems","selectedRanges","selectedRows","selection","selectionMode","showDropDown","showErrors","showGroups","showMarquee","showPlaceholders","showSelectedHeaders","showSort","skipMerged","sortRowIndex","stickyHeaders","treeIndent","validateEdits","virtualizationThreshold"],events:[...wijmo_react_base_1.ControlBaseMeta.events,"autoSizedColumn","autoSizedRow","autoSizingColumn","autoSizingRow","beginningEdit","cellEditEnded","cellEditEnding","columnGroupCollapsedChanged","columnGroupCollapsedChanging","copied","copying","deletedRow","deletingRow","draggedColumn","draggedRow","draggingColumn","draggingColumnOver","draggingRow","draggingRowOver","formatItem","groupCollapsedChanged","groupCollapsedChanging","itemsSourceChanged","itemsSourceChanging","loadedRows","loadingRows","pasted","pastedCell","pasting","pastingCell","pinnedColumn","pinningColumn","prepareCellForEdit","resizedColumn","resizedRow","resizingColumn","resizingRow","rowAdded","rowEditEnded","rowEditEnding","rowEditStarted","rowEditStarting","scrollPositionChanged","selectionChanged","selectionChanging","sortedColumn","sortingColumn","starSizedColumns","updatedLayout","updatedView","updatingLayout","updatingView"]};exports.FlexGrid=react_1.forwardRef((function(e,t){return wijmo_react_base_1.useWjComponentBase({ref:t,properties:exports.FlexGridMeta.inputs,events:exports.FlexGridMeta.events,props:e,constructor:wjcGrid.FlexGrid,initControl:e=>{e.cellFactory=new DirectiveCellFactory(e)}}).renderResult}));exports.RowColMeta={inputs:["align","allowDragging","allowMerging","allowResizing","binding","cssClass","cssClassAll","dataMap","dataMapEditor","dataType","dropDownCssClass","format","inputType","isContentHtml","isReadOnly","isRequired","isSelected","isVisible","mask","maxLength","multiLine","size","sortMemberPath","visible","wordWrap"],events:["gridChanged"]};exports.FlexGridColumnMeta={inputs:[...exports.RowColMeta.inputs,"aggregate","allowSorting","cellTemplate","describedById","editor","header","maxWidth","minWidth","name","quickAutoSize","width"],events:[...exports.RowColMeta.events]};exports.FlexGridColumn=react_1.forwardRef((function(e,t){const r=wijmo_react_base_1.useWjComponentChildBase({ref:t,properties:exports.FlexGridColumnMeta.inputs,events:exports.FlexGridColumnMeta.events,props:e,constructor:wjcGrid.Column,customConstructor:(e,t)=>{e.autoGenerateColumns=!1;return new wjcGrid.Column(t)},needParentInstance:!1,parentProp:"columns",isParentPropArray:!0,assignedToParent:!0});return Object.assign({$_wjComponent:!0},r)}));exports.FlexGridColumnGroupMeta={inputs:[...exports.FlexGridColumnMeta.inputs,"collapseTo","columns","height","isCollapsed"],events:[...exports.FlexGridColumnMeta.events]};exports.FlexGridColumnGroup=react_1.forwardRef((function(e,t){const r=wijmo_react_base_1.useWjComponentChildBase({ref:t,properties:exports.FlexGridColumnGroupMeta.inputs,events:exports.FlexGridColumnGroupMeta.events,props:e,constructor:wjcGrid.ColumnGroup,customConstructor:(e,t)=>{e.autoGenerateColumns=!1;return new wjcGrid.ColumnGroup(t)},needParentInstance:!1,parentProp:"columnGroups",isParentPropArray:!0,assignedToParent:!0});return Object.assign({$_wjComponent:!0},r)}));exports.FlexGridCellTemplateMeta={inputs:["cellType","template","autoSizeRows"],events:[]};exports.FlexGridCellTemplate=react_1.forwardRef((function(e,t){const r=wijmo_react_base_1.useWjComponentChildBase({ref:t,properties:exports.FlexGridCellTemplateMeta.inputs,events:exports.FlexGridCellTemplateMeta.events,props:e,constructor:ReactFlexGridCellTemplate,needParentInstance:!0,parentProp:"",isParentPropArray:!1,assignedToParent:!1});return Object.assign({$_wjComponent:!0},r)}));class ReactFlexGridCellTemplate{constructor(e,t){this.autoSizeRows=!0;this.parent=e;this.cellType=wijmo_1.asEnum(t.cellType,wjcInteropGrid.GridCellTemplateType,!1);const r=wjcInteropGrid.DirectiveCellFactoryBase.getTemplContextProp(this.cellType);this.template=wijmo_1.asFunction(t.template,!0);e[r]=this}initialize(e){this.removeBinding();this.cellType=wijmo_1.asEnum(null==e.cellType?this.cellType:e.cellType,wjcInteropGrid.GridCellTemplateType,!1);this.template=void 0===e.template?this.template:wijmo_1.asFunction(e.template,!0);const t=wjcInteropGrid.DirectiveCellFactoryBase.getTemplContextProp(this.cellType);this.parent[t]=this;this.autoSizeRows=void 0===e.autoSizeRows?this.autoSizeRows:wijmo_1.asBoolean(e.autoSizeRows,!0)||!1;void 0!==e.template&&this.parent&&(this.parent.grid?this.parent.grid.invalidate():this.parent.invalidate&&this.parent.invalidate());this.parent&&this.parent instanceof wjcGrid.Column&&this.parent._setFlag(wjcGrid.RowColFlags.HasTemplate,!0,!0)}removeBinding(){const e=wjcInteropGrid.DirectiveCellFactoryBase.getTemplContextProp(this.cellType);delete this.parent[e];this.parent&&this.parent instanceof wjcGrid.Column&&this.parent._setFlag(wjcGrid.RowColFlags.HasTemplate,!1,!0)}dispose(){this.removeBinding();this.parent&&this.parent.grid?this.parent.grid.invalidate():this.parent&&this.parent.invalidate&&this.parent.invalidate()}}exports.ReactFlexGridCellTemplate=ReactFlexGridCellTemplate;class DirectiveCellFactory extends wjcInteropGrid.DirectiveCellFactoryBase{constructor(e){super(e);this._renderedCells=[];e.updatedView.addHandler(e=>{queueMicrotask(()=>this._reRenderCells())},this)}shouldInstantiate(e){const t=e.templateCache;return null==t||t.column!==e.column||t.templateContextProperty!==e.templateContextProperty||e.cell.firstChild!=t.rootElement}renderTemplate(e,t){let r=e.row,i=e.templateContext,l=e.cell;e.cellBindingsData=this.setBindingsData({},r,e.column,r.dataItem,e.cellValue,i.valuePaths);e.cellBindingsData.localVars.valueFormatted=e.cellValueFormatted;this._renderCell(l,e);if(t){this._addRenderedCell(l);let t=e.templateCache={column:e.column,rootElement:l.firstElementChild,templateContextProperty:e.templateContextProperty};l[e.templateContextProperty]=t}}flushPendingUpdates(){wijmo_react_base_1.baseFlushSync()}applyImmediately(e){}flushPendingEvents(e){}getEditorFocusFlag(){return!0}setEditorFocusFlag(e){}disposeTemplate(e,t,r){if(t){wijmo_react_base_1.selectiveDomUnmount(e);this._removeRenderedCell(e);super.disposeTemplate(e,t,r)}}clearCell(e){wijmo_react_base_1.selectiveDomUnmount(e)}canRender(e){return!(!e||!e.template)}_renderCell(e,t){var r=t||e.__wjCellLastRenderedProp;if(r){let t=r&&r.templateContext.template,i=r.cellBindingsData.localVars;i.row&&!i.row.grid&&(i.row=r.panel.grid.rows[i.row.index]);if(!i.row)return;wijmo_react_base_1.selectiveDomRender(React.createElement("div",{},t&&t(i)),e);e.__wjCellLastRenderedProp=r}}_addRenderedCell(e){let t=this._renderedCells;t.indexOf(e)<0&&t.push(e)}_removeRenderedCell(e){let t=this._renderedCells,r=t.indexOf(e);r>-1&&t.splice(r,1)}_reRenderCells(){this._renderedCells.forEach(e=>this._renderCell(e))}checkHeight(e){"$__cellTemplGroupHeader"!==e.templateContextProperty&&(this._isCheckingHeight||setTimeout(()=>{if(this._isCheckingHeight)return;var t=e.panel.rows,r=e.row.index;if(!t[r])return;let i=e.cell;const l=i.style.height;i.style.height="0";let o=i.scrollHeight>7?i.scrollHeight:t[r].renderHeight;i.style.height=l;if(e.cellStamp===i[wjcInteropGrid.DirectiveCellFactoryBase._cellStampProp]){var n=e.rng,a=n&&n.rowSpan||1,s=e.isEdit;null!=t.maxSize&&(o=Math.min(o,t.maxSize));if(r<t.length&&t[r].renderHeight<o-1||t[r].renderHeight>o+1&&!s&&e.panel.cellType===wjcGrid.CellType.Cell&&1===a){const t=o/a;!e.row.resizedManually&&(null==e.row.height||e.row.height<t)&&(e.row.height=t);if(s){let r=this._isFullEdit(),i=this.grid;this._backupHeight=e.row.height;e.row.height=t;this._cacheRow=e.row;this._isCheckingHeight=!0;i.refresh();i.startEditing(r);this._isCheckingHeight=!1;e.isImeInput?this._initImeEditInput(e.cell,e.templateContext):this._initEditInput(e.cell,e.templateContext,null);return}}else s&&(e.isImeInput?this._initImeEditInput(e.cell,e.templateContext):this._initEditInput(e.cell,e.templateContext,null))}},2))}}exports.DirectiveCellFactory=DirectiveCellFactory;