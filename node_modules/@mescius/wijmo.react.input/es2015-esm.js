/*!
    *
    * Wijmo Library 5.20242.21
    * https://developer.mescius.com/wijmo
    *
    * Copyright(c) MESCIUS inc. All rights reserved.
    *
    * Licensed under the End-User License Agreement For MESCIUS Wijmo Software.
    * us.sales@mescius.com
    * https://developer.mescius.com/wijmo/licensing
    *
    */

import{forwardRef}from"react";import{ControlBaseMeta,selectiveDomRender,selectiveDomUnmount,useWjComponentBase,useWjComponentChildBase}from"@mescius/wijmo.react.base";import*as React from"react";import*as ReactDOM from"react-dom";import*as wjcCore from"@mescius/wijmo";import*as wjcInput from"@mescius/wijmo.input";const wjItemTemplatePropertyKey="$__wjItemTemplate",wjItemTemplateProperty="wjItemTemplate";function updateWjItemTemplateProp(e,t){if(e){if(!e[wjItemTemplatePropertyKey]&&t[wjItemTemplateProperty]){e[wjItemTemplatePropertyKey]=new ItemTemplate(e);e[wjItemTemplatePropertyKey].wjItemTemplate=wjcCore.asFunction(t[wjItemTemplateProperty])}else if(e[wjItemTemplatePropertyKey]&&!t[wjItemTemplateProperty]){const t=e[wjItemTemplatePropertyKey];e[wjItemTemplatePropertyKey]=null;t._detachFromControl()}if(e[wjItemTemplatePropertyKey]&&t[wjItemTemplateProperty]){e[wjItemTemplatePropertyKey].wjItemTemplate=wjcCore.asFunction(t[wjItemTemplateProperty]);e[wjItemTemplatePropertyKey]._updateTemplateItems()}}}export const ListBoxMeta={inputs:[...ControlBaseMeta.inputs,"caseSensitiveSearch","checkedItems","checkedMemberPath","displayMemberPath","isContentHtml","itemFormatter","itemRole","itemsSource","maxHeight","selectedIndex","selectedItem","selectedValue","selectedValuePath","showGroups","virtualizationThreshold"],events:[...ControlBaseMeta.events,"checkedItemsChanged","formatItem","itemChecked","itemsChanged","loadedItems","loadingItems","selectedIndexChanged"]};export const ListBox=forwardRef((function(e,t){const n=useWjComponentBase({ref:t,properties:ListBoxMeta.inputs,events:ListBoxMeta.events,props:e,constructor:wjcInput.ListBox,initControl:t=>{updateWjItemTemplateProp(t,e)}});updateWjItemTemplateProp(n.wjControl,e);return n.renderResult}));export const MultiSelectListBoxMeta={inputs:[...ControlBaseMeta.inputs,"caseSensitiveSearch","checkOnFilter","checkedItems","checkedMemberPath","delay","displayMemberPath","filterInputPlaceholder","isContentHtml","itemsSource","selectAllLabel","selectedIndex","showFilterInput","showGroups","showSelectAllCheckbox","virtualizationThreshold"],events:[...ControlBaseMeta.events,"checkedItemsChanged","selectedIndexChanged"]};export const MultiSelectListBox=forwardRef((function(e,t){return useWjComponentBase({ref:t,properties:MultiSelectListBoxMeta.inputs,events:MultiSelectListBoxMeta.events,props:e,constructor:wjcInput.MultiSelectListBox}).renderResult}));export const DropDownMeta={inputs:[...ControlBaseMeta.inputs,"autoExpandSelection","clickAction","dropDownCssClass","inputType","isAnimated","isDroppedDown","isReadOnly","isRequired","placeholder","showDropDownButton","text"],events:[...ControlBaseMeta.events,"isDroppedDownChanged","isDroppedDownChanging","textChanged"]};export const ComboBoxMeta={inputs:[...DropDownMeta.inputs,"caseSensitiveSearch","displayMemberPath","handleWheel","headerPath","isContentHtml","isEditable","itemFormatter","itemsSource","maxDropDownHeight","maxDropDownWidth","selectedIndex","selectedItem","selectedValue","selectedValuePath","showGroups","trimText","virtualizationThreshold"],events:[...DropDownMeta.events,"formatItem","itemsSourceChanged","selectedIndexChanged"]};export const ComboBox=forwardRef((function(e,t){const n=useWjComponentBase({ref:t,properties:ComboBoxMeta.inputs,events:ComboBoxMeta.events,props:e,constructor:wjcInput.ComboBox,initControl:t=>{updateWjItemTemplateProp(t,e)}});updateWjItemTemplateProp(n.wjControl,e);return n.renderResult}));export const AutoCompleteMeta={inputs:[...ComboBoxMeta.inputs,"beginsWithSearch","cssMatch","delay","itemsSourceFunction","maxItems","minLength","searchMemberPath"],events:[...ComboBoxMeta.events]};export const AutoComplete=forwardRef((function(e,t){const n=useWjComponentBase({ref:t,properties:AutoCompleteMeta.inputs,events:AutoCompleteMeta.events,props:e,constructor:wjcInput.AutoComplete,initControl:t=>{updateWjItemTemplateProp(t,e)}});updateWjItemTemplateProp(n.wjControl,e);return n.renderResult}));export const CalendarMeta={inputs:[...ControlBaseMeta.inputs,"displayMonth","firstDayOfWeek","formatDayHeaders","formatDays","formatMonths","formatYear","formatYearMonth","handleWheel","isReadOnly","itemFormatter","itemValidator","max","min","monthCount","monthView","rangeEnd","rangeMax","rangeMin","repeatButtons","selectionMode","showHeader","showMonthPicker","showYearPicker","value","weeksAfter","weeksBefore"],events:[...ControlBaseMeta.events,"displayMonthChanged","formatItem","rangeChanged","rangeEndChanged","valueChanged"]};export const Calendar=forwardRef((function(e,t){return useWjComponentBase({ref:t,properties:CalendarMeta.inputs,events:CalendarMeta.events,props:e,constructor:wjcInput.Calendar}).renderResult}));export const ColorPickerMeta={inputs:[...ControlBaseMeta.inputs,"palette","showAlphaChannel","showColorString","value"],events:[...ControlBaseMeta.events,"valueChanged"]};export const ColorPicker=forwardRef((function(e,t){return useWjComponentBase({ref:t,properties:ColorPickerMeta.inputs,events:ColorPickerMeta.events,props:e,constructor:wjcInput.ColorPicker}).renderResult}));export const InputMaskMeta={inputs:[...ControlBaseMeta.inputs,"inputType","isReadOnly","isRequired","mask","overwriteMode","placeholder","promptChar","rawValue","value"],events:[...ControlBaseMeta.events,"valueChanged"]};export const InputMask=forwardRef((function(e,t){return useWjComponentBase({ref:t,properties:InputMaskMeta.inputs,events:InputMaskMeta.events,props:e,constructor:wjcInput.InputMask}).renderResult}));export const InputColorMeta={inputs:[...DropDownMeta.inputs,"palette","showAlphaChannel","showColorString","text","value"],events:[...DropDownMeta.events,"valueChanged"]};export const InputColor=forwardRef((function(e,t){return useWjComponentBase({ref:t,properties:InputColorMeta.inputs,events:InputColorMeta.events,props:e,constructor:wjcInput.InputColor}).renderResult}));export const MultiSelectMeta={inputs:[...ComboBoxMeta.inputs,"caseSensitiveSearch","checkOnFilter","checkedItems","checkedMemberPath","delay","filterInputPlaceholder","headerFormat","headerFormatter","maxHeaderItems","selectAllLabel","showFilterInput","showSelectAllCheckbox"],events:[...ComboBoxMeta.events,"checkedItemsChanged"]};export const MultiSelect=forwardRef((function(e,t){const n=useWjComponentBase({ref:t,properties:MultiSelectMeta.inputs,events:MultiSelectMeta.events,props:e,constructor:wjcInput.MultiSelect,initControl:t=>{updateWjItemTemplateProp(t,e)}});updateWjItemTemplateProp(n.wjControl,e);return n.renderResult}));export const MultiAutoCompleteMeta={inputs:[...AutoCompleteMeta.inputs,"maxSelectedItems","selectedItems","selectedMemberPath","showDropDownButton"],events:[...AutoCompleteMeta.events,"selectedItemsChanged"]};export const MultiAutoComplete=forwardRef((function(e,t){return useWjComponentBase({ref:t,properties:MultiAutoCompleteMeta.inputs,events:MultiAutoCompleteMeta.events,props:e,constructor:wjcInput.MultiAutoComplete}).renderResult}));export const InputNumberMeta={inputs:[...ControlBaseMeta.inputs,"format","handleWheel","inputType","isReadOnly","isRequired","max","min","placeholder","repeatButtons","showSpinner","step","text","value"],events:[...ControlBaseMeta.events,"textChanged","valueChanged"]};export const InputNumber=forwardRef((function(e,t){return useWjComponentBase({ref:t,properties:InputNumberMeta.inputs,events:InputNumberMeta.events,props:e,constructor:wjcInput.InputNumber}).renderResult}));export const InputDateMeta={inputs:[...DropDownMeta.inputs,"alwaysShowCalendar","closeOnSelection","format","handleWheel","inputType","itemFormatter","itemValidator","mask","max","min","monthCount","predefinedRanges","rangeEnd","rangeMax","rangeMin","repeatButtons","selectionMode","separator","showHeader","showMonthPicker","showYearPicker","text","value","weeksAfter","weeksBefore","keepInvalidText"],events:[...DropDownMeta.events,"rangeChanged","rangeEndChanged","valueChanged"]};export const InputDate=forwardRef((function(e,t){return useWjComponentBase({ref:t,properties:InputDateMeta.inputs,events:InputDateMeta.events,props:e,constructor:wjcInput.InputDate}).renderResult}));export const InputTimeMeta={inputs:[...ComboBoxMeta.inputs,"format","inputType","mask","max","min","step","text","value"],events:[...ComboBoxMeta.events,"valueChanged"]};export const InputTime=forwardRef((function(e,t){return useWjComponentBase({ref:t,properties:InputTimeMeta.inputs,events:InputTimeMeta.events,props:e,constructor:wjcInput.InputTime}).renderResult}));export const InputDateTimeMeta={inputs:[...InputDateMeta.inputs,"timeFormat","timeMax","timeMin","timeStep"],events:[...InputDateMeta.events]};export const InputDateTime=forwardRef((function(e,t){return useWjComponentBase({ref:t,properties:InputDateTimeMeta.inputs,events:InputDateTimeMeta.events,props:e,constructor:wjcInput.InputDateTime}).renderResult}));export const InputDateRangeMeta={inputs:[...InputDateMeta.inputs],events:[...InputDateMeta.events]};export const InputDateRange=forwardRef((function(e,t){return useWjComponentBase({ref:t,properties:InputDateRangeMeta.inputs,events:InputDateRangeMeta.events,props:e,constructor:wjcInput.InputDateRange}).renderResult}));export const MenuMeta={inputs:[...ComboBoxMeta.inputs,"closeOnLeave","command","commandParameterPath","commandPath","header","isButton","openOnHover","owner","subItemsPath","ariaLabel","autoSelectOnFocus"],events:[...ComboBoxMeta.events,"itemClicked"]};function getReactDOM(){return ReactDOM}function _getContextMenuElements(e){const t=[];(wjcCore.isArray(e)?e:[e]).forEach(e=>{if(e){let n=null;if("string"==typeof e)n=document.getElementById(e);else if("object"==typeof e){const t=e.hostElement?e.hostElement:e.current;if(t)if(t instanceof HTMLElement)n=t;else if(t instanceof wjcCore.Control)n=t.hostElement;else if(t.control&&t.control instanceof wjcCore.Control)n=t.control.hostElement;else{const e=getReactDOM().findDOMNode;e&&(n=e(t))}}n&&t.push(n)}});return t}export const Menu=forwardRef((function(e,t){const n=React.useRef({}),updateHeader=e=>{e.header=e._definedHeader||"";const t=e.selectedItem;if(null!=e.selectedValue&&t&&e.displayMemberPath){let n=null;if(t instanceof _MenuItem){const o=t.itemRoot;n=o?o.innerHTML:t[e.displayMemberPath]}null!=n&&(e.header+=": <b>"+n+"</b>")}},o=useWjComponentBase({ref:t,properties:MenuMeta.inputs,events:MenuMeta.events,props:e,constructor:wjcInput.Menu,prePropsInit:t=>{t._definedHeader=e.header;t.listBox.formatItem.addHandler((e,t)=>{if(t.data instanceof _MenuItem||t.data instanceof _MenuSeparator){t.item.textContent="";t.data.updateItem(t.item)}});queueMicrotask(()=>updateHeader(t))},initControl:t=>{updateWjItemTemplateProp(t,e);t._definedHeader=e.header;t.selectedIndexChanged.addHandler(()=>{updateHeader(t)});if(t.itemsSource&&t.itemsSource.length){Array.from(t.itemsSource).find(e=>e instanceof _MenuItem);t.itemsSource[0]instanceof _MenuItem&&1==t.itemsSource.length&&t.selectedIndex<0&&(t.selectedIndex=0)}},customProps:{header:(e,t)=>{if(e._definedHeader!=t){e._definedHeader=t;e.header=t;updateHeader(e)}},contextMenuOf:(e,t)=>{n.current.contextMenuOf||(n.current.contextMenuOf=[]);e.hostElement.style.display=t?"none":"inline-table";const o=n.current.contextMenuOf;for(let e of o)e.el.removeEventListener("contextmenu",e.handler);n.current.contextMenuOf=[];if(!t)return;const r=_getContextMenuElements(t);for(let t of r){const listener=n=>{if(wjcCore.closest(n.target,"[disabled]"))return;const o=e;if(o&&o.dropDown){n.preventDefault();n.stopPropagation();o.owner=t;o.show(n)}};t.addEventListener("contextmenu",listener);n.current.contextMenuOf.push({el:t,handler:listener})}},value:(e,t)=>{e.selectedValue=t;updateHeader(e)}}});o.wjControl&&(o.wjControl._definedHeader=e.header);updateWjItemTemplateProp(o.wjControl,e);if(o.wjControl&&o.wjControl.itemsSource)for(let e of o.wjControl.itemsSource)if(e instanceof _MenuItem){o.wjControl.listBox.loadList();break}return o.renderResult}));export const MenuItemMeta={inputs:["children","cmd","cmdParam","value"],events:[]};class _MenuItem{constructor(e,t){this.children=[];this.value=null;this.cmd=null;this.cmdParam=null;this._parent=e;wjcCore.copy(this,t);this._init(t)}_init(e){this._parent.displayMemberPath||(this._parent.displayMemberPath="header");this._parent.selectedValuePath||(this._parent.selectedValuePath="value");this._parent.commandPath||(this._parent.commandPath="cmd");this._parent.commandParameterPath||(this._parent.commandParameterPath="cmdParam")}updateItem(e){selectiveDomUnmount(e);selectiveDomRender(this.children,e);this.itemRoot=e}}export const MenuItem=forwardRef((function(e,t){const n=useWjComponentChildBase({ref:t,properties:MenuItemMeta.inputs,events:MenuItemMeta.events,props:e,constructor:_MenuItem,needParentInstance:!0,parentProp:"itemsSource",isParentPropArray:!0,assignedToParent:!0});return Object.assign({$_wjComponent:!0},n)}));export const MenuSeparator=forwardRef((function(e,t){const n=useWjComponentChildBase({ref:t,properties:[],events:[],props:e,constructor:_MenuSeparator,needParentInstance:!0,parentProp:"itemsSource",isParentPropArray:!0,assignedToParent:!0});return Object.assign({$_wjComponent:!0},n)}));class _MenuSeparator{constructor(e,t){}updateItem(e){wjcCore.createElement("<div></div>",e,{width:"100%",height:"1px",backgroundColor:"lightgray"});wjcCore.addClass(e,"wj-state-disabled");wjcCore.setAttribute(e,"role","separator",!1)}}export const PopupMeta={inputs:[...ControlBaseMeta.inputs,"content","dialogResult","dialogResultEnter","dialogResultSubmit","fadeIn","fadeOut","hideTrigger","isDraggable","isResizable","isVisible","modal","owner","position","removeOnHide","showTrigger"],events:[...ControlBaseMeta.events,"dragged","dragging","hidden","hiding","positionChanged","positionChanging","resized","resizing","showing","shown","sizeChanged","sizeChanging"]};function updatePopupContent(e,t){selectiveDomRender(t,e.hostElement)}export const Popup=forwardRef((function(e,t){const n=useWjComponentBase({ref:t,properties:PopupMeta.inputs,events:PopupMeta.events,props:e,constructor:wjcInput.Popup,initControl:t=>{t.removeOnHide=!1;updatePopupContent(t,e.children)}});n.wjControl&&updatePopupContent(n.wjControl,e.children);return n.renderResult}));export const CollectionViewNavigatorMeta={inputs:[...ControlBaseMeta.inputs,"byPage","cv","headerFormat","repeatButtons"],events:[...ControlBaseMeta.events]};export const CollectionViewNavigator=forwardRef((function(e,t){return useWjComponentBase({ref:t,properties:CollectionViewNavigatorMeta.inputs,events:CollectionViewNavigatorMeta.events,props:e,constructor:wjcInput.CollectionViewNavigator}).renderResult}));class ItemTemplate{constructor(e){this._templateItems=[];this.ownerControl=e;this.listBox=this._getListBox(this.ownerControl);this._attachToControl()}_updateTemplateItems(){this._templateItems.forEach(e=>{selectiveDomRender(this._createItemElTpl(e),e.itemEl)})}_attachToControl(){this.listBox.formatItem.addHandler(this._fmtItem,this);this.listBox.loadingItems.addHandler(this._destroyTemplateItems,this);this.ownerControl.invalidate()}_detachFromControl(){this.listBox.formatItem.removeHandler(this._fmtItem,this);this._destroyTemplateItems()}_fmtItem(e,t){const n=t.item,o={control:e,item:t.data,itemIndex:t.index};this._templateItems.push(Object.assign({},o,{itemEl:n}));if(wjcCore.isFunction(this.wjItemTemplate)){selectiveDomUnmount(n);selectiveDomRender(this._createItemElTpl(o),n)}}_getListBox(e){return e instanceof wjcInput.ListBox?e:e.listBox}_destroyTemplateItems(){this._templateItems.forEach(e=>{selectiveDomUnmount(e.itemEl)});this._templateItems=[]}_createItemElTpl(e){return React.createElement("div",{},this.wjItemTemplate({control:e.control,item:e.item,itemIndex:e.itemIndex}))}}