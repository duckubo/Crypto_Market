/*!
    *
    * Wijmo Library 5.20242.21
    * https://developer.mescius.com/wijmo
    *
    * Copyright(c) MESCIUS inc. All rights reserved.
    *
    * Licensed under the End-User License Agreement For MESCIUS Wijmo Software.
    * us.sales@mescius.com
    * https://developer.mescius.com/wijmo/licensing
    *
    */

"use strict";var __importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.hasOwnProperty.call(e,i)&&(t[i]=e[i]);t.default=e;return t};Object.defineProperty(exports,"__esModule",{value:!0});const wijmo_1=require("@mescius/wijmo"),selfModule=__importStar(require("@mescius/wijmo.nav"));class TabPanel extends wijmo_1.Control{constructor(e,t,i,s){super(e,null,!0);this._tabs=new wijmo_1.ObservableArray;this._selectedIndex=-1;this._animated=!0;this._autoSwitch=!0;this.selectedIndexChanged=new wijmo_1.Event;let n=this.hostElement,l=[];if(!i)for(;n.firstElementChild;){let e=n.firstElementChild;n.removeChild(e);s||l.push(e)}let o=this.getTemplate();this.applyTemplate("wj-control wj-tabpanel wj-animated",o,{_dRoot:"root",_dTabHeaders:"tabheaders",_dTabPanes:"tabpanes"});n.tabIndex=-1;this._dRoot.tabIndex=this._dTabHeaders.tabIndex=this._dTabPanes.tabIndex=-1;t&&wijmo_1.isBoolean(t.isAnimated)&&(this.isAnimated=t.isAnimated);this.addEventListener(n,"click",this._click.bind(this));this.addEventListener(n,"keydown",this._keydown.bind(this));this._tabs.collectionChanged.addHandler(this._populateControl.bind(this));this.tabs.deferUpdate(()=>{l.forEach(e=>{wijmo_1.assert(2==e.childElementCount,"TabPanel children should contain header and pane elements");this.tabs.push(new Tab(e.children[0],e.children[1]))})});this.initialize(t);this.selectedIndex<0&&this.tabs.length?this.selectedIndex=0:this.onSelectedIndexChanged()}get tabs(){return this._tabs}get selectedIndex(){return this._selectedIndex}set selectedIndex(e){if((e=wijmo_1.asInt(e,!1))!=this._selectedIndex){this._selectedIndex=e;this._updateContent();this.onSelectedIndexChanged()}else"Angular2"==this.workingAs&&this._updateContent()}get selectedTab(){let e=this._selectedIndex;return e>-1?this._tabs[e]:null}set selectedTab(e){let t=-1;for(let i=0;i<this._tabs.length&&t<0;i++)this._tabs[i]==e&&(t=i);this.selectedIndex=t}get isAnimated(){return this._animated}set isAnimated(e){this._animated=wijmo_1.asBoolean(e);wijmo_1.toggleClass(this.hostElement,"wj-animated",this._animated)}get autoSwitch(){return this._autoSwitch}set autoSwitch(e){if(e!=this._autoSwitch){this._autoSwitch=wijmo_1.asBoolean(e);this._updateContent()}}getTab(e){for(let t=0;t<this._tabs.length;t++){let i=this._tabs[t];if(i.header.id==e||i.pane.id==e)return i}for(let t=0;t<this._tabs.length;t++){let i=this._tabs[t];if(i.header.textContent==e)return i}return null}onSelectedIndexChanged(e){this.selectedIndexChanged.raise(this,e)}_populateControl(){this._removeChildren(this._dTabHeaders);this._removeChildren(this._dTabPanes);let e=-1;this._tabs.forEach((t,i)=>{wijmo_1.assert(t instanceof Tab,"tabs array must contain Tab objects.");t._setPanel(this);let s=t.header;wijmo_1.addClass(s,"wj-tabheader");wijmo_1.setAttribute(s,"role","tab");this._dTabHeaders.appendChild(s);let n=t.pane;wijmo_1.addClass(n,"wj-tabpane");wijmo_1.setAttribute(n,"role","tabpanel");wijmo_1.setAttribute(n,"aria-labelledby",s.id?s.id:null);this._dTabPanes.appendChild(n);e<0&&(wijmo_1.hasClass(s,"wj-state-active")||"true"==s.getAttribute("aria-selected"))&&(e=i)});e<0&&this._tabs.length>0&&(e=0);e>-1?this.selectedIndex=e:this.selectedIndex>-1&&this.selectedIndex<this._tabs.length&&this._updateContent();this._validateSelection()}_validateSelection(){let e=this.selectedTab;if(e&&(e.isDisabled||!e.isVisible)){let e=this._getNextIndex(this.selectedIndex,1);e<0&&(e=this._getNextIndex(this.selectedIndex,-1));this.selectedIndex=e}}_updateContent(){let e=wijmo_1.contains(this._dTabHeaders,wijmo_1.getActiveElement()),t=this._dTabHeaders.children,i=this._dTabPanes.children,s=this._selectedIndex;if(s>-1&&s<i.length){let e=i[s],t=e.style;if(this.isAnimated){this._eAnim&&(this._eAnim.style.opacity="");this._toAnim&&clearInterval(this._toAnim);t.opacity="0";this._eAnim=e;this._toAnim=wijmo_1.animate(e=>{if(1==e){this._eAnim=null;this._toAnim=null;t.opacity=""}else t.opacity=e.toString()})}else t.opacity=""}for(let n=0;n<t.length;n++){let l=n==s,o=t[n];wijmo_1.setAttribute(o,"aria-selected",l);wijmo_1.toggleClass(o,"wj-state-active",l);let a=i[n];wijmo_1.toggleClass(a,"wj-state-active",l);o.tabIndex=l||!this._autoSwitch?this._orgTabIndex:-1;if(l){e&&o.focus();this._szObserver||wijmo_1.Control.invalidateAll(a)}}}_removeChildren(e){for(;e.firstChild;)e.removeChild(e.firstChild)}_click(e){let t=this._getTabIndex(e.target);if(t>-1){let e=this._tabs[t];!e.isDisabled&&e.isVisible&&(this.selectedIndex=t)}}_keydown(e){if(!e.defaultPrevented){let t=this._getTabIndex(wijmo_1.getActiveElement());if(t>-1){let i=this._getKeyCode(e);switch(i){case wijmo_1.Key.Left:case wijmo_1.Key.Up:case wijmo_1.Key.Right:case wijmo_1.Key.Down:case wijmo_1.Key.Home:case wijmo_1.Key.PageUp:case wijmo_1.Key.End:case wijmo_1.Key.PageDown:switch(i){case wijmo_1.Key.Left:case wijmo_1.Key.Up:t=this._getNextIndex(t,-1);break;case wijmo_1.Key.Right:case wijmo_1.Key.Down:t=this._getNextIndex(t,1);break;case wijmo_1.Key.Home:case wijmo_1.Key.PageUp:t=this._getNextIndex(-1,1);break;case wijmo_1.Key.End:case wijmo_1.Key.PageDown:t=this._getNextIndex(this._tabs.length,-1)}t>-1&&(this._autoSwitch?this.selectedIndex=t:this._tabs[t].header.focus());e.preventDefault();break;case wijmo_1.Key.Enter:case wijmo_1.Key.Space:if(t>-1){this._tabs[t].header.click()}e.preventDefault()}}}}_getTabIndex(e){let t=wijmo_1.closest(e,".wj-tabheader");if(t&&wijmo_1.closest(t,".wj-tabpanel")==this.hostElement)for(let e=0;e<this._tabs.length;e++)if(this._tabs[e].header==t)return e;return-1}_getNextIndex(e,t){for(let i=e+t;i>-1&&i<this._tabs.length;i+=t){let e=this._tabs[i];if(!e.isDisabled&&e.isVisible)return i}return-1}_setIsDisabled(e){super._setIsDisabled(e);this._updateTabIndex()}_setTabOrder(e){super._setTabOrder(e);this.isDisabled||this._updateTabIndex()}_updateTabIndex(){let e=this._dTabHeaders.children,t=this._selectedIndex;if(t>-1&&t<e.length){e[t].tabIndex=this.isDisabled?-1:this._orgTabIndex}this.hostElement.tabIndex=-1}}TabPanel.controlTemplate='<div wj-part="root"><div wj-part="tabheaders" class="wj-tabheaders" role="tablist"></div><div wj-part="tabpanes" class="wj-tabpanes"></div></div>';exports.TabPanel=TabPanel;class Tab{constructor(e,t){this._hdr=wijmo_1.asType(wijmo_1.getElement(e),HTMLElement);this._pane=wijmo_1.asType(wijmo_1.getElement(t),HTMLElement)}get tabPanel(){return this._p}get header(){return this._hdr}get pane(){return this._pane}get isDisabled(){return wijmo_1.hasClass(this._hdr,"wj-state-disabled")}set isDisabled(e){wijmo_1.toggleClass(this._hdr,"wj-state-disabled",wijmo_1.asBoolean(e));this._p&&this._p._validateSelection()}get isVisible(){return"none"!=this._hdr.style.display}set isVisible(e){this._hdr.style.display=wijmo_1.asBoolean(e)?"":"none";this._p&&this._p._validateSelection()}_setParts(e,t){e=wijmo_1.asType(wijmo_1.getElement(e),HTMLElement);t=wijmo_1.asType(wijmo_1.getElement(t),HTMLElement,!1);if(this._hdr!==e||this._pane!==t){let i=this.isDisabled,s=this.isVisible;this._hdr=e;this._pane=t;this.isDisabled=i;this.isVisible=s;let n=this.tabPanel;n&&!n.tabs.isUpdating&&n._populateControl()}}_setPanel(e){this._p=e}}exports.Tab=Tab;const _CLS_ACTIVE="wj-state-active";class Accordion extends wijmo_1.Control{constructor(e,t,i){super(e,null,!0);this._panes=new wijmo_1.ObservableArray;this._selectedIndex=-1;this._animated=!0;this._autoSwitch=!0;this._alCollapseAll=!1;this._alExpandMany=!1;this._autoSwitching=!1;this.selectedIndexChanged=new wijmo_1.Event;let s=this.hostElement,n=this._panes,l=[];if(!i)for(;s.firstElementChild;){let e=s.firstElementChild;s.removeChild(e);l.push(e)}wijmo_1.addClass(s,"wj-control wj-accordion wj-show-icons");s.tabIndex=-1;this.addEventListener(s,"click",this._click.bind(this));this.addEventListener(s,"keydown",this._keydown.bind(this));n.collectionChanged.addHandler(this._populateControl.bind(this));n.deferUpdate(()=>{l.forEach(e=>{wijmo_1.assert(2==e.childElementCount,"Accordion children should contain header and pane elements");n.push(new AccordionPane(e.children[0],e.children[1]))})});this.initialize(t);let o=t?t.selectedIndex:null;this.selectedIndex!=o&&this.selectedIndex<0&&n.length?this.selectedIndex=0:this.onSelectedIndexChanged()}get panes(){return this._panes}get selectedIndex(){return this._selectedIndex}set selectedIndex(e){if((e=wijmo_1.asInt(e,!1))!=this._selectedIndex){this._selectedIndex=e;this._updateContent();this.onSelectedIndexChanged()}else this._updateContent()}get selectedPane(){let e=this._selectedIndex;return e>-1?this._panes[e]:null}set selectedPane(e){this.selectedIndex=this._getIndexOfPane(e)}get isAnimated(){return this._animated}set isAnimated(e){this._animated=wijmo_1.asBoolean(e)}get showIcons(){return wijmo_1.hasClass(this.hostElement,"wj-show-icons")}set showIcons(e){wijmo_1.toggleClass(this.hostElement,"wj-show-icons",wijmo_1.asBoolean(e))}get autoSwitch(){return this._autoSwitch}set autoSwitch(e){if(e!=this._autoSwitch){this._autoSwitch=wijmo_1.asBoolean(e);this._updateContent()}}get allowCollapseAll(){return this._alCollapseAll}set allowCollapseAll(e){this._alCollapseAll=wijmo_1.asBoolean(e)}get allowExpandMany(){return this._alExpandMany}set allowExpandMany(e){if(e!=this._alExpandMany){this._alExpandMany=e=wijmo_1.asBoolean(e);e||this.panes.forEach((e,t)=>{let i=t==this.selectedIndex;wijmo_1.toggleClass(e.header,"wj-state-active",i);wijmo_1.setAttribute(e.header,"aria-expanded",i)})}}getPane(e){for(let t=0;t<this._panes.length;t++){let i=this._panes[t];if(i.header.id==e||i.content.id==e)return i}for(let t=0;t<this._panes.length;t++){let i=this._panes[t];if(i.header.textContent==e)return i}return null}onSelectedIndexChanged(e){this.selectedIndexChanged.raise(this,e)}_populateControl(){let e=-1,t=this.hostElement;this._panes.forEach((i,s)=>{wijmo_1.assert(i instanceof AccordionPane,"panes array must contain AccordionPane objects.");i._setAccordion(this);let n=i.header;wijmo_1.addClass(n,"wj-header");wijmo_1.setAttribute(n,"role","button");t.appendChild(n);let l=i.content;wijmo_1.addClass(l,"wj-content");wijmo_1.setAttribute(l,"role","region");wijmo_1.setAttribute(l,"aria-labelledby",n.id?n.id:null);t.appendChild(l);e<0&&(wijmo_1.hasClass(n,_CLS_ACTIVE)||"true"==n.getAttribute("aria-expanded"))&&(e=s)});e>-1?this.selectedIndex=e:this.selectedIndex>-1&&this.selectedIndex<this._panes.length&&this._updateContent();this._validateSelection()}_validateSelection(){let e=this.selectedPane;if(e&&(e.isDisabled||!e.isVisible)){let e=this._getNextIndex(this.selectedIndex,1);e<0&&(e=this._getNextIndex(this.selectedIndex,-1));this.selectedIndex=e}}_updateContent(){let e=wijmo_1.contains(this.hostElement,wijmo_1.getActiveElement()),t=this._selectedIndex,i=this._panes,s=[];i.forEach((i,n)=>{let l=i.header,o=n==t,a=wijmo_1.hasClass(l,_CLS_ACTIVE),r=o||a&&this._alExpandMany&&i!=this._hidePane,h=r&&!a,d=a&&!r;this._animated&&(h||d)&&s.push({show:h,pane:i});wijmo_1.setAttribute(l,"aria-expanded",r);this._animated||wijmo_1.toggleClass(l,_CLS_ACTIVE,r);if(o){e&&l.focus();this._szObserver||wijmo_1.Control.invalidateAll(i.content)}});this._updatePanesTabIndex();if(this._animated&&s.length){s.forEach(e=>{wijmo_1.toggleClass(e.pane.header,_CLS_ACTIVE,!0);e.height=e.pane.content.offsetHeight;e.show&&(e.pane.content.style.height="0")});wijmo_1.animate(e=>{e<1?s.forEach(t=>{let i=t.height*(t.show?e:1-e);t.pane.content.style.height=i.toFixed(0)+"px"}):s.forEach(e=>{e.pane.content.style.height="";wijmo_1.toggleClass(e.pane.header,_CLS_ACTIVE,e.show)})})}this._hidePane=null}_updatePanesTabIndex(){this._panes.forEach((e,t)=>{e.header.tabIndex=this._selectedIndex!==t&&this._autoSwitch?-1:this._orgTabIndex})}_setTabOrder(e){super._setTabOrder(e);this._updatePanesTabIndex()}_click(e){let t=this._getPaneIndex(e.target);if(t>-1){let e=this._panes[t];if(!e.isDisabled&&e.isVisible){if(!wijmo_1.hasClass(e.header,_CLS_ACTIVE)||this._autoSwitching)this.selectedIndex=t;else{const i=this._getNextActiveIndex(t);if(i>-1||this._alCollapseAll){this._hidePane=e;this.selectedIndex=i}}}}}_keydown(e){if(!e.defaultPrevented){let t=this._getPaneIndex(wijmo_1.getActiveElement());if(t>-1){let i=this._getKeyCode(e);switch(i){case wijmo_1.Key.Left:case wijmo_1.Key.Up:case wijmo_1.Key.Right:case wijmo_1.Key.Down:case wijmo_1.Key.Home:case wijmo_1.Key.PageUp:case wijmo_1.Key.End:case wijmo_1.Key.PageDown:switch(i){case wijmo_1.Key.Left:case wijmo_1.Key.Up:t=this._getNextIndex(t,-1);break;case wijmo_1.Key.Right:case wijmo_1.Key.Down:t=this._getNextIndex(t,1);break;case wijmo_1.Key.Home:case wijmo_1.Key.PageUp:t=this._getNextIndex(-1,1);break;case wijmo_1.Key.End:case wijmo_1.Key.PageDown:t=this._getNextIndex(this._panes.length,-1)}if(t>-1){let e=this._panes[t];if(this._autoSwitch){this._autoSwitching=!0;e.header.click();this._autoSwitching=!1}else e.header.focus()}e.preventDefault();break;case wijmo_1.Key.Enter:case wijmo_1.Key.Space:if(t>-1){this._panes[t].header.click()}e.preventDefault()}}}}_getPaneIndex(e){let t=wijmo_1.closest(e,".wj-header");if(t&&wijmo_1.closest(t,".wj-accordion")==this.hostElement)for(let e=0;e<this._panes.length;e++)if(this._panes[e].header==t)return e;return-1}_getNextIndex(e,t){for(let i=e+t;i>-1&&i<this._panes.length;i+=t){let e=this._panes[i];if(!e.isDisabled&&e.isVisible)return i}return-1}_getIndexOfPane(e){let t=-1;const i=this._panes;for(let s=0;s<i.length&&t<0;s++)i[s]==e&&(t=s);return t}_getNextActiveIndex(e){let t=-1;const i=this.panes;for(let s=1;s<i.length;s++){let n=(e+s)%i.length,l=i[n];if(wijmo_1.hasClass(l.header,_CLS_ACTIVE)){t=n;break}}return t}_togglePane(e,t){if(e.isCollapsed!==t&&e.isVisible&&!e.isDisabled)if(t){if(this.allowCollapseAll||this.panes.filter(e=>!e.isCollapsed).length>1){this._hidePane=e;const t=this._getIndexOfPane(e);this.selectedIndex=this._getNextActiveIndex(t)}}else this.selectedPane=e}}exports.Accordion=Accordion;class AccordionPane{constructor(e,t){this._hdr=wijmo_1.asType(wijmo_1.getElement(e),HTMLElement);this._content=wijmo_1.asType(wijmo_1.getElement(t),HTMLElement)}get accordion(){return this._acc}get header(){return this._hdr}get content(){return this._content}get isDisabled(){return wijmo_1.hasClass(this._hdr,"wj-state-disabled")}set isDisabled(e){wijmo_1.toggleClass(this._hdr,"wj-state-disabled",wijmo_1.asBoolean(e));this._acc&&this._acc._validateSelection()}get isVisible(){return"none"!=this._hdr.style.display}set isVisible(e){this._hdr.style.display=wijmo_1.asBoolean(e)?"":"none";this._acc&&this._acc._validateSelection()}get isCollapsed(){return!wijmo_1.hasClass(this._hdr,_CLS_ACTIVE)}set isCollapsed(e){const t=this._acc;t?t._togglePane(this,e):wijmo_1.toggleClass(this._hdr,_CLS_ACTIVE,!wijmo_1.asBoolean(e))}_setParts(e,t){e=wijmo_1.asType(wijmo_1.getElement(e),HTMLElement);t=wijmo_1.asType(wijmo_1.getElement(t),HTMLElement,!1);if(this._hdr!==e||this._content!==t){let i=this.isDisabled,s=this.isVisible;this._hdr=e;this._content=t;this.isDisabled=i;this.isVisible=s;let n=this.accordion;n&&!n.panes.isUpdating&&n._populateControl()}}_setAccordion(e){this._acc=e}}exports.AccordionPane=AccordionPane;class FormatNodeEventArgs extends wijmo_1.EventArgs{constructor(e,t,i){super();this._data=e;this._e=wijmo_1.asType(t,HTMLElement);this._level=i}get dataItem(){return this._data}get element(){return this._e}get level(){return this._level}}exports.FormatNodeEventArgs=FormatNodeEventArgs;class TreeNodeEventArgs extends wijmo_1.CancelEventArgs{constructor(e){super();this._node=e}get node(){return this._node}}exports.TreeNodeEventArgs=TreeNodeEventArgs;class TreeNodeDragDropEventArgs extends wijmo_1.CancelEventArgs{constructor(e,t,i){super();this._src=wijmo_1.asType(e,TreeNode);this._tgt=wijmo_1.asType(t,TreeNode);this._pos=i}get dragSource(){return this._src}get dropTarget(){return this._tgt}get position(){return this._pos}set position(e){this._pos=wijmo_1.asEnum(e,DropPosition)}}exports.TreeNodeDragDropEventArgs=TreeNodeDragDropEventArgs;var DropPosition;!function(e){e[e.Before=0]="Before";e[e.After=1]="After";e[e.Into=2]="Into"}(DropPosition=exports.DropPosition||(exports.DropPosition={}));class TreeNode{constructor(e,t){if(wijmo_1.hasClass(t,"wj-treeview")){e=wijmo_1.Control.getControl(t);t=null}else TreeNode._assertNode(t);if(t&&t[TreeNode.CacheKey]&&t[TreeNode.CacheKey]._t==e)return t[TreeNode.CacheKey];t&&(t[TreeNode.CacheKey]=this);this._t=e;this._e=t}get dataItem(){return this._e[TreeView._DATAITEM_KEY]}get element(){return this._e}get treeView(){return this._t}ensureVisible(){for(let e=this.parentNode;e;e=e.parentNode)e.isCollapsed=!1;let e=this._t.hostElement,t=this.element.getBoundingClientRect(),i=e.getBoundingClientRect();t.bottom>i.bottom?e.scrollTop+=t.bottom-i.bottom:t.top<i.top&&(e.scrollTop-=i.top-t.top)}equals(e){return null!=e&&e.element==this.element}get isSelected(){let e=this._t;return e.selectedNode==this||e.selectedNodes.includes(this)}select(e=!1){let t=this._t,i=t._selNode;if(!this.equals(i)){if(i){wijmo_1.removeClass(i.element,TreeView._CSEL);wijmo_1.setAttribute(i.element,"aria-selected",!1)}t._selNode=this;wijmo_1.addClass(this.element,TreeView._CSEL);wijmo_1.setAttribute(this.element,"aria-selected",!0);this.ensureVisible();if(t.allowMultiSelect&&!t.selectedNodes.includes(this))t.selectedNodes.push(this);else if(!t.selectedNodes.includes(this)){t.selectedNodes.beginUpdate();t.selectedNodes.clear();t.selectedNodes.push(this);t.selectedNodes.endUpdate(!0)}t._updateFocus(i);e||t.onSelectedItemChanged()}}deSelect(e=!1){if(!this.isSelected)return;let t=this._t;wijmo_1.removeClass(this.element,TreeView._CSEL);wijmo_1.setAttribute(this.element,"aria-selected",!1);t.selectedNodes.remove(this);t.selectedNode==this?e?t._selNode=null:t.selectedNode=null:e||t.onSelectedItemChanged()}get index(){let e=0;for(let t=this._pse(this.element);t;t=this._pse(t))TreeNode._isNode(t)&&e++;return e}get parentNode(){let e=null;if(this._e){let t=this._e.parentElement;TreeNode._assertNodeList(t);e=this._pse(t)}return e?new TreeNode(this._t,e):null}get level(){let e=-1;for(let t=this;t;t=t.parentNode)e++;return e}get hasChildren(){return TreeNode._isNode(this._e)&&!TreeNode._isEmpty(this._e)}get hasPendingChildren(){return this.isCollapsed&&this.hasChildren&&!TreeNode._isNodeList(this.element.nextElementSibling)&&wijmo_1.isFunction(this._t.lazyLoadFunction)}get nodes(){return this.hasChildren?TreeNode._getChildNodes(this._t,this._e.nextSibling):null}get checkBox(){return this._e.querySelector("input."+TreeView._CNDC)}get isCollapsed(){return this.hasChildren&&wijmo_1.hasClass(this._e,TreeView._CCLD)}set isCollapsed(e){if(e!=this.isCollapsed){let t=this._t,i=new TreeNodeEventArgs(this);if(t.onIsCollapsedChanging(i)){this.setCollapsed(wijmo_1.asBoolean(e),t.isAnimated,t.autoCollapse);t.onIsCollapsedChanged(i)}}}get isChecked(){let e=this.checkBox;return e&&!e.indeterminate?e.checked:null}set isChecked(e){if(e!=this.isChecked){let t=this._t,i=new TreeNodeEventArgs(this);if(t.onIsCheckedChanging(i)){this.setChecked(wijmo_1.asBoolean(e),!0);t.onIsCheckedChanged(i)}}}get isDisabled(){return this._e&&null!=this._e.getAttribute("disabled")}set isDisabled(e){if((e=wijmo_1.asBoolean(e,!0))!=this.isDisabled){wijmo_1.enable(this._e,!e);this.isDisabled&&this._t&&this._t.collapseWhenDisabled&&(this.isCollapsed=!0)}}previous(e,t){let i=this._pse(this._e);!i&&TreeNode._isNodeList(this._e.parentElement)&&(i=this._pse(this._e.parentElement));if(TreeNode._isNodeList(i)){for(;TreeNode._isNodeList(i)&&i.childElementCount;)i=i.lastChild;TreeNode._isNodeList(i)&&(i=this._pse(i))}let s=TreeNode._isNode(i)?new TreeNode(this._t,i):null;e&&s&&!s.element.offsetHeight&&(s=s.previous(e,t));t&&s&&s.isDisabled&&(s=s.previous(e,t));return s}next(e,t){let i=this._e.nextSibling;TreeNode._isNodeList(i)&&(i=i.childElementCount?i.firstChild:i.nextSibling);if(!i)for(let e=this._e.parentElement;!i&&TreeNode._isNodeList(e);e=e.parentElement)i=e.nextSibling;let s=TreeNode._isNode(i)?new TreeNode(this._t,i):null;e&&s&&!s.element.offsetHeight&&(s=s.next(e,t));t&&s&&s.isDisabled&&(s=s.next(e,t));return s}previousSibling(){let e=this._pse(this.element);for(;TreeNode._isNodeList(e);)e=this._pse(e);return e?new TreeNode(this._t,e):null}nextSibling(){let e=this.element.nextSibling;TreeNode._isNodeList(e)&&(e=e.nextSibling);return e?new TreeNode(this._t,e):null}setCollapsed(e,t,i){let s=this._t,n=this._e,l=this._e.nextElementSibling,o=TreeNode._isNodeList(l);wijmo_1.setAttribute(n,"aria-expanded",o?(!e).toString():null);if(e!=this.isCollapsed)if(e||o||!wijmo_1.isFunction(s.lazyLoadFunction)){null==t&&(t=s.isAnimated);null==i&&(i=s.autoCollapse);if(t){if(o){let t=l.offsetHeight,i=l.style,o=s.hostElement,a=o.style;o.scrollHeight<=o.clientHeight&&(a.overflowY="hidden");if(e){wijmo_1.toggleClass(n,TreeView._CCLG,!0);wijmo_1.animate(e=>{if(e<1){e=1-e;i.height=(e*t).toFixed(0)+"px"}else{i.height=i.opacity=a.overflowY="";wijmo_1.toggleClass(n,TreeView._CCLD,!0);wijmo_1.toggleClass(n,TreeView._CCLG,!1)}},TreeView._AN_DLY)}else{wijmo_1.toggleClass(n,TreeView._CCLD,!1);i.height=i.opacity="0";wijmo_1.animate(e=>{i.height=e>=1?i.opacity=a.overflowY="":(e*t).toFixed(0)+"px"},TreeView._AN_DLY)}}}else wijmo_1.toggleClass(n,TreeView._CCLD,e);if(!e&&i){let e=n.parentElement;if(TreeNode._isNodeList(e))for(let t=0;t<e.children.length;t++){let i=e.children[t];if(i!=n&&TreeNode._isNode(i)){wijmo_1.toggleClass(i,TreeView._CCLD,!0);i.setAttribute("aria-expanded","false")}}}}else s._lazyLoadNode(this)}setChecked(e,t){let i=this.checkBox,s=i.checked!=e;wijmo_1.setChecked(i,e);if(this.hasChildren)for(var n=0;n<this.nodes.length;n++)this.nodes[n].setChecked(e,!1);let l=this._t;l&&l.checkedMemberPath&&l._chkPath.setValue(this.dataItem,this.level,e);if(t){let e=this.parentNode;e&&e._updateCheckedState()}l&&s&&l._raiseCheckedItemsChanged()}remove(){let e=this._t,t=this.parentNode,i=this._getArray(),s=i.indexOf(this.dataItem);e.selectedNode==this&&(e.selectedNode=this.nextSibling()||this.previousSibling()||t);let n=this.element.nextSibling;TreeNode._isNodeList(n)&&wijmo_1.removeChild(n);wijmo_1.removeChild(this.element);t&&t._updateState();i.splice(s,1);this._t=null}addChildNode(e,t){let i=this._t._createNode(t),s=this.nodes;s?e<s.length?i.move(s[e],DropPosition.Before):i.move(s[s.length-1],DropPosition.After):i.move(this,DropPosition.Into);return i}refresh(e){let t=this._getArray();e&&(t[this.index]=e);e=t[this.index];let i=this._t._createNode(e),s=this.hasChildren&&!this.hasPendingChildren?this.element.nextSibling:null;s&&wijmo_1.removeChild(s);(s=i.hasChildren&&!i.hasPendingChildren?i.element.nextSibling:null)&&this.element.parentElement.insertBefore(s,this.element.nextSibling);this.element.innerHTML=i.element.innerHTML;this._updateState()}move(e,t){if(e instanceof TreeNode&&this._contains(e))return!1;let i=this.parentNode,s=this._getArray();this._moveElements(e,t);e.treeView&&(this._t=e.treeView);i&&i._updateState();let n=this.parentNode;n&&n._updateState();let l=this.dataItem,o=s.indexOf(l),a=this._getArray();s.splice(o,1);a.splice(this.index,0,l);return!0}get itemsSource(){return this._getArray()}_pse(e){return e.previousElementSibling}_contains(e){for(;e;e=e.parentNode)if(e.element==this.element)return!0;return!1}_getArray(){let e=this._t,t=this.parentNode,i=e.itemsSource;if(t){let s=e._itmPath;if(!(i=s.getValue(t.dataItem,this.level))){i=[];s.setValue(t.dataItem,this.level,i)}}return i}_moveElements(e,t){let i=document.createDocumentFragment(),s=this.hasChildren&&!this.hasPendingChildren?this.element.nextSibling:null;i.appendChild(this.element);if(s){TreeNode._assertNodeList(s);i.appendChild(s)}if(e instanceof TreeView){e._root.insertBefore(i,null);return}let n=e.element,l=n?n.parentElement:e.treeView._root;TreeNode._assertNodeList(l);let o=DropPosition;switch(t){case o.Before:l.insertBefore(i,n);break;case o.After:n=(e=e.nextSibling())?e.element:null;l.insertBefore(i,n);break;case o.Into:if(!e.hasChildren||e.hasPendingChildren){s=document.createElement("div");wijmo_1.addClass(s,TreeView._CNDL);l.insertBefore(s,n.nextSibling)}l=e.element.nextSibling;TreeNode._assertNodeList(l);l.insertBefore(i,null)}}_updateState(){this._updateEmptyState();this._updateCheckedState()}_updateEmptyState(){let e=this.element.nextSibling,t=!1;TreeNode._isNodeList(e)&&(e.childElementCount?t=!0:wijmo_1.removeChild(e));wijmo_1.toggleClass(this.element,TreeView._CEMP,!t);t||this.element.removeAttribute("aria-expanded")}_updateCheckedState(){let e=this._t,t=this.checkBox,i=this.nodes,s=0,n=0,l=!1;if(t&&i){for(let e=0;e<i.length&&!l;e++){switch(i[e].isChecked){case!0:s++;break;case!1:n++;break;case null:l=!0}s&&n&&(l=!0)}wijmo_1.setChecked(t,l?null:s>0);if(e&&e.checkedMemberPath){let i=l?null:t.checked;e._chkPath.setValue(this.dataItem,this.level,i)}}let o=this.parentNode;o&&o._updateCheckedState()}static _getChildNodes(e,t){let i=[];if(TreeNode._isNodeList(t)){let s=t.children;for(let t=0;t<s.length;t++){let n=s[t];TreeNode._isNode(n)&&i.push(new TreeNode(e,n))}}return i}static _isNode(e){return e&&wijmo_1.hasClass(e,TreeView._CND)}static _isNodeList(e){return e&&wijmo_1.hasClass(e,TreeView._CNDL)}static _isEmpty(e){return TreeNode._isNode(e)&&wijmo_1.hasClass(e,TreeView._CEMP)}static _isCollapsed(e){return TreeNode._isNode(e)&&!TreeNode._isEmpty(e)&&wijmo_1.hasClass(e,TreeView._CCLD)}static _assertNode(e){wijmo_1.assert(TreeNode._isNode(e),"node expected")}static _assertNodeList(e){wijmo_1.assert(TreeNode._isNodeList(e),"nodeList expected")}}TreeNode.CacheKey="$_WJ_TV_NODE";exports.TreeNode=TreeNode;class _BindingArray{constructor(e){this.path=e}get path(){return this._path}set path(e){this._path=e;if(wijmo_1.isString(e))this._bindings=[new wijmo_1.Binding(e)];else if(wijmo_1.isArray(e)){this._bindings=[];for(let t=0;t<e.length;t++)this._bindings.push(new wijmo_1.Binding(e[t]))}else null!=e&&wijmo_1.assert(!1,"Path should be a string or an array of strings.");this._maxLevel=this._bindings?this._bindings.length-1:-1}getValue(e,t){let i=Math.min(t,this._maxLevel);return i>-1?this._bindings[i].getValue(e):null}setValue(e,t,i){let s=Math.min(t,this._maxLevel);s>-1&&this._bindings[s].setValue(e,i)}}exports._BindingArray=_BindingArray;class TreeView extends wijmo_1.Control{constructor(e,t={}){super(e);this._selNodes=new wijmo_1.ObservableArray;this._itmPath=new _BindingArray("items");this._chkPath=new _BindingArray;this._dspPath=new _BindingArray("header");this._imgPath=new _BindingArray;this._html=!1;this._animated=!0;this._chkOnClick=!1;this._collOnClick=!1;this._xpndOnClick=!0;this._xpndOnLoad=!0;this._autoColl=!0;this._showChk=!1;this._collapseWhenDisabled=!0;this._srch="";this._isReadOnly=!0;this._preserveSelNode=!1;this._allowMultiSelect=!1;this.itemsSourceChanged=new wijmo_1.Event;this.loadingItems=new wijmo_1.Event;this.loadedItems=new wijmo_1.Event;this.itemClicked=new wijmo_1.Event;this.selectedItemChanged=new wijmo_1.Event;this.checkedItemsChanged=new wijmo_1.Event;this.isCollapsedChanging=new wijmo_1.Event;this.isCollapsedChanged=new wijmo_1.Event;this.isCheckedChanging=new wijmo_1.Event;this.isCheckedChanged=new wijmo_1.Event;this.formatItem=new wijmo_1.Event(()=>{this.invalidate()});this.dragStart=new wijmo_1.Event;this.dragOver=new wijmo_1.Event;this.drop=new wijmo_1.Event;this.dragEnd=new wijmo_1.Event;this.nodeEditStarting=new wijmo_1.Event;this.nodeEditStarted=new wijmo_1.Event;this.nodeEditEnding=new wijmo_1.Event;this.nodeEditEnded=new wijmo_1.Event;this.options=t;let i=this.getTemplate();this.applyTemplate("wj-control wj-content wj-treeview",i,{_root:"root"});let s=this.hostElement;wijmo_1.setAttribute(s,"role","tree",!0);wijmo_1.addClass(this._root,TreeView._CNDL);wijmo_1.setAttribute(this._root,"role","group",!0);this.addEventListener(s,"mousedown",this._mousedown.bind(this));this.addEventListener(s,"click",this._click.bind(this));this.addEventListener(s,"keydown",this._keydown.bind(this));this.addEventListener(s,"keypress",this._keypress.bind(this));this.addEventListener(s,"wheel",e=>{s.scrollHeight>s.offsetHeight&&(e.deltaY<0&&0==s.scrollTop||e.deltaY>0&&s.scrollTop+s.offsetHeight>=s.scrollHeight)&&e.preventDefault()});this.addEventListener(s,"blur",()=>{this._edtNode&&!wijmo_1.contains(this._edtNode.element,wijmo_1.getActiveElement())&&this.finishEditing()},!0);this.addEventListener(s,"paste",e=>{if(this._edtNode&&!this.isContentHtml){let t=(e.clipboardData||window.clipboardData).getData("text"),i=window.getSelection();if(t&&i.rangeCount){i.deleteFromDocument();i.getRangeAt(0).insertNode(document.createTextNode(t));e.preventDefault()}}});this._selNodes.collectionChanged.addHandler((e,t)=>{switch(t.action){case wijmo_1.NotifyCollectionChangedAction.Add:wijmo_1.addClass(t.item.element,TreeView._CMSEL);break;case wijmo_1.NotifyCollectionChangedAction.Remove:wijmo_1.removeClass(t.item.element,TreeView._CMSEL);break;case wijmo_1.NotifyCollectionChangedAction.Change:wijmo_1.addClass(t.item.element,TreeView._CMSEL);break;case wijmo_1.NotifyCollectionChangedAction.Reset:this.hostElement.querySelectorAll("."+TreeView._CMSEL).forEach(e=>wijmo_1.removeClass(e,TreeView._CMSEL))}});this.initialize(t);this.refresh()}get itemsSource(){return this._items}set itemsSource(e){if(this._items!=e){this._items=wijmo_1.asArray(e);this.onItemsSourceChanged();this._srcChanged=!0;this._reload()}}get childItemsPath(){return this._itmPath.path}set childItemsPath(e){if(e!=this.childItemsPath){this._itmPath.path=e;this._reload()}}get displayMemberPath(){return this._dspPath.path}set displayMemberPath(e){if(e!=this.displayMemberPath){this._dspPath.path=e;this._reload()}}get imageMemberPath(){return this._imgPath.path}set imageMemberPath(e){if(e!=this.imageMemberPath){this._imgPath.path=e;this._reload()}}get checkedMemberPath(){return this._chkPath.path}set checkedMemberPath(e){if(e!=this.checkedMemberPath){this._chkPath.path=e;this._reload()}}get isContentHtml(){return this._html}set isContentHtml(e){if(e!=this._html){this._html=wijmo_1.asBoolean(e);this._reload()}}get showCheckboxes(){return this._showChk}set showCheckboxes(e){if(e!=this._showChk){this._showChk=wijmo_1.asBoolean(e);this._reload()}}get autoCollapse(){return this._autoColl}set autoCollapse(e){this._autoColl=wijmo_1.asBoolean(e)}get collapseWhenDisabled(){return this._collapseWhenDisabled}set collapseWhenDisabled(e){this._collapseWhenDisabled=wijmo_1.asBoolean(e)}get isAnimated(){return this._animated}set isAnimated(e){this._animated=wijmo_1.asBoolean(e);wijmo_1.toggleClass(this.hostElement,"wj-animated",this._animated)}get isReadOnly(){return this._isReadOnly}set isReadOnly(e){this._isReadOnly=wijmo_1.asBoolean(e);wijmo_1.toggleClass(this.hostElement,"wj-state-readonly",this.isReadOnly)}startEditing(e){this._prevDragState=this.allowDragging;if(this.isReadOnly)return!1;e||(e=this.selectedNode);if(!e||e.isDisabled)return!1;if(!this.finishEditing())return!1;let t=e.element.querySelector("."+TreeView._CNDT);if(!t)return!1;let i=new TreeNodeEventArgs(e);if(!this.onNodeEditStarting(i))return!1;t.tabIndex=0;t.focus();t.contentEditable="true";t.style.cursor="auto";let s=document.createRange();s.selectNodeContents(t);let n=getSelection();n.removeAllRanges();n.addRange(s);this.allowDragging=!this.isTxtSelected(t);t.focus();wijmo_1.setAttribute(t,"autocomplete","off");wijmo_1.setAttribute(t,"autocorrect","off");this._edtNode=e;this.onNodeEditStarted(i);return!0}finishEditing(e){let t=this._edtNode;if(t){let i=t.element.querySelector("."+TreeView._CNDT);if(!i)return!1;let s=new TreeNodeEventArgs(t);if(!this.onNodeEditEnding(s))return!1;let n=t.dataItem,l=t.level;this.isContentHtml?e?i.innerHTML=this._dspPath.getValue(n,l):this._dspPath.setValue(n,l,i.innerHTML):e?i.textContent=this._dspPath.getValue(n,l):this._dspPath.setValue(n,l,i.textContent);document.createRange().selectNodeContents(i);getSelection().removeAllRanges();i.contentEditable="false";i.style.cursor="";this.allowDragging=this._prevDragState;this._edtNode=null;this.onNodeEditEnded(s)}return!0}get allowDragging(){return null!=this._dd}set allowDragging(e){if(e!=this.allowDragging){if(wijmo_1.asBoolean(e))this._dd=new _TreeDragDropManager(this);else{this._dd.dispose();this._dd=null}let t=this.hostElement.querySelectorAll("."+TreeView._CND);for(let e=0;e<t.length;e++){let i=t[e];wijmo_1.setAttribute(i,"draggable",!!this._dd||null)}}}get checkOnClick(){return this._chkOnClick}set checkOnClick(e){this._chkOnClick=wijmo_1.asBoolean(e)}get expandOnClick(){return this._xpndOnClick}set expandOnClick(e){this._xpndOnClick=wijmo_1.asBoolean(e)}get collapseOnClick(){return this._collOnClick}set collapseOnClick(e){this._collOnClick=wijmo_1.asBoolean(e)}get expandOnLoad(){return this._xpndOnLoad}set expandOnLoad(e){this._xpndOnLoad=wijmo_1.asBoolean(e)}get selectedItem(){return this._selNode?this._selNode.dataItem:null}set selectedItem(e){if(e!=this.selectedItem){this._isDirty&&this.refresh();this.selectedNode=e?this.getNode(e):null}}get selectedNode(){return this._selNode}set selectedNode(e){if(e!=this.selectedNode){this._prevSel=this._selNode;if(e)e.select();else if(this._selNode){var t=this._selNode.element;wijmo_1.removeClass(t,TreeView._CSEL);wijmo_1.setAttribute(t,"aria-selected",!1);this._selNode=null;this._updateFocus(this._prevSel);this.onSelectedItemChanged()}}}get selectedPath(){let e=[];for(let t=this.selectedNode;t;t=t.parentNode){let i=this._dspPath.getValue(t.dataItem,t.level);e.splice(0,0,i)}return e}get checkedItems(){if(null==this._chkItems){let e=TreeView,t="."+e._CND+"."+e._CEMP+" > input:checked."+e._CNDC,i=this._root.querySelectorAll(t);this._chkItems=[];for(let t=0;t<i.length;t++){let s=i[t].parentElement[e._DATAITEM_KEY];this._chkItems.push(s)}}return this._chkItems}set checkedItems(e){if(this.showCheckboxes){this._isDirty&&this.refresh();let t=TreeView,i="."+t._CND+"."+t._CEMP,s=this._root.querySelectorAll(i);for(let t=0;t<s.length;t++){let i=new TreeNode(this,s[t]),n=e.indexOf(i.dataItem)>-1;i.isChecked!=n&&(i.isChecked=n)}}}checkAllItems(e){if(this.showCheckboxes){let t=TreeView,i="."+t._CND+"."+t._CEMP,s=this._root.querySelectorAll(i);for(let t=0;t<s.length;t++){let i=new TreeNode(this,s[t]);i.isChecked!=e&&(i.isChecked=e)}}}get totalItemCount(){return this.hostElement.querySelectorAll("."+TreeView._CND).length}get lazyLoadFunction(){return this._lazyLoad}set lazyLoadFunction(e){if(e!=this._lazyLoad){this._lazyLoad=wijmo_1.asFunction(e);this._reload()}}get preserveSelectedNode(){return this._preserveSelNode}set preserveSelectedNode(e){this._preserveSelNode=wijmo_1.asBoolean(e,!1)}get selectedNodes(){return this._selNodes}get allowMultiSelect(){return this._allowMultiSelect}set allowMultiSelect(e){this._allowMultiSelect=wijmo_1.asBoolean(e,!1)}getFirstNode(e,t){let i=this.hostElement.querySelector("."+TreeView._CND),s=i?new TreeNode(this,i):null;e&&s&&!s.element.offsetHeight&&(s=s.next(e,t));t&&s&&s.isDisabled&&(s=s.next(e,t));return s}getLastNode(e,t){let i=this.hostElement.querySelectorAll("."+TreeView._CND+":last-child"),s=i.length?new TreeNode(this,i[i.length-1]):null;e&&s&&!s.element.offsetHeight&&(s=s.previous(e,t));t&&s&&s.isDisabled&&(s=s.previous(e,t));return s}get nodes(){return TreeNode._getChildNodes(this,this._root)}getNode(e){this._isDirty&&this._loadTree();let t=this.hostElement.querySelectorAll("."+TreeView._CND);for(let i=0;i<t.length;i++){let s=t[i];if(s[TreeView._DATAITEM_KEY]==e)return new TreeNode(this,s)}return null}addChildNode(e,t){let i=this._createNode(t),s=this.nodes;s?e<s.length?i.move(s[e],DropPosition.Before):i.move(s[s.length-1],DropPosition.After):i.move(this,DropPosition.Into);return i}collapseToLevel(e){let t=this._animated,i=this._autoColl;this._animated=this._autoColl=!1;this._collapseToLevel(this.nodes,e,0);this._animated=t;this._autoColl=i}loadTree(e){this._loadTree(e)}onItemsSourceChanged(e){this.itemsSourceChanged.raise(this,e)}onLoadingItems(e){this.loadingItems.raise(this,e);return!e.cancel}onLoadedItems(e){this.loadedItems.raise(this,e)}onItemClicked(e){this.itemClicked.raise(this,e)}onSelectedItemChanged(e){this.selectedItemChanged.raise(this,e)}onCheckedItemsChanged(e){this._chkItems=null;this.checkedItemsChanged.raise(this,e)}onIsCollapsedChanging(e){this.isCollapsedChanging.raise(this,e);return!e.cancel}onIsCollapsedChanged(e){this.isCollapsedChanged.raise(this,e)}onIsCheckedChanging(e){this.isCheckedChanging.raise(this,e);return!e.cancel}onIsCheckedChanged(e){this.isCheckedChanged.raise(this,e)}onFormatItem(e){this.formatItem.raise(this,e)}onDragStart(e){this.dragStart.raise(this,e);return!e.cancel}onDragOver(e){this.dragOver.raise(this,e);return!e.cancel}onDrop(e){this.drop.raise(this,e);return!e.cancel}onDragEnd(e){this.dragEnd.raise(this,e)}onNodeEditStarting(e){this.nodeEditStarting.raise(this,e);return!e.cancel}onNodeEditStarted(e){this.nodeEditStarted.raise(this,e)}onNodeEditEnding(e){this.nodeEditEnding.raise(this,e);return!e.cancel}onNodeEditEnded(e){this.nodeEditEnded.raise(this,e)}refresh(e=!0){super.refresh(e);!this.isUpdating&&this._isDirty&&this._loadTree(!0)}_updateFocus(e){this._updateTabIndex();if(this.containsFocus()){let e=this._selNode;e?e.element.focus():this.hostElement.focus()}e&&(e.element.tabIndex=-1)}_updateTabIndex(){let e=this._selNode;e&&(e.element.tabIndex=this._orgTabIndex);this.hostElement.tabIndex=e||this.isDisabled?-1:this._orgTabIndex}_setTabOrder(e){this._orgTabIndex=e;this._updateTabIndex()}_raiseCheckedItemsChanged(){this._toItemsChanged&&clearTimeout(this._toItemsChanged);this._toItemsChanged=setTimeout(()=>{this._toItemsChanged=null;this.onCheckedItemsChanged()},10)}_reload(){this._isDirty=!0;this.invalidate()}_createNode(e){const t=Object.assign({},this.options);this.formatItem&&(t.formatItem=this.formatItem.getHandler());return new TreeView(document.createElement("div"),Object.assign({},t,{expandOnLoad:this.expandOnLoad,allowDragging:this.allowDragging,lazyLoadFunction:this.lazyLoadFunction,childItemsPath:this.childItemsPath,displayMemberPath:this.displayMemberPath,imageMemberPath:this.imageMemberPath,isContentHtml:this.isContentHtml,showCheckboxes:this.showCheckboxes,itemsSource:[e]})).getFirstNode()}_getCollapseIconWidthBounds(e){const t=getComputedStyle(e,":before"),i=parseFloat(getComputedStyle(e).paddingLeft);let s=0,n=0;if("auto"!==t.width)if("none"==t.transform){s=i;n=parseFloat(t.width)+i}else{const e=parseFloat(t.height),l=(parseFloat(t.width)-e)/2;s=i+l;n=parseFloat(t.height)+i+l}else;if(this.rightToLeft){const t=n-s;s=(n=e.clientWidth-s)-t}return{left:s,right:n}}_mousedown(e){if(!e.defaultPrevented){let t=wijmo_1.closestClass(e.target,TreeView._CND),i=t?new TreeNode(this,t):null;if(i&&!i.isDisabled){const s=this._getCollapseIconWidthBounds(t),n=t==e.target&&e.offsetX>=s.left&&e.offsetX<=s.right;if(!this.preserveSelectedNode||!n)if((e.ctrlKey||e.metaKey)&&this.allowMultiSelect)i.isSelected?i.deSelect():i.select();else if(e.shiftKey&&this.allowMultiSelect){let e=this.selectedNode;e||(e=this._prevSel);if(e){const t=this._getNodesBetween(i.element,e.element),s=new Set(this.selectedNodes);for(let e=t.length-1;e>=0;e--){const i=new TreeNode(this,t[e]);s.has(i)?s.delete(i):i.select(!0)}const n=e.equals(this.selectedNode)&&s.size>0;Array.from(s).forEach(e=>e.deSelect(!0));e.select();n&&this.onSelectedItemChanged()}}else{i.isSelected?this._prevSel=i:this._clearMultiSelectedNodes();this.selectedNode=i;i.select()}}}}_getNodesBetween(e,t){let i=e,s=t;if(this._getOffsetFromRoot(i)>this._getOffsetFromRoot(t)){i=t;s=e}const n=[],l=this.hostElement.querySelectorAll("."+TreeView._CND);let o=!1;for(let e=l.length-1;e>=0;e--){const t=l[e];t==s&&(o=!0);o&&n.unshift(t);if(t==i)break}return n}_getOffsetFromRoot(e){let t=0;for(;e!=this.hostElement;){t+=e.offsetTop;e=e.parentElement}return t}_checkCollapseIconClick(e){if(e.defaultPrevented)return;let t=wijmo_1.closestClass(e.target,TreeView._CND),i=t?new TreeNode(this,t):null;if(i&&!i.isDisabled){const s=this._getCollapseIconWidthBounds(t),n=t==e.target&&e.offsetX>=s.left&&e.offsetX<=s.right;if(this.preserveSelectedNode&&n){(e.ctrlKey||e.metaKey)&&!i.hasPendingChildren?this.collapseToLevel(i.isCollapsed?i.level+1:i.level):i.isCollapsed=!i.isCollapsed;this.isAnimated?setTimeout(()=>{this.focus()},TreeView._AN_DLY+wijmo_1.Control._ANIM_DEF_STEP):this.focus();e.preventDefault()}}}_click(e){this._checkCollapseIconClick(e);if(!e.defaultPrevented){let t=wijmo_1.closestClass(e.target,TreeView._CND);if(t){let i=new TreeNode(this,t),s="input."+TreeView._CNDC,n=wijmo_1.closest(e.target,s),l=t.getBoundingClientRect(),o=this.rightToLeft?l.right-e.clientX:e.clientX-l.left;if(i.isDisabled)return;if(!n&&i.equals(this._edtNode))return;!n&&this._chkOnClick&&(!i.hasChildren||o>t.offsetHeight)&&(n=t.querySelector(s));let a=this._prevSel;const r=(e.shiftKey||e.ctrlKey||e.metaKey)&&this.allowMultiSelect;if(!r){this.selectedNode=i;this._clearMultiSelectedNodes(!0)}t.focus();if(n){e.preventDefault();e.stopPropagation();setTimeout(()=>{i.isChecked=!i.isChecked})}if(!n){let s=(e.ctrlKey||e.metaKey)&&!i.hasPendingChildren,n=i.isCollapsed,l=!1;if(i.hasChildren)if(o<=t.offsetHeight){l=!0;s?this.collapseToLevel(n?i.level+1:i.level):i.isCollapsed=!n}else if(this.expandOnClick&&n){l=!0;s?this.collapseToLevel(i.level+1):i.isCollapsed=!1}else if(this.collapseOnClick&&!n){l=!0;s?this.collapseToLevel(i.level):i.isCollapsed=!0}l&&s&&this.selectedNode&&this.selectedNode.ensureVisible();if(!l&&!this.isReadOnly&&!r){let e=this.selectedNode;e&&e.equals(a)&&this.startEditing()}}this.selectedItem&&this.onItemClicked()}}}_keydown(e){if(!e.defaultPrevented){let t,i=this._getKeyCode(e),s=this._selNode,n=!0;if(!s)switch(i){case wijmo_1.Key.Up:case wijmo_1.Key.Down:case wijmo_1.Key.Left:case wijmo_1.Key.Right:case wijmo_1.Key.Enter:case wijmo_1.Key.Home:case wijmo_1.Key.End:if(t=this.getFirstNode(!0,!0)){this.selectedNode=t;e.preventDefault();return}}if(s&&!s.isDisabled){switch(i){case wijmo_1.Key.F2:this.startEditing();e.preventDefault();break;case wijmo_1.Key.Escape:this.finishEditing(!0);e.preventDefault();break;case wijmo_1.Key.Up:case wijmo_1.Key.Down:this.finishEditing();break;case wijmo_1.Key.Enter:if(this._edtNode){this.finishEditing();i=wijmo_1.Key.Down}else{this.startEditing();e.preventDefault()}}if(this._edtNode)return;if(this.rightToLeft)switch(i){case wijmo_1.Key.Left:i=wijmo_1.Key.Right;break;case wijmo_1.Key.Right:i=wijmo_1.Key.Left}switch(i){case wijmo_1.Key.Left:!s.isCollapsed&&s.hasChildren?s.isCollapsed=!0:(s=s.parentNode)&&s.select();break;case wijmo_1.Key.Right:s.isCollapsed&&s.hasChildren&&(s.isCollapsed=!1);break;case wijmo_1.Key.Up:t=s.previous(!0,!0);break;case wijmo_1.Key.Down:t=s.next(!0,!0);break;case wijmo_1.Key.Home:t=this.getFirstNode(!0,!0);break;case wijmo_1.Key.End:t=this.getLastNode(!0,!0);break;case wijmo_1.Key.Space:if(this.selectedItem){let e=s.checkBox;e&&(s.isChecked=e.indeterminate||!e.checked)}break;case wijmo_1.Key.Enter:this.selectedItem&&this.onItemClicked();break;default:n=!1}if(n){e.preventDefault();e.shiftKey?t&&t.isSelected&&s.deSelect(!0):this._clearMultiSelectedNodes(!t);t&&t.select()}}}}_keypress(e){if(!e.defaultPrevented){if(e.ctrlKey||e.metaKey||e.altKey)return;if(e.target instanceof HTMLInputElement)return;if(this._edtNode)return;if(e.charCode>32&&this.startEditing(this.selectedNode)){let t=wijmo_1.getActiveElement();if(wijmo_1.contains(this._edtNode.element,t)){t.textContent=String.fromCharCode(e.charCode);e.preventDefault();let i=document.createRange();i.selectNodeContents(t);i.collapse(!1);let s=getSelection();s.removeAllRanges();s.addRange(i)}return}if(e.charCode>32||32==e.charCode&&this._srch){e.preventDefault();this._srch+=String.fromCharCode(e.charCode).toLowerCase();this._toSrch&&clearTimeout(this._toSrch);this._toSrch=setTimeout(()=>{this._toSrch=null;this._srch=""},TreeView._AS_DLY);let t=this._findNext();if(null==t&&this._srch.length>1){this._srch=this._srch[this._srch.length-1];t=this._findNext()}null!=t&&(this.selectedItem=t)}}}_findNext(){if(this.hostElement&&this.selectedItem){let e=this.getNode(this.selectedItem),t=e,i=!1,s=!1;1==this._srch.length&&(s=!0);for(;t;){if(!t.isDisabled&&!s){if(0==t.element.textContent.trim().toLowerCase().indexOf(this._srch))return t.dataItem}let n=t.next(!0,!0);if(n==e&&i)break;if(!n&&!i){n=this.getFirstNode(!0,!0);i=!0}t=n;s=!1}}return null}_loadTree(e){let t=this._root;if(t){if(!this.onLoadingItems(new wijmo_1.CancelEventArgs))return;let i=this.containsFocus(),s=this._srcChanged;this._isDirty=!1;this._srcChanged=!1;let n=this.selectedItem;this.selectedItem=null;let l,o=[];if(this.allowMultiSelect){this.selectedNodes.forEach(e=>o.push(e.dataItem));this.selectedNodes.beginUpdate();this.selectedNodes.clear();this.selectedNodes.endUpdate(!0)}this._chkItems=null;this._ldLvl=-1;if(e&&wijmo_1.isFunction(window.Map)&&!s&&this.nodes.length>0){l=new Map;let e=this.hostElement.querySelectorAll("."+TreeView._CND);for(let t=0;t<e.length;t++){let i=e[t];wijmo_1.hasClass(i,TreeView._CCLD)&&l.set(i[TreeView._DATAITEM_KEY],!0)}}t.innerHTML="";this._items&&this._items.forEach(e=>{this._addItem(t,0,e)});if(l){let e=this.hostElement.querySelectorAll("."+TreeView._CND);for(let t=0;t<e.length;t++){let i=e[t],s=TreeNode._isNodeList(i.nextElementSibling),n=!TreeNode._isEmpty(i),o=l.get(i[TreeView._DATAITEM_KEY]);n&&(o||s)&&wijmo_1.toggleClass(i,TreeView._CCLD,1==o);wijmo_1.setAttribute(i,"aria-expanded",n?(!wijmo_1.hasClass(i,TreeView._CCLD)).toString():null)}}i&&!this.containsFocus()&&this.focus();this.allowMultiSelect&&o.forEach(e=>{const t=this.getNode(e);t&&t.select(!0)});this.selectedItem=n;this.onLoadedItems();this._ldLvl=-1;this._srcChanged=!1}}_addItem(e,t,i){let s,n=this._dspPath.getValue(i,t),l=this._imgPath.getValue(i,t),o=wijmo_1.asArray(this._itmPath.getValue(i,t),!0),a=document.createElement("div");wijmo_1.addClass(a,TreeView._CND);a.tabIndex=-1;wijmo_1.setAttribute(a,"role","treeitem",!0);wijmo_1.setAttribute(a,"aria-selected",!1);let r=document.createElement("span");this.isContentHtml?r.innerHTML=n:r.textContent=n;wijmo_1.addClass(r,TreeView._CNDT);a.appendChild(r);if(l){let e=document.createElement("img");e.src=l;a.insertBefore(e,a.firstChild)}if(this._showChk&&!this._lazyLoad){(s=document.createElement("input")).type="checkbox";s.tabIndex=-1;wijmo_1.addClass(s,TreeView._CNDC);a.insertBefore(s,a.firstChild)}this._dd&&a.setAttribute("draggable","true");e.appendChild(a);a[TreeView._DATAITEM_KEY]=i;o&&0==o.length&&!this.lazyLoadFunction&&(o=null);if(o){let i=this.expandOnLoad;if(t>this._ldLvl&&i){this._ldLvl=t;if(0==o.length){i=!1;wijmo_1.addClass(a,TreeView._CCLD)}}else{i=!1;wijmo_1.addClass(a,TreeView._CCLD);t<this._ldLvl&&(this._ldLvl=100)}if(o.length>0){let i=document.createElement("div");i.tabIndex=-1;wijmo_1.addClass(i,TreeView._CNDL);for(let e=0;e<o.length;e++)this._addItem(i,t+1,o[e]);e.appendChild(i);wijmo_1.setAttribute(i,"role","group",!0)}wijmo_1.setAttribute(a,"aria-expanded",i.toString(),!0)}else wijmo_1.addClass(a,TreeView._CEMP);if(s&&this.checkedMemberPath)if(o&&o.length){new TreeNode(this,a)._updateCheckedState()}else s.checked=this._chkPath.getValue(i,t);this.formatItem.hasHandlers&&this.onFormatItem(new FormatNodeEventArgs(i,a,t))}_collapseToLevel(e,t,i){for(let s=0;s<e.length;s++){let n=e[s];if(!n.hasPendingChildren){n.isCollapsed=i>=t;n.hasChildren&&this._collapseToLevel(n.nodes,t,i+1)}}}_lazyLoadNode(e){let t=this.hostElement;if(!wijmo_1.hasClass(t,TreeView._CLDG)){wijmo_1.addClass(t,TreeView._CLDG);wijmo_1.addClass(e.element,TreeView._CLDG);this.lazyLoadFunction(e,this._lazyLoadCallback.bind(e))}}_lazyLoadCallback(e){this.treeView._lazyLoadNodeDone(this,e)}_lazyLoadNodeDone(e,t){let i=TreeView;wijmo_1.removeClass(e.element,i._CLDG);wijmo_1.removeClass(this.hostElement,i._CLDG);let s=e.dataItem,n=e.level,l=wijmo_1.asArray(t,!0);if(null==l||0==l.length){this._itmPath.setValue(s,n,null);wijmo_1.addClass(e.element,i._CEMP);wijmo_1.removeClass(e.element,i._CCLD)}else if(l.length){this._itmPath.setValue(s,n,l);let t=document.createElement("div"),o=e.element;wijmo_1.addClass(t,i._CNDL);o.parentElement.insertBefore(t,o.nextSibling);for(let e=0;e<l.length;e++)this._addItem(t,n+1,l[e]);e.isCollapsed=!1}}isTxtSelected(e){let t=window.getSelection();return t.anchorNode===e&&t.toString().length>0}_clearMultiSelectedNodes(e=!1){for(let t=this._selNodes.length-1;t>=0;t--)e&&this._selNodes[t]==this.selectedNode||this._selNodes[t].deSelect(!0)}}TreeView._DATAITEM_KEY="wj-Data-Item";TreeView._AS_DLY=600;TreeView._AN_DLY=200;TreeView._CND="wj-node";TreeView._CNDL="wj-nodelist";TreeView._CEMP="wj-state-empty";TreeView._CNDT="wj-node-text";TreeView._CNDC="wj-node-check";TreeView._CSEL="wj-state-selected";TreeView._CMSEL="wj-state-multi-selected";TreeView._CCLD="wj-state-collapsed";TreeView._CCLG="wj-state-collapsing";TreeView._CLDG="wj-state-loading";TreeView.controlTemplate='<div wj-part="root"></div>';exports.TreeView=TreeView;class _TreeDragDropManager{constructor(e){this._tree=wijmo_1.asType(e,TreeView);this._dragstartBnd=this._dragstart.bind(this);this._dragoverBnd=this._dragover.bind(this);this._dropBnd=this._drop.bind(this);this._dragendBnd=this._dragend.bind(this);let t=this._tree,i=t.hostElement;t.addEventListener(i,"dragstart",this._dragstartBnd);t.addEventListener(i,"dragover",this._dragoverBnd);t.addEventListener(i,"dragleave",this._dragoverBnd);t.addEventListener(i,"drop",this._dropBnd);t.addEventListener(i,"dragend",this._dragendBnd);t.addEventListener(i,"keydown",this._keydown)}dispose(){let e=this._tree,t=e.hostElement;e.removeEventListener(t,"dragstart",this._dragstartBnd);e.removeEventListener(t,"dragover",this._dragoverBnd);e.removeEventListener(t,"dragleave",this._dragoverBnd);e.removeEventListener(t,"drop",this._dropBnd);e.removeEventListener(t,"dragend",this._dragendBnd);e.removeEventListener(t,"keydown",this._keydown);this._showDragMarker()}_dragstart(e){if(!e.defaultPrevented){let t=this._tree,i=wijmo_1.closestClass(e.target,TreeView._CND),s=_TreeDragDropManager;s._drgSrc=TreeNode._isNode(i)?new TreeNode(t,i):null;if(s._drgSrc){let e=new TreeNodeEventArgs(s._drgSrc);t.onDragStart(e)||(s._drgSrc=null)}if(s._drgSrc&&e.dataTransfer){wijmo_1._startDrag(e.dataTransfer,"copyMove");e.stopPropagation()}else e.preventDefault()}}_removeDragFeedback(){document.body.querySelectorAll("."+_TreeDragDropManager.CLS_DRAG_FEEDBACK).forEach(e=>e.remove())}_dragover(e){this._handleDragDrop(e,!1)}_drop(e){this._handleDragDrop(e,!0)}_dragend(e){_TreeDragDropManager._drgSrc=null;this._showDragMarker();this._removeDragFeedback();this._tree.onDragEnd()}_keydown(e){e.defaultPrevented||e.keyCode==wijmo_1.Key.Escape&&this._dragendBnd(null)}_handleDragDrop(e,t){let i,s,n=this._tree,l=_TreeDragDropManager,o=DropPosition,a=o.Into;if(!e.defaultPrevented&&l._drgSrc){let r=document.elementFromPoint(e.clientX,e.clientY),h=wijmo_1.closestClass(r,TreeView._CND);if(null==h){let e=wijmo_1.Control.getControl(wijmo_1.closest(r,".wj-treeview"));e instanceof TreeView&&0==e.totalItemCount&&(h=e.hostElement)}h==l._drgSrc.element&&(h=null);if(h&&n.allowMultiSelect&&TreeNode._isNode(h)&&n.hostElement.contains(l._drgSrc.element)){const e=new TreeNode(n,h);if(e.isSelected)h=null;else for(let t=n.selectedNodes.length-1;t>=0;t--){const i=n.selectedNodes[t];if(i.hasChildren&&i._contains(e)){h=null;break}}}if(h){s=h.getBoundingClientRect();let t=new TreeNode(n,h),r=t.hasPendingChildren?s.height/2:s.height/3;if(null==t.element){(s=wijmo_1.Rect.fromBoundingRect(s)).inflate(-12,-12);a=o.Before}else if(e.clientY<s.top+r)a=o.Before;else if(e.clientY>s.bottom-r||t.hasPendingChildren){a=o.After;if(t.hasChildren&&!t.isCollapsed&&!t.hasPendingChildren){a=o.Before;s=(h=(t=t.next(!0,!1)).element).getBoundingClientRect()}}if(l._drgSrc._contains(t))h=null;else{(i=new TreeNodeDragDropEventArgs(l._drgSrc,t,a)).cancel=l._drgSrc.treeView!=t.treeView;n.onDragOver(i)||(h=null)}}if(h)if((a=i.position)==o.Before){let e=i.dragSource.next(!0,!1);e&&e.element==h&&(h=null)}else if(a==o.After){let e=i.dragSource.previous(!0,!1);e&&e.element==h&&(h=null)}if(h&&!t){e.dataTransfer.dropEffect="move";e.preventDefault();e.stopPropagation();this._showDragMarker(s,a)}else this._showDragMarker();if(h&&t&&n.onDrop(i)){n.hostElement.focus();if(n.allowMultiSelect){const e=this._getTopLevelSelectedNodes(),t=i.dragSource.treeView,s=i.dropTarget.treeView;i.position==DropPosition.After&&e.reverse();e.forEach(e=>e.move(i.dropTarget,i.position));if(t!=s){t.selectedNodes.clear();t.selectedNode=null;e.forEach(e=>e.select())}}else{let e=i.dragSource;e.move(i.dropTarget,i.position);e.ensureVisible();e.select()}}}}_getTopLevelSelectedNodes(){const e=_TreeDragDropManager._drgSrc.treeView,t=[];e.hostElement.querySelectorAll("."+TreeView._CMSEL+" , ."+TreeView._CSEL).forEach(i=>{const s=new TreeNode(e,i);((e,t)=>{if(!t)return!1;for(let i=0;i<t.length;i++)if(t[i]._contains(e))return!0;return!1})(s,t)||t.push(s)});return t}_showDragMarker(e,t){let i=this._tree,s=_TreeDragDropManager._dMarker.parentElement;if(e){let n=i.hostElement.getBoundingClientRect(),l=t==DropPosition.After?e.bottom:e.top,o={top:Math.round(l-n.top+i.hostElement.scrollTop-2),width:"75%",height:t==DropPosition.Into?e.height:4,opacity:t==DropPosition.Into?"0.15":""};i.rightToLeft?o.right=Math.round(n.right-e.right):o.left=Math.round(e.left-n.left);wijmo_1.setCss(_TreeDragDropManager._dMarker,o);s!=i._root&&i._root.appendChild(_TreeDragDropManager._dMarker)}else s&&s.removeChild(_TreeDragDropManager._dMarker)}}_TreeDragDropManager.CLS_DRAG_FEEDBACK="wj-tv-drag-feedback";_TreeDragDropManager.CLS_DRAG_ITEMCOUNT="wj-tv-drag-ic";_TreeDragDropManager.CLS_DRAG_ITEMCOUNT_LARGE="wj-larger-drag-ic";_TreeDragDropManager._dMarker="undefined"!=typeof window?wijmo_1.createElement('<div class="wj-marker">&nbsp;</div>'):null;exports._TreeDragDropManager=_TreeDragDropManager;wijmo_1._registerModule("wijmo.nav",selfModule);