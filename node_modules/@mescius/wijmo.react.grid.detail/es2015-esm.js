/*!
    *
    * Wijmo Library 5.20242.21
    * https://developer.mescius.com/wijmo
    *
    * Copyright(c) MESCIUS inc. All rights reserved.
    *
    * Licensed under the End-User License Agreement For MESCIUS Wijmo Software.
    * us.sales@mescius.com
    * https://developer.mescius.com/wijmo/licensing
    *
    */

import{forwardRef}from"react";import{selectiveDomRender,selectiveDomUnmount,useWjComponentChildBase}from"@mescius/wijmo.react.base";import*as wjcCore from"@mescius/wijmo";import*as wjcGridDetail from"@mescius/wijmo.grid.detail";export const FlexGridDetailMeta={inputs:["detailVisibilityMode","isAnimated","keyActionEnter","maxHeight","rowHasDetail","template"],events:[]};const lastDetailContextKey="$_templateFnLastCtx";export const FlexGridDetail=forwardRef((function(e,t){const i=useWjComponentChildBase({ref:t,properties:FlexGridDetailMeta.inputs,events:FlexGridDetailMeta.events,props:e,constructor:DirectiveFlexGridDetail,needParentInstance:!0,parentProp:"",isParentPropArray:!1,assignedToParent:!1});return Object.assign({$_wjComponent:!0},i)}));export class DirectiveFlexGridDetail extends wjcGridDetail.FlexGridDetailProvider{constructor(e,t){super(e,t);this.renderedCellsCache=[];this._createDetailCellFn=e=>{const t={row:e,item:e.dataItem,provider:this},i=this._templateFn;if(!i)return;const r=document.createElement("div"),s=i(t);r[lastDetailContextKey]=t;selectiveDomRender(s,r);this.renderedCellsCache.push(r);return r};this._disposeDetailCellFn=e=>{const t=e.detail;selectiveDomUnmount(t);let i=-1;for(let e=0;e<this.renderedCellsCache.length;e++)if(this.renderedCellsCache[e]==t){i=e;break}i>-1&&this.renderedCellsCache.splice(i,1)}}get template(){return this._templateFn}set template(e){this._templateFn!=e&&(this._templateFn=wjcCore.asFunction(e,!0))}initialize(e){wjcCore.copy(this,e,!1);this.updateTemplate()}updateTemplate(){if(this._templateFn)for(let e of this.renderedCellsCache){const t=e[lastDetailContextKey];selectiveDomRender(this._templateFn(t),e,!0)}}}