/*!
    *
    * Wijmo Library 5.20242.21
    * https://developer.mescius.com/wijmo
    *
    * Copyright(c) MESCIUS inc. All rights reserved.
    *
    * Licensed under the End-User License Agreement For MESCIUS Wijmo Software.
    * us.sales@mescius.com
    * https://developer.mescius.com/wijmo/licensing
    *
    */

var _a,__extends=this&&this.__extends||function(){var extendStatics=function(e,t){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=null===t?Object.create(t):(__.prototype=t.prototype,new __)}}(),__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,i=1,o=arguments.length;i<o;i++){t=arguments[i];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}).apply(this,arguments)};import{isInt,asInt,_addCultureInfo,tryCast,format,Size,CancelEventArgs,asType,asBoolean,isFunction,Key,_getModule,asArray,assert,copy,isArray,isNumber,isString,toHeaderCase,NotifyCollectionChangedEventArgs,ObservableArray,Point,mouseToPage,closest,Control,SortDescription,isSafari,isIE,isIE9,closestClass,addClass,removeClass,setCss,getActiveElement,removeChild,createElement,setAttribute,_startDrag,clamp,isEdge,hasClass,Event,EventArgs,_MaskProvider,asString,asCollectionView,toPlainText,_Map,asFunction,culture,Globalize,escapeHtml,isBoolean,toggleClass,contains,setChecked,setAriaLabel,disableAutoComplete,evalTemplate,DataType,isChromiumBased,isMobile,isiOS,setSelectionRange,isUndefined,asNumber,asEnum,getType,_deprecated,Aggregate,Binding,CollectionViewGroup,uidGenerator,changeType,isFirefox,DateTime,Rect,CollectionView,NotifyCollectionChangedAction,getAggregate,isDate,showPopup,hidePopup,Clipboard,_isMacOS,Tooltip,isPrimitive,enable,setText,getTypes,hasItems,getElementRect,supportsFocusOptions,isIE10,getScrollableParent,getOffsetFromAncestor,_NullValue,_registerModule}from"@mescius/wijmo";import{MultiSelect}from"@mescius/wijmo.input";import*as mInput from"@mescius/wijmo.input";import*as selfModule from"@mescius/wijmo.grid";var _safariVer=null;export function _getSafariVer(){return _safariVer}if(isSafari()){var match=navigator.userAgent.match(/version\/([\d\.]+)/i);if(null!=match){var version=match[1],parts=(match=version.match(/(\d+)/g)).map((function(e){return parseInt(e)}));_safariVer={full:version,major:parts[0],minor:parts[1]}}}export var DataMapEditor;!function(e){e[e.AutoComplete=0]="AutoComplete";e[e.DropDownList=1]="DropDownList";e[e.RadioButtons=2]="RadioButtons";e[e.Menu=3]="Menu"}(DataMapEditor||(DataMapEditor={}));var DataMap=function(){function DataMap(e,t,i){this._keyPath="";this._displayPath="";this._sortByVal=!0;this._editable=!1;this._useFilter=!1;this._serK=!0;this.mapChanged=new Event;if(isArray(e)&&!t&&!i){e=e.map((function(e){return{value:e}}));t=i="value"}this._cv=asCollectionView(e);this._keyPath=asString(t,!1);this._displayPath=asString(i,!1);this._cv.collectionChanged.addHandler(this.onMapChanged,this)}Object.defineProperty(DataMap.prototype,"sortByDisplayValues",{get:function(){return this._sortByVal},set:function(e){this._sortByVal=asBoolean(e)},enumerable:!0,configurable:!0});Object.defineProperty(DataMap.prototype,"serializeKeys",{get:function(){return this._serK},set:function(e){if((e=asBoolean(e))!==this._serK){var t=this._map,i=t&&t.size;this._map=null;this._serK=e;i&&this.onMapChanged(EventArgs.empty)}},enumerable:!0,configurable:!0});Object.defineProperty(DataMap.prototype,"collectionView",{get:function(){return this._cv},enumerable:!0,configurable:!0});Object.defineProperty(DataMap.prototype,"selectedValuePath",{get:function(){return this._keyPath},enumerable:!0,configurable:!0});Object.defineProperty(DataMap.prototype,"displayMemberPath",{get:function(){return this._displayPath},enumerable:!0,configurable:!0});DataMap.prototype.getDataItem=function(e){var t=this;if(!this._map){var i=this._cv.sourceCollection,o=new _Map(this.serializeKeys);isArray(i)&&this._keyPath&&i.forEach((function(e){var i=e[t._keyPath];o.has(i)||o.set(i,e)}));this._map=o}return this._map.get(e)};DataMap.prototype.getDisplayValue=function(e){var t=this._displayPath,i=this.getDataItem(e);return t&&i?i[t]:e};DataMap.prototype.getKeyValue=function(e,t){var i=this._displayPath,o=this._indexOf(e,i,t,!0);o<0&&(o=this._indexOf(e,i,t,!1));return o>-1?this._cv.sourceCollection[o][this._keyPath]:null};DataMap.prototype.getDisplayValues=function(e){var t=this;return this._cv&&this._displayPath?this._cv.items.map((function(e){return e[t._displayPath]})):[]};DataMap.prototype.getFilteredItems=function(e){return this._cv?this._cv.items:[]};Object.defineProperty(DataMap.prototype,"useFilter",{get:function(){return this._useFilter},set:function(e){this._useFilter=asBoolean(e)},enumerable:!0,configurable:!0});DataMap.prototype.getKeyValues=function(){var e=this;return this._cv&&this._keyPath?this._cv.items.map((function(t){return t[e._keyPath]})):[]};Object.defineProperty(DataMap.prototype,"isEditable",{get:function(){return this._editable},set:function(e){this._editable=asBoolean(e)},enumerable:!0,configurable:!0});Object.defineProperty(DataMap.prototype,"search",{get:function(){return this._search},set:function(e){e&&(this._search=asFunction(e))},enumerable:!0,configurable:!0});DataMap.prototype.onMapChanged=function(e){this._map=null;this.mapChanged.raise(this,e)};DataMap.prototype._indexOf=function(e,t,i,o){var n=-1,r=-1;if(this._cv&&t){var l=null!=e?e.toString():"";l&&i&&(e=toPlainText(l));for(var s=o?l:l.toLowerCase(),a=this._cv.sourceCollection,c=0;c<a.length;c++){var u=a[c],h=u?u[t]:void 0;null!=h&&null!=h||(h="");i&&isString(h)&&(h=toPlainText(h));h==e?n=c:o||h.length!=s.length||h.toLowerCase()!=s?null!=h&&h.toString()==l&&(n=c):n=c;if(n==c){if(!this._cv.filter||this._cv.filter(u))return n;r<0&&(r=n)}}}return r};return DataMap}();export{DataMap};var CellRange=function(){function CellRange(e,t,i,o){void 0===e&&(e=-1);void 0===t&&(t=-1);void 0===i&&(i=e);void 0===o&&(o=t);this.setRange(e,t,i,o)}CellRange.prototype.setRange=function(e,t,i,o){void 0===e&&(e=-1);void 0===t&&(t=-1);void 0===i&&(i=e);void 0===o&&(o=t);this._row=asInt(e);this._col=asInt(t);this._row2=asInt(i);this._col2=asInt(o)};Object.defineProperty(CellRange.prototype,"row",{get:function(){return this._row},set:function(e){this._row=asInt(e)},enumerable:!0,configurable:!0});Object.defineProperty(CellRange.prototype,"col",{get:function(){return this._col},set:function(e){this._col=asInt(e)},enumerable:!0,configurable:!0});Object.defineProperty(CellRange.prototype,"row2",{get:function(){return this._row2},set:function(e){this._row2=asInt(e)},enumerable:!0,configurable:!0});Object.defineProperty(CellRange.prototype,"col2",{get:function(){return this._col2},set:function(e){this._col2=asInt(e)},enumerable:!0,configurable:!0});CellRange.prototype.clone=function(){return new CellRange(this._row,this._col,this._row2,this._col2)};CellRange.prototype.copy=function(e){this.setRange(e._row,e._col,e._row2,e._col2)};Object.defineProperty(CellRange.prototype,"rowSpan",{get:function(){return Math.abs(this._row2-this._row)+1},enumerable:!0,configurable:!0});Object.defineProperty(CellRange.prototype,"columnSpan",{get:function(){return Math.abs(this._col2-this._col)+1},enumerable:!0,configurable:!0});Object.defineProperty(CellRange.prototype,"topRow",{get:function(){return Math.min(this._row,this._row2)},enumerable:!0,configurable:!0});Object.defineProperty(CellRange.prototype,"bottomRow",{get:function(){return Math.max(this._row,this._row2)},enumerable:!0,configurable:!0});Object.defineProperty(CellRange.prototype,"leftCol",{get:function(){return Math.min(this._col,this._col2)},enumerable:!0,configurable:!0});Object.defineProperty(CellRange.prototype,"rightCol",{get:function(){return Math.max(this._col,this._col2)},enumerable:!0,configurable:!0});Object.defineProperty(CellRange.prototype,"isValid",{get:function(){return this._row>-1&&this._col>-1&&this._row2>-1&&this._col2>-1},enumerable:!0,configurable:!0});Object.defineProperty(CellRange.prototype,"isSingleCell",{get:function(){return this._row==this._row2&&this._col==this._col2},enumerable:!0,configurable:!0});CellRange.prototype.contains=function(e,t){var i=tryCast(e,CellRange);if(i)return i.topRow>=this.topRow&&i.bottomRow<=this.bottomRow&&i.leftCol>=this.leftCol&&i.rightCol<=this.rightCol;if(isInt(e)&&isInt(t))return e>=this.topRow&&e<=this.bottomRow&&t>=this.leftCol&&t<=this.rightCol;throw"contains expects a CellRange or row/column indices."};CellRange.prototype.containsRow=function(e){return asInt(e)>=this.topRow&&e<=this.bottomRow};CellRange.prototype.containsColumn=function(e){return asInt(e)>=this.leftCol&&e<=this.rightCol};CellRange.prototype.intersects=function(e){return this.intersectsRow(e)&&this.intersectsColumn(e)};CellRange.prototype.intersectsRow=function(e){return e&&!(this.bottomRow<e.topRow||this.topRow>e.bottomRow)};CellRange.prototype.intersectsColumn=function(e){return e&&!(this.rightCol<e.leftCol||this.leftCol>e.rightCol)};CellRange.prototype.getRenderSize=function(e){var t=new Size(0,0);if(this.isValid){for(var i=this.topRow;i<=this.bottomRow;i++)e.rows[i]&&(t.height+=e.rows[i].renderSize);for(var o=this.leftCol;o<=this.rightCol;o++)e.columns[o]&&(t.width+=e.columns[o].renderSize)}return t};CellRange.prototype.equals=function(e){return e instanceof CellRange&&this._row==e._row&&this._col==e._col&&this._row2==e._row2&&this._col2==e._col2};CellRange.prototype.combine=function(e){return e?new CellRange(Math.min(this.topRow,e.topRow),Math.min(this.leftCol,e.leftCol),Math.max(this.bottomRow,e.bottomRow),Math.max(this.rightCol,e.rightCol)):this};CellRange.prototype.toString=function(){return format("({row}, {col})-({row2}, {col2})",this)};return CellRange}();export{CellRange};var CellRangeEventArgs=function(e){__extends(CellRangeEventArgs,e);function CellRangeEventArgs(t,i,o){var n=e.call(this)||this;n._p=asType(t,GridPanel,!0);n._rng=asType(i,CellRange,!0);n._data=o;return n}Object.defineProperty(CellRangeEventArgs.prototype,"panel",{get:function(){return this._p},enumerable:!0,configurable:!0});Object.defineProperty(CellRangeEventArgs.prototype,"range",{get:function(){return this._rng.clone()},enumerable:!0,configurable:!0});Object.defineProperty(CellRangeEventArgs.prototype,"row",{get:function(){return this._rng.row},enumerable:!0,configurable:!0});Object.defineProperty(CellRangeEventArgs.prototype,"col",{get:function(){return this._rng.col},enumerable:!0,configurable:!0});Object.defineProperty(CellRangeEventArgs.prototype,"data",{get:function(){return this._data},set:function(e){this._data=e},enumerable:!0,configurable:!0});CellRangeEventArgs.prototype.getRow=function(){return this._p&&this.row>-1?this._p.rows[this.row]:null};CellRangeEventArgs.prototype.getColumn=function(e){var t=this._p,i=t&&this.col>-1?t.columns[this.col]:null;if(i&&e){var o=t.grid;i=t.cellType===CellType.ColumnHeader&&o._hasColumnGroups()?o._getColumnGroup(this.row,this.col):t.grid._getBindingColumn(t,this.row,i)}return i};return CellRangeEventArgs}(CancelEventArgs);export{CellRangeEventArgs};var FormatItemEventArgs=function(e){__extends(FormatItemEventArgs,e);function FormatItemEventArgs(t,i,o,n){void 0===n&&(n=!0);var r=e.call(this,t,i)||this;r._updateContent=!0;r._cell=asType(o,HTMLElement);return r}Object.defineProperty(FormatItemEventArgs.prototype,"cell",{get:function(){return this._cell},enumerable:!0,configurable:!0});Object.defineProperty(FormatItemEventArgs.prototype,"updateContent",{get:function(){return this._updateContent},enumerable:!0,configurable:!0});return FormatItemEventArgs}(CellRangeEventArgs);export{FormatItemEventArgs};var CellEditEndingEventArgs=function(e){__extends(CellEditEndingEventArgs,e);function CellEditEndingEventArgs(){var t=null!==e&&e.apply(this,arguments)||this;t._stayInEditMode=!1;t._refresh=!0;return t}Object.defineProperty(CellEditEndingEventArgs.prototype,"stayInEditMode",{get:function(){return this._stayInEditMode},set:function(e){this._stayInEditMode=asBoolean(e)},enumerable:!0,configurable:!0});Object.defineProperty(CellEditEndingEventArgs.prototype,"refresh",{get:function(){return this._refresh},set:function(e){this._refresh=asBoolean(e)},enumerable:!0,configurable:!0});Object.defineProperty(CellEditEndingEventArgs.prototype,"previousData",{get:function(){return null!=this._previousData?this._previousData:this._data},set:function(e){this._previousData=e},enumerable:!0,configurable:!0});return CellEditEndingEventArgs}(CellRangeEventArgs);export{CellEditEndingEventArgs};export function softInput(){return _getModule("wijmo.input")}export function softDetailRow(){return _getModule("wijmo.grid.detail")}export function softMultirow(){return _getModule("wijmo.grid.multirow")}export function softTransposed(){return _getModule("wijmo.grid.transposed")}export function softTransposedMultirow(){return _getModule("wijmo.grid.transposedmultirow")}export function softRestCollectionView(){return _getModule("wijmo.rest")}export var SelectionMode;!function(e){e[e.None=0]="None";e[e.Cell=1]="Cell";e[e.CellRange=2]="CellRange";e[e.Row=3]="Row";e[e.RowRange=4]="RowRange";e[e.ListBox=5]="ListBox";e[e.MultiRange=6]="MultiRange"}(SelectionMode||(SelectionMode={}));export var SelectedState;!function(e){e[e.None=0]="None";e[e.Selected=1]="Selected";e[e.Cursor=2]="Cursor";e[e.Active=3]="Active"}(SelectedState||(SelectedState={}));export var SelMove;!function(e){e[e.None=0]="None";e[e.Next=1]="Next";e[e.Prev=2]="Prev";e[e.NextPage=3]="NextPage";e[e.PrevPage=4]="PrevPage";e[e.Home=5]="Home";e[e.End=6]="End";e[e.NextCell=7]="NextCell";e[e.PrevCell=8]="PrevCell";e[e.NextEditableCell=9]="NextEditableCell";e[e.PrevEditableCell=10]="PrevEditableCell"}(SelMove||(SelMove={}));var _SelectionHandler=function(){function _SelectionHandler(e){this._sel=new CellRange(0,0);this._xSel=new ObservableArray;this._mode=SelectionMode.CellRange;this._g=e;this._e=new CellRangeEventArgs(e.cells,new CellRange(0,0));this._xSel.collectionChanged.addHandler((function(){e.invalidate()}))}Object.defineProperty(_SelectionHandler.prototype,"selectionMode",{get:function(){return this._mode},set:function(e){e!=this._mode&&this._setSelectionMode(e)},enumerable:!0,configurable:!0});Object.defineProperty(_SelectionHandler.prototype,"selection",{get:function(){return this._sel},set:function(e){this.select(e)},enumerable:!0,configurable:!0});Object.defineProperty(_SelectionHandler.prototype,"extendedSelection",{get:function(){return this._xSel},enumerable:!0,configurable:!0});Object.defineProperty(_SelectionHandler.prototype,"cellRangeEventArgs",{get:function(){return this._e},enumerable:!0,configurable:!0});_SelectionHandler.prototype.select=function(e,t,i,o){void 0===t&&(t=!0);void 0===i&&(i=!1);o||(o=this._g._gpCells);var n=this._g,r=this._e.range,l=this._sel,s=r,a=!1,c=SelectionMode,u=n.activePanelType,h=o.cellType==CellType.RowHeader||o.cellType==CellType.ColumnHeader,d=n._mouseHdl._eMouse&&(n._mouseHdl._eMouse.ctrlKey||n._mouseHdl._eMouse.metaKey);if(isNumber(e)&&isString(t)){var p=o.columns.indexOf(t);if(p<0)throw"Invalid column name or binding.";r.setRange(e,p);t=!0}else if(isNumber(e)&&isNumber(t)){r.setRange(e,t);t=!0}else e instanceof CellRange?r.copy(e):assert(!1,"CellRange expected");n.activePanel=o;switch(n.selectionMode){case c.Cell:s.row2=s.row;s.col2=s.col;break;case c.Row:s.row2=s.row;break;case c.ListBox:if(d){this._sel.copy(s);n.refreshCells(!1,!0,!0);t&&this._showSelection();return!0}a=!0}if(h){s.row2=s.row;s.col2=s.col}var f=s.equals(l)&&u==o.cellType;if(f&&a&&!h)for(var g=0;g<n.rows.length;g++)if(n.rows[g].isSelected!==s.containsRow(g)){f=!1;break}if(f){t&&o.isRangeValid(s)&&this._showSelection();return!0}var _=Control.getControl(closest(getActiveElement(),".wj-flexgrid"));if(_&&_==n&&_.activeEditor&&!_.finishEditing())return!1;var m=this._e;m._rng=s;m.cancel=!1;if(!n.onSelectionChanging(m)&&!i)return!1;!h&&a&&n.rows.forEach((function(e,t){e._setFlag(RowColFlags.Selected,s.containsRow(t),!0)}));s.row=Math.min(s.row,o.rows.length-1);s.row2=Math.min(s.row2,o.rows.length-1);this._sel.copy(s);n.refreshCells(!1,!0,!0);t&&this._showSelection();var w=n.collectionView;if(w&&!h){var C=n._getCvIndex(s.row);w.moveCurrentToPosition(C)}var v=getActiveElement();this._g.errorTip&&(v.classList.contains("wj-state-invalid")?this._g.errorTip._showAutoTip(void 0,v):this._g.errorTip.hide());n.onSelectionChanged(m);return!0};_SelectionHandler.prototype.moveSelectionWithinSelectedPanel=function(e,t){var i=this._g,o=this._sel.clone(),n=i.activePanel,r=i.getMergedRange(n,o.row,o.col,!1);r||(r=new CellRange(o.row,o.col));if(e>0){var l=n.getNextVisibleRow(r.bottomRow+e);l>=0&&(o.row=o.row2=l);if(!n.columns[o.col].isVisible){var s=n.getNextVisibleColumn(r.leftCol);s>=0&&(o.col=o.col2=s)}}else if(e<0){var a=n.getLastVisibleRow(r.topRow+e);a>=0&&(o.row=o.row2=a)}if(t>0){var c=n.getNextVisibleColumn(r.rightCol+t);c>=0&&(o.col=o.col2=c)}else if(t<0){var u=n.getLastVisibleColumn(r.leftCol+t);u>=0&&(o.col=o.col2=u)}o.equals(this._sel)||i.select(o,!0,n)};_SelectionHandler.prototype.moveSelection=function(e,t,i){var o=this._g,n=this._sel,r=i&&o.anchorCursor?new CellRange(n.row2,n.col2):new CellRange(n.row,n.col),l=r.row,s=r.col,a=o.columns,c=Math.max(0,o._szClient.height-o.columnHeaders.height),u=SelMove,h=-1,d=o.getMergedRange(o.cells,l,s),p=0;if(d){t==u.Next||t==u.NextCell||t==u.NextEditableCell?s=d.rightCol:t!=u.Prev&&t!=u.PrevCell&&t!=u.PrevEditableCell||(s=d.leftCol);if(e==u.Next||e==u.NextCell||e==u.NextEditableCell){l=d.bottomRow;if(softMultirow()&&o instanceof softMultirow().MultiRow){p=r.row-d.topRow;if(d.bottomRow===o.rows.length-1)return}}else if(e==u.Prev||e==u.PrevCell||e==u.PrevEditableCell){l=d.topRow;if(softMultirow()&&o instanceof softMultirow().MultiRow){p=r.row-d.bottomRow;if(0===d.topRow)return}}}switch(t){case u.NextCell:case u.NextEditableCell:h=s;(s=this._getNextColumnCell(l,h,t))!=h&&(d=o.getMergedRange(o.cells,l,s))&&s<d.col2&&(s=d.col2);if(s==h)for(;;){if(l==o.rows.length-1){s=r.col;l=r.row;break}var f=!1;if((l=this._getNextRowCell(l,s,t))>r.row){h=-1;for(;h<a.length;){if((s=this._getNextColumnCell(l,h,t))==h){f=!0;break}(d=o.getMergedRange(o.cells,l,s))&&s<d.col2&&(s=d.col2);break}if(f)continue}break}o.select(l,s);break;case u.PrevCell:case u.PrevEditableCell:h=s;(s=this._getNextColumnCell(l,h,t))!=h&&(d=o.getMergedRange(o.cells,l,s))&&s>d.col&&(s=d.col);if(s==h)for(;;){if(0==l){s=r.col;l=r.row;break}f=!1;if((l=this._getNextRowCell(l,s,t))<r.row){h=a.length;for(;h>-1;){(s=this._getNextColumnCell(l,h,t))!=h?(d=o.getMergedRange(o.cells,l,s))&&s>d.col&&(s=d.col):f=!0;break}if(f)continue}break}o.select(l,s);break;default:l=this._getNextRowCell(l,s,e,c);l+=p;s=this._getNextColumnCell(l,s,t,c);i?o.selection=o.anchorCursor?new CellRange(n.row,n.col,l,s):new CellRange(l,s,n.row2,n.col2):o.select(l,s)}};_SelectionHandler.prototype._getNextColumnCell=function(e,t,i,o){void 0===o&&(o=0);return this._g.columns.getNextCell(t,i,o)};_SelectionHandler.prototype._getNextRowCell=function(e,t,i,o){void 0===o&&(o=0);return this._g.rows.getNextCell(e,i,o)};_SelectionHandler.prototype._setSelectionMode=function(e){var t=this._g,i=t.rows;this._mode=e;this._xSel.clear();if(i.length){this._adjustSelection(this._sel,e,!0);t.invalidate()}};_SelectionHandler.prototype._adjustSelection=function(e,t,i){void 0===i&&(i=!1);var o=this._g.rows,n=SelectionMode,r=void 0;if(this._g.hostElement){r=this._g.hostElement.querySelector("input.wj-column-selector")instanceof HTMLInputElement}if(!r)for(var l=0;l<o.length;l++)o[l]._setFlag(RowColFlags.Selected,!1,!0);var s=e.clone();switch(t){case n.None:s=new CellRange;break;case n.Cell:s=new CellRange(e.row,e.col);break;case n.ListBox:if(r)return;for(l=0;l<o.length;l++)o[l]._setFlag(RowColFlags.Selected,s.containsRow(l),!0)}this.select(s,!1,i)};_SelectionHandler.prototype._expandSelection=function(){var e=this._g,t=e.selectionMode;if(e.expandSelectionOnCopyPaste&&t){var i=this.selection,o=SelectionMode;switch(t){case o.Cell:case o.Row:break;case o.ListBox:this._expandSelectedRows();break;case o.RowRange:i=new CellRange(i.topRow,0,i.bottomRow,e.columns.length-1);default:var n=this._expandSelectionRange(i);n&&this.select(n,!1)}}};_SelectionHandler.prototype._deselectRange=function(e){var t=this.selection,i=this.extendedSelection;if(t.contains(e)){var o=i.length;this._sel=o?i[o-1]:new CellRange;o&&i.removeAt(o-1);return!0}for(var n=0;n<i.length;n++)if(i[n].contains(e)){i.removeAt(n);return!0}return!1};_SelectionHandler.prototype._expandSelectedRows=function(){assert(this.selectionMode==SelectionMode.ListBox,"ListBox mode expected");for(var e=this._g,t=e.selectedRows.map((function(e){return e.index})),i=[],o=0;o<t.length;o++)for(var n=new CellRange(t[o],0,t[o],e.columns.length-1),r=this._expandSelectionRange(n)||n,l=r.topRow;l<=r.bottomRow;l++)-1===i.indexOf(l)&&i.push(l);i.sort();this._selectRows(i)};_SelectionHandler.prototype._expandSelectionRange=function(e){var t=this._g,i=t.cells,o=t.getMergedRange(i,e.topRow,e.leftCol,!1),n=t.getMergedRange(i,e.bottomRow,e.leftCol,!1),r=t.getMergedRange(i,e.topRow,e.rightCol,!1),l=t.getMergedRange(i,e.bottomRow,e.rightCol,!1);if(o||n||r||l){o=o||new CellRange(e.topRow,e.leftCol);n=n||new CellRange(e.bottomRow,e.leftCol);r=r||new CellRange(e.topRow,e.rightCol);l=l||new CellRange(e.bottomRow,e.rightCol);return new CellRange(Math.min(o.topRow,n.topRow,r.topRow,l.topRow),Math.min(o.leftCol,n.leftCol,r.leftCol,l.leftCol),Math.max(o.bottomRow,n.bottomRow,r.bottomRow,l.bottomRow),Math.max(o.rightCol,n.rightCol,r.rightCol,l.rightCol))}return null};_SelectionHandler.prototype._selectRows=function(e){assert(this.selectionMode==SelectionMode.ListBox,"ListBox mode expected");for(var t=this._g,i=0,o=!0;i<t.rows.length;i++){var n=t.rows[i],r=e&&e.indexOf(n.index)>-1;if(r&&o){o=!1;this.select(i,this.selection.col)}n.isSelected=r}};_SelectionHandler.prototype._showSelection=function(){var e=this._g,t=this._sel.clone();e.activePanelType===CellType.ColumnHeader?t.row=-1:e.activePanelType===CellType.RowHeader&&(t.col=-1);e.activePanelType!==CellType.TopLeft&&(e.anchorCursor?e.scrollIntoView(t.row2,t.col2):e.scrollIntoView(t.row,t.col));e.activePanelType!==CellType.Cell&&this._showHeaderSelection()};_SelectionHandler.prototype._showHeaderSelection=function(){var e=this._g.activePanel.activeCell;if(e){var t=e.getBoundingClientRect(),i=0,o=0,n=document.documentElement.clientWidth,r=document.documentElement.clientHeight;t.y<0?i=t.y:t.y>r-2&&(i=t.y-r+t.height);t.x<0?o=t.x:t.x>n-2&&(o=t.x-n+t.width);0==i&&0==o||window.scrollBy(o,i)}};_SelectionHandler.prototype._adjustReferenceCell=function(e,t,i){var o=this._g,n=o.getMergedRange(o.cells,e.row,e.col);if(n&&!n.isSingleCell){var r=SelMove;switch(t){case r.Next:case r.NextCell:case r.NextEditableCell:e.row=n.bottomRow;break;case r.Prev:case r.PrevCell:case r.PrevEditableCell:e.row=n.topRow}switch(i){case r.Next:case r.NextCell:case r.NextEditableCell:e.col=n.rightCol;break;case r.Prev:case r.PrevCell:case r.PrevEditableCell:e.col=n.leftCol}}};return _SelectionHandler}();export{_SelectionHandler};export var CellType;!function(e){e[e.None=0]="None";e[e.Cell=1]="Cell";e[e.ColumnHeader=2]="ColumnHeader";e[e.RowHeader=3]="RowHeader";e[e.TopLeft=4]="TopLeft";e[e.ColumnFooter=5]="ColumnFooter";e[e.BottomLeft=6]="BottomLeft"}(CellType||(CellType={}));var GridPanel=function(){function GridPanel(e,t,i,o,n){this._offsetY=0;this._rng=new CellRange;this._g=asType(e,FlexGrid);this._ct=asInt(t);this._rows=asType(i,RowCollection);this._cols=asType(o,ColumnCollection);this._e=asType(n,HTMLElement);this._vrb=new CellRange;this._uid=uidGenerator()}Object.defineProperty(GridPanel.prototype,"activeCell",{get:function(){return this._activeCell},enumerable:!0,configurable:!0});Object.defineProperty(GridPanel.prototype,"grid",{get:function(){return this._g},enumerable:!0,configurable:!0});Object.defineProperty(GridPanel.prototype,"cellType",{get:function(){return this._ct},enumerable:!0,configurable:!0});Object.defineProperty(GridPanel.prototype,"viewRange",{get:function(){return this._getViewRange()},enumerable:!0,configurable:!0});Object.defineProperty(GridPanel.prototype,"width",{get:function(){return this._cols.getTotalSize()},enumerable:!0,configurable:!0});Object.defineProperty(GridPanel.prototype,"height",{get:function(){return this._rows.getTotalSize()},enumerable:!0,configurable:!0});Object.defineProperty(GridPanel.prototype,"rows",{get:function(){return this._rows},enumerable:!0,configurable:!0});Object.defineProperty(GridPanel.prototype,"columns",{get:function(){return this._cols},enumerable:!0,configurable:!0});GridPanel.prototype.getCellData=function(e,t,i){t=this._toIndex(t);return this._getCellData(e,t,i)};GridPanel.prototype._getCellData=function(e,t,i){var o,n,r=this._g,l=this._rows[asNumber(e,!1,!0)];if(!l)return null;o=this._cols[asNumber(t,!1,!0)];var s=r?r._getBindingColumn(this,e,o):o,a=null,c=l instanceof GroupRow;c&&l.dataItem instanceof CollectionViewGroup&&!r.childItemsPath&&(a=l.dataItem);s.binding&&l.dataItem&&!a?n=s._binding.getValue(l.dataItem):l._ubv&&(n=l._ubv[o._hash]);null==n&&(n=this._getSpecialData(e,l,t,o,s,c,a,n));if(i){var u=s.dataMap||l.dataMap;if(this.cellType==CellType.Cell&&s._edt&&s._edt._ctl instanceof MultiSelect&&n){var h=new Binding(s._edt._ctl.displayMemberPath),d=h&&isArray(n)?n.map((function(e){return h.getValue(e)})):n;if(isArray(d)&&d.length>0){var p=d.join(", ");n=format(p||culture.MultiSelect.itemsSelected,{count:d.length})}}else this.cellType==CellType.Cell&&u&&(n=u.getDisplayValue(n));n=null!=n?Globalize.format(n,s.format||l.format):""}return n};GridPanel.prototype.setCellData=function(e,t,i,o,n,r){void 0===o&&(o=!0);void 0===n&&(n=!0);void 0===r&&(r=!1);var l=this._g,s=this._rows[asNumber(e,!1,!0)],a=this._cols[asNumber(this._toIndex(t),!1,!0)],c=DataType;if(!s)return!1;var u=l?l._getBindingColumn(this,e,a):a,h=u.dataMap||s.dataMap;if(this._ct==CellType.Cell){var d=u.getIsRequired(s),p=u.isContentHtml||s.isContentHtml;if(!r&&h&&null!=i){var f=h.getKeyValue(i,p);if(null==f&&null==h.getDisplayValue(null)){if(h.getDisplayValue(i)!=i);else if(!h.isEditable||h.displayMemberPath!=h.selectedValuePath){if(""!=i||d||!l.commitEmptyEdits)return!1;i=null}}else i=f}var g=c.Object,_=u.dataType||s.dataType,m=this.getCellData(e,t,!1);this.cellType==CellType.Cell&&u._edt&&u._edt._ctl instanceof MultiSelect&&i&&(_=c.Array);g=_||getType(m);if(null==i||""===i&&o&&!h){if(d||!l.commitEmptyEdits&&(null==m||""===m))return!1;g!=c.String&&(i=null);o=!1}if("NaN"==i&&Number.isNaN(m)&&!l.commitEmptyEdits)return!1;if(o){var w=u.format||s.format;w||g!=c.Date||(w="d");u.mask&&isString(i)&&g!=c.String&&(i=i.replace(/_/g,""));i=changeType(i,g,w,m);if(g!=c.Object&&getType(i)!=g)return!1}}if(s.dataItem&&u.binding){var C=u._binding,v=s.dataItem,y=C.getValue(v);if(i!==y&&(h&&!h.serializeKeys||!DateTime.equals(i,y))){var b=l.collectionView,R=b instanceof CollectionView&&v!=b.currentEditItem&&b.trackChanges,E=null;R&&(E=b._extend({},v));C.setValue(v,i);if(R){var S=new NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Change,v,b.items.indexOf(v));b.onCollectionChanged(S,E)}}}else{s._ubv||(s._ubv={});s._ubv[a._hash]=i}n&&l&&l.invalidate();return!0};GridPanel.prototype._getRowData=function(e){var t,i=this._g,o=this._rows[asNumber(e,!1,!0)],n=null,r=[];if(null!=o){var l=null,s=o instanceof GroupRow;s&&o.dataItem instanceof CollectionViewGroup&&!i.childItemsPath&&(l=o.dataItem);for(var a=!l&&o.dataItem,c=0;c<i.columns.length;c++){var u=t=this._cols[c];a&&i&&(u=i._getBindingColumn(this,e,t));u.binding?n=u._binding.getValue(o.dataItem):o._ubv&&(n=o._ubv[t._hash]);null==n&&(n=this._getSpecialData(e,o,c,t,u,s,l,n));r[c]=n}}return r};GridPanel.prototype._getSpecialData=function(e,t,i,o,n,r,l,s){var a=s,c=CellType;switch(this._ct){case c.TopLeft:case c.ColumnHeader:e!=this._rows.length-1&&n==o||(a=n.header);break;case c.ColumnFooter:if(r&&n.aggregate!=Aggregate.None){var u=this._g.collectionView;if(u){var h=tryCast(u,CollectionView);a=h?h.getAggregate(n.aggregate,n.binding):getAggregate(n.aggregate,u.items,n.binding)}}break;case c.Cell:var d=void 0,p=softRestCollectionView()&&this._g.collectionView instanceof softRestCollectionView().RestCollectionView;p&&(d=this._g.collectionView);if(t instanceof GroupRow)if(i==this._cols.firstVisibleIndex)a=t.getGroupHeader();else if(p&&(d.groupLazyLoading||d.virtualization)){var f=t.dataItem;a=d.getGroupAggregate(n.binding,f,n.aggregate)}else l&&n.aggregate!=Aggregate.None&&(a=l.getAggregate(n.aggregate,n.binding,this._g.collectionView,this._g))}return a};GridPanel.prototype.getCellBoundingRect=function(e,t,i){var o=this._g,n=this.rows[e],r=this.columns[this._toIndex(t)],l=this.rows._frozenInternal<0&&this.rows.isFrozen(e)&&o._hasScroll(this.rows)?this._g._szClient.height+n._antipos:n.pos,s=this.columns._frozenInternal<0&&this.columns.isFrozen(Number(t))&&o._hasScroll(this.columns)?this._g._szClient.width+r._antipos:r.pos,a=new Rect(s,l,r.renderSize,n.renderSize);if(o.rightToLeft){a.left=this.hostElement.clientWidth-a.right;isIE()||(a.left-=o._root.offsetWidth-o._root.clientWidth)}if(!i){var c=this.hostElement.getBoundingClientRect();a.left+=c.left;a.top+=c.top-this._offsetY}this.rows.isFrozen(e)&&(this.rows._frozenInternal>0||!this.rows.isFrozen(this.rows._firstVisible))&&(a.top-=o.scrollPosition.y);this.columns.isFrozen(Number(t))&&(a.left-=o.scrollPosition.x*(o.rightToLeft?-1:1));return a};GridPanel.prototype.getCellElement=function(e,t){var i=this.hostElement.children,o=this._g.rows._frozenInternal<0?i.length:Math.min(e+2,i.length);t=this._toIndex(t);for(var n=0;n<o;n++)for(var r=i[n].children,l=this._g.columns._frozenInternal<0?r.length:Math.min(t+2,r.length),s=0;s<l;s++){var a=r[s],c=a[GridPanel._INDEX_KEY];if(c&&(c.row==e&&c.col==t||c.rng&&c.rng.contains(e,t)))return a}return null};GridPanel.prototype.getSelectedState=function(e,t,i){var o=this._g,n=o.selectionMode,r=o._selHdl.selection,l=SelectionMode,s=SelectedState;if(n==l.None)return s.None;t=this._toIndex(t);switch(this._ct){case CellType.Cell:if(o.activePanelType!=this.cellType){i||(i=o.getMergedRange(this,e,t)||new CellRange(e,t));for(var a=i.leftCol;a<=i.rightCol;a++)if(o.columns[a]&&o.columns[a].isSelected)return s.Selected;for(var c=i.topRow;c<=i.bottomRow;c++)if(o.rows[c].isSelected)return s.Selected;return s.None}i||(i=o.getMergedRange(this,e,t));var u=o._getAnchorCell();if(i){if(i.contains(r.row,r.col)){if(!o.anchorCursor||null==u)return o.showMarquee?s.Active:s.Cursor;if(e==u.y&&t==u.x||i.row==u.y&&i.col==u.x)return o.showMarquee?s.Active:s.Cursor}if(i.intersects(r)&&o.anchorCursor&&null!=u&&(e==u.y&&t==u.x||i.row==u.y&&i.col==u.x))return o.showMarquee?s.Active:s.Cursor;if(i.intersects(r)&&n!=l.ListBox)return s.Selected;for(a=i.leftCol;a<=i.rightCol;a++)if(o.columns[a]&&o.columns[a].isSelected)return s.Selected;for(c=i.topRow;c<=i.bottomRow;c++)if(o.rows[c].isSelected)return s.Selected}if(o.anchorCursor&&null!=u){if(e==u.y&&t==u.x)return o.showMarquee?s.Active:s.Cursor}else if(r.row==e&&r.col==t)return o.showMarquee?s.Active:s.Cursor;if(o.rows[e].isSelected||o.columns[t].isSelected)return s.Selected;if(n==l.MultiRange)for(var h=o._selHdl.extendedSelection,d=0;d<h.length;d++)if(h[d].contains(e,t)||i&&i.intersects(h[d]))return s.Selected;if(i)switch(n){case l.Row:case l.RowRange:if(i.containsRow(r.row))return s.Selected}return n==l.ListBox?s.None:(r=this._getAdjustedSelection(r)).containsRow(e)&&r.containsColumn(t)?s.Selected:s.None;case CellType.ColumnHeader:if(o.activePanelType==CellType.ColumnHeader){i||(i=o.getMergedRange(this,e,t,!1));if(i&&i.contains(r))return s.Cursor;if(r.row==e&&r.col==t)return s.Cursor}if(o.activePanelType==CellType.Cell&&o.showSelectedHeaders&HeadersVisibility.Column&&(o.columns[t].isSelected||r.containsColumn(t)||r.intersectsColumn(i))){i&&(e=i.bottomRow);if(e==this.rows.length-1)return s.Selected}break;case CellType.RowHeader:if(o.activePanelType==CellType.RowHeader){i||(i=o.getMergedRange(this,e,t,!1));if(i&&i.contains(r))return s.Cursor;if(r.row==e&&r.col==t)return s.Cursor}if(o.activePanelType==CellType.Cell&&o.showSelectedHeaders&HeadersVisibility.Row&&(o.rows[e].isSelected||r.containsRow(e)||r.intersectsRow(i))){i&&(t=i.rightCol);if(t==this.columns.length-1)return s.Selected}break;case CellType.TopLeft:if(o.activePanelType==CellType.TopLeft){i||(i=o.getMergedRange(this,e,t,!1));if(i&&i.contains(r))return s.Cursor;if(r.row==e&&r.col==t)return s.Cursor}}return s.None};Object.defineProperty(GridPanel.prototype,"hostElement",{get:function(){return this._e},enumerable:!0,configurable:!0});GridPanel.prototype.isRangeValid=function(e){return e&&e.isValid&&e.bottomRow<this.rows.length&&e.rightCol<this.columns.length};GridPanel.prototype.getNextVisibleRow=function(e){void 0===e&&(e=0);for(var t=Math.max(e,0);t<this.rows.length;t++)if(this.rows[t].isVisible)return t;return-1};GridPanel.prototype.getLastVisibleRow=function(e){void 0===e&&(e=1/0);for(var t=Math.min(e,this.rows.length-1);t>=0;t--)if(this.rows[t].isVisible)return t;return-1};GridPanel.prototype.getNextVisibleColumn=function(e){void 0===e&&(e=0);for(var t=Math.max(e,0);t<this.columns.length;t++)if(this.columns[t].isVisible)return t;return-1};GridPanel.prototype.getLastVisibleColumn=function(e){void 0===e&&(e=1/0);for(var t=Math.min(e,this.columns.length-1);t>=0;t--)if(this.columns[t].isVisible)return t;return-1};GridPanel.prototype._toIndex=function(e){if(isString(e)&&(e=this._cols.indexOf(e))<0)throw"Invalid column name or binding.";return e};GridPanel.prototype._getAdjustedSelection=function(e){var t=this._g,i=this._rng,o=SelectionMode;switch(t.selectionMode){case o.Cell:i.setRange(e.row,e.col,e.row,e.col);break;case o.Row:i.setRange(e.row,0,e.row,t.columns.length-1);break;case o.RowRange:case o.ListBox:i.setRange(e.row,0,e.row2,t.columns.length-1);break;default:i.copy(e)}return i};GridPanel.prototype._getOffsetY=function(){return this._offsetY};GridPanel.prototype._updateContent=function(e,t,i){var o=this._g,n=this._e,r=this._rows,l=this._cols,s=this._ct;if(s==CellType.ColumnHeader||s==CellType.ColumnFooter||s==CellType.RowHeader){var a=o._ptScrl,c=n.style;s==CellType.RowHeader?c.top=a.y+"px":o.rightToLeft?c.right=a.x+"px":c.left=a.x+"px"}switch(s){case CellType.RowHeader:setAttribute(this.hostElement.parentElement,"aria-hidden",!(o.headersFocusability&HeadersFocusability.Row));break;case CellType.ColumnHeader:setAttribute(this.hostElement.parentElement,"aria-hidden",!(o.headersFocusability&HeadersFocusability.Column));break;case CellType.TopLeft:setAttribute(this.hostElement.parentElement,"aria-hidden",!(o.headersFocusability&HeadersFocusability.All))}if(this._offsetY!=i){e=!1;this._offsetY=i}var u=this._getViewRange(),h=u;if(h.isValid){var d=r.length<=o._vtRows?r.length:0,p=l.length<=o._vtCols?l.length:0,f=r._frozenInternal>=0?Math.max(u.row-d,r._frozenInternal):Math.max(u.row-d,0),g=r._frozenInternal>=0?Math.min(u.row2+d,r.length-1):Math.min(u.row2+d,r.length-1+r._frozenInternal),_=l._frozenInternal>=0?Math.max(u.col-p,l._frozenInternal):Math.max(u.col-p,0),m=l._frozenInternal>=0?Math.min(u.col2+p,l.length-1):Math.min(u.col2+p,l.length-1+l._frozenInternal);h=new CellRange(f,_,g,m)}if(e&&!t&&this._vrb.contains(u)&&!r._frozenInternal&&!l._frozenInternal)return this._activeCell;e&&h.equals(this._vrb)||(t=!1);e&&!t&&this._ct!=CellType.TopLeft&&this._reorderCells(h,this._vrb);this._activeCell=null;this._vru=u;this._vrb=h;this._recycle=e;var w=0;this._ct!=CellType.Cell||isiOS()||(w=this._renderColHdrRow(h,t));this._updateCells(t,w);return this._activeCell};GridPanel.prototype._updateCells=function(e,t){this._e;var i=this._rows;if(i._frozenInternal>0)for(var o=0;o<i._frozenInternal&&o<i.length;o++)t=this._renderRow(o,this._vrb,e,t);else if(i._frozenInternal<0)for(o=i._lastFrozen;o<i.length;o++)t=this._renderRow(o,this._vrb,e,t);for(o=this._vrb.topRow;o<=this._vrb.bottomRow&&o>-1;o++)t=this._renderRow(o,this._vrb,e,t);this._scanAndRemoveExtraCells(t)};GridPanel.prototype._scanAndRemoveExtraCells=function(e){for(var t=this._e;t.childElementCount>e;){var i=t.lastElementChild;removeChild(i);this._removeExtraCells(i,0)}};GridPanel.prototype._clearCells=function(){for(var e=this.hostElement,t=this._g.cellFactory,i=e.childElementCount-1;i>=0;i--){for(var o=e.children[i],n=o.childElementCount-1;n>=0;n--)t.disposeCell(o.children[n]);removeChild(o)}};GridPanel.prototype._reorderCells=function(e,t){var i=this;if(this._g._reorderCells&&t.isValid&&e.isValid&&e.intersects(t)){var relocateForScrollToBeginning=function(e,t,o,n,r,l){assert(o<0,"Scroll delta must be a negative number");var s,a,c=-o,u=t+(n-r+1),h=e.childElementCount-u;if(h<c&&h>0){s=h;a=c-h}else{s=c;a=0}if(s>0){var d=i._createRange(e,u,u+s);d&&e.insertBefore(d.extractContents(),e.children[t])}if(a>0)for(var p=e.children[t],f=0;f<a;f++){var g=document.createElement("div");g.className=l;e.insertBefore(g,p)}};if(e.row!=t.row){var o=this._e;if(0!=(a=e.row-t.row)){var n=this._ct==CellType.Cell?1:0,r=o.childElementCount;this.rows._frozenInternal>0&&(n+=this.rows._frozenInternal);if(a>0){var l=n,s=Math.min(n+a,r);(d=this._createRange(o,l,s))&&o.appendChild(d.extractContents())}else relocateForScrollToBeginning(o,n,a,e.row2,t.row,"wj-row")}}if(e.col!=t.col){var a;o=this._e;if(0!=(a=e.col-t.col)){n=this._ct==CellType.Cell&&this._g.rowHeaderPath?1:0;this.columns._frozenInternal>=0&&(n+=this.columns._frozenInternal);for(var c=0;c<o.children.length;c++){var u=o.children[c],h=r=u.children.length;this.columns._frozenInternal<0&&(h+=this.columns._frozenInternal);if(hasClass(u,"wj-row"))if(a>0){var d;l=n,s=Math.min(n+a,h);(d=this._createRange(u,l,s))&&u.appendChild(d.extractContents())}else relocateForScrollToBeginning(u,n,a,e.col2,t.col,"wj-cell")}}}}};GridPanel.prototype._createRange=function(e,t,i){if(i>t&&i<=e.children.length&&t>-1){this._docRange||(this._docRange=document.createRange());var o=this._docRange;o.setStart(e,t);o.setEnd(e,i);return o}return null};GridPanel.prototype._renderColHdrRow=function(e,t){if(t)return 1;var i=this._e.children[0];i||(i=createElement('<div class="wj-row" role="row"></div>',this._e));var o=this._g,n=o?o.columnHeaders.rows.ariaLabel:null;setAttribute(i,"aria-label",n);setAttribute(i,"aria-selected",null);var r=0,l=this._g._getRowHeaderPath();l&&(r=this._renderRowHdrCell(i,-1,l.path));for(var s=0;s<this.columns._frozenInternal&&s<this.columns.length;s++)r=this._renderColHdrCell(i,s,e,t,r);for(s=e.leftCol;s<=e.rightCol&&s>-1;s++)r=this._renderColHdrCell(i,s,e,t,r);([HeadersVisibility.None,HeadersVisibility.Row].includes(o.headersVisibility)||o.headersFocusability&HeadersFocusability.Column)&&setAttribute(i.closest(".wj-row"),"aria-hidden","true");this._removeExtraCells(i,r);return 1};GridPanel.prototype._renderColHdrCell=function(e,t,i,o,n){var r=this.grid,l=this.columns[t];if(l.renderSize<=0)return n;if(o)return n+1;var s=e.children[n];s||(s=createElement(GridPanel._HTML_CELL,e));if(s&&this._recycle&&r._lazyRender){var a=s[GridPanel._INDEX_KEY];if(a&&-1==a.row&&a.col==t&&!this.columns.isFrozen(t))return n+1}s.textContent=this.columns[t].header;setCss(s,{position:"fixed",left:l.pos,top:-32e3,width:l.renderSize,height:.1,overflow:"hidden",opacity:"0",pointerEvents:"none"});colHdrAriaAttributes(s,l,this,r);s[GridPanel._INDEX_KEY]={row:-1,col:t,panel:this};return n+1};GridPanel.prototype._renderRowHdrCell=function(e,t,i){var o=e.children[0];o||(o=createElement(GridPanel._HTML_CELL,e));o.setAttribute("role",t<0?"columnheader":"rowheader");o.textContent=i?i.toString():"";setCss(o,{position:"fixed",left:-32e3,top:-32e3,width:.1,height:.1,overflow:"hidden",opacity:"0"});o[GridPanel._INDEX_KEY]={row:t,col:-1,panel:this};return 1};GridPanel.prototype._renderRow=function(e,t,i,o){var n=this._g,r=this.rows[e];if(r.renderSize<=0)return o;var l=this._e.children[o];l||(l=createElement('<div class="wj-row"></div>',this._e));switch(this._ct){case CellType.ColumnHeader:case CellType.TopLeft:setAttribute(l,"aria-rowindex",e+1);break;case CellType.Cell:case CellType.RowHeader:setAttribute(l,"aria-rowindex",e+1+(this._g.headersVisibility&HeadersVisibility.Column?this._g.columnHeaders.rows.length:0));break;default:setAttribute(l,"aria-rowindex",e+1)}if(this._ct==CellType.Cell){l.setAttribute("role","row");var s=SelectionMode,a=r.isSelected;switch(n.selectionMode){case s.Row:case s.RowRange:a=a||this._g._selHdl.selection.containsRow(e)}setAttribute(l,"aria-selected",!!a||null);setAttribute(l,"aria-level",r instanceof GroupRow?r.level+1:null);setAttribute(l,"aria-expanded",r instanceof GroupRow?!r.isCollapsed:null);this.rows.ariaLabel&&setAttribute(l,"aria-label",this.rows.ariaLabel)}this._ct===CellType.TopLeft&&l.setAttribute("role","row");var c=0;if(this._ct==CellType.Cell){var u=this._g._getRowHeaderPath();u&&(c=this._renderRowHdrCell(l,e,u.getValue(r.dataItem)))}var h=t.clone();h.col=this.columns._frozenInternal>=0?0:this.columns.length+this.columns._frozenInternal;h.col2=this.columns._frozenInternal>=0?this.columns._frozenInternal-1:this.columns.length-1;if(this.columns._frozenInternal>=0)for(var d=0;d<this.columns._frozenInternal&&d<this.columns.length;d++)c=this._renderCell(l,e,d,h,i,c);else for(d=Math.max(0,this.columns.length-1+this.columns._frozenInternal);d<this.columns.length;d++)c=this._renderCell(l,e,d,h,i,c);if(t.leftCol>-1){var p=n.getMergedRange(this,e,t.leftCol,!1),f=-1;if(p){f=p.leftCol;for(;!this.columns[f].isVisible&&f<p.rightCol;)f++}p&&f<t.leftCol&&(c=this._renderCell(l,e,f,t,i,c))}for(d=t.leftCol;d<=t.rightCol&&d>-1;d++)c=this._renderCell(l,e,d,t,i,c);this._removeExtraCells(l,c);return o+1};GridPanel.prototype._renderCell=function(e,t,i,o,n,r){var l=this._g,s=l.getMergedRange(this,t,i,!1);if(s){for(var a=Math.max(o.row,s.row);a<t;a++)if(this.rows[a].renderSize)return r;for(a=Math.max(o.col,s.col);a<i;a++)if(this.columns[a].renderSize)return r;if(t>=s.row&&t<=s.row2&&i>s.col&&i<=s.col2&&this._ct===CellType.Cell&&s.isSingleCell)return r;var c=this.columns._frozenInternal;if(c&&s.col<c&&s.col2>=c&&i>s.col)return r;if(!this.columns[i].isVisible&&"DetailRow"!==this._rows[t].constructor.name)return r;if(s.leftCol!=i)for(var u=s.leftCol;u<i;u++)if(this.columns[u].isVisible)return r}var h=this.columns[i];if((!h||h.renderSize<=0)&&(!s||s.getRenderSize(this).width<=0))return r;var d=e.children[r];if(d&&!n&&this._recycle&&l._lazyRender&&!l.activeEditor){var p=d[GridPanel._INDEX_KEY];p&&p.row==t&&p.col==i&&p.rng==s&&(this.rows.isFrozen(t)||this.columns.isFrozen(i)||(n=!0))}var f=SelectedState,g=this.getSelectedState(t,i,s),_=g==f.Cursor||g==f.Active,m=!1;switch(this.cellType){case CellType.RowHeader:case CellType.ColumnHeader:case CellType.TopLeft:m=!0}if(d&&n){toggleClass(d,"wj-state-active",_);toggleClass(d,m?"wj-focus-header-cell":"wj-state-selected",g==f.Cursor);toggleClass(d,"wj-state-multi-selected",g==f.Selected);var w=d.querySelector(".wj-column-selector");w?_||g!=f.None?setAttribute(d,"aria-selected",!!w.checked):setAttribute(d,"aria-selected",null):setAttribute(d,"aria-selected",!(!_&&g==f.None)||null);_&&(this._activeCell=d);return r+1}d||(d=createElement(GridPanel._HTML_CELL,e));setAttribute(d,"aria-colindex",i+1);_&&(this._activeCell=d);if(this._ct==CellType.Cell){setAttribute(d,"role","gridcell");setAttribute(d,"aria-selected",!(g==f.None&&!_)||null);var C=!l.canEditCell(t,i)||null;setAttribute(d,"aria-readonly",C);setAttribute(d,"aria-required",C?null:h.getIsRequired())}l.cellFactory.updateCell(this,t,i,d,s);d[GridPanel._INDEX_KEY]={row:t,col:i,rng:s,panel:this};return r+1};GridPanel.prototype._removeExtraCells=function(e,t){for(var i=this._g.cellFactory;e.childElementCount>t;){var o=e.lastElementChild;removeChild(o);i.disposeCell(o)}};GridPanel.prototype._getViewRange=function(){var e=this._g,t=e._ptScrl,i=e._szClientSB,o=this._rows,n=this._cols,r=new CellRange(0,0,o.length-1,n.length-1);if(this._ct==CellType.Cell||this._ct==CellType.RowHeader){var l=-t.y+this._offsetY,s=i.height;if((h=Math.min(Math.abs(o._frozenInternal),o.length-1))>0)if(o._frozenInternal>=0){l+=f=o[h-1].pos;s-=f}else{s+=f=o[o.length-h]._antipos}if(o._frozenInternal>=0)if(h>0&&o[h].pos>i.height)r.row=r.row2=-1;else{r.row=Math.min(o.length-1,Math.max(h,o.getItemAt(l)));r.row2=Math.max(r.row,o.getItemAt(l+s))}else if(h>0&&o[o.length-h]._antipos+i.height<0)r.row=r.row2=-1;else{r.row=Math.min(o.length+o._frozenInternal-1,o.getItemAt(l));r.row2=Math.max(r.row,o.getItemAt(l+s));e.columnFooters.rows.length>0&&(r.row2-=e.columnFooters.rows.length)}var a=e.hostElement;if(e._clipToScreen&&a){var c=a.getBoundingClientRect(),u=-c.top-e.cells._e.offsetTop;c.top<0&&(r.row=Math.max(r.row,o.getItemAt(u)-1));c.bottom>innerHeight&&(r.row2=Math.min(r.row2,o.getItemAt(u+innerHeight)+1))}}if(this._ct==CellType.Cell||this._ct==CellType.ColumnHeader){var h,d=-t.x,p=i.width;if((h=Math.min(Math.abs(n._frozenInternal),n.length-1))>0&&n._frozenInternal>0){d+=f=n[h-1].pos;p-=f}else if(h>0&&n._frozenInternal<0){var f;d+=f=n[0].pos}if(n._frozenInternal>=0?h>0&&n[h].pos>i.width:h>0&&Math.abs(n[n.length-h]._antipos)>i.width)r.col=r.col2=-1;else if(n._frozenInternal>=0){r.col=Math.min(n.length-1,Math.max(h,n.getItemAt(d)));r.col2=Math.max(r.col,n.getItemAt(d+p))}else{r.col=Math.min(n.length-1,Math.max(0,n.getItemAt(d)));r.col2=Math.max(r.col,n.getItemAt(d+p-n._frozenColAreaWidth))}}o.length<=Math.abs(o._frozenInternal)&&(r.row=r.row2=-1);n.length<=Math.abs(n._frozenInternal)&&(r.col=r.col2=-1);return r};GridPanel.prototype._getFrozenPos=function(){var e=this._rows._frozenInternal,t=this._cols._frozenInternal,i=null,o=null,n=0,r=0;e>0?n=(i=e>0?this._rows[e-1]:null)?i.pos+i.renderSize:0:e<0&&this._rows.lastFrozen&&(n=Math.min(this._rows.lastFrozen.pos,this._g._szClient.height+this._rows.lastFrozen._antipos));t>0?r=(o=t>0?this._cols[t-1]:null)?o.pos+o.renderSize:0:t<0&&this._cols.lastFrozen&&(r=Math.min(this._cols.lastFrozen.pos,this._g._szClient.width+this._cols.lastFrozen._antipos));return new Point(r,n)};GridPanel._INDEX_KEY="wj-cell-index";GridPanel._HTML_CELL='<div class="wj-cell" tabindex="-1"></div>';return GridPanel}();export{GridPanel};export var RowColFlags;!function(e){e[e.Visible=1]="Visible";e[e.AllowResizing=2]="AllowResizing";e[e.AllowDragging=4]="AllowDragging";e[e.AllowMerging=8]="AllowMerging";e[e.AllowSorting=16]="AllowSorting";e[e.AutoGenerated=32]="AutoGenerated";e[e.Collapsed=64]="Collapsed";e[e.ParentCollapsed=128]="ParentCollapsed";e[e.Selected=256]="Selected";e[e.ReadOnly=512]="ReadOnly";e[e.HtmlContent=1024]="HtmlContent";e[e.WordWrap=2048]="WordWrap";e[e.MultiLine=4096]="MultiLine";e[e.HasTemplate=8192]="HasTemplate";e[e.RowDefault=3]="RowDefault";e[e.ColumnDefault=23]="ColumnDefault"}(RowColFlags||(RowColFlags={}));var RowCol=function(){function RowCol(){this._type=null;this._align=null;this._inpType=null;this._mask=null;this._maxLen=null;this._required=null;this._fmt=null;this._map=null;this._ddCssClass=null;this._cssClass=null;this._cssClassAll=null;this._szMin=null;this._szMax=null;this._sz=null;this._pos=0;this._antipos=0;this._idx=-1;this._idxVis=-1;this._idxData=-1;this.gridChanged=new Event}Object.defineProperty(RowCol.prototype,"binding",{get:function(){return this._binding?this._binding.path:null},set:function(e){if(e!=this.binding){var t=asString(e);this._binding=t?new Binding(t):null;if(!this._type&&this.grid&&this._binding){var i=this.grid.collectionView;if(i&&i.sourceCollection&&i.sourceCollection.length){var o=i.sourceCollection[0];this._type=getType(this._binding.getValue(o))}}this.onPropertyChanged()}},enumerable:!0,configurable:!0});Object.defineProperty(RowCol.prototype,"sortMemberPath",{get:function(){return this._bindingSort?this._bindingSort.path:null},set:function(e){if(e!=this.sortMemberPath){var t=asString(e);this._bindingSort=t?new Binding(t):null;this.onPropertyChanged()}},enumerable:!0,configurable:!0});Object.defineProperty(RowCol.prototype,"dataType",{get:function(){return this._type},set:function(e){e=asEnum(e,DataType,!0);if(this._type!=e){this._type=e;this.grid&&this.grid.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(RowCol.prototype,"inputType",{get:function(){return this._inpType},set:function(e){this._inpType=asString(e,!0)},enumerable:!0,configurable:!0});Object.defineProperty(RowCol.prototype,"mask",{get:function(){return this._mask},set:function(e){this._mask=asString(e,!0)},enumerable:!0,configurable:!0});Object.defineProperty(RowCol.prototype,"maxLength",{get:function(){return this._maxLen},set:function(e){this._maxLen=asNumber(e,!0,!0)},enumerable:!0,configurable:!0});Object.defineProperty(RowCol.prototype,"align",{get:function(){return this._align},set:function(e){if(this._align!=e){this._align=e;this.onPropertyChanged()}},enumerable:!0,configurable:!0});Object.defineProperty(RowCol.prototype,"format",{get:function(){return this._fmt},set:function(e){if(this._fmt!=e){this._fmt=e;this.onPropertyChanged()}},enumerable:!0,configurable:!0});Object.defineProperty(RowCol.prototype,"dataMap",{get:function(){return this._map},set:function(e){if(this._map!=e){this._map&&this._map.mapChanged.removeHandler(this.onPropertyChanged,this);isArray(e)&&(e=new DataMap(e,null,null));this._map=asType(e,DataMap,!0);this._map&&this._map.mapChanged.addHandler(this.onPropertyChanged,this);this.onPropertyChanged()}},enumerable:!0,configurable:!0});Object.defineProperty(RowCol.prototype,"dataMapEditor",{get:function(){return null!=this._mapEditor?this._mapEditor:DataMapEditor.DropDownList},set:function(e){if(e!=this._mapEditor){this._mapEditor=asEnum(e,DataMapEditor);this.grid&&this.grid.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(RowCol.prototype,"showDropDown",{get:function(){return this.dataMapEditor==DataMapEditor.DropDownList},set:function(e){_deprecated("showDropDown","dataMapEditor");this.dataMapEditor=e?DataMapEditor.DropDownList:DataMapEditor.AutoComplete},enumerable:!0,configurable:!0});Object.defineProperty(RowCol.prototype,"dropDownCssClass",{get:function(){return this._ddCssClass},set:function(e){this._ddCssClass=asString(e)},enumerable:!0,configurable:!0});Object.defineProperty(RowCol.prototype,"visible",{get:function(){return this._getFlag(RowColFlags.Visible)},set:function(e){this._setFlag(RowColFlags.Visible,e)},enumerable:!0,configurable:!0});Object.defineProperty(RowCol.prototype,"isVisible",{get:function(){return!!this._getFlag(RowColFlags.Visible)&&(!this._getFlag(RowColFlags.ParentCollapsed)||this instanceof _NewRowTemplate)},enumerable:!0,configurable:!0});Object.defineProperty(RowCol.prototype,"pos",{get:function(){this._list&&this._list._dirty&&this._list._update();return this._pos},enumerable:!0,configurable:!0});Object.defineProperty(RowCol.prototype,"index",{get:function(){this._list&&this._list._dirty&&this._list._update();return this._idx},enumerable:!0,configurable:!0});Object.defineProperty(RowCol.prototype,"visibleIndex",{get:function(){this._list&&this._list._dirty&&this._list._update();return this.isVisible?this._idxVis:-1},enumerable:!0,configurable:!0});Object.defineProperty(RowCol.prototype,"size",{get:function(){return this._sz},set:function(e){if(e!=this._sz){this._sz=asNumber(e,!0);this.onPropertyChanged()}},enumerable:!0,configurable:!0});Object.defineProperty(RowCol.prototype,"renderSize",{get:function(){var e=0,t=this._list;if(this.isVisible){(null==(e=this._sz)||e<0)&&(e=t?t.defaultSize:0);t&&null!=t.minSize&&e<t.minSize&&(e=t.minSize);t&&null!=t.maxSize&&e>t.maxSize&&(e=t.maxSize);null!=this._szMin&&e<this._szMin&&(e=this._szMin);null!=this._szMax&&e>this._szMax&&(e=this._szMax)}return e},enumerable:!0,configurable:!0});Object.defineProperty(RowCol.prototype,"allowResizing",{get:function(){return this._getFlag(RowColFlags.AllowResizing)},set:function(e){this._setFlag(RowColFlags.AllowResizing,e)},enumerable:!0,configurable:!0});Object.defineProperty(RowCol.prototype,"allowDragging",{get:function(){return this._getFlag(RowColFlags.AllowDragging)},set:function(e){this._setFlag(RowColFlags.AllowDragging,e)},enumerable:!0,configurable:!0});Object.defineProperty(RowCol.prototype,"allowMerging",{get:function(){return this._getFlag(RowColFlags.AllowMerging)},set:function(e){this._setFlag(RowColFlags.AllowMerging,e)},enumerable:!0,configurable:!0});Object.defineProperty(RowCol.prototype,"isSelected",{get:function(){return this._getFlag(RowColFlags.Selected)},set:function(e){if(!!e!=this.isSelected){var t=this.grid;if(t){var i=new CellRangeEventArgs(t?t.cells:null,t.selection);if(t.onSelectionChanging(i)&&this._setFlag(RowColFlags.Selected,e,!0)){t.refreshCells(!1,!0,!0);t.onSelectionChanged(i)}}else this._setFlag(RowColFlags.Selected,e)}},enumerable:!0,configurable:!0});Object.defineProperty(RowCol.prototype,"isReadOnly",{get:function(){return this._getFlag(RowColFlags.ReadOnly)},set:function(e){this._setFlag(RowColFlags.ReadOnly,e)},enumerable:!0,configurable:!0});Object.defineProperty(RowCol.prototype,"isRequired",{get:function(){return this._required},set:function(e){this._required=asBoolean(e,!0)},enumerable:!0,configurable:!0});Object.defineProperty(RowCol.prototype,"isContentHtml",{get:function(){return this._getFlag(RowColFlags.HtmlContent)},set:function(e){if(this.isContentHtml!=e){this._setFlag(RowColFlags.HtmlContent,e);this.grid&&this.grid.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(RowCol.prototype,"wordWrap",{get:function(){return this._getFlag(RowColFlags.WordWrap)},set:function(e){this._setFlag(RowColFlags.WordWrap,e)},enumerable:!0,configurable:!0});Object.defineProperty(RowCol.prototype,"multiLine",{get:function(){return this._getFlag(RowColFlags.MultiLine)},set:function(e){this._setFlag(RowColFlags.MultiLine,e)},enumerable:!0,configurable:!0});Object.defineProperty(RowCol.prototype,"cssClass",{get:function(){return this._cssClass},set:function(e){if(e!=this._cssClass){this._cssClass=asString(e);this.grid&&this.grid.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(RowCol.prototype,"cssClassAll",{get:function(){return this._cssClassAll},set:function(e){if(e!=this._cssClassAll){this._cssClassAll=asString(e);this.grid&&this.grid.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(RowCol.prototype,"grid",{get:function(){return this._list?this._list._g:null},enumerable:!0,configurable:!0});Object.defineProperty(RowCol.prototype,"collectionView",{get:function(){return this.grid?this.grid.collectionView:null},enumerable:!0,configurable:!0});RowCol.prototype.onPropertyChanged=function(){if(this._list){this._list._dirty=!0;this.grid.invalidate()}};RowCol.prototype.onGridChanged=function(e){this.gridChanged.raise(this,e)};RowCol.prototype._setList=function(e){if(e!=this._list){this._list=e;this.onGridChanged()}};RowCol.prototype._getFlag=function(e){return 0!=(this._f&e)};RowCol.prototype._setFlag=function(e,t,i){if(!!t!=this._getFlag(e)){this._f=t?this._f|e:this._f&~e;i||this.onPropertyChanged();return!0}return!1};return RowCol}();export{RowCol};var Column=function(e){__extends(Column,e);function Column(t){var i=e.call(this)||this;i._hdr=null;i._name=null;i._agg=null;i._quickSize=null;i._descById=null;i._tpl=null;i._f=RowColFlags.ColumnDefault;i._hash=Column._ctr.toString(36);Column._ctr++;copy(i,t);i._uid=uidGenerator();return i}Object.defineProperty(Column.prototype,"name",{get:function(){return this._name},set:function(e){this._name=e},enumerable:!0,configurable:!0});Object.defineProperty(Column.prototype,"width",{get:function(){return null!=this._szStar?this._szStar:this.size},set:function(e){if(null!=Column._parseStarSize(e)){this._szStar=e;this.onPropertyChanged()}else{this._szStar=null;this.size=asNumber(e,!0)}},enumerable:!0,configurable:!0});Object.defineProperty(Column.prototype,"minWidth",{get:function(){return this._szMin},set:function(e){if(e!=this._szMin){this._szMin=asNumber(e,!0,!0);this.onPropertyChanged()}},enumerable:!0,configurable:!0});Object.defineProperty(Column.prototype,"maxWidth",{get:function(){return this._szMax},set:function(e){if(e!=this._szMax){this._szMax=asNumber(e,!0,!0);this.onPropertyChanged()}},enumerable:!0,configurable:!0});Object.defineProperty(Column.prototype,"quickAutoSize",{get:function(){return this._quickSize},set:function(e){this._quickSize=asBoolean(e,!0)},enumerable:!0,configurable:!0});Column.prototype._getQuickAutoSize=function(){return!!this.grid._getQuickAutoSize()&&(isBoolean(this._quickSize)?this._quickSize:!(this.isContentHtml||this.wordWrap||this.multiLine||this._getFlag(RowColFlags.HasTemplate)))};Object.defineProperty(Column.prototype,"renderWidth",{get:function(){return this.renderSize},enumerable:!0,configurable:!0});Object.defineProperty(Column.prototype,"header",{get:function(){return this._hdr?this._hdr:this.binding},set:function(e){if(this._hdr!=e){this._hdr=e;this.onPropertyChanged()}},enumerable:!0,configurable:!0});Object.defineProperty(Column.prototype,"cellTemplate",{get:function(){return this._tpl},set:function(e){if(e!=this._tpl){assert(null==e||isString(e)||isFunction(e),"cellTemplate should be a string or an ICellTemplateFunction.");this._tpl=e;this._setFlag(RowColFlags.HasTemplate,null!=e&&""!=e);this.onPropertyChanged()}},enumerable:!0,configurable:!0});Object.defineProperty(Column.prototype,"editor",{get:function(){var e=this._edt;return e?e.control:null},set:function(e){if(e!=this.editor){if(this._edt){this._edt.dispose();this._edt=null}if(null!=e){e=asType(e,Control);this._edt=new _CustomEditor(this,e)}}},enumerable:!0,configurable:!0});Object.defineProperty(Column.prototype,"allowSorting",{get:function(){return this._getFlag(RowColFlags.AllowSorting)},set:function(e){this._setFlag(RowColFlags.AllowSorting,e)},enumerable:!0,configurable:!0});Object.defineProperty(Column.prototype,"currentSort",{get:function(){var e=this.currentSortIndex;if(e>-1){return this.grid.collectionView.sortDescriptions[e].ascending?"+":"-"}return null},enumerable:!0,configurable:!0});Object.defineProperty(Column.prototype,"currentSortIndex",{get:function(){var e=this.grid?this.grid.collectionView:null,t=e?e.sortDescriptions:null,i=t&&t.length?this._getBindingSort():null;if(i)for(var o=0;o<t.length;o++)if(t[o].property==i)return o;return-1},enumerable:!0,configurable:!0});Object.defineProperty(Column.prototype,"aggregate",{get:function(){return null!=this._agg?this._agg:Aggregate.None},set:function(e){if((e=asEnum(e,Aggregate))!=this._agg){this._agg=e;this.onPropertyChanged()}},enumerable:!0,configurable:!0});Object.defineProperty(Column.prototype,"describedById",{get:function(){return this._descById},set:function(e){if(e!=this._descById){this._descById=asString(e);this.grid&&this.grid.invalidate()}},enumerable:!0,configurable:!0});Column.prototype.getIsRequired=function(e){return null!=this._required?this._required:e&&null!=e.isRequired?e.isRequired:this.dataType==DataType.String?null!=this.dataMap||null!=this._mask&&this._mask.length>0:!e||e.dataType!=DataType.String||(null!=e.dataMap||null!=e.mask&&e.mask.length>0)};Column.prototype.getAlignment=function(e){if(null!=this._align)return this._align;if(e&&null!=e.align)return e.align;if(!this._map)switch(this.dataType){case DataType.Boolean:return"center";case DataType.Number:return"right"}if(e&&!e.dataMap)switch(e.dataType){case DataType.Boolean:return"center";case DataType.Number:return"right"}return""};Column.prototype._getBindingSort=function(){return this.sortMemberPath?this.sortMemberPath:this.binding?this.binding:null};Column._parseStarSize=function(e){if(isString(e)){var t=e.length;if(t>0&&"*"==e[t-1]){var i=1==t?1:parseFloat(e);if(i>0&&!isNaN(i))return i}}return null};Column._ctr=0;return Column}(RowCol);export{Column};var Row=function(e){__extends(Row,e);function Row(t){var i=e.call(this)||this;i.resizedManually=!1;i._f=RowColFlags.ColumnDefault;i._data=t||null;return i}Object.defineProperty(Row.prototype,"dataItem",{get:function(){return this._data},set:function(e){this._data=e},enumerable:!0,configurable:!0});Object.defineProperty(Row.prototype,"dataIndex",{get:function(){this._list&&this._list._dirty&&this._list._update();return this._idxData},enumerable:!0,configurable:!0});Object.defineProperty(Row.prototype,"height",{get:function(){return this.size},set:function(e){this.size=e},enumerable:!0,configurable:!0});Object.defineProperty(Row.prototype,"renderHeight",{get:function(){return this.renderSize},enumerable:!0,configurable:!0});return Row}(RowCol);export{Row};var GroupRow=function(e){__extends(GroupRow,e);function GroupRow(t){var i=e.call(this,t)||this;i._level=-1;i._isSummary=!1;i.level=t instanceof CollectionViewGroup?t.level:-1;i.isReadOnly=!0;return i}Object.defineProperty(GroupRow.prototype,"isSummary",{get:function(){return this._isSummary},set:function(e){if(e!=this._isSummary){this._isSummary=asBoolean(e);this.onPropertyChanged()}},enumerable:!0,configurable:!0});Object.defineProperty(GroupRow.prototype,"level",{get:function(){return this._level},set:function(e){asInt(e);if(e!=this._level){this._level=e;this.onPropertyChanged()}},enumerable:!0,configurable:!0});Object.defineProperty(GroupRow.prototype,"hasChildren",{get:function(){if(this.isSummary)return!1;if(null!=this.grid&&null!=this._list){this._list._update();var e=this.index<this._list.length-1?this._list[this.index+1]:null,t=tryCast(e,GroupRow),i=tryCast(e,_NewRowTemplate);return null!=e&&null==i&&(null==t||t.level>this.level)}return!0},enumerable:!0,configurable:!0});Object.defineProperty(GroupRow.prototype,"isCollapsed",{get:function(){return this._getFlag(RowColFlags.Collapsed)},set:function(e){!!e==this.isCollapsed||null==this._list||this.isSummary||this._setCollapsed(asBoolean(e))},enumerable:!0,configurable:!0});GroupRow.prototype.getGroupHeader=function(){if(this.isSummary)return"";var e=this.grid,t=e.groupHeaderFormat||culture.FlexGrid.groupHeaderFormat,i=this.dataItem;i&&i instanceof CollectionViewGroup&&!this.hasChildren&&!this.isSummary&&0==i.items.length&&(t=null);if(i instanceof CollectionViewGroup&&t&&e.showGroups&&!e.childItemsPath){var o=i.groupDescription.propertyName,n=i.name,r=e.getColumn(o),l=this.isContentHtml;if(r){l=l||r.isContentHtml;r.header&&(o=r.header);var s=r.dataMap;s&&(n=s.getDisplayValue(n));r.dataType==getType(n)&&(n=Globalize.format(n,r.format))}else o=toHeaderCase(o);var a=i.getAggregate(Aggregate.CntAll,null,e.collectionView);return format(t,{name:escapeHtml(o),value:l?n:escapeHtml(n),level:i.level,count:a})}return""};GroupRow.prototype._setCollapsed=function(e){var t=this,i=this.grid,o=i.rows,n=this.getCellRange(),r=new CellRangeEventArgs(i.cells,new CellRange(this.index,-1));if(i.onGroupCollapsedChanging(r)){i.deferUpdate((function(){o.deferUpdate((function(){t._setFlag(RowColFlags.Collapsed,e,!0);for(var i=n.topRow+1;i<=n.bottomRow&&i>-1&&i<o.length;i++){o[i]._setFlag(RowColFlags.ParentCollapsed,e,!0);var r=o[i];r instanceof GroupRow&&r.isCollapsed&&(i=r.getCellRange().bottomRow)}}))}));i.onGroupCollapsedChanged(r)}};GroupRow.prototype.getCellRange=function(){for(var e=this._list,t=this.index,i=e.length-1,o=t+1;o<=i;o++){var n=e[o];if(n instanceof GroupRow&&n.level<=this.level){i=o-1;break}}if(this.grid.groupSummaryPosition===GroupSummaryPosition.Auto&&e.length>i&&e[i+1]instanceof GroupRow&&e[i+1].isSummary)do{i++}while(e[i+1]instanceof GroupRow&&e[i+1].isSummary&&e[i+1].dataItem==e[i].dataItem);return new CellRange(t,0,i,this.grid.columns.length-1)};return GroupRow}(Row);export{GroupRow};var RowColCollection=function(e){__extends(RowColCollection,e);function RowColCollection(t,i){var o=e.call(this)||this;o.frozenDetailChildren=0;o._frozen=0;o._frozenEnd=0;o._lastFrozen=-1;o._lastFrozenVisible=-1;o._lastUnfrozenVisible=-1;o._firstVisible=-1;o._vlen=0;o._szDef=28;o._szTot=0;o._szFrozen=0;o._szCustom=!1;o._dirty=!1;o._frozenColAreaWidth=0;o._g=asType(t,FlexGrid);o._szDef=asNumber(i,!1,!0);o._uid=uidGenerator();return o}Object.defineProperty(RowColCollection.prototype,"grid",{get:function(){return this._g},enumerable:!0,configurable:!0});Object.defineProperty(RowColCollection.prototype,"defaultSize",{get:function(){return this._szDef},set:function(e){this._szCustom=!0;if(this._szDef!=e){this._szDef=asNumber(e,!1,!0);this._dirty=!0;this._g.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(RowColCollection.prototype,"frozen",{get:function(){return this._frozen},set:function(e){assert(isNumber(e),"Positive number expected");if(isNumber(e)&&e!=this._frozen){this._frozen=asNumber(e,!1,!0);this._dirty=!0;this._g.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(RowColCollection.prototype,"frozenEnd",{get:function(){return this._frozenEnd},set:function(e){assert(isNumber(e),"Positive number expected");if(isNumber(e)&&e!=this._frozenEnd){this._frozenEnd=asNumber(e,!1,!0);this._dirty=!0;this._g.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(RowColCollection.prototype,"_frozenInternal",{get:function(){return this._frozen>0?this._frozen:-this._frozenEnd},set:function(e){if(e<0){this.frozen=0;this.frozenEnd=-e}else{this.frozen=e;this.frozenEnd=0}},enumerable:!0,configurable:!0});RowColCollection.prototype.isFrozen=function(e){return this._frozenInternal>=0?e<this._frozenInternal:e>=this._lastFrozen};Object.defineProperty(RowColCollection.prototype,"minSize",{get:function(){return this._szMin},set:function(e){if(e!=this._szMin){this._szMin=asNumber(e,!0,!0);this._dirty=!0;this._g.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(RowColCollection.prototype,"maxSize",{get:function(){return this._szMax},set:function(e){if(e!=this._szMax){this._szMax=asNumber(e,!0,!0);this._dirty=!0;this._g.invalidate()}},enumerable:!0,configurable:!0});RowColCollection.prototype.getTotalSize=function(){this._dirty&&this._update();return this._szTot};RowColCollection.prototype.getFrozenSize=function(){this._dirty&&this._update();return this._szFrozen};Object.defineProperty(RowColCollection.prototype,"visibleLength",{get:function(){this._dirty&&this._update();return this._vlen},enumerable:!0,configurable:!0});Object.defineProperty(RowColCollection.prototype,"lastFrozen",{get:function(){return-1!=this._lastFrozen?this[this._lastFrozen]:null},enumerable:!0,configurable:!0});RowColCollection.prototype.getItemAt=function(e){this._dirty&&this._update();if(e<=0&&this.length>0&&this[0].renderSize)return 0;for(var t,i,o=this.length,n=0,r=o-1;n<=r;)if((i=this[t=n+r>>>1])._pos>=e&&t>0)r=t-1;else{if(!(i._pos+i.renderSize<=e&&t<o-1)){for(;t>0&&!this[t].renderSize;)t--;for(;t<o-1&&!this[t].renderSize;)t++;return t}n=t+1}return r};RowColCollection.prototype.getNextCell=function(e,t,i){void 0===i&&(i=0);var o,n=SelMove;switch(t){case n.Next:case n.NextCell:for(o=e+1;o<this.length;o++)if(this[o].renderSize>0)return o;break;case n.NextEditableCell:for(o=e+1;o<this.length;o++)if(this[o].renderSize>0&&!this[o].isReadOnly)return o;break;case n.Prev:case n.PrevCell:for(o=e-1;o>=0;o--)if(this[o].renderSize>0)return o;break;case n.PrevEditableCell:for(o=e-1;o>=0;o--)if(this[o].renderSize>0&&!this[o].isReadOnly)return o;break;case n.End:for(o=this.length-1;o>=0;o--)if(this[o].renderSize>0)return o;break;case n.Home:for(o=0;o<this.length;o++)if(this[o].renderSize>0)return o;break;case n.NextPage:return(o=this.getItemAt(this[e].pos+this[e].renderSize+i))<0?this.getNextCell(e,SelMove.End,i):o==e&&o<this.length-1&&this[o+1].renderSize?o+1:o;case n.PrevPage:return(o=this.getItemAt(this[e].pos-i))<0?this.getNextCell(e,SelMove.Home,i):o==e&&o>0&&this[o-1].renderSize?o-1:o}return e};RowColCollection.prototype.canMoveElement=function(e,t,i){void 0===i&&(i=!0);if(t==e)return!1;if(e<0||e>=this.length||t>=this.length)return!1;if(i){t<0&&(t=this.length-1);for(var o=Math.min(e,t),n=Math.max(e,t),r=o;r<=n;r++)if(!this[r].allowDragging)return!1}return!(this[t]instanceof _NewRowTemplate)};RowColCollection.prototype.moveElement=function(e,t,i){void 0===i&&(i=!0);if(this.canMoveElement(e,t,i)){var o=this[e];this.removeAt(e);t<0&&(t=this.length);this.insert(t,o);i&&(this.isFrozen(e)&&!this.isFrozen(t)?this._frozenInternal>=0?this._frozenInternal--:this._frozenInternal++:!this.isFrozen(e)&&this.isFrozen(t)&&(this._frozenInternal>=0?this._frozenInternal++:this._frozenInternal--));return!0}return!1};RowColCollection.prototype.onCollectionChanged=function(t){void 0===t&&(t=NotifyCollectionChangedEventArgs.reset);this._dirty=!0;this._g.invalidate();e.prototype.onCollectionChanged.call(this,t)};RowColCollection.prototype.push=function(t){t._setList(this);return e.prototype.push.call(this,t)};RowColCollection.prototype.splice=function(t,i){for(var o=this,n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];for(var l=t;l<t+i&&l<this.length;l++){var s=this[l];s instanceof RowCol&&s._setList(null)}n.forEach((function(e){return e._setList(o)}));return e.prototype.splice.apply(this,[t,i].concat(n))};RowColCollection.prototype.beginUpdate=function(){this._update();e.prototype.beginUpdate.call(this)};RowColCollection.prototype._setDefaultSize=function(e){if(!this._szCustom){this.defaultSize=e;this._szCustom=!1}};RowColCollection.prototype._update=function(){if(this._dirty&&!this.isUpdating){this._dirty=!1;this._lastFrozen=-1;this._firstVisible=-1;this._lastUnfrozenVisible=-1;this._frozenColAreaWidth=0;this._szFrozen=0;var e=0,t=0,i=void 0,o=void 0;if(this._frozenInternal>=0){for(var n=0;n<this.length;n++){(o=this[n])._idx=n;o._idxVis=e;o._pos=t;o._setList(this);if((i=o.renderSize)>0){t+=i;e++;n<this._frozenInternal&&(this._lastFrozen=n)}this._firstVisible<0&&o.visible&&(this._firstVisible=n);n<this._frozenInternal&&(this._szFrozen+=i)}this._vlen=e;this._szTot=t;return!0}for(n=0;n<this.length;n++){(o=this[n])._idx=n;o._idxVis=e;o._pos=t;o._setList(this);if((i=o.renderSize)>0){t+=i;e++}this._firstVisible<0&&o.visible&&(this._firstVisible=n);o.visible&&n<this.length+this._frozenInternal&&(this._lastUnfrozenVisible=n);n>=this.length+this._frozenInternal&&(this._szFrozen+=i)}this._lastFrozen=Math.max(0,this.length+this._frozenInternal);this._lastFrozenVisible=this._lastFrozen;for(;this._lastFrozenVisible<this.length&&!(this[this._lastFrozenVisible].renderSize>0);)this._lastFrozenVisible++;var r=0;for(n=this.length-1;n>=Math.max(0,this.length+this._frozenInternal);n--){i=(o=this[n]).renderSize;r-=this[n].renderSize;o._antipos=r;this._frozenColAreaWidth+=i}this._vlen=e;this._szTot=t;return!0}return!1};return RowColCollection}(ObservableArray);export{RowColCollection};var ColumnCollection=function(e){__extends(ColumnCollection,e);function ColumnCollection(){return null!==e&&e.apply(this,arguments)||this}ColumnCollection.prototype.getColumn=function(e){var t=isNumber(e)?e:this.indexOf(e);return t>-1?this[t]:null};ColumnCollection.prototype.indexOf=function(t){if(t instanceof Column)return e.prototype.indexOf.call(this,t);for(var i=0;i<this.length;i++)if(this[i].name==t)return i;for(i=0;i<this.length;i++)if(this[i].binding==t)return i;return-1};Object.defineProperty(ColumnCollection.prototype,"describedById",{get:function(){return this._descById},set:function(e){if(e!=this._descById){this._descById=asString(e);this._g&&this._g.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(ColumnCollection.prototype,"firstVisibleIndex",{get:function(){this._dirty&&this._update();return this._firstVisible},enumerable:!0,configurable:!0});ColumnCollection.prototype._updateStarSizes=function(e){var t,i=!1,o=0;e-=.5;for(var n=0;n<this.length;n++){if((l=this[n]).isVisible)if(l._szStar){o+=Column._parseStarSize(l._szStar);t=l}else e-=l.renderWidth}if(t){var r=e;for(n=0;n<this.length;n++){var l;if((l=this[n]).isVisible&&l._szStar){var s=l._sz;l==t&&r>0?s=r:r-=s=Math.max(0,Math.round(Column._parseStarSize(l._szStar)/o*e));if(s!=l._sz){l._sz=s;i=!0}}}if(i){this._dirty=!0;this._update()}return i}return!1};return ColumnCollection}(RowColCollection);export{ColumnCollection};var RowCollection=function(e){__extends(RowCollection,e);function RowCollection(){var t=null!==e&&e.apply(this,arguments)||this;t._maxLevel=-1;return t}Object.defineProperty(RowCollection.prototype,"ariaLabel",{get:function(){return this._ariaLabel},set:function(e){if(e!=this.ariaLabel){this._ariaLabel=asString(e);this._g&&this._g.refresh()}},enumerable:!0,configurable:!0});Object.defineProperty(RowCollection.prototype,"maxGroupLevel",{get:function(){this._dirty&&this._update();return this._maxLevel},enumerable:!0,configurable:!0});RowCollection.prototype.getDetailRowCountUptoRow=function(e){var t=softDetailRow(),i=0,o=Math.abs(e),n=0,r=this.length-1,l=1,s=0;if(e<0){l=-1;s=1}for(;o>0&&n<=r&&n>=0;){var a=r*s+n*l,c=this[a];if(c&&!(t&&c instanceof t.DetailRow)){var u=this[a+1];u&&t&&u instanceof t.DetailRow&&i++;o--}n++}return i};RowCollection.prototype._update=function(){var t=this;if(e.prototype._update.call(this)){var i=this.grid?this.grid.collectionView:null,o=i?i.items:null,n=0;this._maxLevel=-1;this.forEach((function(e){e instanceof GroupRow&&e.level>t._maxLevel&&(t._maxLevel=e.level);var i=e.dataItem;i&&o?i===o[n]?e._idxData=n:i===o[n+1]?e._idxData=++n:i!==o[e._idxData]&&(e._idxData=-1):e._idxData=-1}));return!0}return!1};return RowCollection}(RowColCollection);export{RowCollection};export var colHdrAriaAttributes=function(e,t,i,o,n){void 0===n&&(n=!1);setAttribute(e,"role",n?"rowheader":"columnheader");if(t.describedById||i.columns.describedById){var r=[t.describedById,i.columns.describedById].join(" ").trim();setAttribute(e,"aria-describedby",r||null)}if(o.allowSorting){var l="none";switch(o._getBindingColumn(i,0,t).currentSort){case"+":l="ascending";break;case"-":l="descending"}setAttribute(e,"aria-sort",l)}if(!o.isReadOnly){setAttribute(e,"aria-readonly",t.isReadOnly);setAttribute(e,"aria-required",t.isReadOnly?null:t.getIsRequired()&&!n)}var s=e.closest(".wj-row");setAttribute(s,"role","row")};var _ColumnGroupHandler=function(){function _ColumnGroupHandler(e){this._updatingCollection=0;this._initialized=!1;this._grid=e;this._initializeColumnGroups();this._initialized=!0}Object.defineProperty(_ColumnGroupHandler.prototype,"columnGroups",{get:function(){return this._colGroups},enumerable:!0,configurable:!0});_ColumnGroupHandler.prototype.createColumnGroups=function(e){this._initialized=!1;this._createColumnGroups(e);this._initialized=!0};_ColumnGroupHandler.prototype.hasColumnGroups=function(){return null!=this._colGroups&&this._colGroups.length>0};_ColumnGroupHandler.prototype.getGroupDefinitions=function(){return this._groupDefs};_ColumnGroupHandler.prototype.getColumnGroup=function(e,t){return this._getColumnGroup(e,t)};_ColumnGroupHandler.prototype.canMoveColumnGroup=function(e,t,i,o){if(e==i&&t==o)return!1;var n=this._grid,r=n.columnHeaders.rows,l=n.columns;if(e<0||e>=r.length||t<0||t>=l.length||i<0||i>=r.length||o<0||o>=l.length)return!1;var s=this._getColumnGroup(e,t),a=this._getColumnGroup(i,o);if(!s||!a||s==a)return!1;if(s.level<a.level&&s._containsGroup(a))return!1;var c=s.parentGroup,u=a.parentGroup;return!c||c===u||!c._isCollapseTo(s)};_ColumnGroupHandler.prototype.moveColumnGroup=function(e,t,i,o,n){if(this.canMoveColumnGroup(e,t,i,o)){var r=this._getColumnGroup(e,t),l=this._getColumnGroup(i,o);if(!r||!l||r==l)return!1;if(n&&!l.isEmpty)return!1;var s=this._getCollection(r),a=n?l.columns:this._getCollection(l);if(!s||!a)return!1;var c=n?0:a.indexOf(l);if(c<0)return!1;!n&&s!=a&&o>t&&c++;this._deferCollectionUpdate((function(){if(!s.remove(r))return!1;a.insert(c,r)}));return!0}return!1};_ColumnGroupHandler.prototype.handleCollectionChange=function(){if(this._initialized&&!this._updatingCollection){this._initialized=!1;this._buildColumnGroups();this._initialized=!0}};_ColumnGroupHandler.prototype.handlePropertyChange=function(e){if(e&&this._initialized){var t=this._grid,i=e._rng,o=e.header;if(o!=e._curr_header)for(var n=i.topRow;n<=i.bottomRow;n++)for(var r=i.leftCol;r<=i.rightCol;r++){t.columnHeaders.setCellData(n,r,o);e._curr_header=o}e.columns.length>0&&t.invalidate()}};_ColumnGroupHandler.prototype._initializeColumnGroups=function(){var e=this._grid,t=new ColumnGroupCollection;this._groupDefs=t;this._colGroups=t;this._colGroups._setOwner(e);this._colGroups._setChangeHandler(this)};_ColumnGroupHandler.prototype._createColumnGroups=function(e){this._grid;this._groupDefs=asArray(e);this._colGroups&&this._colGroups._setOwner(null);this._colGroups=ColumnGroupCollection._parse(e);this._buildColumnGroups()};_ColumnGroupHandler.prototype._buildColumnGroups=function(){var e=this,t=this._grid;this._colGroups._removeChangeHandler();this._assertColumnGroups(this._colGroups);t.autoGenerateColumns=!1;t.columns.clear();this._colGroups._setOwner(t);this._colGroups.forEach((function(e){e._beginBuild()}));var i=0;this._colGroups.forEach((function(t){e._addColumnGroup(t);i=Math.max(i,t._getMaxLevel())}));this._colGroups.forEach((function(e){e._expandRange(i)}));var o=t.columnHeaders.rows;o.clear();for(var n=0;n<=i;n++){var r=new Row;o.splice(n,0,r);n<i&&(r.cssClassAll="wj-colgroup")}for(n=0;n<o.length;n++)for(var l=0;l<t.columns.length;l++){var s=this._getColumnGroup(n,l);if(s){var a=s.header||toHeaderCase(s.binding);t.columnHeaders.setCellData(n,l,a);if(s.height){var c=t.columnHeaders.rows[n].height;t.columnHeaders.rows[n].height=c<=s.height?s.height:c}s._curr_header=s.header}}this._colGroups._setChangeHandler(this);this._colGroups.forEach((function(e){e._checkIfCollapsed()}))};_ColumnGroupHandler.prototype._getColumnGroup=function(e,t){var i=this._grid;if(e<i.columnHeaders.rows.length&&t<i.columns.length)for(var o=this._colGroups;o;){for(var n=o,r=0;r<o.length;r++){var l=o[r],s=l._rng;if(s.containsColumn(t)){if(s.containsRow(e)||0==l.columns.length)return l;o=l.columns;break}}if(o==n)break}return null};_ColumnGroupHandler.prototype._getCollection=function(e){var t=e.parentGroup;return t?t.columns:this._colGroups};_ColumnGroupHandler.prototype._assertColumnGroups=function(e){var t=this;assert(e instanceof ColumnGroupCollection,"column groups contain items of invalid collection type");e.forEach((function(e){assert(e instanceof ColumnGroup,"column groups contain items of invalid type");t._assertColumnGroups(e.columns)}))};_ColumnGroupHandler.prototype._addColumnGroup=function(e){var t=this,i=this._grid;e._rng.col=i.columns.length;0==e.columns.length?i.columns.push(e):e.columns.forEach((function(e){t._addColumnGroup(e)}));e._rng.col2=i.columns.length-1};_ColumnGroupHandler.prototype._beginCollectionUpdate=function(){this._updatingCollection++};_ColumnGroupHandler.prototype._endCollectionUpdate=function(){this._updatingCollection--;this._updatingCollection<=0&&this.handleCollectionChange()};_ColumnGroupHandler.prototype._deferCollectionUpdate=function(e){try{this._beginCollectionUpdate();e()}finally{this._endCollectionUpdate()}};return _ColumnGroupHandler}();export{_ColumnGroupHandler};var ColumnGroup=function(e){__extends(ColumnGroup,e);function ColumnGroup(t,i){var o=e.call(this)||this;o._rng=new CellRange(0,-1);o._lvl=0;o._collapsed=!1;o._cols=new ColumnGroupCollection;copy(o,t);var n=i&&i.columns;n&&n.indexOf(o)<0&&n.push(o);return o}ColumnGroup.prototype._copy=function(e,t){if("columns"==e){var i=asArray(t);this._cols=ColumnGroupCollection._parse(i);return!0}return!1};Object.defineProperty(ColumnGroup.prototype,"columns",{get:function(){return this._cols},enumerable:!0,configurable:!0});Object.defineProperty(ColumnGroup.prototype,"columnGroups",{get:function(){return this._cols},enumerable:!0,configurable:!0});Object.defineProperty(ColumnGroup.prototype,"height",{get:function(){return this._cgHeight},set:function(e){this._cgHeight=e},enumerable:!0,configurable:!0});Object.defineProperty(ColumnGroup.prototype,"isEmpty",{get:function(){return 0===this._cols.length},enumerable:!0,configurable:!0});Object.defineProperty(ColumnGroup.prototype,"parentGroup",{get:function(){var e=this._ownerList,t=e&&e.owner;return t instanceof ColumnGroup?t:null},enumerable:!0,configurable:!0});Object.defineProperty(ColumnGroup.prototype,"level",{get:function(){for(var e=this,t=0;e.parentGroup;){e=e.parentGroup;t++}return t},enumerable:!0,configurable:!0});Object.defineProperty(ColumnGroup.prototype,"collapseTo",{get:function(){return this._collTo},set:function(e){assert(isArray(e)||isString(e),"collapseTo should be an array or a string.");if(this._collTo!=e){this._collTo=e;this._updateCollapsedState()}},enumerable:!0,configurable:!0});Object.defineProperty(ColumnGroup.prototype,"isCollapsed",{get:function(){return this._collapsed},set:function(e){var t=this.grid,i=null;if(e!=this._collapsed)if(t){i=new CellRangeEventArgs(t.columnHeaders,this._rng,this);t.onColumnGroupCollapsedChanging(i)?this._collapsed=asBoolean(e):i=null}else this._collapsed=asBoolean(e);this._updateCollapsedState();t&&i&&t.onColumnGroupCollapsedChanged(i)},enumerable:!0,configurable:!0});Object.defineProperty(ColumnGroup.prototype,"grid",{get:function(){var e=this._ownerList,t=e&&e.owner;return t instanceof ColumnGroup?t.grid:t instanceof FlexGrid?t:null},enumerable:!0,configurable:!0});ColumnGroup.prototype._beginBuild=function(){var e=this;this._lvl=0;for(var t=this.parentGroup;t;t=t.parentGroup)this._lvl++;setTimeout((function(){if(e.parentGroup&&0!==e._lvl&&e.parentGroup.width&&(null===e.width||void 0===e.width)){var t=0,i=0;e.parentGroup._cols.forEach((function(e){t+=e.width;null!==e.width&&void 0!==e.width||i++}));e.width=(e.parentGroup.width-t)/i}}),0);this._rng=new CellRange(0,-1);this._rng.row=this._rng.row2=this._lvl;this._cols.forEach((function(e){e._beginBuild()}))};ColumnGroup.prototype._setChangeHandler=function(e){this._changeHdl=e;this._cols._setChangeHandler(e)};ColumnGroup.prototype._removeChangeHandler=function(){this._changeHdl=null;this._cols._removeChangeHandler()};ColumnGroup.prototype._setOwnerList=function(e){e!=this._ownerList&&(this._ownerList=e)};ColumnGroup.prototype._checkIfCollapsed=function(){var e=this.grid;(e?e.columns:null)&&(this._collapsed?this._updateCollapsedState():this._cols.forEach((function(e){e._checkIfCollapsed()})))};ColumnGroup.prototype._updateCollapsedState=function(){var e=this.grid,t=e?e.columns:null,i=this._rng,o=this._collapsed;if(t){this._cols.forEach((function(e){if(e instanceof ColumnGroup){e._collapsed=o;e._updateCollapsedState()}}));for(var n=this._getCollapseToIndices(),r=i.leftCol;r<=i.rightCol;r++){var l=!o||n.indexOf(r)>-1;t[r]._setFlag(RowColFlags.ParentCollapsed,!l)}}};ColumnGroup.prototype._getMaxLevel=function(){var e=this._lvl;this.columns.forEach((function(t){e=Math.max(e,t._getMaxLevel())}));return e};ColumnGroup.prototype._expandRange=function(e){var t=e-this._getMaxLevel();if(t>0){this._rng.row2+=t;this._cols.forEach((function(e){e._shiftRange(t)}))}for(var i=this.grid.columns,o=this._rng,n=o.col;n<=o.col2;n++){i[n]._rng.row2=e}};ColumnGroup.prototype._shiftRange=function(e){this._rng.row+=e;this._rng.row2+=e;this._cols.forEach((function(t){t._shiftRange(e)}))};ColumnGroup.prototype._containsGroup=function(e){for(var t=0;t<this._cols.length;t++){var i=this._cols[t];if(i==e||i._containsGroup(e))return!0}return!1};ColumnGroup.prototype._isCollapseTo=function(e){var t=this.grid,i=t?t.columns:null;if(!e||!i)return!1;var o=this._getCollapseToBindings();if(o&&o.length)for(var n=0;n<o.length;n++)switch(o[n]){case"$first":case"$last":continue;default:if(e===i.getColumn(o[n]))return!0}return!1};ColumnGroup.prototype._getCollapseToBindings=function(){var e=this.collapseTo;return isString(e)?[e]:e};ColumnGroup.prototype._getCollapseToIndices=function(){var e=this.grid,t=this._rng,i=this._getCollapseToBindings();if(i&&i.length){for(var o=[],n=e.columns,r=0;r<i.length;r++)switch(i[r]){case"$first":o.push(t.leftCol);break;case"$last":o.push(t.rightCol);break;default:var l=n.getColumn(i[r]),s=n.indexOf(l);l&&t.containsColumn(s)&&o.push(s)}if(o.length)return o}return[t.rightCol]};ColumnGroup.prototype.onPropertyChanged=function(){var t=this._changeHdl;t&&t.handlePropertyChange(this);e.prototype.onPropertyChanged.call(this)};return ColumnGroup}(Column);export{ColumnGroup};var ColumnGroupCollection=function(e){__extends(ColumnGroupCollection,e);function ColumnGroupCollection(){return null!==e&&e.apply(this,arguments)||this}ColumnGroupCollection.prototype.getColumn=function(e){return isNumber(e)?this._getColByIdx(e):this._findColByProp("name",e)||this._findColByProp("binding",e)};Object.defineProperty(ColumnGroupCollection.prototype,"owner",{get:function(){return this._owner},enumerable:!0,configurable:!0});ColumnGroupCollection.prototype.push=function(t){t._setOwnerList(this);return e.prototype.push.call(this,t)};ColumnGroupCollection.prototype.splice=function(t,i){for(var o=this,n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];for(var l=t;l<t+i&&l<this.length;l++){var s=this[l];s instanceof ColumnGroup&&s._setOwnerList(null)}n.forEach((function(e){return e._setOwnerList(o)}));return e.prototype.splice.apply(this,[t,i].concat(n))};ColumnGroupCollection._parse=function(e){var t=null;if(e)if(e instanceof ColumnGroupCollection)t=e;else{t=new ColumnGroupCollection;e.forEach((function(e){var i=e instanceof ColumnGroup?e:new ColumnGroup(e);t.indexOf(i)<0&&t.push(i)}))}else t=new ColumnGroupCollection;return t};ColumnGroupCollection.prototype._setChangeHandler=function(e){this._changeHdl=e;this.forEach((function(t){return t._setChangeHandler(e)}))};ColumnGroupCollection.prototype._removeChangeHandler=function(){this._changeHdl=null;this.forEach((function(e){return e._removeChangeHandler()}))};ColumnGroupCollection.prototype._setOwner=function(e){this._owner=e;this.forEach((function(e){return e.columns._setOwner(e)}))};ColumnGroupCollection.prototype._getColByIdx=function(e){return e>-1&&e<this.length?this[e]:null};ColumnGroupCollection.prototype._findColByProp=function(e,t){for(var i=0;i<this.length;i++){var o=this[i];if(o[e]===t)return o;if(null!==(o=o.columns._findColByProp(e,t)))return o}return null};ColumnGroupCollection.prototype.onCollectionChanged=function(t){void 0===t&&(t=NotifyCollectionChangedEventArgs.reset);var i=this._changeHdl;i&&i.handleCollectionChange();e.prototype.onCollectionChanged.call(this,t)};return ColumnGroupCollection}(ObservableArray);export{ColumnGroupCollection};_addCultureInfo("FlexGrid",{groupHeaderFormat:"{name}: <b>{value}</b> ({count:n0} items)",ariaLabels:{toggleDropDown:"Toggle Dropdown",toggleGroup:"Toggle Group"}});export var AllowSorting;!function(e){e[e.None=0]="None";e[e.SingleColumn=1]="SingleColumn";e[e.MultiColumn=2]="MultiColumn"}(AllowSorting||(AllowSorting={}));export var AllowPinning;!function(e){e[e.None=0]="None";e[e.SingleColumn=1]="SingleColumn";e[e.ColumnRange=2]="ColumnRange";e[e.Both=3]="Both"}(AllowPinning||(AllowPinning={}));export var HeadersVisibility;!function(e){e[e.None=0]="None";e[e.Column=1]="Column";e[e.Row=2]="Row";e[e.All=3]="All"}(HeadersVisibility||(HeadersVisibility={}));export var ClipStringOptions;!function(e){e[e.Default=0]="Default";e[e.CSV=1]="CSV";e[e.QuoteAll=2]="QuoteAll";e[e.SkipMerged=4]="SkipMerged";e[e.Unformatted=8]="Unformatted";e[e.InvisibleRows=16]="InvisibleRows";e[e.InvisibleColumns=32]="InvisibleColumns";e[e.InvisibleCells=48]="InvisibleCells"}(ClipStringOptions||(ClipStringOptions={}));export var HeadersFocusability;!function(e){e[e.None=0]="None";e[e.Column=1]="Column";e[e.Row=2]="Row";e[e.All=3]="All"}(HeadersFocusability||(HeadersFocusability={}));export var FrozenRowCol;!function(e){e[e.Column=0]="Column";e[e.Row=1]="Row"}(FrozenRowCol||(FrozenRowCol={}));export var GroupSummaryPosition;!function(e){e[e.Top=0]="Top";e[e.Bottom=1]="Bottom";e[e.Auto=2]="Auto"}(GroupSummaryPosition||(GroupSummaryPosition={}));var FlexGrid=function(e){__extends(FlexGrid,e);function FlexGrid(t,i){var o=e.call(this,t,null,!0)||this;o._activeCell=null;o._szClient=new Size(0,0);o._szClientSB=new Size(0,0);o._offsetY=0;o._cssPage=0;o._ptScrl=new Point(0,0);o._ptLastScrl=new Point(0,0);o._cellPadLeft=3;o._cellPadHorz=3;o._cellPadVert=0;o._clipToScreen=!1;o._anchorCell=null;o._spDiff=new Point(0,0);o._autoGenCols=!0;o._autoClipboard=!0;o._xOnCopyPaste=!0;o._autoScroll=!0;o._autoSearch=!1;o._caseSensitive=!1;o._readOnly=!1;o._indent=14;o._autoSizeMode=AutoSizeMode.Both;o._autoHeights=!1;o._quickSize=null;o._hdrVis=HeadersVisibility.All;o._hdrFoc=HeadersFocusability.None;o._alSorting=AllowSorting.SingleColumn;o._alPinning=AllowPinning.None;o._alAddNew=!1;o._alDelete=!1;o._alResizing=AllowResizing.Columns;o._alDragging=AllowDragging.Columns;o._alMerging=AllowMerging.None;o._ssHdr=HeadersVisibility.None;o._shSort=!0;o._shGroups=!0;o._shMarquee=!1;o._shPlcHld=!1;o._altStep=1;o._shErr=!0;o._shDropDown=!0;o._valEdt=!0;o._gHdrFmt=null;o._childItemsPath=null;o._sortRowIndex=null;o._editColIndex=null;o._deferResizing=!1;o._pSel=!0;o._pOutline=!0;o._stickyHdr=!1;o._anchorCursor=!1;o._copyHeaders=HeadersVisibility.None;o._bigChecks=!1;o._skipMerged=!1;o._commitEmptyEdits=!0;o._maxContent=!1;o._pasteEmptyCells=!0;o._groupSummaryPosition=GroupSummaryPosition.Top;o._fzClone=null;o._vt=0;o._vtRows=0;o._vtCols=0;o._lazyRender=!0;o._refreshOnEdit=!0;o._reorderCells=!0;o._lastStickyScroll=0;o._scrollStickyThrottleTimeout=14;o._scrollEndTimer=null;o._contentEstimationLimit=100;o._isSilentScroll=!1;o._isISChanging=!1;o._isScrollingByWheel=!1;o.cachedDefaultHeight=-1;o.cachedHeights={};o._canOverRuleCtrlPress=!1;o._touchEdit=!1;o._isGrpClpsChanging=!1;o._initialRestCvLoad=!0;o._grpClpsChng=!1;o.itemsSourceChanging=new Event;o.itemsSourceChanged=new Event;o.scrollPositionChanged=new Event;o.selectionChanging=new Event;o.selectionChanged=new Event;o.loadingRows=new Event;o.loadedRows=new Event;o.updatingLayout=new Event;o.updatedLayout=new Event;o.resizingColumn=new Event;o.resizedColumn=new Event;o.autoSizingColumn=new Event;o.autoSizedColumn=new Event;o.starSizedColumns=new Event;o.draggingColumn=new Event;o.draggingColumnOver=new Event;o.draggedColumn=new Event;o.pinningColumn=new Event;o.pinnedColumn=new Event;o.resizingRow=new Event;o.resizedRow=new Event;o.autoSizingRow=new Event;o.autoSizedRow=new Event;o.draggingRow=new Event;o.draggingRowOver=new Event;o.draggedRow=new Event;o.groupCollapsedChanging=new Event;o.groupCollapsedChanged=new Event;o.columnGroupCollapsedChanging=new Event;o.columnGroupCollapsedChanged=new Event;o.sortingColumn=new Event;o.sortedColumn=new Event;o.beginningEdit=new Event;o.prepareCellForEdit=new Event;o.cellEditEnding=new Event;o.cellEditEnded=new Event;o.rowEditStarting=new Event;o.rowEditStarted=new Event;o.rowEditEnding=new Event;o.rowEditEnded=new Event;o.rowAdded=new Event;o.deletingRow=new Event;o.deletedRow=new Event;o.copying=new Event;o.copied=new Event;o.pasting=new Event;o.pasted=new Event;o.pastingCell=new Event;o.pastedCell=new Event;o.formatItem=new Event((function(){o._clearCells()}));o.updatingView=new Event;o.updatedView=new Event;o._mappedColumns=null;var n=o.hostElement;isIE()&&(n.style.borderRadius="0");var r=o.getTemplate();o.applyTemplate("wj-control wj-content wj-flexgrid",r,{_root:"root",_eSz:"sz",_eCt:"cells",_fCt:"fcells",_eTL:"tl",_eBL:"bl",_eCHdr:"ch",_eRHdr:"rh",_eCFtr:"cf",_eTLCt:"tlcells",_eBLCt:"blcells",_eCHdrCt:"chcells",_eCFtrCt:"cfcells",_eRHdrCt:"rhcells",_eMarquee:"marquee",_eFocus:"focus"});setCss(o._root.parentElement,{position:"relative",left:"0",top:"0",width:"100%",height:"100%",overflow:"hidden",minWidth:"inherit",minHeight:"inherit",maxWidth:"inherit",maxHeight:"inherit"});setCss(o._root,{position:"absolute",left:"0",top:"0",width:"100%",height:"100%",minWidth:"inherit",minHeight:"inherit",maxWidth:"inherit",maxHeight:"inherit",overflow:"auto",webkitOverflowScrolling:"touch"});setCss(o._eCt,{position:"absolute"});setCss(o._eMarquee,{display:"none"});setCss(o._eMarquee.firstChild,{width:"100%",height:"100%"});setCss(o._fCt,{position:"absolute",top:0,left:0,overflow:"hidden",pointerEvents:"none"});setCss(o._eFocus,{position:"fixed",left:"-32000px"});setCss(o._eSz,{position:"relative",visibility:"hidden"});[o._eRHdr,o._eCFtr,o._eCHdr,o._eBL,o._eTL].forEach((function(e){setAttribute(e,"aria-hidden",!0);setCss(e,{position:"absolute",overflow:"hidden",outline:"none"});setCss(e.firstElementChild,{position:"relative"})}));[o._eFocus,o._eMarquee,o._fCt,o._eSz].forEach((function(e){setAttribute(e,"aria-hidden",!0)}));if(isIE9()||isIE10()){var l=o._eMarquee;["click","dblclick","mousedown","mouseup"].forEach((function(e){o.addEventListener(l,e,(function(t){var i=l.style.display;l.style.display="none";var o=document.elementFromPoint(t.clientX,t.clientY);l.style.display=i;var n=document.createEvent("Event");n.initEvent(e,!0,!0);for(var r in t)try{n[r]=t[r]}catch(e){}o.dispatchEvent(n)}))}))}n.tabIndex=-1;o._uid=uidGenerator();o.deferUpdate((function(){var e=o._getDefaultRowHeight();o._rows=new RowCollection(o,e);o._cols=new ColumnCollection(o,4*e);o._hdrRows=new RowCollection(o,e);o._hdrCols=new ColumnCollection(o,Math.round(1.25*e));o._ftrRows=new RowCollection(o,e);var t=CellType;o._gpTL=new GridPanel(o,t.TopLeft,o._hdrRows,o._hdrCols,o._eTLCt);o._gpCHdr=new GridPanel(o,t.ColumnHeader,o._hdrRows,o._cols,o._eCHdrCt);o._gpRHdr=new GridPanel(o,t.RowHeader,o._rows,o._hdrCols,o._eRHdrCt);o._gpCells=new GridPanel(o,t.Cell,o._rows,o._cols,o._eCt);o._gpBL=new GridPanel(o,t.BottomLeft,o._ftrRows,o._hdrCols,o._eBLCt);o._gpCFtr=new GridPanel(o,t.ColumnFooter,o._ftrRows,o._cols,o._eCFtrCt);o.activePanel=o._gpCells;o._hdrRows.push(new Row);o._hdrCols.push(new Column({align:"center"}));o._cf=new CellFactory;o._keyHdl=new _KeyboardHandler(o);o._mouseHdl=new _MouseHandler(o);o._edtHdl=new _EditHandler(o);o._selHdl=o._createSelHdl();o._addHdl=new _AddNewHandler(o);o._grpHdl=new _ColumnGroupHandler(o);o._mrgMgr=new MergeManager;o._bndSortConverter=o._sortConverter.bind(o);o._errorTip=new Tooltip({isContentHtml:!1,showDelay:50,cssClass:"wj-error-tip"});o._errorTip._tooltipVisibleOnHover=!1;o.selectionMode=SelectionMode.CellRange;o._root.tabIndex=-1;o.initialize(i)}));o.addEventListener(o._root,"scroll",(function(e){isChromiumBased()&&o._handleSpaceDisorderOnScrollToEnd();if(o._updateScrollPosition()||o._forceScrollUpdate){var t=o.activeEditor,i=o.activeCell,n=i?i.className:null;if((hasClass(i,"wj-detail")||hasClass(t,"wj-numeric"))&&Control.sharedState.InvalidScroll){setTimeout((function(){Control.sharedState.InvalidScroll=!1}),0);return}o._forceScrollUpdate||Control.sharedState.InvalidScroll||o.finishEditing();o._forceScrollUpdate=!1;var r=o._edtHdl._getCustomEditor(o),l=!(!t||!r)&&r.isOpen,s=o._edtHdl.validate;if(!l||!s){if("React"===o.workingAs)requestAnimationFrame((function(){o._updateContent(!0);setTimeout((function(){Control.sharedState.InvalidScroll=!1}),0)}));else{o._updateContent(!0);setTimeout((function(){Control.sharedState.InvalidScroll=!1}),0)}var a=o.activeEditor,c=o.activeCell;if(a&&c&&t&&n){a.value=t.value;c.className=n;o._setFocusNoScroll(a)}else!a||c||Control.sharedState.InvalidScroll||o.finishEditing(!0)}o.columns._frozenInternal&&setTimeout((function(){var e=o.columnHeaders.hostElement.style,t=parseInt(e.left),i=o._ptScrl.x;Math.abs(t-i)>1&&o.invalidate()}));setTimeout((function(){o._isScrollingByWheel=!1;Control.sharedState.InvalidScroll=!1}),0)}}));o.addEventListener(n,"focus",(function(e){if(n.tabIndex>-1){var t=e.target;t instanceof HTMLElement&&t.tabIndex<0&&o._setFocus(!0)}}),!0);o.addEventListener(window,"resize",(function(){o.finishEditing(!1);o.invalidate()}));o.resizingColumn.addHandler(o._handleRowColResizing);o.resizingRow.addHandler(o._handleRowColResizing);o.resizedColumn.addHandler(o._getRowColResizedHandler(o,!1));o.resizedRow.addHandler(o._getRowColResizedHandler(o,!0));return o}Object.defineProperty(FlexGrid.prototype,"activePanel",{get:function(){return this._activePanel},set:function(e){this._activePanel=asType(e,GridPanel,!1)},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"activePanelType",{get:function(){return this._activePanel?this._activePanel.cellType:CellType.Cell},enumerable:!0,configurable:!0});FlexGrid.prototype._handleSpaceDisorderOnScrollToEnd=function(){var e=new Size(this._szClientSB.width-(this._root.offsetWidth-this._root.clientWidth),this._szClientSB.height-(this._root.offsetHeight-this._root.clientHeight)),t=this._gpCells.width-e.width+this._ptScrl.x,i=this._gpCells.height-e.height+this._eCFtr.clientHeight+this._ptScrl.y,o=1==this._rtlDir?-1:1,n=o*(this._root.scrollLeft-this._ptLastScrl.x),r=this._root.scrollTop-this._ptLastScrl.y,l=new Point(this._ptLastScrl.x+n,this._ptLastScrl.y+r),s=this._gpCells.width+this._eRHdr.clientWidth-this._root.clientWidth,a=this._gpCells.height+this._eCHdr.clientHeight-this._root.clientHeight+this._eCFtr.clientHeight;this._ptLastScrl=new Point(this._root.scrollLeft,this._root.scrollTop);if((t<1||l.x>s)&&n>0){var c=o*(this._gpCells.width-e.width);if(c!=this._root.scrollLeft){this._szClient=e;this._root.scrollLeft=c;return!0}}else if((i<1||l.y>a)&&r>0){var u=this._gpCells.height-(e.height-this._eCFtr.clientHeight);if(this._root.scrollTop!=u){this._szClient=e;this._root.scrollTop=u;return!0}}return!1};FlexGrid.prototype._handleResize=function(){var t=this;this._rcBounds=null;this.activeEditor&&this.isTouching||this._touchEdit?setTimeout((function(){if(!t.activeEditor){t._touchEdit=!0;t.startEditing(!0)}}),50):e.prototype._handleResize.call(this);this._touchEdit=!1};Object.defineProperty(FlexGrid.prototype,"headersVisibility",{get:function(){return this._hdrVis},set:function(e){if((e=asEnum(e,HeadersVisibility))!=this._hdrVis){this._hdrVis=e;this.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"headersFocusability",{get:function(){return this._hdrFoc},set:function(e){if((e=asEnum(e,HeadersFocusability))!=this._hdrFoc){this._hdrFoc=e;this.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"stickyHeaders",{get:function(){return this._stickyHdr},set:function(e){if(e!=this._stickyHdr){this._stickyHdr=asBoolean(e);this._updateStickyHeaders();this.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"maxContent",{get:function(){return this._maxContent},set:function(e){if(e!=this._maxContent){this._maxContent=asBoolean(e);this._adjustMaxContentWidth();this.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"preserveSelectedState",{get:function(){return this._pSel},set:function(e){this._pSel=asBoolean(e)},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"preserveOutlineState",{get:function(){return this._pOutline},set:function(e){this._pOutline=asBoolean(e)},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"anchorCursor",{get:function(){return this._anchorCursor},set:function(e){this._anchorCursor=asBoolean(e)},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"copyHeaders",{get:function(){return this._copyHeaders},set:function(e){this._copyHeaders=asEnum(e,HeadersVisibility)},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"lazyRender",{get:function(){return this._lazyRender},set:function(e){this._lazyRender=asBoolean(e)},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"refreshOnEdit",{get:function(){return this._refreshOnEdit},set:function(e){this._refreshOnEdit=asBoolean(e)},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"virtualizationThreshold",{get:function(){return this._vt},set:function(e){this._vt=e;if(isNumber(e))this._vtRows=this._vtCols=asNumber(e);else if(e)if(isArray(e)&&2==e.length){this._vtRows=asNumber(e[0]);this._vtCols=asNumber(e[1])}else assert(!1,"virtualizationThreshold should be a number or an array with two numbers.");else this._vtRows=this._vtCols=0},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"autoGenerateColumns",{get:function(){return this._autoGenCols},set:function(e){this._autoGenCols=asBoolean(e)},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"autoClipboard",{get:function(){return this._autoClipboard},set:function(e){this._autoClipboard=asBoolean(e)},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"expandSelectionOnCopyPaste",{get:function(){return this._xOnCopyPaste},set:function(e){this._xOnCopyPaste=asBoolean(e)},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"autoScroll",{get:function(){return this._autoScroll},set:function(e){this._autoScroll=asBoolean(e)},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"autoSearch",{get:function(){return this._autoSearch},set:function(e){this._autoSearch=asBoolean(e)},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"caseSensitiveSearch",{get:function(){return this._caseSensitive},set:function(e){this._caseSensitive=asBoolean(e)},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"columnLayout",{get:function(){var e,t=this._hasColumnGroups(),i=t?ColumnGroup:Column,o=t?"columnGroups":"columns",n=FlexGrid._getSerializableProperties(i),r=t?["collapseTo"]:[],l=["size"],s=new i,a=t?this.getColumnGroups():this.columns,serializeColumns=function(e){var i=[];e.forEach((function(e){var o={};n.forEach((function(t){var i=e[t];(function(e,t){return t!=s[e]&&l.indexOf(e)<0&&(isPrimitive(t)||r.indexOf(e)>-1)})(t,i)&&(o[t]=i)}));if(t){var a=e.columns;a.length&&(o.columns=serializeColumns(a))}i.push(o)}));return i},c=serializeColumns(a);return JSON.stringify(((e={})[o]=c,e))},set:function(e){var t=this,i=JSON.parse(asString(e));assert(i,"Invalid columnLayout data.");this.columns.deferUpdate((function(){t.columns.clear();t._hasColumnGroups()&&(t.columnGroups=new ColumnGroupCollection);t.initialize(i)}))},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"columnGroups",{get:function(){return this._grpHdl.getGroupDefinitions()},set:function(e){this.columns.clear();this._grpHdl.createColumnGroups(asArray(e))},enumerable:!0,configurable:!0});FlexGrid.prototype.getColumnGroups=function(){return this._grpHdl.columnGroups};Object.defineProperty(FlexGrid.prototype,"isReadOnly",{get:function(){return this._readOnly},set:function(e){if(e!=this._readOnly){this._readOnly=asBoolean(e);this.finishEditing();this.invalidate(!0);this._addHdl.updateNewRowTemplate();toggleClass(this.hostElement,"wj-state-readonly",this.isReadOnly);this._setAria("readonly",this.isReadOnly?"true":null)}},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"bigCheckboxes",{get:function(){return this._bigChecks},set:function(e){this._bigChecks=asBoolean(e)},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"skipMerged",{get:function(){return this._skipMerged},set:function(e){this._skipMerged=asBoolean(e)},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"pasteEmptyCells",{get:function(){return this._pasteEmptyCells},set:function(e){this._pasteEmptyCells=asBoolean(e)},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"isDisabled",{get:function(){return this._e&&null!=this._e.getAttribute("disabled")},set:function(e){if((e=asBoolean(e,!0))!=this.isDisabled){var t=this._e;if(t){enable(t,!e);this._updateTabIndex();this.invalidate()}}},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"imeEnabled",{get:function(){return null!=this._imeHdl},set:function(e){if(asBoolean(e)!=this.imeEnabled&&this.finishEditing()){var t=this.containsFocus();if(this._imeHdl){this._imeHdl.dispose();this._imeHdl=null}e&&(this._imeHdl=new _ImeHandler(this));t&&this.focus()}},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"allowResizing",{get:function(){return this._alResizing},set:function(e){this._alResizing=asEnum(e,AllowResizing)},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"deferResizing",{get:function(){return this._deferResizing},set:function(e){this._deferResizing=asBoolean(e)},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"autoSizeMode",{get:function(){return this._autoSizeMode},set:function(e){this._autoSizeMode=asEnum(e,AutoSizeMode)},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"autoRowHeights",{get:function(){return this._autoHeights},set:function(e){this._autoHeights=asBoolean(e);this._autoRowHeights()},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"quickAutoSize",{get:function(){return this._quickSize},set:function(e){this._quickSize=asBoolean(e,!0)},enumerable:!0,configurable:!0});FlexGrid.prototype._getQuickAutoSize=function(){return isBoolean(this._quickSize)?this._quickSize:!this.formatItem.hasHandlers&&null==this.itemFormatter};Object.defineProperty(FlexGrid.prototype,"allowSorting",{get:function(){return this._alSorting},set:function(e){isBoolean(e)&&(e=e?AllowSorting.SingleColumn:AllowSorting.None);this._alSorting=asEnum(e,AllowSorting)},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"allowPinning",{get:function(){return this._alPinning},set:function(e){if(e!=this._alPinning){isBoolean(e)&&(e=e?AllowPinning.SingleColumn:AllowPinning.None);this._alPinning=asEnum(e,AllowPinning);this.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"allowAddNew",{get:function(){return this._alAddNew},set:function(e){if(e!=this._alAddNew){this._alAddNew=asBoolean(e);this._addHdl.updateNewRowTemplate()}},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"newRowAtTop",{get:function(){return this._addHdl.newRowAtTop},set:function(e){this._addHdl.newRowAtTop=asBoolean(e)},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"allowDelete",{get:function(){return this._alDelete},set:function(e){e!=this._alDelete&&(this._alDelete=asBoolean(e))},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"allowMerging",{get:function(){return this._alMerging},set:function(e){if((e=asEnum(e,AllowMerging))!=this._alMerging){this._alMerging=e;this.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"showSelectedHeaders",{get:function(){return this._ssHdr},set:function(e){if((e=asEnum(e,HeadersVisibility))!=this._ssHdr){this._ssHdr=e;this.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"showMarquee",{get:function(){return this._shMarquee},set:function(e){if(e!=this._shMarquee){this._shMarquee=asBoolean(e);this.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"showPlaceholders",{get:function(){return this._shPlcHld},set:function(e){this._shPlcHld=asBoolean(e)},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"showSort",{get:function(){return this._shSort},set:function(e){if(e!=this._shSort){this._shSort=asBoolean(e);this.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"showGroups",{get:function(){return this._shGroups},set:function(e){if(e!=this._shGroups){this._shGroups=asBoolean(e);this._bindGrid(!1)}},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"alternatingRowStep",{get:function(){return this._altStep},set:function(e){if(e!=this._altStep){this._altStep=asInt(e,!1,!0);this.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"showAlternatingRows",{get:function(){return this._altStep>0},set:function(e){_deprecated("showAlternatingRows","alternatingRowStep");this.alternatingRowStep=e?1:0},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"showErrors",{get:function(){return this._shErr},set:function(e){if(e!=this._shErr){this._clearCells();this._shErr=asBoolean(e)}},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"errorTip",{get:function(){return this._errorTip},set:function(e){if(e!=this._errorTip){this._clearCells();this._errorTip=asType(e,Tooltip,!0)}},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"itemValidator",{get:function(){return this._itemValidator},set:function(e){if(e!=this.itemValidator){this._itemValidator=asFunction(e);this.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"validateEdits",{get:function(){return this._valEdt},set:function(e){this._setvalidateEdits(e)},enumerable:!0,configurable:!0});FlexGrid.prototype._setvalidateEdits=function(e){this._valEdt=asBoolean(e)};Object.defineProperty(FlexGrid.prototype,"groupHeaderFormat",{get:function(){return this._gHdrFmt},set:function(e){if(e!=this._gHdrFmt){this._gHdrFmt=asString(e);this._bindGrid(!1)}},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"allowDragging",{get:function(){return this._alDragging},set:function(e){if((e=asEnum(e,AllowDragging))!=this._alDragging){this._alDragging=e;this.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"ariaLabel",{get:function(){return this._ariaLabel},set:function(e){this._ariaLabel=e},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"itemsSource",{get:function(){return this._items},set:function(e){var t=this;if(e!=this._items){var i=new CancelEventArgs;if(this.onItemsSourceChanging(i)){if(this._cv){var o=this._cv,n=void 0;if(softRestCollectionView()&&this.collectionView instanceof softRestCollectionView().RestCollectionView){(n=this.collectionView).loading.removeHandler(null,this);n.loaded.removeHandler(null,this)}o.currentChanged.removeHandler(null,this);o.collectionChanged.removeHandler(null,this);o instanceof CollectionView&&o.sortConverter==this._bndSortConverter&&(o.sortConverter=null);this._cv=null}this._items=e;this._cv=this._getCollectionView(e);this._lastCount=0;if(this._cv){(o=this._cv).collectionChanged.addHandler((function(e,i){return t._cvCollectionChanged(e,i)}),this);var r;n=void 0;if(softRestCollectionView()&&this.collectionView instanceof softRestCollectionView().RestCollectionView){(n=this.collectionView)._groupLazyLoading&&this._isFlexSheetInstance()&&console.error("groupLazyLoading is not supported for FlexSheet.");n.loading.addHandler((function(e,i){r=t.selection}),this);n.loaded.addHandler((function(e,i){return t._restCvLoadedHandler(e,i,r)}),this)}o.currentChanged.addHandler((function(e,i){return t._cvCurrentChanged(e,i)}),this);if(o instanceof CollectionView){e&&(o.trackChanges=Boolean(e.trackChanges));o.sortConverter||(o.sortConverter=this._bndSortConverter)}}this._isISChanging=!0;this._bindGrid(!0);this._isISChanging=!1;this.onItemsSourceChanged(i)}}},enumerable:!0,configurable:!0});FlexGrid.prototype._restCvLoadedHandler=function(e,t,i){var o=this;e._groupLazyLoading&&this.deferUpdate((function(){var e=o._isGrpClpsChanging;o._isGrpClpsChanging=!0;o.rows.deferUpdate((function(){for(var e=0;e<o.rows.length;e++)o.rows[e]instanceof GroupRow&&Object.keys(o.rows[e].dataItem.items[0]).length==o.rows[e].dataItem.level+1&&(o.rows[e].isCollapsed=!0)}));o._isGrpClpsChanging=!1;if(!o._initialRestCvLoad&&e){i.col=i.col2=-1;o.groupCollapsedChanged.raise(o,new CellRangeEventArgs(o.cells,i,null))}}));if(e._virtualization){for(var n=this.viewRange,r=this._getGroupCount(n.row),l=n.row;l<n.row2;l++)if(!(this.rows[l].dataItem instanceof GroupRow)&&this.rows[l].dataItem instanceof _NullValue){this.scrollIntoView(e._start+r,0);break}this._isGrpClpsChanging=!1}(e.virtualization||e.groupLazyLoading)&&this.selection&&-1==this.selection.row&&i&&-1!=i.row&&this.select(i,!1,this.cells);if(this._initialRestCvLoad){this._initialRestCvLoad=!1;this._isFlexSheetInstance()&&(this._selHdl.selection.col=this._selHdl.selection.col2=0)}};Object.defineProperty(FlexGrid.prototype,"collectionView",{get:function(){return this._cv},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"editableCollectionView",{get:function(){return tryCast(this._cv,"IEditableCollectionView")},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"childItemsPath",{get:function(){return this._childItemsPath},set:function(e){if(e!=this._childItemsPath){assert(null==e||isArray(e)||isString(e),"childItemsPath should be an array or a string.");this._childItemsPath=e;this._bindGrid(!0)}},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"rowHeaderPath",{get:function(){return this._rowHdrPath?this._rowHdrPath.path:null},set:function(e){if(e!=this.rowHeaderPath){e=asString(e);this._rowHdrPath=e?new Binding(e):null;this.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"cells",{get:function(){return this._gpCells},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"columnHeaders",{get:function(){return this._gpCHdr},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"columnFooters",{get:function(){return this._gpCFtr},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"rowHeaders",{get:function(){return this._gpRHdr},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"topLeftCells",{get:function(){return this._gpTL},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"bottomLeftCells",{get:function(){return this._gpBL},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"rows",{get:function(){return this._rows},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"columns",{get:function(){return this._cols},enumerable:!0,configurable:!0});FlexGrid.prototype.getColumn=function(e,t){if(this._hasColumnGroups()&&t){var i=this.getColumnGroups();return null!==i?i.getColumn(e):null}return this.columns.getColumn(e)};Object.defineProperty(FlexGrid.prototype,"frozenCells",{get:function(){return{top:this.rows.frozen,bottom:this.rows.frozenEnd,left:this.columns.frozen,right:this.columns.frozenEnd}},set:function(e){if(this._isFrozenObjectAllowed()){assert("object"==typeof e,"Object of type IGridFreezeOptions expected");var t={top:e.top?e.top:0,bottom:e.bottom?e.bottom:0,left:e.left?e.left:0,right:e.right?e.right:0},i=0;if(t.top){i=this.rows.getDetailRowCountUptoRow(t.top);t.top+=i}else if(t.bottom){i=this.rows.getDetailRowCountUptoRow(-t.bottom);t.bottom+=i}this.rows.frozen=t.top;this.rows.frozenEnd=t.bottom;i&&(this.rows.frozenDetailChildren=i);this.columns.frozen=t.left;this.columns.frozenEnd=t.right}},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"frozenRows",{get:function(){return this.rows.frozen-this.rows.frozenDetailChildren},set:function(e){var t=this.rows.getDetailRowCountUptoRow(e);this.rows.frozen=e+t;this.rows.frozenDetailChildren=t},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"frozenColumns",{get:function(){return this.columns.frozen},set:function(e){this.columns.frozen=e},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"cloneFrozenCells",{get:function(){return this._fzClone},set:function(e){if(e!=this._fzClone){setText(this._fCt,null);this._fzClone=asBoolean(e,!0);this.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"sortRowIndex",{get:function(){return this._sortRowIndex},set:function(e){if(e!=this._sortRowIndex){this._sortRowIndex=asNumber(e,!0);this.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"editColumnIndex",{get:function(){return this._editColIndex},set:function(e){if(e!=this._editColIndex){this._editColIndex=asNumber(e,!0);this.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"scrollPosition",{get:function(){return this._ptScrl.clone()},set:function(e){var t=this._root,i=-e.x;if(this.rightToLeft)switch(FlexGrid._getRtlMode()){case"rev":i=t.scrollWidth-t.clientWidth+e.x;break;case"neg":i=e.x;break;default:i=-e.x}t.scrollLeft!=i&&(t.scrollLeft=i);t.scrollTop!=-e.y&&(t.scrollTop=-e.y);this._updateScrollPosition()&&(this._forceScrollUpdate=!0)},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"commitEmptyEdits",{get:function(){return this._commitEmptyEdits},set:function(e){if(e!=this._commitEmptyEdits){this._commitEmptyEdits=asBoolean(e);this.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"clientSize",{get:function(){return this._szClient},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"controlRect",{get:function(){this._rcBounds||(this._rcBounds=getElementRect(this._root));return this._rcBounds},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"scrollSize",{get:function(){return new Size(this._gpCells.width,this._heightBrowser)},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"viewRange",{get:function(){return this._gpCells.viewRange},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"cellFactory",{get:function(){return this._cf},set:function(e){if(e!=this._cf){this._clearCells();this._cf=asType(e,CellFactory,!1)}},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"itemFormatter",{get:function(){return this._itemFormatter},set:function(e){if(e!=this._itemFormatter){this._clearCells();this._itemFormatter=asFunction(e)}},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"groupSummaryPosition",{get:function(){return this.childItemsPath?GroupSummaryPosition.Top:this._groupSummaryPosition},set:function(e){if(e!==this._groupSummaryPosition){this._groupSummaryPosition=asEnum(e,GroupSummaryPosition,!1);this._bindGrid(!1)}},enumerable:!0,configurable:!0});FlexGrid.prototype.canEditCell=function(e,t){return this._edtHdl._allowEdit(e,t)};FlexGrid.prototype.getCellData=function(e,t,i){return this.cells.getCellData(e,t,i)};FlexGrid.prototype.getRowDataItem=function(e,t){return this.rows[asNumber(e,!1,!0)].dataItem};FlexGrid.prototype._getRowData=function(e){return this.cells._getRowData(e)};FlexGrid.prototype.getCellBoundingRect=function(e,t,i){return this.cells.getCellBoundingRect(e,t,i)};FlexGrid.prototype.setCellData=function(e,t,i,o,n){void 0===o&&(o=!0);void 0===n&&(n=!0);return this.cells.setCellData(e,t,i,o,n)};FlexGrid.prototype.hitTest=function(e,t){isNumber(e)&&isNumber(t)&&(e=new Point(e,t));isBoolean(t)&&t&&(this._rcBounds=null);return new HitTestInfo(this,e)};FlexGrid.prototype.getClipString=function(e,t,i,o){var n;n=this.skipMerged?ClipStringOptions.SkipMerged:null==t||isBoolean(t)?t?ClipStringOptions.CSV:ClipStringOptions.Default:t;assert(isNumber(n),"Unexpected value for ClipStringOptions parameter.");return this._edtHdl.getClipString(e,n,i,o)};FlexGrid.prototype.setClipString=function(e,t){this._edtHdl.setClipString(e,t)};FlexGrid.prototype.focus=function(e){this.isDisabled||this._setFocus(e)};FlexGrid.prototype.dispose=function(){this.finishEditing(!0);this.itemsSource=null;e.prototype.dispose.call(this)};FlexGrid.prototype.refresh=function(t){void 0===t&&(t=!0);e.prototype.refresh.call(this,t);this.finishEditing();if(t){this._updateColumnTypes();this.scrollPosition=this._ptScrl;this._updateDefaultSizes();clearTimeout(this._toInv);this._toInv=null}this.refreshCells(t);var i=this._e;i&&(this._szCtl=new Size(i.offsetWidth,i.offsetHeight))};FlexGrid.prototype.refreshCells=function(e,t,i){this.isUpdating||(e?this._updateLayout():this._updateContent(t,i))};FlexGrid.prototype.refreshRange=function(e){for(var t=e.topRow;t<=e.bottomRow;t++)for(var i=e.leftCol;i<=e.rightCol;i++){var o=this.cells.getCellElement(t,i);if(o){var n=o[GridPanel._INDEX_KEY];this.cellFactory.updateCell(this.cells,t,i,o,n.rng)}}this._useFrozenDiv()&&this._updateFrozenCells(!0,!0)};FlexGrid.prototype.autoSizeColumn=function(e,t,i){void 0===t&&(t=!1);void 0===i&&(i=4);this.autoSizeColumns(e,e,t,i)};FlexGrid.prototype.autoSizeColumns=function(e,t,i,o){var n=this;void 0===i&&(i=!1);void 0===o&&(o=4);var r=0,l=i?this.topLeftCells:this.columnHeaders,s=i?this.bottomLeftCells:this.columnFooters,a=i?this.rowHeaders:this.cells,c=this.viewRange;e=null==e?0:asInt(e);t=null==t?a.columns.length-1:asInt(t);c.row=Math.max(0,c.row-1e3);c.row2=Math.min(c.row2+1e3,this.rows.length-1);this.finishEditing()&&this.columns.deferUpdate((function(){setCss(n._eCt,{width:n._gpCells.width});for(var i=createElement("<div "+FlexGrid._WJS_MEASURE+'="true"/>',a.hostElement,{visibility:"hidden"}),u=n._getCanvasContext(),h=e;h<=t&&h>-1&&h<a.columns.length;h++){var d=a.columns[h];if(d.isVisible){r=0;if(n.autoSizeMode&AutoSizeMode.Headers){for(var p=0;p<l.rows.length;p++)l.rows[p].isVisible&&(r=Math.max(n._getDesiredWidth(l,p,h,i),r));for(p=0;p<s.rows.length;p++)s.rows[p].isVisible&&(r=Math.max(n._getDesiredWidth(s,p,h,i),r))}if(n.autoSizeMode&AutoSizeMode.Cells&&c.row>-1&&c.row2>-1)if(d._getQuickAutoSize()){p=n._getWidestRow(a,c,h,u);r=Math.max(n._getDesiredWidth(a,p,h,i),r)}else for(p=c.row;p<=c.row2&&p<a.rows.length;p++)a.rows[p].isVisible&&(r=Math.max(n._getDesiredWidth(a,p,h,i),r));r>0&&(d.width=r+o+2)}}n.cellFactory.disposeCell(i);removeChild(i)}))};FlexGrid.prototype.autoSizeRow=function(e,t,i){void 0===t&&(t=!1);void 0===i&&(i=0);this.autoSizeRows(e,e,t,i)};FlexGrid.prototype.autoSizeRows=function(e,t,i,o){var n=this;void 0===i&&(i=!1);void 0===o&&(o=0);var r=0,l=1==i?this.topLeftCells:null==i?this.bottomLeftCells:this.rowHeaders,s=1==i?this.columnHeaders:null==i?this.columnFooters:this.cells;o=asNumber(o);e=null==e?0:asInt(e);if((t=null==t?s.rows.length-1:asInt(t))>=e&&this.finishEditing()){setCss(this._eCt,{width:this._gpCells.width});this.cachedHeights={};var a=createElement("<div "+FlexGrid._WJS_MEASURE+'="true"/>',s.hostElement,{visibility:"hidden"});this.rows.deferUpdate((function(){for(var i={},c=n._autoSizeMode,u=AutoSizeMode,h=e;h<=t&&h>-1&&h<s.rows.length;h++){if(s.rows[h].isVisible){r=0;c&u.Headers&&(r=n._getDesiredRowHeight(l,h,a,i));c&u.Cells&&(r=Math.max(n._getDesiredRowHeight(s,h,a,i),r));r>0&&(s.rows[h].height=r+o)}}}));this.cellFactory.disposeCell(a);removeChild(a)}};Object.defineProperty(FlexGrid.prototype,"treeIndent",{get:function(){return this._indent},set:function(e){if(e!=this._indent){this._indent=asNumber(e,!1,!0);this.columns.onCollectionChanged()}},enumerable:!0,configurable:!0});FlexGrid.prototype.collapseGroupsToLevel=function(e){var t=this;if(this.finishEditing()){softRestCollectionView()&&this._cv instanceof softRestCollectionView().RestCollectionView&&(this._grpClpsChng=!0);this.deferUpdate((function(){var i=t.rows;i.deferUpdate((function(){for(var t=0;t<i.length;t++){var o=i[t];o instanceof GroupRow&&!o.isSummary&&(o.isCollapsed=o.level>=e)}}))}))}this._grpClpsChng=!1};Object.defineProperty(FlexGrid.prototype,"selectionMode",{get:function(){return this._selHdl.selectionMode},set:function(e){if((e=asEnum(e,SelectionMode))!=this.selectionMode){this._selHdl.selectionMode=e;this._updateTabIndex()}},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"selection",{get:function(){return this._selHdl.selection.clone()},set:function(e){this._selHdl.selection=e},enumerable:!0,configurable:!0});FlexGrid.prototype.select=function(e,t,i){void 0===t&&(t=!0);return this._selHdl.select(e,t,!1,i)};FlexGrid.prototype.selectAll=function(){var e=this.rows.length,t=this.columns.length;return!(!e||!t)&&this.select(new CellRange(0,0,e-1,t-1),!1)};FlexGrid.prototype.getSelectedState=function(e,t){return this.cells.getSelectedState(e,t)};Object.defineProperty(FlexGrid.prototype,"selectedRows",{get:function(){var e=this,t=this.selectionMode,i=this.rows.filter((function(e){return e.isSelected}));if(0==i.length&&t!=SelectionMode.None&&t!=SelectionMode.ListBox){var o=[];this.selectedRanges.forEach((function(t){for(var i=t.topRow;i<=t.bottomRow&&i>-1&&i<e.rows.length;i++)o.indexOf(i)<0&&o.push(i)}));o.sort();i=o.map((function(t){return e.rows[t]}))}return i},set:function(e){var t=this;assert(this.selectionMode==SelectionMode.ListBox,"This property can be set only in ListBox mode.");e=asArray(e);this.deferUpdate((function(){for(var i=0,o=!0;i<t.rows.length;i++){var n=t.rows[i],r=e&&e.indexOf(n)>-1;if(r&&o){o=!1;t.select(i,t.selection.col)}n.isSelected=r}}))},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"selectedItems",{get:function(){var e=[];this.selectedRows.forEach((function(t){var i=t?t.dataItem:null;i&&e.indexOf(i)<0&&e.push(i)}));return e},set:function(e){var t=this;assert(this.selectionMode==SelectionMode.ListBox,"This property can be set only in ListBox mode.");e=asArray(e);this.deferUpdate((function(){for(var i=0,o=!0;i<t.rows.length;i++){var n=t.rows[i],r=e&&e.indexOf(n.dataItem)>-1;if(r&&o){o=!1;t.select(i,t.selection.col)}n.isSelected=r}}))},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"selectedRanges",{get:function(){var e=[this.selection];this._selHdl.extendedSelection.forEach((function(t){e.push(t)}));return e},set:function(e){if((e=asArray(e))&&e.length>0){this.select(e[0]);if(this.selectionMode==SelectionMode.MultiRange){var t=this._selHdl.extendedSelection;t.deferUpdate((function(){t.clear();for(var i=1;i<e.length;i++)t.push(e[i])}))}}},enumerable:!0,configurable:!0});FlexGrid.prototype.scrollIntoView=function(e,t,i){var o=this;(null==this._maxOffsetY||this._rows._dirty||this._cols._dirty)&&e>-1&&this._updateLayout();var n=this.scrollPosition,r=this._szClient,l=r.width,s=r.height-this._gpCFtr.rows.getTotalSize(),a=this.cells._getFrozenPos();e=asInt(e);isString(t)&&(t=this.columns.indexOf(t));t=asInt(t);var c=null;try{var u=this.getMergedRange(this.cells,e,t,!1);c=u;var h=this.cells._getFrozenPos();this.rows._frozenInternal>=0?u&&u.rowSpan>1&&this._rows[e].pos>h.y+-this.scrollPosition.y&&this._rows[e].renderHeight*u.rowSpan<this.hostElement.clientHeight&&this._edtHdl._getCustomEditor(this)&&(e=u.bottomRow):u&&u.rowSpan>1&&this._rows[u.bottomRow].pos+this._rows[u.bottomRow].renderHeight>h.y+-this.scrollPosition.y&&this._rows[u.bottomRow].pos-this._rows[u.topRow].pos+this._rows[u.bottomRow].renderHeight<this.clientSize.height&&(e=u.bottomRow)}catch(e){}var d=this._rows[e];if(e>-1&&e<this._rows.length&&!this._rows.isFrozen(e)){var p=this._getCssPage(d.pos);if(p!=this._cssPage){for(var f=this._maxOffsetY,g=Math.round(f*p);g>d.pos;p-=.1)g=Math.round(f*p);this._offsetY=g}var _=d.pos-this._offsetY,m=_+d.renderSize;m>s-n.y&&(n.y=Math.max(-_,s-m));if(this.rows._frozenInternal>=0)_-a.y<-n.y&&(n.y=-(_-a.y));else{d.pos<-n.y&&(n.y=-d.pos);m+n.y-a.y>0&&(n.y-=m+n.y-a.y);0==Math.abs(n.y-(this._ptScrl.y-this._spDiff.y))&&(n.y=this._ptScrl.y)}p!=this._cssPage&&(this._cssPage=this._getCssPage(-n.y))}isString(t)&&(t=this.columns.indexOf(t));if((t=asInt(t))>-1&&t<this._cols.length&&!this._cols.isFrozen(t)){var w=this._cols[t],C=w.pos+w.renderSize;C>-n.x+l&&(n.x=Math.max(-w.pos,l-C));if(this.columns._frozenInternal>=0)w.pos-a.x<-n.x&&(n.x=-(w.pos-a.x));else{w.pos<-n.x&&(n.x=-w.pos);C+n.x-a.x>0&&(n.x-=C+n.x-a.x);0==Math.abs(n.x-(this._ptScrl.x-this._spDiff.x))&&(n.x=this._ptScrl.x);this.rightToLeft&&!this._rows.isFrozen(e)&&isFirefox()&&n.x++}}if(!n.equals(this._ptScrl,.8,.8)){var v=1,y=1;this.columns._frozenInternal<0&&(v=-1);this.rows._frozenInternal<0&&(y=-1);n.x!=this._ptScrl.x&&this._root.clientWidth-n.x<this._root.scrollWidth&&(0!==n.x?n.x-=1*v:this.rightToLeft&&(n.x+=1*v));0!==n.y&&n.y<this._ptScrl.y&&this._root.clientHeight-n.y<this._root.scrollHeight&&(n.y-=1*y);this.scrollPosition=n;if(i){this._updateScrollPosition();this._forceScrollUpdate=!1;this.refresh()}this._spDiff.x=this._ptScrl.x-n.x;this._spDiff.y=this._ptScrl.y-n.y;setTimeout((function(){var e=getActiveElement();e.classList.contains("wj-state-invalid")&&o.errorTip._showAutoTip(void 0,e)}),50);return!0}if(e>-1&&t>-1){var b=this._root,R=b.scrollWidth==b.clientWidth,E=b.scrollHeight==b.clientHeight;if(R||E){var S=getScrollableParent(this.hostElement);if(S.clientHeight==S.scrollHeight&&S.clientWidth==S.scrollWidth)return!1;var x=getOffsetFromAncestor(this.hostElement,S),H=this.cells.getCellElement(e,t),z=c||new CellRange(e,t),F=z.getRenderSize(this.cells),M=this.rows[z.topRow].pos+this._eCHdr.clientHeight,I=this.columns[z.leftCol].pos+this._eRHdr.clientWidth,T=H?H.clientWidth:F.width,G=H?H.clientHeight:F.height,P=M+x.top,A=I+x.left,D=P+G,L=A+T,O=S.clientWidth,V=S.clientHeight,j=S.scrollTop,N=S.scrollLeft,k=j+V,B=N+O;this.stickyHeaders&&(j+=this._eCHdr.clientHeight-1);this.rightToLeft&&(A=(L=x.left+b.clientWidth-this._eRHdr.clientWidth-this.columns[z.leftCol].pos)-T);if(j<=P&&D<=k&&N<=A&&L<=B)return!1;var W=0,K=0;E&&(j>P?K=P-j:k<D&&(K=D-k));R&&(N>A?W=A-N:B<L&&(W=L-B));S.scrollBy(W,K);if(W||K){i&&(this._isSilentScroll=!0);return!0}}}return!1};FlexGrid.prototype.isRangeValid=function(e){return e&&e.isValid&&e.bottomRow<this.rows.length&&e.rightCol<this.columns.length};FlexGrid.prototype.startEditing=function(e,t,i,o,n){void 0===e&&(e=!0);return this._edtHdl.startEditing(e,t,i,o,n)};FlexGrid.prototype.finishEditing=function(e){return this._edtHdl.finishEditing(e)};Object.defineProperty(FlexGrid.prototype,"activeCell",{get:function(){return this._activeCell},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"activeEditor",{get:function(){var e=this._edtHdl;return e?e.activeEditor:null},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"editRange",{get:function(){var e=this._edtHdl.editRange;return e?e.clone():null},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"mergeManager",{get:function(){return this._mrgMgr},set:function(e){if(e!=this._mrgMgr){this._mrgMgr=asType(e,MergeManager,!0);this.invalidate()}},enumerable:!0,configurable:!0});FlexGrid.prototype.getMergedRange=function(e,t,i,o){void 0===o&&(o=!0);return this._mrgMgr?this._mrgMgr.getMergedRange(e,t,i,o):null};Object.defineProperty(FlexGrid.prototype,"keyActionTab",{get:function(){return this._keyHdl._kaTab},set:function(e){this._keyHdl._kaTab=asEnum(e,KeyAction)},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"keyActionEnter",{get:function(){return this._keyHdl._kaEnter},set:function(e){this._keyHdl._kaEnter=asEnum(e,KeyAction)},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"preserveWhiteSpace",{get:function(){return hasClass(this.hostElement,FlexGrid._WJS_WSPRE)},set:function(e){toggleClass(this.hostElement,FlexGrid._WJS_WSPRE,asBoolean(e))},enumerable:!0,configurable:!0});Object.defineProperty(FlexGrid.prototype,"showDropDown",{get:function(){return this._shDropDown},set:function(e){if(e!=this._shDropDown){this._shDropDown=asBoolean(e,!0);this.invalidate()}},enumerable:!0,configurable:!0});FlexGrid.prototype.toggleDropDownList=function(){if(!this._tglDropDown){this._tglDropDown=!0;this._edtHdl._toggleListBox(null);this._tglDropDown=!1}return null!=this._edtHdl._lbx};Object.defineProperty(FlexGrid,"defaultTypeWidth",{get:function(){return FlexGrid._defTypeWidth},enumerable:!0,configurable:!0});FlexGrid.prototype.onItemsSourceChanging=function(e){this.itemsSourceChanging.raise(this,e);return!e.cancel};FlexGrid.prototype.onItemsSourceChanged=function(e){this.itemsSourceChanged.raise(this,e)};FlexGrid.prototype.onScrollPositionChanged=function(e){this.scrollPositionChanged.raise(this,e);var t;if(softRestCollectionView()&&this.collectionView instanceof softRestCollectionView().RestCollectionView){if((t=this.collectionView)._virtualization&&t.groupDescriptions.length>0){var i=this.showGroups?this._getGroupCount(this.viewRange.row):0;t.setWindow(Math.floor((this.viewRange.row-i)/this._getRowsPerItem()),Math.ceil((this.viewRange.row2-i)/this._getRowsPerItem()))}t._virtualization&&0==t.groupDescriptions.length&&t.setWindow(Math.floor(this.viewRange.row/this._getRowsPerItem()),Math.ceil(this.viewRange.row2/this._getRowsPerItem()))}};FlexGrid.prototype.onSelectionChanging=function(e){this.selectionChanging.raise(this,e);return!e.cancel};FlexGrid.prototype.onSelectionChanged=function(e){this.selectionChanged.raise(this,e)};FlexGrid.prototype.onLoadingRows=function(e){this.loadingRows.raise(this,e);return!e.cancel};FlexGrid.prototype.onLoadedRows=function(e){this.loadedRows.raise(this,e);this._autoRowHeights()};FlexGrid.prototype.onUpdatingLayout=function(e){this.updatingLayout.raise(this,e);return!e.cancel};FlexGrid.prototype.onUpdatedLayout=function(e){this.updatedLayout.raise(this,e)};FlexGrid.prototype.onResizingColumn=function(e){this.resizingColumn.raise(this,e);return!e.cancel};FlexGrid.prototype.onResizedColumn=function(e){this.resizedColumn.raise(this,e);this._autoRowHeights()};FlexGrid.prototype.onAutoSizingColumn=function(e){this.autoSizingColumn.raise(this,e);return!e.cancel};FlexGrid.prototype.onAutoSizedColumn=function(e){this.autoSizedColumn.raise(this,e)};FlexGrid.prototype.onStarSizedColumns=function(e){this.starSizedColumns.raise(this,e);this._autoRowHeights()};FlexGrid.prototype.onDraggingColumn=function(e){this.draggingColumn.raise(this,e);return!e.cancel};FlexGrid.prototype.onDraggingColumnOver=function(e){this.draggingColumnOver.raise(this,e);return!e.cancel};FlexGrid.prototype.onDraggedColumn=function(e){this.draggedColumn.raise(this,e)};FlexGrid.prototype.onPinningColumn=function(e){this.pinningColumn.raise(this,e);return!e.cancel};FlexGrid.prototype.onPinnedColumn=function(e){this.pinnedColumn.raise(this,e)};FlexGrid.prototype.onResizingRow=function(e){this.resizingRow.raise(this,e);return!e.cancel};FlexGrid.prototype.onResizedRow=function(e){this.resizedRow.raise(this,e)};FlexGrid.prototype.onAutoSizingRow=function(e){this.autoSizingRow.raise(this,e);return!e.cancel};FlexGrid.prototype.onAutoSizedRow=function(e){this.autoSizedRow.raise(this,e)};FlexGrid.prototype.onDraggingRow=function(e){this.draggingRow.raise(this,e);return!e.cancel};FlexGrid.prototype.onDraggingRowOver=function(e){this.draggingRowOver.raise(this,e);return!e.cancel};FlexGrid.prototype.onDraggedRow=function(e){this.draggedRow.raise(this,e)};FlexGrid.prototype.onGroupCollapsedChanging=function(e){this._isGrpClpsChanging||-1==this.selection.row||this.groupCollapsedChanging.raise(this,e);if(!e.cancel){var t=void 0;if(softRestCollectionView()&&this.collectionView instanceof softRestCollectionView().RestCollectionView){t=this.collectionView;var i=this.rows[e.row];!this.isUpdating&&t.groupLazyLoading&&this.preserveOutlineState&&t._updateExpandedGroups(i.dataItem,i.isCollapsed);if(t.groupLazyLoading&&i.isCollapsed&&Object.keys(i.dataItem.items[0]).length<=t.groupDescriptions.length&&!this._isGrpClpsChanging){this._isGrpClpsChanging=!(t.groupDescriptions.length>1)||Object.keys(i.dataItem.items[0]).length<t.groupDescriptions.length;t.lazyLoadGroup(i.dataItem)}}}return!e.cancel};FlexGrid.prototype.onGroupCollapsedChanged=function(e){this._isGrpClpsChanging||-1==this.selection.row||this.groupCollapsedChanged.raise(this,e);if(softRestCollectionView()&&this.collectionView instanceof softRestCollectionView().RestCollectionView){var t=this._cv;if(t._virtualization){var i=this.viewRange,o=this.selection;if(o&&o.row>-1&&!this._grpClpsChng){var n=Math.floor((o.row-this._getGroupCount(o.row))/this._getRowsPerItem()+(this.rows[e.row].isCollapsed?this.rows[o.row].dataItem.items.length:0)),r=Math.ceil((i.row2-this._getGroupCount(i.row2))/this._getRowsPerItem());t._isVirtualRefreshNeeded(n,r)&&(this._isGrpClpsChanging=!0);t.setWindow(n,r)}}}};FlexGrid.prototype._getGroupCount=function(e){for(var t=0,i=0;i<e;i++)this.rows[i]instanceof GroupRow&&t++;return t++};FlexGrid.prototype.onColumnGroupCollapsedChanging=function(e){this.columnGroupCollapsedChanging.raise(this,e);return!e.cancel};FlexGrid.prototype.onColumnGroupCollapsedChanged=function(e){this.columnGroupCollapsedChanged.raise(this,e)};FlexGrid.prototype.onSortingColumn=function(e){this.sortingColumn.raise(this,e);return!e.cancel};FlexGrid.prototype.onSortedColumn=function(e){this.sortedColumn.raise(this,e)};FlexGrid.prototype.onBeginningEdit=function(e){this._addHdl._beginningEdit(this,e);e.cancel||this.beginningEdit.raise(this,e);return!e.cancel};FlexGrid.prototype.onPrepareCellForEdit=function(e){this.prepareCellForEdit.raise(this,e)};FlexGrid.prototype.onCellEditEnding=function(e){this.cellEditEnding.raise(this,e);return!e.cancel&&!e.stayInEditMode};FlexGrid.prototype.onCellEditEnded=function(e){this.cellEditEnded.raise(this,e);this._autoRowHeights()};FlexGrid.prototype.onRowEditStarting=function(e){this._addHdl._rowEditStarting(this,e);e.cancel||this.rowEditStarting.raise(this,e);return!e.cancel};FlexGrid.prototype.onRowEditStarted=function(e){this.rowEditStarted.raise(this,e)};FlexGrid.prototype.onRowEditEnding=function(e){this._addHdl._rowEditEnding(this,e);this.rowEditEnding.raise(this,e)};FlexGrid.prototype.onRowEditEnded=function(e){this.rowEditEnded.raise(this,e);this._addHdl._rowEditEnded(this,e);this._autoRowHeights()};FlexGrid.prototype.onRowAdded=function(e){this.rowAdded.raise(this,e);return!e.cancel};FlexGrid.prototype.onDeletingRow=function(e){this.deletingRow.raise(this,e);return!e.cancel};FlexGrid.prototype.onDeletedRow=function(e){this.deletedRow.raise(this,e)};FlexGrid.prototype.onCopying=function(e){this.copying.raise(this,e);return!e.cancel};FlexGrid.prototype.onCopied=function(e){this.copied.raise(this,e)};FlexGrid.prototype.onPasting=function(e){this.pasting.raise(this,e);return!e.cancel};FlexGrid.prototype.onPasted=function(e){this.pasted.raise(this,e)};FlexGrid.prototype.onPastingCell=function(e){this.pastingCell.raise(this,e);return!e.cancel};FlexGrid.prototype.onPastedCell=function(e){this.pastedCell.raise(this,e)};FlexGrid.prototype.onFormatItem=function(e){this.formatItem.raise(this,e)};FlexGrid.prototype.onUpdatingView=function(e){this.updatingView.raise(this,e);return!e.cancel};FlexGrid.prototype.onUpdatedView=function(e){this.updatedView.raise(this,e)};FlexGrid.prototype.getMergedRangeRawData=function(e,t,i,o){void 0===o&&(o=!0);return this._mrgMgr?softMultirow()&&this instanceof softMultirow().MultiRow||softTransposed()&&this instanceof softTransposed().TransposedGrid||softTransposedMultirow()&&this instanceof softTransposedMultirow().TransposedMultiRow?this._mrgMgr.getMergedRange(e,t,i,o):this._mrgMgr._getMergedRange?this._mrgMgr._getMergedRange(e,t,i,o,!1):this._mrgMgr.getMergedRange(e,t,i,o):null};FlexGrid.prototype._createSelHdl=function(){return new _SelectionHandler(this)};FlexGrid.prototype._getTabIndex=function(){return this._orgTabIndex};FlexGrid.prototype._setTabOrder=function(e){this._orgTabIndex=e;this._updateTabIndex()};FlexGrid.prototype._updateTabIndex=function(){var e=this.isDisabled?-1:this._orgTabIndex,t=this._imeHdl;t&&t._updateImeFocus();var i=this._activeCell,o=this._root,n=this._eFocus;if(i){i.tabIndex=e;n.tabIndex=-1;o.tabIndex=-1}else if(this.selectionMode!=SelectionMode.None){n.tabIndex=e;o.tabIndex=-1}else{o.tabIndex=e;n.tabIndex=-1}};FlexGrid.prototype._autoRowHeights=function(){var e=this;if(this._autoHeights){this.rows.length>100&&[this.columnHeaders,this.rowHeaders].forEach((function(e){e._updateContent(!0,!1,e._getOffsetY())}));clearTimeout(this._toAutoHeights);this._toAutoHeights=setTimeout((function(){e._toAutoHeights=null;e.editRange||e._autoSizeRows()}),Control._REFRESH_INTERVAL)}};FlexGrid.prototype._autoSizeRows=function(){var e=this.autoSizeMode,t=AutoSizeMode;if(e&t.Headers){this._autoSizeMode=t.Both;this.autoSizeRows(0,this.columnHeaders.rows.length-1,!0);this._autoSizeMode=e}e&t.Cells&&this.autoSizeRows()};FlexGrid.prototype._getShowErrors=function(){return this.showErrors&&this._hasValidation};FlexGrid.prototype._getHasValidation=function(){return this._hasValidation};FlexGrid.prototype._getError=function(e,t,i,o){if(isFunction(this.itemValidator)){if(e==this.cells)return this.itemValidator(t,i,o);if(e==this.rowHeaders){var n=e.rows,r=this.columns,l=n[t].dataItem,s=null,a=[],c=t;if(g=this.getMergedRange(e,t,i,!1)){for(t=c=g.row;t<n.length&&(n[t].dataItem==l||g&&g.rowSpan>1&&g.row2>=t);t++)for(var u=0;u<r.length;u++)if(s=this.itemValidator(t,u,!1)){(C=this.getMergedRange(this.cells,t,u))&&(C.columnSpan>1&&C.col<u||C.rowSpan>1&&C.row<t)||a.push(s)}}else for(u=0;u<this.columns.length;u++){var h=this.itemValidator(t,u,!1);h&&a.push(h)}if(a.length){var d=!!(v=this.errorTip)&&v.isContentHtml;s=a.join(d?"<br/>":"\n")}return s}}var p=this._cv,f=p?p.getError:null;if(isFunction(f)){n=e.rows,r=this.columns;if((l=n[t].dataItem)&&!(l instanceof CollectionViewGroup))if(e==this.cells)for(;t<n.length&&n[t].dataItem==l;t++){return f(l,(_=this._getBindingColumn(this.cells,t,r[i])).binding,o)}else if(e==this.rowHeaders){if(!(s=f(l,null,!1))){var g;a=[],c=t;(g=this.getMergedRange(e,t,i,!1))&&(c=g.row);for(t=c;t<n.length&&(n[t].dataItem==l||g&&g.rowSpan>1&&g.row2>=t);t++)for(u=0;u<r.length;u++){var _=this._getBindingColumn(this.cells,t,r[u]),m=n[t].dataItem,w=m&&_&&_.binding?_._binding.getValue(m):null;if(s=_.binding&&m&&_.getIsRequired(n[t])&&(null==w||""===w)?this._edtHdl._getRequiredMsg():f(m,_.binding,!1)){var C;(C=this.getMergedRange(this.cells,t,u))&&(C.columnSpan>1&&C.col<u||C.rowSpan>1&&C.row<t)||a.push(s)}}if(a.length){var v;d=!!(v=this.errorTip)&&v.isContentHtml;s=a.join(d?"<br/>":"\n")}}return s}}return null};FlexGrid.prototype._setAria=function(e,t){setAttribute(this.cells.hostElement,"aria-"+e,t)};FlexGrid.prototype._setFocus=function(e){if(this.hostElement){var t=getActiveElement(),i=this.activeEditor,o=this._activeCell,n=this._eFocus,r=this._root,l=this._getTabIndex(),s=this.containsFocus();if(!e&&s&&this.selectionMode!=SelectionMode.None){if(this.rows.length>0&&this.selection.row>=0&&this.selection.col>=0){var a=this._getBindingColumn(this.cells,this.selection.row,this.columns[this.selection.col]),c=a&&a._edt;this._isInputElement(t)||!o||contains(o,t)||this.imeEnabled||c||this._correctFocusOfActiveCell(o)}}else if(e||!s){if(i){if(!contains(i,t)){i.focus();n.tabIndex=-1;r.tabIndex=-1}}else if(o)contains(o,t)||this._correctFocusOfActiveCell(o);else if(!contains(n,t)&&t!=r)if(this.selectionMode!=SelectionMode.None){n.tabIndex=l;this._setFocusNoScroll(n)}else{r.tabIndex=l;this._setFocusNoScroll(r)}if(!this.containsFocus())if(this.selectionMode!=SelectionMode.None){n.tabIndex=l;this._setFocusNoScroll(n)}else{r.tabIndex=l;this._setFocusNoScroll(r)}}}};FlexGrid.prototype._correctFocusOfActiveCell=function(e){var t=this._getTabIndex();if(getActiveElement()!=this._root){isIE()&&hasClass(e,"wj-group")&&(e=e.querySelector("."+CellFactory._WJC_COLLAPSE)||e);e.tabIndex=t;this._setFocusNoScroll(e)}else e.tabIndex=t;this._eFocus.tabIndex=-1};FlexGrid.prototype._setFocusNoScroll=function(e){if(getActiveElement()!=e){if(supportsFocusOptions())this._imeHdl&&this._imeHdl._handlingCompositionStart||e.focus({preventScroll:!0});else{var t=this.scrollPosition,i=e.style,o=i.position;i.position="fixed";e.focus();i.position=o;this.scrollPosition=t}this._fixScroll()}};FlexGrid.prototype._clearAnchorCell=function(){this._anchorCell=null};FlexGrid.prototype._setAnchorCell=function(e,t){var i=this.getMergedRange(this.cells,e,t);this._anchorCell=i?new Point(i.col,i.row):new Point(t,e)};FlexGrid.prototype._getAnchorCell=function(){return this._anchorCell};FlexGrid.prototype._updateDefaultSizes=function(){var e=this._getDefaultRowHeight();this._rows._setDefaultSize(e);this._cols._setDefaultSize(4*e);this._hdrRows._setDefaultSize(e);this._hdrCols._setDefaultSize(Math.round(1.25*e));this._ftrRows._setDefaultSize(e);return e};FlexGrid.prototype._getDefaultRowHeight=function(){var e=this.hostElement,t=this._eFocus,i=null;if(!t.offsetHeight){i=createElement('<div><div class="wj-cell">0</div></div>',document.body);e&&i.setAttribute("class",e.getAttribute("class"));t=i.children[0]}var o=t.offsetHeight;(isNaN(o)||o<=6)&&(o=28);removeChild(i);return o};FlexGrid.prototype._getCollectionView=function(e){return asCollectionView(e)};FlexGrid.prototype._getCanvasContext=function(){var e=document.createElement("canvas").getContext("2d"),t=getComputedStyle(this.hostElement);e.font=t.fontSize+" "+t.fontFamily.split(",")[0];return e};FlexGrid.prototype._getWidestRow=function(e,t,i,o){for(var n=0,r=0,l=1===this._getRowsPerItem()&&e.columns[i].dataType==DataType.Boolean,s=t.row;s<=t.row2;s++)if(e.rows[s].isVisible){var a=e.getCellData(s,i,!0),c=o.measureText(a).width,u=this.getMergedRange(e,s,i,!1);u&&u.columnSpan>1&&(c/=u.columnSpan);if(c>r){r=c;n=s}if(l)break;s+=u?u.rowSpan-1:0}return n};FlexGrid.prototype._getDesiredWidth=function(e,t,i,o){var n=this.getMergedRange(e,t,i,!1),r=o.style;this.cellFactory.updateCell(e,t,i,o,n);r.width=r.top=r.left="";return o.offsetWidth/(n&&n.columnSpan>1?n.columnSpan:1)};FlexGrid.prototype._getDesiredHeight=function(e,t,i,o){var n=o.style,r=this.getMergedRange(e,t,i,!1),l=r?r.rowSpan:1;this.cellFactory.updateCell(e,t,i,o,r);var s=o.innerHTML,a=this.cachedHeights[s],c=s.trim();if(!c||"<div></div>"===c){s="&nbsp;";var u=o;if(null==(a=this.cachedHeights[s])){c?u.firstElementChild.innerHTML=s:u.innerHTML=s;u.style.height=u.style.top=u.style.left=""}if(!e.rows[t].wordWrap&&!e.columns[i].wordWrap){if(-1==this.cachedDefaultHeight){n.height=n.top=n.left="";this.cachedDefaultHeight=u.offsetHeight}this.cachedHeights[s]=this.cachedDefaultHeight;return this.cachedDefaultHeight/l}}if(null==a||a<o.scrollHeight){n.height=n.top=n.left="";this.cachedHeights[s]=o.offsetHeight}return this.cachedHeights[s]/l};FlexGrid.prototype._getDesiredRowHeight=function(e,t,i,o){for(var n=0,r=(e.rows[t],this._getQuickAutoSize()),l=0;l<e.columns.length;l++){if(e.columns[l].isVisible){var s=this.getMergedRange(e,t,l,!1),a=void 0;if(r){var c={ct:e.cellType,col:l,spr:s&&s.rowSpan>1?s.rowSpan:1,spc:s&&s.columnSpan>1?s.columnSpan:1,data:e.getCellData(t,l,!0)||"1"},u=JSON.stringify(c);if(null==(a=o[u])){a=this._getDesiredHeight(e,t,l,i);o[u]=a}}else a=this._getDesiredHeight(e,t,l,i);n=Math.max(a,n);l+=s?s.columnSpan-1:0}}return n};FlexGrid.prototype._getSortRowIndex=function(){return null!=this._sortRowIndex?this._sortRowIndex:this.columnHeaders.rows.length-1};FlexGrid.prototype._getDeleteColumnIndex=function(){return 0};FlexGrid.prototype._getEditColumnIndex=function(){return null!=this._editColIndex?this._editColIndex:this.rowHeaders.columns.length-1};FlexGrid.prototype._sortConverter=function(e,t,i,o){var n,r=this;if(o){this._mappedColumns=null;this._cv&&this._cv.sortDescriptions.forEach((function(e){if((n=r.getColumn(e.property))&&n.dataMap){r._mappedColumns||(r._mappedColumns={});r._mappedColumns[n.binding]=n.dataMap}}));if(this._mouseHdl._htDown&&this._mouseHdl._htDown.col>-1){n=this.columns[this._mouseHdl._htDown.col];this._mappedColumns&&n.dataMap&&(this._mappedColumns[n.binding]=n.dataMap)}}if(this._mappedColumns){var l=this._mappedColumns[e.property];l&&l.sortByDisplayValues&&(i=l.getDisplayValue(i))}return i};FlexGrid.prototype._bindGrid=function(e){var t=this;this.finishEditing();this.deferUpdate((function(){t.autoGenerateColumns&&0==t._lastCount&&hasItems(t._cv)&&(e=!0);var i;t.preserveSelectedState&&(i=t._getMap())&&t.rows.forEach((function(e){e.isSelected&&e.dataItem&&i.set(e.dataItem,!0)}));var o=null;if(t.preserveSelectedState&&t._cv&&t.selection){var n=t.selection;!t._cv.currentItem&&n.row>-1&&t.rows[n.row]&&(o=t.rows[n.row].dataItem)}var r,l=t._getMap();l&&t.rows.forEach((function(e){e.isReadOnly&&e.dataItem&&l.set(e.dataItem,!0)}));if(t.preserveOutlineState&&t.rows.maxGroupLevel>-1&&(r=t._getMap()))for(var s=0;s<t.rows.length;s++){var a=t.rows[s];if(a instanceof GroupRow&&a.isCollapsed&&a.dataItem){var c=a.dataItem;c instanceof CollectionViewGroup&&(c=c._path);r.set(c,!0)}}e&&t.columns.deferUpdate((function(){t._bindColumns()}));var u=new CancelEventArgs;if(t.onLoadingRows(u)){t.rows.deferUpdate((function(){t._bindRows()}));t.onLoadedRows(u)}t._selHdl.extendedSelection.clear();var h=0;i&&i.size&&t.rows.forEach((function(e){var t=e.dataItem;if(t&&i.has(t)){e.isSelected=!0;h++}}));l&&l.size&&t.rows.forEach((function(e){var t=e.dataItem;t&&l.has(t)&&(e.isReadOnly=!0)}));if(0==h&&t.selectionMode==SelectionMode.ListBox)for(s=(n=t.selection).topRow;s<=n.bottomRow&&s>-1&&s<t.rows.length;s++)t.rows[s]._setFlag(RowColFlags.Selected,!0,!0);if(t._cv&&!t._cv.currentItem&&o){for(var d=!1,p=0;p<t.rows.length;p++)if(t.rows[p].dataItem===o){t._selHdl.selection.row=t._selHdl.selection.row2=p;d=!0;break}if(!d){t._selHdl.selection.row=-1;t._selHdl.selection.row2=-1}}r&&r.size&&t.rows.deferUpdate((function(){t.rows.forEach((function(e){if(e instanceof GroupRow){var t=e.dataItem;t instanceof CollectionViewGroup&&(t=t._path);r.has(t)&&(e.isCollapsed=!0)}}))}));if(!t._lastCount){var f=t._cv;f&&f.items&&(t._lastCount=f.items.length)}}));if(this._cv){var i=e&&!this._toInv;this.activePanelType===CellType.Cell&&this._syncSelection(i)}else{var o=this.selection,n=new CellRange(-1,o.col,-1,o.col2);this.activePanelType===CellType.Cell&&this._selHdl._adjustSelection(n,this.selectionMode)}};FlexGrid.prototype._getMap=function(){return window.Map?new Map:null};FlexGrid.prototype._cvCollectionChanged=function(e,t){if(this.autoGenerateColumns&&0==this.columns.length)this._bindGrid(!0);else{var i=NotifyCollectionChangedAction;if(this.childItemsPath&&t.action!=i.Change)this._bindGrid(!1);else{switch(t.action){case i.Change:this.invalidate();return;case i.Add:if(t.index==this._cv.items.length-1){var o=this.rows.length;this.rows[o-1]instanceof _NewRowTemplate&&o--;this.rows.insert(o,new Row(t.item));return}assert(!1,"added item should be the last one.");break;case i.Remove:var n=this._findRow(t.item);if(n>-1){this.rows.removeAt(n);this._syncSelection(!1);return}assert(!1,"removed item not found on grid.")}this._bindGrid(!1)}}};FlexGrid.prototype._cvCurrentChanged=function(e,t){this._syncSelection(!1)};FlexGrid.prototype._syncSelection=function(e){if(this._cv&&this.selectionMode!=SelectionMode.None){var t=this._selHdl,i=t.selection,o=i.row>-1&&i.row<this.rows.length?this.rows[i.row]:null,n=o?o.dataItem:null,r=this._cv;if(r instanceof CollectionView&&r.isUpdating)return;if(this.newRowAtTop&&o instanceof _NewRowTemplate)return;n instanceof CollectionViewGroup&&(n=null);var l=this._isISChanging;if(e||n!=r.currentItem||i.row>=this.rows.length||i.row2>=this.rows.length||l&&i.row!==i.row2){var s=this.editableCollectionView;if(!this.childItemsPath||!s||!s.currentAddItem){var a=this._getRowIndex(r.currentPosition),c=this.getMergedRange(this._activePanel,a,i.col,!1);if(!(null!=c&&c._row<=i.row&&c._row2>=i.row2||a==i.row&&this.childItemsPath)){var u=l?i.col:i.col2;i=new CellRange(a,i.col,a,u);t._adjustSelection(i,this.selectionMode);this.selectionMode&&!this._updating&&this.scrollIntoView(i.row,-1)}}}}};FlexGrid.prototype._getRowIndex=function(e){if(this._cv){var t=this.rows;if(e>-1){for(var i=this._cv.items[e];e<t.length;e++)if(t[e].dataItem===i)return e;return-1}if(1==t.length&&t[0]instanceof _NewRowTemplate)return 0;var o=this.selection.row,n=o>-1?t[o]:null;return n&&(n instanceof GroupRow||null==n.dataItem)?o:-1}return this.selection.row};FlexGrid.prototype._getCvIndex=function(e){return e>-1&&e<this.rows.length?this.rows[e].dataIndex:-1};FlexGrid.prototype._findRow=function(e){for(var t=0;t<this.rows.length;t++)if(this.rows[t].dataItem==e)return t;return-1};FlexGrid.prototype._preWidth=function(){var e=this._root,t=this._hdrVis&HeadersVisibility.Row?this._hdrCols.getTotalSize():0;return e.clientWidth-t};FlexGrid.prototype._updateLayout=function(){var e=new CancelEventArgs;if(this.onUpdatingLayout(e)){var t=this._hdrVis&HeadersVisibility.Row?this._hdrCols.getTotalSize():0,i=this._hdrVis&HeadersVisibility.Column?this._hdrRows.getTotalSize():0,o=this._ftrRows.getTotalSize(),n=this._rows.getTotalSize()+o;n<1&&(n=1);this._heightReal=n;this._heightBrowser=Math.min(n,FlexGrid._getMaxSupportedCssHeight());this._maxOffsetY=Math.max(0,n-this._heightBrowser);var r=getComputedStyle(this._eFocus);this._cellPadVert=parseInt(r.paddingTop)+parseInt(r.paddingBottom);this._cellPadHorz=parseInt(r.paddingLeft)+parseInt(r.paddingRight);this._cellPadLeft=parseInt(this.rightToLeft?r.paddingRight:r.paddingLeft);var l=this._heightBrowser+i-o,s=this._gpCells.width,a=this._heightBrowser;!s&&this.rows.length&&(s=.1);!a&&this.columns.length&&(a=.1);if(this.rightToLeft){setCss(this._eTL,{right:0,top:0,width:t,height:i});setCss(this._eCHdr,{right:t,top:0,height:i});setCss(this._eRHdr,{right:0,top:i,width:t});setCss(this._eCt,{right:t,top:i,width:s,height:a});setCss(this._fCt,{right:t,top:i});setCss(this._eBL,{right:0,top:l,width:t,height:o});setCss(this._eCFtr,{right:t,top:l,height:o})}else{setCss(this._eTL,{left:0,top:0,width:t,height:i});setCss(this._eCHdr,{left:t,top:0,height:i});setCss(this._eRHdr,{left:0,top:i,width:t});setCss(this._eCt,{left:t,top:i,width:s,height:a});setCss(this._fCt,{left:t,top:i});setCss(this._eBL,{left:0,top:l,width:t,height:o});setCss(this._eCFtr,{left:t,top:l,height:o})}this._stickyHdr&&this._updateStickyHeaders();var c=this.rows._frozenInternal||this.columns._frozenInternal;setCss([this._eTL,this._eBL,this._eCFtr,this._eRHdr],{zIndex:c?"4":"3"});setCss(this._eCHdr,{zIndex:c?"5":"3"});setCss(this._eMarquee,{zIndex:c?"4":"1"});this._eCHdr.closest(".wj-cell")&&setCss(this._eCHdr,{zIndex:c?"5":"2"});isIE()&&(this._fCt.style.zIndex=c?"3":"");var u=this._root,h=u.offsetWidth-u.clientWidth,d=u.offsetHeight-u.clientHeight;setCss(this._eSz,{width:t+h+this._gpCells.width,height:i+d+this._heightBrowser});var p=null;if(this.columns._updateStarSizes(u.clientWidth-t)){p=u.clientWidth;setCss(this._eCt,{width:this._gpCells.width});this.onStarSizedColumns()}this._szClient=new Size(u.clientWidth-t,u.clientHeight-i);this._szClientSB=new Size(u.offsetWidth-t,u.offsetHeight-i);this._rcBounds=null;this._updateScrollHandler();this._updateContent(!1);h=u.offsetWidth-u.clientWidth;d=u.offsetHeight-u.clientHeight;setCss(this._eSz,{width:t+h+this._gpCells.width,height:i+d+this._heightBrowser});var f=new Size(this._szClient.width,this._szClient.height);this._szClient=new Size(u.clientWidth-t,u.clientHeight-i);!(this.columns._frozenInternal<0||this.rows._frozenInternal<0)||f.width==this._szClient.width&&f.height==this._szClient.height||this._updateContent(!1);if(p&&p!=u.clientWidth&&this.columns._updateStarSizes(u.clientWidth-t)){setCss(this._eCt,{width:this._gpCells.width});this._updateContent(!1)}setCss([this._eCHdr,this._eCFtr,this._fCt],{width:this._szClient.width});setCss([this._eRHdr,this._fCt],{height:this._szClient.height});if(o){l=Math.min(l,this._szClient.height+i-o);setCss([this._eBL,this._eCFtr],{top:l})}this._alignTheTail(this.rows);this._alignTheTail(this.columns);this.onUpdatedLayout(e)}};FlexGrid.prototype.handleLoad=function(){setCss(this._root,{"overflow-y":this._root.scrollHeight===this._root.parentElement.clientHeight?"hidden":"auto","overflow-x":this._root.scrollWidth===this._root.parentElement.clientWidth?"hidden":"auto"})};FlexGrid.prototype._updateStickyHeaders=function(){var e=!1,t=0;if(this._stickyHdr){for(var i=0,o=null,n=this.hostElement;n;n=n.parentElement)if("inline"!=getComputedStyle(n).display){var r=n.getBoundingClientRect();null==o&&(o=r.top);i=Math.max(i,r.top)}t=-(o=Math.max(0,i-o-1));e=o>0;this._rcBounds=null}this._eTL.style.top=this._eCHdr.style.top=e?-t+"px":"";toggleClass(this._eTL,FlexGrid._WJS_STICKY,e);toggleClass(this._eCHdr,FlexGrid._WJS_STICKY,e)};FlexGrid.prototype._updateScrollHandler=function(){this._clipToScreen=this._getClipToScreen();var e=this._stickyHdr||this._clipToScreen;if(e!=this._scrollHandlerAttached){this._scrollHandlerAttached=e;e?this.addEventListener(window,"scroll",this._scroll.bind(this),!0):this.removeEventListener(window,"scroll")}};FlexGrid.prototype._getClipToScreen=function(){if(this.rows.length<=FlexGrid._MIN_VIRT_ROWS)return!1;if(this._root.scrollHeight>this._root.clientHeight)return!1;for(var e=this.hostElement;e&&e!=document.documentElement;e=e.parentElement){if("auto"==getComputedStyle(e).overflow)return!1}return!0};FlexGrid.prototype._scroll=function(e){var t=this;if(contains(e.target,this.hostElement)){if(this._clipToScreen){var i=this;this._afClip&&cancelAnimationFrame(this._afClip);this._afClip=requestAnimationFrame((function(){if(i._isSilentScroll)queueMicrotask((function(){return i._isSilentScroll=!1}));else{t._afClip=null;t.finishEditing();t._updateContent(!0)}}))}if(this._stickyHdr){var o=Date.now();if(o-this._lastStickyScroll>this._scrollStickyThrottleTimeout){this._afSticky&&cancelAnimationFrame(this._afSticky);this._afSticky=requestAnimationFrame((function(){t._afSticky=null;var e=new CancelEventArgs;if(t.onUpdatingLayout(e)){t._updateStickyHeaders();t.onUpdatedLayout(e)}}));this._lastStickyScroll=o}this._handleScrollEnd()}}};FlexGrid.prototype._getCssPage=function(e){if(this._heightReal>this._heightBrowser){var t=this._szClient.height-this._gpCFtr.rows.getTotalSize();if(this._heightBrowser>t)return clamp(Math.round(e/(this._heightBrowser-t)*10)/10,0,1)}return 0};FlexGrid.prototype._updateScrollPosition=function(){var e=this._root,t=e.scrollTop,i=e.scrollLeft;this.rightToLeft&&"rev"==FlexGrid._getRtlMode()&&(i=e.scrollWidth-e.clientWidth-i);var o=new Point(-Math.abs(i),-t),n=this.columns.getTotalSize();this.rightToLeft&&"rev"!=FlexGrid._getRtlMode()&&(i=-i);if(isSafari()&&(i<0||n>this._szClient.width&&i+this._szClient.width>n))return!1;if(!this._ptScrl.equals(o)){this._ptScrl=o;this._updateMarquee();this.onScrollPositionChanged();return!0}return!1};FlexGrid.prototype._updateContent=function(e,t){var i=this,o=this._root,n=this.hostElement,r=this.cells.hostElement,l=this._activeCell,s=getActiveElement(),a=contains(n,s),c=closest(s,".wj-flexgrid")==n?s:null,u=new CancelEventArgs;if(this.onUpdatingView(u)){if([HeadersFocusability.All,HeadersFocusability.Column].includes(this.headersFocusability)){setAttribute(this.hostElement,"role",this.rows.maxGroupLevel<0?"grid":"treegrid");setAttribute(this.hostElement,"aria-label",this.ariaLabel)}else{setAttribute(r,"role",this.rows.maxGroupLevel<0?"grid":"treegrid");setAttribute(r,"aria-label",this.ariaLabel)}this._hasValidation=isFunction(this._itemValidator)||this._cv&&isFunction(this._cv.getError);var h=!t&&this._errorTip&&this._errorTip._tips.length,d=this._getCssPage(-this._ptScrl.y);if(d!=this._cssPage){this._cssPage=d;this._offsetY=Math.round(this._maxOffsetY*d)}this._updateScrollPosition();this._updateMarquee();var p=this._gpCells._updateContent(e,t,this._offsetY),f=this._hdrVis;if(f&HeadersVisibility.Column&&(!t||this._ssHdr&f||this.headersFocusability&HeadersFocusability.Column)){this._gpCHdr._updateContent(e,t,0);this.rightToLeft||(this._eCHdr.scrollLeft=0)}if(f&HeadersVisibility.Row&&(!t||this._ssHdr&f||this.headersFocusability&HeadersFocusability.Row)){this._gpRHdr._updateContent(e,t,this._offsetY);this._eRHdr.scrollTop=0}!f||this.headersFocusability!==HeadersFocusability.All&&t||this._gpTL._updateContent(e,t,0);if(this._gpCFtr.rows.length){this._gpBL._updateContent(e,t,0);this._gpCFtr._updateContent(e,t,0)}switch(this.activePanelType){case CellType.ColumnHeader:p=this._gpCHdr.activeCell;break;case CellType.RowHeader:p=this._gpRHdr.activeCell;break;case CellType.TopLeft:p=this._gpTL.activeCell}if(h&&this._errorTip&&this._errorTip._tips.length){clearTimeout(this._toErrorTips);this._toErrorTips=setTimeout((function(){var e=i._errorTip;if(e){e.hide();for(var t=e._tips,o=0;o<t.length;o++){var n=t[o].element;if(!n.offsetHeight||!hasClass(n,"wj-state-invalid")){e.setTooltip(n,null);o--}}}}),40)}if(this._useFrozenDiv()){this._updateFrozenCells(t);p&&hasClass(p,"wj-frozen")&&(p=null)}this._fCt.style.display=this._fCt.childElementCount?"":"none";this._activeCell=p;if(c)if(c==o||c==this._eFocus||!contains(n,c)||contains(r,c)||this.imeEnabled){var g=p!==l;this._setFocus(g)}else{getActiveElement()!==c&&c.focus();if(isIE()&&c instanceof HTMLInputElement&&!c.type.match(/checkbox|radio|range/i)){var _=c.selectionStart,m=c.selectionEnd;c.setSelectionRange(_,m)}}!c&&p&&(p.tabIndex=this.isDisabled?-1:this._orgTabIndex);l&&l!=p&&(l.tabIndex=-1);if(this.selectionMode!=SelectionMode.None)this._eFocus.tabIndex=null!=p||this.isDisabled?-1:this._orgTabIndex;else{this._eFocus.tabIndex=-1;this._root.tabIndex=null!=p||this.isDisabled?-1:this._orgTabIndex}a&&this.focus();this._fixScroll();this._rcBounds=null;this._updateMarquee();this.onUpdatedView(u)}};FlexGrid.prototype._fixScroll=function(){var e=this._root;if(!this._updating){var t=this.hostElement,i=e?e.parentElement:null,o=this.rightToLeft;if(t){t.scrollTop&&(t.scrollTop=0);t.scrollLeft&&!o&&(t.scrollLeft=0)}if(i){i.scrollTop&&(i.scrollTop=0);i.scrollLeft&&!o&&(i.scrollLeft=0)}}var n=_getSafariVer();if(e&&n&&14==n.major&&n.minor>=1){e.style.transform="";e.style.transform="translateZ(0)"}};FlexGrid.prototype._clearCells=function(){for(var e in this)if("_"==e[0]){var t=this[e];t instanceof GridPanel&&t._clearCells()}this.invalidate()};FlexGrid.prototype._useFrozenDiv=function(){return isBoolean(this._fzClone)?this._fzClone:isIE()||isFirefox()||isSafari()||isMobile()};FlexGrid.prototype._updateFrozenCells=function(e,t){void 0===t&&(t=!1);var i=this._fCt;(t||0===this.rows.frozen&&0===this.columns.frozen)&&setText(i,null);if(this.rows._frozenInternal||this.columns._frozenInternal){var o=this._eCt.querySelectorAll(".wj-frozen");if(e&&i.children.length==o.length){for(var n=0;n<o.length;n++)i.children[n].className=o[n].className;return}setText(i,null);if(!this.activeEditor){var r=this._errorTip,l=navigator.userAgent.indexOf("MSIE")>=0;for(n=0;n<o.length;n++){var s=o[n];if(closest(s,".wj-flexgrid")==this.hostElement){var a=s[GridPanel._INDEX_KEY],c=s.firstElementChild,u=null;if(a&&c){var h=a.panel,d=this._getBindingColumn(h,a.row,h.columns[a.col]);u=isFunction(d.cellTemplate)?c.onclick:null}if(l){var p="input[type=checkbox]",f=s.querySelector(p);s=s.cloneNode(!0);if(f){s.querySelector(p).checked=f.checked}}else{var g=(s=s.cloneNode(!0)).getAttribute("top-for-clone"),_=s.getAttribute("left-for-clone");g&&(s.style.top=g+"px");_?this.rightToLeft?s.style.right=_+"px":s.style.left=_+"px":s.style.left=Math.round(parseFloat(s.style.left))+"px"}c=s.firstElementChild;u&&c&&(c.onclick=u);s[GridPanel._INDEX_KEY]=a;if(r){var m=r.getTooltip(o[n]);m&&r.setTooltip(s,m)}i.appendChild(s)}}}}};FlexGrid.prototype._updateMarquee=function(){if(this.activePanelType==CellType.Cell){var e=this._eMarquee,t=this._getMarqueeRect();if(t&&t.width&&t.height){var i=this.cells.hostElement,o=e.firstChild,n=e.offsetWidth-o.offsetWidth,r=e.offsetHeight-o.offsetHeight;setCss(e,{width:t.width+n,height:t.height+r,top:t.top+i.offsetTop-r/2,left:t.left+i.offsetLeft-n/2,display:""})}else e.style.display="none"}else this._hideMarquee()};FlexGrid.prototype._hideMarquee=function(){var e=this._eMarquee;setCss(e,{display:"none"})};FlexGrid.prototype._getMarqueeRect=function(){if(!this._shMarquee||!this.selectionMode)return null;var e=this._selHdl.selection;if(!this.isRangeValid(e))return null;e=(e=(e=this.cells._getAdjustedSelection(e)).combine(this.getMergedRange(this.cells,e.topRow,e.leftCol,!1))).combine(this.getMergedRange(this.cells,e.bottomRow,e.rightCol,!1));var t=this.cells.getCellBoundingRect(e.topRow,e.leftCol,!0),i=this.cells.getCellBoundingRect(e.bottomRow,e.rightCol,!0);if(this.rows._frozenInternal){var o=this.rows._frozenInternal>=0?Math.min(this.rows.length,this.rows._frozenInternal):this.rows._lastFrozen,n=this.rows._frozenInternal>=0?this.cells.getCellBoundingRect(o-1,0,!0):this.cells.getCellBoundingRect(o,0,!0);if(this.rows._frozenInternal>=0){e.topRow>=o&&t.top<n.bottom&&(t.top=n.bottom);e.bottomRow>=o&&i.bottom<n.bottom&&(i.height=n.bottom-i.top)}else{e.bottomRow<o&&i.bottom>n.top&&(i.height-=i.bottom-n.top);e.topRow<o&&t.top>n.top&&(t.top=n.top);this.rows.isFrozen(this.rows._firstVisible)&&e.topRow===this.rows._firstVisible&&t.top++;if(isChromiumBased()&&!isMobile()){e.bottomRow>=o&&i.top--;e.topRow>=o&&t.top--}}}if(this.columns._frozenInternal){var r=this.columns._frozenInternal>=0?Math.min(this.columns.length,this.columns._frozenInternal):this.columns._lastFrozen;n=this.columns._frozenInternal>=0?this.cells.getCellBoundingRect(0,r-1,!0):this.cells.getCellBoundingRect(0,r,!0);if(this.rightToLeft)if(this.columns._frozenInternal>=0){e.leftCol>=r&&t.right>n.left&&(t.left=n.left-t.width);e.rightCol>=r&&i.left>n.left&&(i.left=n.left)}else{if(e.rightCol<r&&i.left<n.right){i.left=n.right;if(t.right<=n.right){t.left=n.right;t.width=0}}if(e.leftCol<r&&t.right<n.right){t.left=n.right;t.width=0}}else if(this.columns._frozenInternal>=0){e.leftCol>=r&&t.left<n.right&&(t.left=n.right);e.rightCol>=r&&i.right<n.right&&(i.width=n.right-i.left)}else{e.rightCol<r&&i.right>n.left&&(i.left-=i.right-n.left);e.leftCol<r&&t.left>n.left&&(t.left=n.left)}}var l=0;this.columns._frozenInternal<0&&isChromiumBased()&&!isMobile()&&this.columns.isFrozen(e.rightCol)&&t.right-i.left!=0&&(l=1);return this.rightToLeft?new Rect(i.left,t.top,t.right-i.left-l,i.bottom-t.top):new Rect(t.left,t.top,i.right-t.left-l,i.bottom-t.top)};FlexGrid.prototype._bindColumns=function(){for(var e=this.columns,t=0;t<e.length;t++){if(e[t]._getFlag(RowColFlags.AutoGenerated)){e.removeAt(t);t--}}var i=this._cv,o=i?i.items:null;o&&o.length&&this.autoGenerateColumns&&this._getColumnTypes(o).forEach((function(t){var i=new Column(t);i._setFlag(RowColFlags.AutoGenerated,!0);i.name=i.binding;i.header=toHeaderCase(i.binding);var o=FlexGrid._defTypeWidth[i.dataType];if(null!=o){if(isString(o)){var n=Math.round(parseFloat(o));o=o.indexOf("*")>-1?n*e.defaultSize:n}isNumber(o)&&o>0&&(i.width=o)}e.push(i)}));this._updateColumnTypes()};FlexGrid.prototype._getColumnTypes=function(e){return getTypes(e)};FlexGrid.prototype._updateColumnTypes=function(){var e=this._cv;if(hasItems(e)){var t=e.items[0];this.columns.forEach((function(e){null==e.dataType&&e._binding&&(e.dataType=getType(e._binding.getValue(t)))}))}};FlexGrid.prototype._getMapEditor=function(e,t){return t.editor?null!=t.editor.isDroppedDown?t.dataMapEditor:null:!e.dataMap||e instanceof GroupRow?t.dataMap?t.dataMapEditor:null:e.dataMapEditor};FlexGrid.prototype._getBindingColumn=function(e,t,i){return i};FlexGrid.prototype._getBindingColumns=function(){return this.columns};FlexGrid.prototype._getRowsPerItem=function(){return 1};FlexGrid.prototype._isTransposed=function(){return!1};FlexGrid.prototype._getRowHeaderPath=function(){return this._rowHdrPath};FlexGrid.prototype._bindRows=function(){this.rows.clear();var e=this._cv;if(e&&e.items){var t=e.items,i=e.groups;if(this.childItemsPath)for(var o=0;o<t.length;o++)this._addNode(t,o,0);else if(null!=i&&i.length>0&&this.showGroups)for(o=0;o<i.length;o++)this._addGroup(i[o]);else for(o=0;o<t.length;o++)this._addBoundRow(t,o)}};FlexGrid.prototype._addBoundRow=function(e,t){var i=new Row(e[t]),o=this.rows;i._list=o;o[o.length++]=i};FlexGrid.prototype._addGroupRow=function(e){this.rows.push(new GroupRow(e))};FlexGrid.prototype._addNode=function(e,t,i){var o=e[t],n=this.childItemsPath,r=o[isArray(n)?n[i]:n],l=new GroupRow(o);l.level=i;this.rows.push(l);if(isArray(r))for(var s=0;s<r.length;s++)this._addNode(r,s,i+1)};FlexGrid.prototype._addGroup=function(e){this._addGroupRow(e);if(e.isBottomLevel)for(var t=e.items,i=0;i<t.length;i++)this._addBoundRow(t,i);else for(i=0;i<e.groups.length;i++)this._addGroup(e.groups[i]);if(this.groupSummaryPosition!=GroupSummaryPosition.Top){var o=e._clone();this._addGroupSummaryRow(o)}};FlexGrid.prototype._addGroupSummaryRow=function(e){var t=new GroupRow(e);t.isSummary=!0;this.rows.push(t)};FlexGrid._getSerializableProperties=function(e){var t=[];for(e=e.prototype;e!=Object.prototype;e=Object.getPrototypeOf(e))for(var i=Object.getOwnPropertyNames(e),o=0;o<i.length;o++){var n=i[o],r=Object.getOwnPropertyDescriptor(e,n);r&&r.set&&r.get&&"_"!=n[0]&&!n.match(/^(disabled|required|showDropDown)$/)&&t.push(n)}return t};FlexGrid.prototype._hasColumnGroups=function(){return this._grpHdl.hasColumnGroups()};FlexGrid.prototype._getColumnGroup=function(e,t){return this._grpHdl.getColumnGroup(e,t)};FlexGrid.prototype._canMoveColumnGroup=function(e,t,i,o){return this._grpHdl.canMoveColumnGroup(e,t,i,o)};FlexGrid.prototype._moveColumnGroup=function(e,t,i,o,n){return this._grpHdl.moveColumnGroup(e,t,i,o,n)};FlexGrid.prototype._copy=function(e,t){var i=this;if("columns"==e){var o=asArray(t);if(o.some((function(e){return null!=e.columns})))this.columnGroups=o;else{this.columns.clear();o.forEach((function(e){var t=new Column(e);i.columns.push(t)}))}return!0}return!1};FlexGrid.prototype._isInputElement=function(e){return e instanceof HTMLElement&&!hasClass(e,"wj-btn-glyph")&&("true"==e.contentEditable||null!=e.tagName.match(/^(INPUT|TEXTAREA|BUTTON|A|SELECT|OPTION)$/i)||e instanceof HTMLSpanElement&&e.parentElement&&null!=e.parentElement.tagName.match(/^(INPUT|TEXTAREA|BUTTON|A|SELECT|OPTION)$/i)&&!hasClass(e.parentElement,"wj-btn-glyph"))};FlexGrid.prototype._isNativeCheckbox=function(e){return e instanceof HTMLInputElement&&"checkbox"==e.type&&!e.disabled&&!e.readOnly&&hasClass(e,CellFactory._WJC_CHECKBOX)&&closest(e,".wj-flexgrid")==this.hostElement};FlexGrid.prototype._wantsInput=function(e){return this._isInputElement(e)&&!this.activeEditor&&!this._isNativeCheckbox(e)&&!hasClass(e,"wj-grid-ime")&&contains(document.body,e)};FlexGrid._getMaxSupportedCssHeight=function(){if(!FlexGrid._maxCssHeight){var e=265e5;isIE()?e=15e5:isFirefox()&&(e=175e5);FlexGrid._maxCssHeight=e}return FlexGrid._maxCssHeight};FlexGrid._getRtlMode=function(){if(!FlexGrid._rtlMode){var e=createElement('<div dir="rtl"><div></div></div>');setCss(e,{visibility:"hidden",width:100,height:100,overflow:"auto"});setCss(e.firstChild,{width:2e3,height:2e3});document.body.appendChild(e);var t=e.scrollLeft;e.scrollLeft=-1e3;var i=e.scrollLeft;removeChild(e);FlexGrid._rtlMode=i<0?"neg":t>0?"rev":"std"}return FlexGrid._rtlMode};FlexGrid.prototype.getEmptyRequiredCell=function(e){return this._getEmptyRequiredCell(e)};FlexGrid.prototype._getEmptyRequiredCell=function(e){if(e>=0)for(var t=0;t<this.columns.length;t++){var i=this.getCellData(e,t,!1);if(this.columns[t].getIsRequired(this.rows[e])&&(""===i||null==i)){if(!this.columns[t].isReadOnly&&!this.rows[e].isReadOnly)return t;console.warn("Incorrect data. Cell ("+e+", "+t+") is  at the same time  required, empty and read-only")}}return null};FlexGrid.prototype.adjustFrozenRowColSize=function(e,t,i){var o=t===FrozenRowCol.Column,n=o?this.columns:this.rows,r=o?this.columns._frozenInternal:this.rows._frozenInternal,l=o?this._szClient.width:this._szClient.height;if(!(e<0||e>=n.length)&&n.isFrozen(e)){var s=l-(o?r>=0?this.columns.slice(0,this.columns._frozenInternal).reduce((function(e,t){return e+t.renderSize}),0):this.columns.slice(this.columns.length+this.columns._frozenInternal,this.columns.length).reduce((function(e,t){return e+t.renderSize}),0):r>=0?this.rows.slice(0,this.rows._frozenInternal).reduce((function(e,t){return e+t.renderSize}),0):this.rows.slice(this.rows.length+this.rows._frozenInternal,this.rows.length).reduce((function(e,t){return e+t.renderSize}),0))-5,a=n[e].size||n[e].renderSize,c=i>s?a+s:a+i;n[e].size=c}};FlexGrid.prototype._adjustMaxContentWidth=function(){if(0!==this.rows.length&&0!==this.columns.length&&this._maxContent){var e=document.createElement("div");e.style.visibility="hidden";this.hostElement.appendChild(e);for(var t=0,i=1/0,o=new Array(this.columns.length).fill(0),n=0;n<this.columns.length;n++){for(var r=0,l=1/0,s=Math.min(this._contentEstimationLimit,this.rows.length),a=0;a<s;a++){var c=Math.round(a*this.rows.length/s),u=this._getDesiredWidth(this.cells,c,n,e);r=Math.max(r,u);l=Math.min(l,u)}o[n]=r;t+=r;i=Math.min(i,l)}this.hostElement.removeChild(e);var h=window.innerWidth,d=this.hostElement.parentElement?this.hostElement.parentElement.offsetWidth:h,p=window.getComputedStyle(this.hostElement),f=this.hostElement.getBoundingClientRect();p.minWidth.includes("content")&&(this.hostElement.style.minWidth=Math.min.apply(Math,o)+"px");"min-content"===p.maxWidth?this.hostElement.style.maxWidth=i+"px":"fit-content"===p.maxWidth||"max-content"===p.maxWidth?this.hostElement.style.maxWidth=t>d?d+"px":t+"px":this.hostElement.style.width=t>f.width?"100%":"";this.hostElement.parentElement.style.overflowX=t>h||t>d?"auto":"hidden";var g=window.innerHeight-(f.top+window.pageYOffset)-50;this.hostElement.style.maxHeight=g+"px"}};FlexGrid.prototype._isAllCellsSelected=function(){var e=this.selection;return 1===this.selectedRanges.length&&this.columns.length===e.columnSpan&&this.rows.length===e.rowSpan};FlexGrid.prototype._canResizeAllCellsWithoutCtrl=function(){return this._canOverRuleCtrlPress&&this.selectionMode===SelectionMode.MultiRange};FlexGrid.prototype._handleScrollEnd=function(){var e=this;null!==this._scrollEndTimer&&clearTimeout(this._scrollEndTimer);this._scrollEndTimer=window.setTimeout((function(){e._updateStickyHeaders()}),75)};FlexGrid.prototype._updateLayoutOnPin=function(){var e=this._root,t=this._hdrVis&HeadersVisibility.Row?this._hdrCols.getTotalSize():0,i=this._hdrVis&HeadersVisibility.Column?this._hdrRows.getTotalSize():0,o=e.offsetWidth-e.clientWidth,n=e.offsetHeight-e.clientHeight,r=e.offsetWidth-t-o,l=e.offsetHeight-i-n,s=e.scrollTop,a=Math.abs(e.scrollLeft),c=this.cells.height-l,u=this.cells.width-r;s>c&&e.scrollTo({top:c,left:a});a>u&&e.scrollTo({top:s,left:this.rightToLeft?-u:u})};FlexGrid.prototype._hasScroll=function(e,t){void 0===t&&(t=0);if(e.length&&e._frozenInternal&&e._frozenInternal<0){if(e instanceof ColumnCollection)return e.lastFrozen.pos+t>this._szClient.width+e.lastFrozen._antipos;if(e instanceof RowCollection)return e.lastFrozen.pos+t>this._szClient.height+e.lastFrozen._antipos}return!1};FlexGrid.prototype._alignTheTail=function(e){if(e._frozenInternal&&e._frozenInternal<0&&e._lastFrozen>0){var t=e[e._lastFrozen-1],i=t.pos+t.renderSize,o=this.scrollPosition;if(e instanceof ColumnCollection){var n=this._szClient.width+e.lastFrozen._antipos;if(i+this._ptScrl.x<n){var r=n-i-this._ptScrl.x;o.x+=r;this.scrollPosition=o}}else if(e instanceof RowCollection){n=this._szClient.height+e.lastFrozen._antipos;if(i+this._ptScrl.y<n){r=n-i-this._ptScrl.y;o.y+=r;this.scrollPosition=o}}}};FlexGrid.prototype._getRangesToResize=function(e,t,i){var o,n,r=i,l=this._getResizingInfo(t,e),s=l.isRowResizing,a=l.isColResizing,c=l.rangeBeingResized;o=this.selection.containsColumn(c.col);n=this.selection.containsRow(c.row);(a&&!o||s&&!n)&&(r=[c]);return r};FlexGrid.prototype._getResizingInfo=function(e,t){var i=this._mouseHdl,o={isRowResizing:i._szRowCol instanceof Row,isColResizing:i._szRowCol instanceof Column,rangeBeingResized:null};if(e){var n=this.hitTest(t);o.isRowResizing=n.edgeBottom;o.isColResizing=n.edgeRight;o.rangeBeingResized=n.range}else i._szArgs&&(o.rangeBeingResized=i._szArgs.range);return o};FlexGrid.prototype._handleRowColResizing=function(e,t){if(-1==t.row){if(!e.columns.isFrozen(t.col)||!t.data||!t.data.isPrimaryDragged)return;var i=t.getColumn(),o=(l=e.columns.getFrozenSize())-i.renderWidth+t.data.newSize,n=t.data.newSize>i.renderWidth,r=e.clientSize.width;if(o+FlexGrid._MAX_FROZEN_GAP_LIMIT>r&&n){t.data.maxSize=r-l+i.renderWidth;t.data.internalCancel=!0}}else{if(!e.rows.isFrozen(t.row)||!t.data||!t.data.isPrimaryDragged)return;var l,s=t.getRow(),a=(o=(l=e.rows.getFrozenSize())-s.renderHeight+t.data.newSize,n=t.data.newSize>s.renderHeight,e.clientSize.height);if(o+FlexGrid._MAX_FROZEN_GAP_LIMIT>a&&n){t.data.maxSize=a-l+s.renderHeight;t.data.internalCancel=!0}}};FlexGrid.prototype._getRowColResizedHandler=function(e,t){var i=new Set;return t?function(t,o){if(o.data){if(o.data.isPrimaryDragged){i.clear();queueMicrotask((function(){var t=e.rows.getFrozenSize(),o=Array.from(i).filter((function(t){return e.rows.isFrozen(t)}));if(t+FlexGrid._MAX_FROZEN_GAP_LIMIT>e.clientSize.height&&o.length>0){var n=t-o.reduce((function(t,i){return t+e.rows[i].renderHeight}),0),r=e.clientSize.height-n-2,l=Math.floor(r/o.length);e.rows.deferUpdate((function(){o.forEach((function(t){return e.rows[t].height=l}))}))}}))}i.add(o.row)}}:function(t,o){if(o.data){if(o.data.isPrimaryDragged){i.clear();queueMicrotask((function(){var t=e.columns.getFrozenSize(),o=Array.from(i).filter((function(t){return e.columns.isFrozen(t)}));if(t+FlexGrid._MAX_FROZEN_GAP_LIMIT>e.clientSize.width&&o.length>0){var n=t-o.reduce((function(t,i){return t+e.columns[i].renderWidth}),0),r=e.clientSize.width-n-2,l=Math.floor(r/o.length);e.columns.deferUpdate((function(){o.forEach((function(t){return e.columns[t].width=l}))}))}0==e.columns.getTotalSize()&&setTimeout((function(){e.invalidate()}),Control._REFRESH_INTERVAL)}))}i.add(o.col)}}};FlexGrid.prototype._isFrozenObjectAllowed=function(){return new Set(["FlexGrid","WjFlexGrid"]).has(this.constructor.name)};FlexGrid.prototype._isFlexSheetInstance=function(){return"flexsheet,wjflexsheet".split(",").indexOf(this.constructor.name.toLowerCase())>-1};FlexGrid._WJS_STICKY="wj-state-sticky";FlexGrid._WJS_MEASURE="wj-state-measuring";FlexGrid._WJS_UPDATING="wj-state-updating";FlexGrid._WJS_WSPRE="wj-whitespace-pre";FlexGrid._MIN_VIRT_ROWS=200;FlexGrid._RESIZE_SCRL_GAP=5;FlexGrid._MAX_FROZEN_GAP_LIMIT=2;FlexGrid._defTypeWidth=((_a={})[DataType.Number]="0.714285714*",_a);FlexGrid.controlTemplate='<div>  <div wj-part="ch"><div wj-part="chcells" class="wj-colheaders"></div></div><div wj-part="root"><div wj-part="cells" class="wj-cells"></div><div wj-part="marquee" class="wj-marquee"><div></div></div></div><div wj-part="fcells" aria-hidden="true" class="wj-cells wj-frozen-clone"></div><div wj-part="rh"><div wj-part="rhcells" class="wj-rowheaders"></div></div><div wj-part="cf"><div wj-part="cfcells" class="wj-colfooters"></div></div><div wj-part="bl"><div wj-part="blcells" class="wj-bottomleft"></div></div><div wj-part="tl"><div wj-part="tlcells" class="wj-topleft"></div></div><div wj-part="focus" class="wj-cell">0</div><div wj-part="sz"></div></div>';return FlexGrid}(Control);export{FlexGrid};var _ImeHandler=function(){function _ImeHandler(e){var t=this;this._updateImeFocusAsyncBnd=this._updateImeFocusAsync.bind(this);this._cmpstartBnd=this._compositionstart.bind(this);this._keypressBnd=this._keypress.bind(this);this._suspended=!1;this._handlingCompositionStart=!1;this._g=e;var i=createElement('<textarea class="wj-grid-editor wj-form-control wj-grid-ime" aria-hidden="true"/>');setCss(i,_ImeHandler._cssHidden);disableAutoComplete(i);i.tabIndex=-1;this._tbx=i;this._suspended=!1;this._maskProvider=new _MaskProvider(i);e._root.appendChild(i);this._updateImeFocus();var o=e.hostElement,n=e.addEventListener.bind(e),r=this._updateImeFocusAsyncBnd;n(o,"blur",r,!0);n(o,"focus",r,!0);n(i,"compositionstart",this._cmpstartBnd);isiOS()&&n(o,"keypress",this._keypressBnd);e.selectionChanged.addHandler(r,this);e.cellEditEnded.addHandler(this._cellEditEnded,this);e.cellEditEnding.addHandler(this._cellEditEnding,this);n(o,"mousedown",(function(t){var i=closest(getActiveElement(),".wj-flexgrid")==e.hostElement,o=e.hitTest(t);i&&o.panel==e.cells&&hasClass(o.target,"wj-cell")&&(e.isReadOnly||t.preventDefault())}));e.gotFocus.addHandler((function(){return t._updateImeFocus()}))}_ImeHandler.prototype.dispose=function(){var e=this._g,t=e.hostElement,i=this._tbx,o=e.removeEventListener.bind(e),n=this._updateImeFocusAsyncBnd;o(t,"blur",n);o(t,"focus",n);o(t,"keypress",this._keypressBnd);o(i,"compositionstart",this._cmpstartBnd);e.selectionChanged.removeHandler(n);e.cellEditEnded.removeHandler(this._cellEditEnded);e.cellEditEnding.removeHandler(this._cellEditEnding);removeChild(i);this._suspended=!1};_ImeHandler.prototype._compositionstart=function(e){var t=this,i=this._g;if(!i.activeEditor){var o=i._selHdl.selection;this._handlingCompositionStart=!0;var n=i.startEditing(!1,o.row,o.col,!1,e);this._handlingCompositionStart=!1;if(n){if(i.activeEditor&&"checkbox"!=i.activeEditor.type){o=i.editRange;var r=i._getBindingColumn(i.cells,o.row,i.columns[o.col]),l=r&&r._edt,s=i.activeEditor,a=this._tbx,c=i.cells.hostElement,u=i.columns[o.col].pos+c.offsetLeft,h=i.rows[o.row].pos+c.offsetTop,d=i.getCellBoundingRect(o.row,o.col),p=i.cells.getCellElement(o.row,o.col);d.width=p.offsetWidth;d.height=p.offsetHeight;if(i.rows.isFrozen(o.row)){h+=i._root.scrollTop;i.rows._frozenInternal<0&&i._hasScroll(i.rows)&&(h=i._szClient.height+i.rows[o.row]._antipos+c.offsetTop+i._root.scrollTop)}if(i.columns.isFrozen(o.col)){u+=i._root.scrollLeft;i.columns._frozenInternal<0&&i._hasScroll(i.columns)&&(u=i._szClient.width+i.columns[o.col]._antipos+c.offsetLeft+i._root.scrollLeft)}var f=p.querySelector(".wj-btn.wj-right");f&&(d.width-=f.offsetWidth);"minLength,maxLength,pattern".split(",").forEach((function(e){setAttribute(a,e,s.getAttribute(e))}));var g=s instanceof HTMLTextAreaElement;setAttribute(a,"wrap",g?"soft":"off");var _=getComputedStyle(p),m=_.paddingTop;if(o.rowSpan>1&&!g){var w=parseFloat(_.lineHeight);isNaN(w)&&(w=1.2*parseFloat(_.fontSize));m=Math.max(0,(d.height-w)/2)+"px"}var C={position:"absolute",left:u,top:h,width:d.width-1,height:d.height-1,paddingTop:m,paddingLeft:_.paddingLeft,paddingRight:_.paddingRight,textAlign:_.textAlign,zIndex:p.style.zIndex};if(i.rightToLeft){C.right=parseInt(p.style.right)+parseInt(i.cells.hostElement.style.right);C.left=""}setCss(a,C);if(l){var v=l._tbx.getBoundingClientRect(),y=a.getBoundingClientRect(),b=window.getComputedStyle(a),R=parseFloat(b.left),E=parseFloat(b.right),S=parseFloat(b.top);i.rightToLeft?setCss(a,{right:E+y.right-v.right+"px",top:S+v.top-y.top+"px",width:v.width+"px",height:v.height+"px"}):setCss(a,{left:R+v.left-y.left+"px",top:S+v.top-y.top+"px",width:v.width+"px",height:v.height+"px"})}i._edtHdl._edt=a;a.select();var x=s.value;if(isSafari()){"　"!=a.value&&" "!=a.value||(a.value=x);setSelectionRange(a,a.value.length)}else setTimeout((function(){"　"!=a.value&&" "!=a.value||(a.value=x);setSelectionRange(a,a.value.length)}),20);Control.sharedState.InvalidScroll=isEdge();a.placeholder=s.placeholder;s.placeholder="";s.value=""}}else{this._tbx.blur();setTimeout((function(){t._tbx.focus();i._setFocusNoScroll(i.hostElement)}),20)}}};_ImeHandler.prototype._cellEditEnding=function(){var e=this._maskProvider;e&&e.mask&&e._valueChanged()};_ImeHandler.prototype._cellEditEnded=function(){var e=this._tbx,t=this._g;if(this._enableIme()){var i=getActiveElement();i.blur();if(t._isScrollingByWheel)setTimeout((function(){i.focus();t._setFocusNoScroll(t.hostElement);e.value="";i.focus()}),20);else{i.focus();t._setFocusNoScroll(t.hostElement);i.focus()}e.value="";setCss(e,_ImeHandler._cssHidden);this._updateImeFocus()}};_ImeHandler.prototype._keypress=function(e){if(!e.defaultPrevented&&e.target==this._tbx&&!(e.ctrlKey||e.altKey||e.metaKey||27==e.keyCode||this._g.activeEditor)){this._tbx.value="";this._compositionstart(e);e.stopPropagation()}};_ImeHandler.prototype._updateImeFocus=function(){var e=this._g,t=this._tbx,i=getActiveElement(),o=e._getTabIndex();if(e.activeEditor||closest(i,".wj-flexgrid")!=e.hostElement)(e.isDisabled||o<0)&&t.tabIndex>=0&&(t.tabIndex=-1);else if(this._enableIme()&&!e._wantsInput(i)){if(i!=t){e.activeCell&&(e.activeCell.tabIndex=-1);t.tabIndex=o;t.disabled=!1;t.value="";if(!e.isTouching)if(window&&window.top!=window.self){setSelectionRange(t,0,0,!1);e._setFocusNoScroll(t)}else{setSelectionRange(t,0);t.focus()}}var n=e._selHdl.selection,r=n.isValid?e._getBindingColumn(e.cells,n.row,e.columns[n.col]):null;this._maskProvider.mask=r?r.mask:null}else{t.tabIndex=-1;t.disabled=!0;t.value="";if(i==t){t.blur();var l=e.activeCell;if(l){l.tabIndex=o;l.focus()}else e.focus()}}};_ImeHandler.prototype._updateImeFocusAsync=function(){var e=this;this._toFocus&&clearTimeout(this._toFocus);this._toFocus=setTimeout((function(){e._toFocus=null;e._updateImeFocus()}),100)};_ImeHandler.prototype._resetTabIndex=function(){this._tbx.tabIndex=-1};_ImeHandler.prototype._suspendIME=function(){this._suspended=!0};_ImeHandler.prototype._resumeIME=function(){this._suspended=!1};_ImeHandler.prototype._enableIme=function(){var e=this._g,t=e._selHdl.selection;if(this._suspended)return!1;if(!e.canEditCell(t.row,t.col))return!1;var i=t.isValid?e._getBindingColumn(e.cells,t.row,e.columns[t.col]):null;return!(!i||i.dataType==DataType.Boolean)&&(!i||!i.dataMap||i.dataMapEditor!=DataMapEditor.RadioButtons)};_ImeHandler._cssHidden={position:"fixed",width:"1px",left:-32e3,top:-32e3,overflow:"hidden"};return _ImeHandler}();export{_ImeHandler};var _AddNewHandler=function(){function _AddNewHandler(e){this._nrt=new _NewRowTemplate;this._top=!1;this._keydownBnd=this._keydown.bind(this);this._committing=!1;this._pasting=!1;this._g=e;this._attach()}Object.defineProperty(_AddNewHandler.prototype,"newRowAtTop",{get:function(){return this._top},set:function(e){if(e!=this.newRowAtTop){this._top=asBoolean(e);this.updateNewRowTemplate();var t=this._g;if(this._top&&t.selectionMode==SelectionMode.ListBox){t.rows.forEach((function(e,t){e._setFlag(RowColFlags.Selected,0==t,!0)}));t.select(0,t.selection.col)}}},enumerable:!0,configurable:!0});_AddNewHandler.prototype.updateNewRowTemplate=function(){var e=this._g,t=e.editableCollectionView,i=e.rows,o=this._nrt,n=t&&t.canAddNew&&e.allowAddNew&&!e.isReadOnly,r=i.indexOf(o),l=this._top?0:i.length-1,s=!1;if(!n&&r>-1){var a=e.selection;a.row==r&&e.select(a.row-1,a.col);i.removeAt(r)}else if(n){if(r<0)s=!0;else if(r!=l){i.removeAt(r);s=!0}s&&(this._top?i.insert(0,o):i.push(o));if(o){o._ubv=null;o._setFlag(RowColFlags.ParentCollapsed,!1);this._top&&e.selectionMode==SelectionMode.ListBox||o._setFlag(RowColFlags.Selected,!1)}}};_AddNewHandler.prototype._attach=function(){var e=this._g;if(e){e.pasting.addHandler(this._pastingData,this);e.pasted.addHandler(this._pastedData,this);e.loadedRows.addHandler(this.updateNewRowTemplate,this);e.hostElement.addEventListener("keydown",this._keydownBnd,!0)}};_AddNewHandler.prototype._detach=function(){var e=this._g;if(e){e.pasting.removeHandler(this._pastingData,this);e.pasted.removeHandler(this._pastedData,this);e.loadedRows.removeHandler(this.updateNewRowTemplate);e.hostElement.removeEventListener("keydown",this._keydownBnd,!0)}};_AddNewHandler.prototype._keydown=function(e){if(!e.defaultPrevented&&e.keyCode==Key.Escape&&null==this._g.activeEditor&&this._top&&this._nrt.dataItem){this._nrt.dataItem=null;this._g.invalidate()}};_AddNewHandler.prototype._beginningEdit=function(e,t){if(!t.cancel){var i=e.rows[t.row];i instanceof _NewRowTemplate&&this._handleEditStarting(e,t,i)}};_AddNewHandler.prototype._pastingData=function(e,t){t.cancel||(this._pasting=!0)};_AddNewHandler.prototype._pastedData=function(e,t){this._pasting=!1};_AddNewHandler.prototype._rowEditStarting=function(e,t){if(this._pasting){var i=e.rows[t.row];i instanceof _NewRowTemplate&&this._handleEditStarting(e,t,i)}};_AddNewHandler.prototype._rowEditEnding=function(e,t){var i=e.editableCollectionView,o=this._nrt.dataItem;if(i&&this._top&&o&&!t.cancel){var n=i.currentAddItem;if(!(n&&n==o)){n=i.addNew();for(var r in o)n[r]=o[r]}}};_AddNewHandler.prototype._rowEditEnded=function(e,t){var i=this,o=e.editableCollectionView;if(o&&!this._committing)if(this._top){if(t.cancel)return;var n=this._nrt.dataItem;if(n){this._committing=!0;this._nrt.dataItem=null;var r=this._g.rows,l=o.items.indexOf(n)+1;l<r.length&&t._rng.setRange(l,-1);e.onRowAdded(t)?o.commitNew():o.cancelNew();this._committing=!1}var s=e.rows[t.row];setTimeout((function(){if(s instanceof _NewRowTemplate){e._selHdl.extendedSelection.clear();e.select(0,e.columns.firstVisibleIndex)}i.updateNewRowTemplate()}),20)}else o.isAddingNew&&o.commitNew()};_AddNewHandler.prototype._handleEditStarting=function(e,t,i){var o=e.editableCollectionView;if(o&&o.canAddNew)if(this._top)if(null==this._nrt.dataItem){var n=null,r=o.sourceCollection,l=o.newItemCreator;n=isFunction(l)?l():r&&r.length?new r[0].constructor:{};this._nrt.dataItem=n}else o.currentAddItem&&(e.onRowAdded(t)||o.cancelNew());else{n=o.currentAddItem&&o.currentAddItem==i.dataItem?o.currentAddItem:o.addNew();o.moveCurrentTo(n);var s=this._nrt.isSelected;this.updateNewRowTemplate();s&&t.row>-1&&(e.rows[t.row].isSelected=!0);e.isUpdating||e.refresh(!0);e.onRowAdded(t)||o.cancelNew()}};return _AddNewHandler}();export{_AddNewHandler};var _NewRowTemplate=function(e){__extends(_NewRowTemplate,e);function _NewRowTemplate(){return null!==e&&e.apply(this,arguments)||this}return _NewRowTemplate}(Row);export{_NewRowTemplate};export var AllowMerging;!function(e){e[e.None=0]="None";e[e.Cells=1]="Cells";e[e.ColumnHeaders=2]="ColumnHeaders";e[e.RowHeaders=4]="RowHeaders";e[e.AllHeaders=6]="AllHeaders";e[e.All=7]="All"}(AllowMerging||(AllowMerging={}));var MergeManager=function(){function MergeManager(e){null!=e&&console.error('** WARNING: the "grid" parameter has been deprecated. Please remove it.')}MergeManager.prototype.getMergedRange=function(e,t,i,o){void 0===o&&(o=!0);return this._getMergedRange(e,t,i,o)};MergeManager.prototype._getMergedRange=function(e,t,i,o,n){void 0===o&&(o=!0);void 0===n&&(n=!0);var r,l=e.grid,s=e.cellType,a=e.columns,c=e.rows,u=c[t],h=a[i];if(u instanceof _NewRowTemplate)return null;if(!(u instanceof Row&&h instanceof Column))return null;if(e==l.columnHeaders){var d=l._getColumnGroup(t,i);if(d){var p=d._rng,f=e.columns;if(f.isFrozen(p.col)!=f.isFrozen(p.col2)){p=p.clone();f.isFrozen(i)?f._frozenInternal>0?p.col2=f._frozenInternal-1:p.col=f.length+f._frozenInternal:f._frozenInternal>0?p.col=f._frozenInternal:p.col2=f.length+f._frozenInternal-1}return p}}if(l.showGroups&&!l.childItemsPath&&u instanceof GroupRow&&u.dataItem instanceof CollectionViewGroup&&s==CellType.Cell){p=new CellRange(t,i);if(h.aggregate==Aggregate.None){for(var g=a._frozenInternal>=0?a._frozenInternal:a.length+a._frozenInternal;p.col>0&&a[p.col-1].aggregate==Aggregate.None&&p.col!=g;)p.col--;for(;p.col2<a.length-1&&a[p.col2+1].aggregate==Aggregate.None&&p.col2+1!=g;)p.col2++}for(;p.col<i&&!a[p.col].visible;)p.col++;return p.isSingleCell?null:p}var _=!1,m=AllowMerging,w=CellType;switch(l.allowMerging){case m.None:_=!0;break;case m.Cells:_=s!=w.Cell;break;case m.ColumnHeaders:_=s!=w.ColumnHeader&&s!=w.TopLeft;break;case m.RowHeaders:_=s!=w.RowHeader&&s!=w.TopLeft;break;case m.AllHeaders:_=s==w.Cell}if(_)return null;if(s==w.Cell){var C=l.editableCollectionView,v=C?C.currentAddItem:null;if(v&&u.dataItem==v)return null}var y=e.grid.editableCollectionView;r=y?y.currentAddItem:null;if(a[i].allowMerging){p=new CellRange(t,i);var b=e._vrb,R=0,E=c.length-1;if(t>=c._frozenInternal){if(o&&(s==CellType.Cell||s==CellType.RowHeader)&&l._vtRows<c.length&&b){R=b.topRow;E=b.bottomRow}}else c.length>c._frozenInternal&&(E=c._frozenInternal-1);for(var S=e._getCellData(t,i,n),x=t-1;x>=R&&this._mergeCell(e,t,i,x,i,r,n,S);x--)p.row=x;for(var H=t+1;H<=E&&this._mergeCell(e,t,i,H,i,r,n,S);H++)p.row2=H;for(;p.row<t&&!c[p.row].visible;)p.row++;if(!p.isSingleCell)return p}if(c[t].allowMerging){p=new CellRange(t,i),b=e._vrb;var z=0,F=a.length-1;if(i>=a._frozenInternal){if(o&&(s==CellType.Cell||s==CellType.ColumnHeader)&&l._vtCols<a.length&&b){z=b.leftCol;F=b.rightCol}}else F=a._frozenInternal-1;S=e._getCellData(t,i,n);for(var M=i-1;M>=z&&this._mergeCell(e,t,i,t,M,r,n,S);M--)p.col=M;for(var I=i+1;I<=F&&this._mergeCell(e,t,i,t,I,r,n,S);I++)p.col2=I;for(;p.col<i&&!a[p.col].visible;)p.col++;if(!p.isSingleCell)return p}return null};MergeManager.prototype._mergeCell=function(e,t,i,o,n,r,l,s){void 0===l&&(l=!0);void 0===s&&(s=null);var a=e.rows[t],c=e.rows[o];if(!a||!c)return!1;if(a instanceof GroupRow||a instanceof _NewRowTemplate||c instanceof GroupRow||c instanceof _NewRowTemplate)return!1;if(r&&(a.dataItem==r||c.dataItem==r))return!1;if(t!=o&&e.rows.isFrozen(t)!=e.rows.isFrozen(o))return!1;if(i!=n&&e.columns.isFrozen(i)!=e.columns.isFrozen(n))return!1;if(t!=o){if(i>0&&(a.allowMerging&&this._mergeCell(e,t,i-1,t,i,r,l)||c.allowMerging&&this._mergeCell(e,o,i-1,o,i,r,l)))return!1;if(n<e.columns.length-1&&(a.allowMerging&&this._mergeCell(e,t,n,t,n+1,r,l)||c.allowMerging&&this._mergeCell(e,o,n,o,n+1,r,l)))return!1}var u=e._getCellData(o,n,l);null==s&&(s=e._getCellData(t,i,l));return!!(s==u||isDate(s)&&DateTime.equals(s,u))};return MergeManager}();export{MergeManager};var _MASK_PROVIDER="$WJ-MSKP",CellFactory=function(){function CellFactory(){}CellFactory.prototype.updateCell=function(e,t,i,o,n,r){var l=e.grid,s=l.rightToLeft,a=e.rows,c=e.columns,u=a[t],h=c[i],d=t,p=i,f=u instanceof GroupRow?u:null,g=!!f&&f.isSummary,_=f&&(l.groupSummaryPosition===GroupSummaryPosition.Bottom||l.groupSummaryPosition===GroupSummaryPosition.Auto&&!f.isCollapsed),m=u instanceof _NewRowTemplate?u:null,w=!!(softDetailRow()&&u instanceof softDetailRow().DetailRow),C=h.renderWidth,v=u.renderHeight,y=e.cellType,b="wj-cell",R="",E={display:""},S=CellType,x=0,H=0,z=!0;f&&i!=c.firstVisibleIndex?!g&&_&&(z=!1):g&&i==c.firstVisibleIndex&&(z=!1);0!=r&&o.firstElementChild&&(1==o.childNodes.length&&"checkbox"==o.firstElementChild.type||(o.textContent=""));if(l._useFrozenDiv()){o.getAttribute("left-for-clone")&&o.removeAttribute("left-for-clone");o.getAttribute("top-for-clone")&&o.removeAttribute("top-for-clone");if(c.isFrozen(i)&&c._frozenInternal<0){var F=l._szClient.width+h._antipos;(H=F<=h.pos?F:0)&&isChromiumBased()&&!isMobile()&&H--;H&&setAttribute(o,"left-for-clone",H)}if(a.isFrozen(t)&&a._frozenInternal<0){var M=l._szClient.height+u._antipos;(x=M<=u.pos?M:0)&&isChromiumBased()&&!isMobile()&&x--;x!=Math.floor(x)&&(x=Math.round(x));if(x){l.columnFooters.rows.length>0&&(x-=l.columnFooters.height);setAttribute(o,"top-for-clone",x)}}}if(n&&!n.isSingleCell){t=n.row;i=n.col;d=n.row2;p=n.col2;u=a[t];h=c[i];f=u instanceof GroupRow?u:null;v=(B=n.getRenderSize(e)).height;C=B.width}var I,T,G,P,A,D,L=l._getBindingColumn(e,t,h),O=L?L.dataType:u?u.dataType:void 0;G=y==S.RowHeader||y==S.Cell&&(!f||l.childItemsPath);D=L&&L.isContentHtml||u&&u.isContentHtml;T=y==S.Cell?l._getMapEditor(u,L):null;I=null;L&&(I=L.dataMap);null==I&&u&&(I=u.dataMap);P=G&&T==DataMapEditor.RadioButtons;A=O==DataType.Boolean&&!I;var V=G&&T==DataMapEditor.Menu,j=h.pos,N=u.pos,k=l._ptScrl;if(l._useFrozenDiv()&&y==S.Cell&&!l.editRange)c.isFrozen(i)&&!a.isFrozen(d)?N+=k.y:a.isFrozen(t)&&!c.isFrozen(p)&&(j+=k.x);else{var B=l._szClient;if(a.isFrozen(d))if(a._frozenInternal>=0){N=Math.min(N,B.height);v=Math.min(v,Math.max(0,B.height-N));N-=k.y}else{N=Math.min(u.pos,B.height+u._antipos);a.isFrozen(a._firstVisible)||(N-=k.y);isChromiumBased()&&!isMobile()&&(N-=1)}if(c.isFrozen(p)&&!w){var W=0!=B.width?B.width:l._preWidth();if(c._frozenInternal>=0){j=Math.min(j,W);j-=k.x}else{j=Math.min(h.pos,W+h._antipos);j-=k.x;isChromiumBased()&&!isMobile()&&(j-=1)}}}s?E.right=j+"px":E.left=j+"px";a.isFrozen(d)||(N-=e._getOffsetY());E.top=N+"px";E.width=C+"px";E.height=v+"px";var K=0;c.isFrozen(i)&&(K+=1);if(a.isFrozen(t)){a._frozenInternal<0&&l.columnFooters.rows.length>0&&(E.top=N-l.columnFooters.height+"px");K+=2;0===v&&(K=-1)}var q=!1,U=l.alternatingRowStep;if(U&&(!n||n.row==n.row2)){q=u.visibleIndex%(U+1)==0;1==U&&(q=!q)}if(y==S.Cell){f&&(b+=" wj-group");f&&g&&(b+=" wj-group-summary");q&&(b+=" wj-alt");(a.isFrozen(t)||c.isFrozen(i))&&(b+=" wj-frozen");m&&(b+=" wj-new");u&&u.cssClass&&(b+=" "+u.cssClass);L&&L.cssClass&&(b+=" "+L.cssClass)}else{b+=" wj-header";q&&(b+=" wj-header-alt");u&&u.cssClass&&y==S.ColumnHeader&&(b+=" "+u.cssClass);L&&L.cssClass&&y==S.RowHeader&&(b+=" "+L.cssClass);var J=!1;y!=S.ColumnHeader&&y!=S.TopLeft||l.allowResizing&AllowResizing.Columns&&(J=null!=l._mouseHdl._getResizeCol(e,p));J||y!=S.RowHeader||l.allowResizing&AllowResizing.Rows&&(J=null!=l._mouseHdl._getResizeRow(e,d));J&&(b+=" wj-big-header")}var Y=y==S.Cell&&i==c.firstVisibleIndex&&f&&f.hasChildren&&!_isEditingCell(l,t,i),X=y,$=l._isTransposed(),Z=(X==S.ColumnHeader&&!$||X==S.RowHeader&&$)&&l._hasColumnGroups()?l._getColumnGroup(t,i):null;u&&u.cssClassAll&&(b+=" "+u.cssClassAll);L&&L.cssClassAll&&(null==Z||0==Z.columns.length)&&(b+=" "+L.cssClassAll);Z&&Z.cssClassAll&&Z.columns.length>0&&(b+=" "+Z.cssClassAll);var Q=SelectedState,ee=e.getSelectedState(t,i,n);ee!=Q.None&&y==S.Cell&&!A&&l.editRange&&l.editRange.contains(t,i)&&(ee=Q.None);var te=!1;switch(y){case S.RowHeader:case S.ColumnHeader:case S.TopLeft:te=!0}switch(ee){case Q.Active:b+=" wj-state-active";break;case Q.Cursor:b+=te?" wj-focus-header-cell wj-state-active":" wj-state-selected wj-state-active";break;case Q.Selected:b+=" wj-state-multi-selected"}if(a.isFrozen(d))if(a._frozenInternal>0){b+=" wj-frozen-row";d===a._lastFrozen&&(b+=" wj-last-frozen-row")}else{b+=" wj-frozen-row-bottom";if(t===a._lastFrozenVisible)b+=" wj-last-frozen-row-bottom";else if(f&&a.length-t<Math.abs(a._frozenInternal)){for(var ie=t-1,oe=!1;ie>=a.length+a._frozenInternal;){if(a[ie].isVisible){oe=!0;break}ie--}oe||(b+=" wj-last-frozen-row-bottom")}}if(c._frozenInternal>0){if(p<=c._lastFrozen){b+=" wj-frozen-col-left";p===c._lastFrozen&&(b+=" wj-frozen-col")}}else if(c._frozenInternal<0&&p>=c._lastFrozen){b+=" wj-frozen-col-right";if(i===c._lastFrozenVisible)b+=" wj-frozen-col-right-edge";else if(c.length-i<Math.abs(c._frozenInternal)){for(var ne=i-1,re=!1;ne>=c.length+c._frozenInternal;){if(c[ne].isVisible){re=!0;break}ne--}re||(b+=" wj-frozen-col-right-edge")}}a._frozenInternal<0&&d==a._lastUnfrozenVisible&&(b+=" wj-last-visible-row");c._frozenInternal<0&&p==c._lastUnfrozenVisible&&(b+=" wj-last-visible-col");(L&&L.wordWrap||u&&u.wordWrap)&&(b+=" wj-wrap");(L&&L.multiLine||u&&u.multiLine)&&(b+=" wj-multiline");var le=L?L.getAlignment(u):void 0;le&&(R=" wj-align-"+le);Z&&Z.align&&(R=" wj-align-"+Z.align);E.paddingLeft=E.paddingRight=E.paddingTop=E.paddingBottom="";if(y==S.Cell&&l.rows.maxGroupLevel>-1&&i==c.firstVisibleIndex&&l.treeIndent){var se=f?Math.max(0,f.level):a.maxGroupLevel+1,ae=Math.min(l.treeIndent*se+l._cellPadLeft,C-l._cellPadHorz)+"px";s?E.paddingRight=ae:E.paddingLeft=ae}C<=l._cellPadHorz&&null==o.getAttribute(FlexGrid._WJS_MEASURE)&&(E.paddingLeft=E.paddingRight=0);Y&&(R="");Y&&setAttribute(o,"aria-expanded",!f.isCollapsed);var ce=null,ue=null;if(0!=r&&L){ce=e.getCellData(t,i,!1),ue=e.getCellData(t,i,!0);f&&_&&!f.isSummary&&X==S.Cell&&(ue="");if(Y&&!f.isSummary){var he=_getTreeBtn(f,o);ue=f.getGroupHeader()||escapeHtml(ue);o.innerHTML=he.outerHTML+" "+ue}else if(y!=S.ColumnHeader||d!=l._getSortRowIndex()&&L==h)if(y==S.RowHeader&&!ue&&function(){var e=!1;if(i==l._getEditColumnIndex()){var t=l.editableCollectionView,n=t?t.currentEditItem:null;ue=o.innerHTML=n&&u.dataItem==n?_getGlyph("pencil"):u instanceof _NewRowTemplate?_getGlyph("asterisk"):"";e=!0}var r=L._tpl;if(r){_renderTemplate(r,o,ce,ue,u,L);e=!0}return e}());else if(y!=S.Cell||O!=DataType.Boolean||I||f&&!isBoolean(ce))if(y==S.Cell&&V&&_isEditingCell(l,t,i)){D&&I&&!I.isEditable&&(ue=toPlainText(ue));o.innerHTML="<span style='flex-grow:1'></span>";o.children[0].textContent=ue;(fe=document.createElement("input")).type="menu";fe.value=ue;l._edtHdl._edt=fe}else if(y==S.Cell&&!P&&_isEditingCell(l,t,i)){var de=L.inputType||u.inputType;de||(de=O!=DataType.Number||I?"text":"tel");if(!I&&!L.mask&&!u.mask){var pe=e.getCellData(t,i,!1);isNumber(pe)&&(ue=_getEditString(pe,L.format||u.format))}o.innerHTML=(L.multiLine||u.multiLine)&&"checkbox"!=de?'<textarea wrap="soft"></textarea>':'<input type="'+de+'"/>';var fe=o.children[0];addClass(fe,"wj-grid-editor wj-form-control");disableAutoComplete(fe);D&&I&&!I.isEditable&&(ue=toPlainText(ue));fe.value=ue;fe.tabIndex=-1;fe.required=L.getIsRequired(u);setAttribute(fe,"aria-required",fe.required);var ge=L.maxLength||u.maxLength;ge&&(fe.maxLength=ge);fe.style.textAlign=L.getAlignment(u);var _e=L.mask||u.mask;_e&&(fe[_MASK_PROVIDER]=new _MaskProvider(fe,_e));l.showPlaceholders&&(fe.placeholder=L.header);(isSafari()||Control.sharedState.InvalidScroll)&&l._edtHdl&&l._edtHdl._edt&&(fe.value=l._edtHdl._edt.value);l._edtHdl._edt=fe}else{if(P){var me=[],we=e.getCellData(t,i,!1);I._cv.items.forEach((function(e,t){var i=e[I.selectedValuePath],o=i===we?" checked":"",n=l.isReadOnly||u.isReadOnly||h.isReadOnly?" disabled":"",r=escapeHtml(I.getDisplayValue(i));me.push('<label><input type="radio" tabindex="-1"'+o+n+' data-idx="'+t+'" value="'+r+'"><span>'+r+"</span></label>")}));o.innerHTML=me.join(" ");b+=" "+CellFactory._WJC_RADIOMAP}var Ce=G?L._tpl:null;Ce&&z?_renderTemplate(Ce,o,ce,ue,u,L):P||(y==S.Cell&&D?o.innerHTML=ue:o.textContent=ue||"");if(Z&&Z.collapseTo){var ve=Z._rng;if(ve&&(y==S.ColumnHeader&&ve.columnSpan>1||y==S.RowHeader&&ve.rowSpan>1)){var ye=Z.isCollapsed;o.innerHTML='<div role="button" class="'+CellFactory._WJC_COLLAPSE+'">'+_getGlyph(ye?"plus":"minus")+"</div>&nbsp;"+o.innerHTML;ye&&addClass(o,"wj-state-collapsed")}}}else{var be=o.firstChild;if(!f||z){if(!l._isNativeCheckbox(be)){o.innerHTML='<label><input type="checkbox" class="'+CellFactory._WJC_CHECKBOX+'" tabindex="-1"/><span></span></label>';be=o.querySelector("input")}setChecked(be,ce);be.disabled=!l.canEditCell(t,i);be.disabled&&(be.style.cursor="default")}else f&&(o.innerHTML="");l.editRange&&l.editRange.contains(t,i)&&(l._edtHdl._edt=be)}else{o.innerHTML=escapeHtml(ue);var Re=L.currentSort;if(Re&&l.showSort){b+=" wj-sort-"+("+"==Re?"asc":"desc");o.innerHTML+="&nbsp;"+_getSortGlyph(L)}l.allowPinning&&contains(l.hostElement,o)&&_addPinButton(o,l.columns.isFrozen(i))}if((T==DataMapEditor.DropDownList||T==DataMapEditor.Menu)&&l.showDropDown&&l.canEditCell(t,i)&&softInput()){var Ee=_getDropDownBtn();o.insertBefore(Ee,o.firstChild);_isEditingCell(l,t,i)&&(b+=" wj-hasdropdown")}}if(y==S.RowHeader||y==S.ColumnHeader){var Se=y==S.RowHeader?!f&&!m&&u.allowDragging&&0!=(l.allowDragging&AllowDragging.Rows):(Z||h).allowDragging&&0!=(l.allowDragging&AllowDragging.Columns);setAttribute(o,"draggable",Se?"true":null)}(l.headersFocusability&HeadersFocusability.Column&&S.ColumnHeader===y||l.headersFocusability&HeadersFocusability.Row&&S.RowHeader===y)&&colHdrAriaAttributes(o,h,e,l,S.RowHeader===y);l.headersFocusability&HeadersFocusability.All&&S.TopLeft===y&&setAttribute(o,"role","rowheader");b+=R;o.className!=b&&(o.className=b);E.zIndex=0===K?"":K;var xe=o.style;for(var He in E)xe[He]!==E[He]&&(xe[He]=E[He]);if(l._edtHdl._edt&&l._edtHdl._edt.parentElement==o){var ze=l._root,Fe=ze.getBoundingClientRect(),Me=o.getBoundingClientRect(),Ie=Fe.top+ze.clientHeight-Me.top,Te=Fe.left+ze.clientWidth-Me.left;if(c._frozenInternal<0){var Ge=document.querySelector('[wj-part="rh"]').getBoundingClientRect(),Pe=e._getFrozenPos();if(Ge.left+Ge.width>Me.left&&Me.width>Pe.x){Te=Pe.x;o.style.left=o.offsetLeft+Te-Pe.x+"px"}}if(a._frozenInternal<0){var Ae=document.querySelector('[wj-part="ch"]').getBoundingClientRect();Pe=e._getFrozenPos();if(Ae.top+Ae.height>Me.top&&Me.height>Pe.y){Ie=Pe.y;o.style.top=o.offsetTop+Ie-Pe.y+"px"}}Me.height>Ie&&(o.style.height=Ie+"px");Me.width>Te&&(o.style.width=Te+"px")}if((y==S.Cell||y==S.RowHeader)&&l._getShowErrors()){var De="";!1===r&&L&&(ce=e.getCellData(t,i,!1));var Le=a[t].dataItem;De=L.binding&&Le&&L.getIsRequired(u)&&(null==ce||""===ce)?l._edtHdl._getRequiredMsg():l._getError(e,t,i,!1);l._edtHdl._setCellError(o,De)}l.itemFormatter&&l.itemFormatter(e,t,i,o);if(l.formatItem.hasHandlers){var Oe=CellFactory._fmtItemArgs;if(Oe){Oe._p=e;Oe._rng.setRange(t,i,d,p);Oe._cell=o}else Oe=CellFactory._fmtItemArgs=new FormatItemEventArgs(e,new CellRange(t,i,d,p),o);Oe._updateContent=!1!==r;l.onFormatItem(Oe)}};CellFactory.prototype.disposeCell=function(e){};CellFactory.prototype.getEditorValue=function(e){var t=e._edtHdl._edt;if(t instanceof HTMLInputElement)switch(t.type){case"checkbox":return t.checked;case"radio":return t.value}if(t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement){var i=t[_MASK_PROVIDER],o=i?i._applyMask():t.value,n=t.maxLength;if(isNumber(n)&&n>-1&&o.length>n){var r=culture.Globalize.numberFormat["%"]||"%",l=o.length&&o[o.length-1]==r;o=o.substr(0,n);l&&o.indexOf(r)<0&&(o+=r)}return o}return null};CellFactory._WJC_RADIOMAP="wj-radio-map";CellFactory._WJC_CHECKBOX="wj-cell-check";CellFactory._WJC_COLLAPSE="wj-elem-collapse";CellFactory._WJC_DROPDOWN="wj-elem-dropdown";CellFactory._WJC_PIN="wj-elem-pin";CellFactory._tplDdBtn=_getButton(CellFactory._WJC_DROPDOWN,"down");CellFactory._tplCtx={row:null,col:null,value:null,text:null,item:null};return CellFactory}();export{CellFactory};function _renderTemplate(e,t,i,o,n,r){var l=CellFactory._tplCtx;l.value=i;l.text=o;l.item=n.dataItem;l.row=n;l.col=r;var s=isString(e)?evalTemplate(e,l):e(l,t);null!=s&&(t.innerHTML=s)}function _getEditString(e,t){t=t||"n";var i=Globalize._parseNumericFormat(t);switch(i.spec){case"d":case"x":break;case"e":t=t.replace(/[0-9]/g,"");break;default:t="p"==i.spec?"P15":"r";i.scale&&(t+=Array(i.scale/3+1).join(","))}return Globalize.formatNumber(e,t,!0)}function _isEditingCell(e,t,i){return e.editRange&&e.editRange.contains(t,i)}function _getDropDownBtn(){var e=CellFactory._ddBtn;if(!e){e=CellFactory._ddBtn=createElement(CellFactory._tplDdBtn);setAriaLabel(e,culture.FlexGrid.ariaLabels.toggleDropDown);setAttribute(e,"aria-expanded",!1)}return e.cloneNode(!0)}function _addPinButton(e,t){var i=_getButton(CellFactory._WJC_PIN,"pin"),o=createElement(i);toggleClass(o,"wj-state-pinned",t);setAttribute(o,"aria-pressed",t);e.insertBefore(o,e.firstChild)}function _getSortGlyph(e){var t=_getGlyph("+"==e.currentSort?"up":"down"),i=e.grid.collectionView;if(i&&i.sortDescriptions.length>1){var o=e.currentSortIndex;o>-1&&(t+='<span class="wj-sort-index">'+(o+1)+"</span>")}return t}function _getTreeBtn(e,t){var i=CellFactory._WJC_COLLAPSE,o=(e.isCollapsed?"":"down-")+(e.grid.rightToLeft?"left":"right"),n=createElement('<button class="wj-btn wj-btn-glyph '+i+'" type="button" tabindex="-1">'+_getGlyph(o)+"</button>");setAriaLabel(n,culture.FlexGrid.ariaLabels.toggleGroup);setAttribute(n,"aria-expanded",!e.isCollapsed);setAttribute(t,"aria-expanded",!e.isCollapsed);return n}function _getGlyph(e){return'<span class="wj-glyph-'+e+'"></span>'}function _getButton(e,t){return'<button class="wj-btn wj-btn-glyph wj-right {cls}" type="button" tabindex="-1">{glyph}</button>'.replace("{cls}",e).replace("{glyph}",_getGlyph(t))}var _CustomEditor=function(){function _CustomEditor(e,t){this._col=asType(e,Column);this._ctl=t;this._tbx=t.hostElement.querySelector("input");assert(this._col instanceof Column,"Invalid Column");assert(this._ctl instanceof Control,"Invalid edit control");assert(this._tbx instanceof HTMLInputElement,"Input element not found in editor");var i=this._ctl;this._prop=isUndefined(i.value)?isUndefined(i.checkedItems)?isUndefined(i.text)?null:"text":"checkedItems":"value";assert(null!=this._prop,"value, text properties not found in editor");var o=softInput();if(o){this._isDropDown=i instanceof o.DropDown;this._isComboBox=i instanceof o.ComboBox;this._isAutoComplete=i instanceof o.AutoComplete;this._isInputDateTime=i instanceof o.InputDateTime;this._isInputNumber=i instanceof o.InputNumber;this._isInputMask=i instanceof o.InputMask}this._updateFocusBnd=this._updateFocus.bind(this);this._keydownBnd=this._keydown.bind(this);this._cmpstartBnd=this._cmpstart.bind(this);this._mousedownBnd=this._mousedown.bind(this);this._connect();this._col.gridChanged.addHandler(this._connect,this);this._hideEditor();this._updateFocus()}Object.defineProperty(_CustomEditor.prototype,"grid",{get:function(){return this._g},enumerable:!0,configurable:!0});Object.defineProperty(_CustomEditor.prototype,"column",{get:function(){return this._col},enumerable:!0,configurable:!0});Object.defineProperty(_CustomEditor.prototype,"control",{get:function(){return this._ctl},enumerable:!0,configurable:!0});_CustomEditor.prototype.dispose=function(){this._disconnect();this._isDropDown&&(this._isDropDown=!1);this._g=this._col=this._ctl=this._tbx=null};_CustomEditor.prototype._connect=function(){var e=this._col?this._col.grid:null;if(e!=this._g){this._disconnect();if(e){var t=e.hostElement,i=e.addEventListener.bind(e),o=this._updateFocusBnd;this._g=e;this._hideEditor();this._updateFocus();i(t,"keydown",this._keydownBnd,!0);i(t,"mousedown",this._mousedownBnd,!0);i(t,"mouseup",o,!0);i(t,"blur",o,!0);i(t,"focus",o);i(this._tbx,"compositionstart",this._cmpstartBnd);e.gotFocus.addHandler(o,this);e.selectionChanged.addHandler(o,this);e.prepareCellForEdit.addHandler(this._prepareCellForEdit,this);e.cellEditEnding.addHandler(this._cellEditEnding,this);e.cellEditEnded.addHandler(this._cellEditEnded,this)}}};_CustomEditor.prototype._disconnect=function(){var e=this._g;if(e){var t=e.hostElement,i=e.removeEventListener.bind(e),o=this._updateFocusBnd;i(t,"keydown",this._keydownBnd);i(t,"mousedown",this._mousedownBnd);i(t,"mouseup",o);i(t,"blur",o);i(t,"focus",o);i(this._tbx,"compositionstart",this._cmpstartBnd);e.gotFocus.removeHandler(o,this);e.selectionChanged.removeHandler(o,this);e.prepareCellForEdit.removeHandler(this._prepareCellForEdit,this);e.cellEditEnding.removeHandler(this._cellEditEnding,this);e.cellEditEnded.removeHandler(this._cellEditEnded,this);this._g=null}};_CustomEditor.prototype._prepareCellForEdit=function(e,t){if(!t.cancel&&t.getColumn(!0)==this._col){var i=this.grid,o=i.rightToLeft,n=this._ctl,r=this._tbx,l=this._prop,s=t.range,a=t.data,c=a&&void 0!==a.type?a.type:"",u=i.getCellData(s.row,s.col,"text"==l||this._isInputMask),h=!1;n._rtlDir=o;toggleClass(n.hostElement,"wj-rtl",o);setAttribute(n.hostElement,"dir",o?"rtl":null);if(this._isComboBox){""!=u&&(n._emptyValueAction=!1);this._isInputDateTime&&n._setDropdown(n._ddDate)}this._isAutoComplete&&n.reset();this._isInputMask&&(n._fullEdit=!0);if("checkedItems"==l){if(n.showFilterInput){n.showFilterInput=!1;n.showFilterInput=!0}if(null==u||0==u.length){n[l]=[];n.selectedIndex=0}}if(null!=u||!n.isRequired){if("checkedItems"==l){var d=[];if(n.selectedValuePath)for(var _loop_1=function(e){var t=n.collectionView.items.findIndex((function(t){return null!=u[e][n.selectedValuePath]&&t[n.selectedValuePath]===u[e][n.selectedValuePath]}));if(t>=0){n._lbx.toggleItemChecked(t);d.push(n.collectionView.items[t])}},p=0;p<u.length;p++)_loop_1(p);else isArray(u)?d=u:u.length>0&&u.split(",").forEach((function(e){return d.push(e.trim())}));n[l]=d}else n[l]=u;if(this._isAutoComplete){clearTimeout(n._toSearch);if((g=n.collectionView)&&(g.filter||n._rxHighlight)){n._rxHighlight=null;g.filter=null}if(u){var f=n._findNext(u,1,-1);n.selectedIndex!=f&&(n.selectedIndex=f);!n.containsFocus()&&n._focus&&n.onGotFocus()}}}switch(c){case"keydown":case"mousedown":if(isUndefined(a.keyCode)||a.keyCode==Key.F4||a.altKey){h=this._isDropDown;if(this._isAutoComplete&&(null==u||isString(u))){var g;if(g=n.collectionView){if(g.filter||n._rxHighlight){n._rxHighlight=null;g.filter=null}f=u?n._findNext(u,1,-1):-1;n.selectedIndex!=f&&(n.selectedIndex=f)}}}}i.showPlaceholders&&!n.placeholder&&(r.placeholder=this._col.header);this.showEditor();i._edtHdl._fullEdit=!0;if(0==c.indexOf("key")&&32==a.keyCode){setSelectionRange(r,r.value.length);a.preventDefault()}if(isIE()&&!i.imeEnabled)if("keypress"==c&&a.key){setTimeout((function(){r.value=a.key;setSelectionRange(r,1);var e=document.createEvent("HTMLEvents");e.initEvent("input",!0,!1);r.dispatchEvent(e)}));a.preventDefault()}else if("compositionstart"==c){var _=r.value.length;setSelectionRange(r,_)}this._isDropDown&&(n.isDroppedDown=h)}};_CustomEditor.prototype._cellEditEnding=function(e,t){if(!t.cancel&&t.getColumn(!0)==this._col){var i=this.grid,o=this._ctl,n=this._prop;if(this._isAutoComplete){var r=o.selectedIndex;if(isNumber(r)&&r<0){var l=o.collectionView;l&&1==l.items.length?o.selectedIndex=0:this._col.isRequired&&(t.cancel=!0)}}if(!t.cancel&&n){var s=!1;if(this._isInputMask){var a=o;if(null!=a){i._edtHdl._setCustomEditorValue(a._msk._applyMask());s=!0}}s||i._edtHdl._setCustomEditorValue(o[n])}}};_CustomEditor.prototype._cellEditEnded=function(e,t){this._hideEditor();this._updateFocus()};_CustomEditor.prototype._cmpstart=function(e){var t=this;this.grid.imeEnabled&&(isIE()?setTimeout((function(){t._activateEditor(e)})):this._activateEditor(e))};_CustomEditor.prototype._keydown=function(e){if(!e.defaultPrevented&&this._checkColumn(e.target))if(this.grid.activeEditor){if(e.keyCode==Key.Enter&&this._isDropDown){var t=this._ctl;if(t.isDroppedDown){t.isDroppedDown=!1;e.preventDefault();e.stopImmediatePropagation()}}}else if(this._isDropDown){var i=e.keyCode;switch(i){case Key.F4:case Key.Up:case Key.Down:if(i==Key.F4||e.altKey){this._activateEditor(e);e.preventDefault()}}}};_CustomEditor.prototype._checkColumn=function(e){var t=this._g;if(contains(e,this._tbx)||null!=e&&this._imeEditor()===e){var i=t._selHdl.selection;return t._getBindingColumn(t.cells,i.row,t.columns[i.col])==this._col}return!1};_CustomEditor.prototype._mousedown=function(e){if(!e.defaultPrevented&&0==e.button&&!e.shiftKey&&!e.ctrlKey&&!e.metaKey&&this._isDropDown&&closestClass(e.target,CellFactory._WJC_DROPDOWN)){var t=this.grid,i=t.hitTest(e);if(i.getColumn(!0)==this._col){t.select(i.range);t.refresh();this._activateEditor(e);i._clickChildGrid||e.preventDefault()}}};_CustomEditor.prototype._activateEditor=function(e){var t=this.grid;if(!t.activeEditor){var i=t._selHdl.selection;if(i.isValid)return t.startEditing(!0,i.row,i.col,!0,e)}return!1};_CustomEditor.prototype.showEditor=function(){this.isOpen=!0;var e=this.grid,t=e.activeEditor,i=closest(t,".wj-cell");if(i){var o=this._tbx,n=this._ctl.hostElement;setCss(n,_CustomEditor._cssVisible);toggleClass(o,"wj-grid-ime",!1);i.innerHTML="";i.appendChild(n);e._edtHdl._edt=o;if(this._imeEditor())this._initImeEditInput();else{o.select();o.focus();t.value=""}}};_CustomEditor.prototype._hideEditor=function(){this.isOpen=!1;var e=this.grid,t=this._ctl.hostElement,i=this._tbx;this._isDropDown&&(this._ctl.isDroppedDown=!1);i.setCustomValidity("");var o=i.value;i.value=o+" ";i.value=o;setCss(t,_CustomEditor._cssHidden);toggleClass(i,"wj-grid-ime",!0);e&&t.parentElement!=e._root&&e._root.appendChild(t)};_CustomEditor.prototype._resetTabIndex=function(){this._tbx.tabIndex=-1};_CustomEditor.prototype._updateFocus=function(){var e=this.grid;if(e&&!e.activeEditor){var t=e.hostElement,i=".wj-flexgrid",o=this._tbx,n=getActiveElement(),r=e._getTabIndex();if(closest(n,i)==t)if(closest(o,i)!=t)this._hideEditor();else if(e.imeEnabled)o.tabIndex>-1&&(o.tabIndex=-1);else{var l=e._selHdl.selection,s=e._getBindingColumn(e.cells,l.row,e.columns[l.col]);if(s&&s==this._col&&e.canEditCell(l.row,l.col)){if(n!==o){e.activeCell&&(e.activeCell.tabIndex=-1);o.tabIndex=r;if(!e.isTouching){o.select();o.focus()}}}else if(o.tabIndex>-1){o.tabIndex=-1;n==o&&e.focus(!0)}}}};_CustomEditor.prototype._initImeEditInput=function(){var e=this,t=this._imeEditor();if(t){var i=this._tbx,o=i&&i.style.color,n=this._ctl,compEndEh_1=function(){t.removeEventListener("compositionend",compEndEh_1);setCss(t,_ImeHandler._cssHidden);if(i){i.style.color=o;var gotF=function(){n.gotFocus.removeHandler(gotF);e._g._edtHdl._edt=i;var o=t.value;if(o){i.value=o;e._isInputMask?setTimeout((function(){_CustomEditor._setSelectionRange(i,o.length,o.length)}),0):_CustomEditor._setSelectionRange(i,o.length,o.length);var r=document.createEvent("HTMLEvents");r.initEvent("input",!0,!1);i.dispatchEvent(r)}};n.gotFocus.addHandler(gotF);i.focus()}};t.addEventListener("compositionend",compEndEh_1);i&&(i.style.color="transparent")}};_CustomEditor._setSelectionRange=function(e,t,i){void 0===i&&(i=t);if(contains(document.body,e)&&!e.disabled&&"none"!=e.style.display)try{e.setSelectionRange(asNumber(t),asNumber(i),isIE()?null:"backward");e.focus()}catch(e){}};_CustomEditor.prototype._imeEditor=function(){var e=this.grid;if(e&&e.imeEnabled){var t=getActiveElement();if(t&&(t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement)&&hasClass(t,"wj-grid-ime"))return t}return null};_CustomEditor._cssHidden={position:"fixed",left:-32e3,top:-32e3,width:"1px",height:"1px",overflow:"hidden",border:"none"};_CustomEditor._cssVisible={position:"absolute",left:0,top:0,width:"100%",height:"100%"};return _CustomEditor}();export{_CustomEditor};export var KeyAction;!function(e){e[e.None=0]="None";e[e.MoveDown=1]="MoveDown";e[e.MoveAcross=2]="MoveAcross";e[e.Cycle=3]="Cycle";e[e.CycleOut=4]="CycleOut";e[e.CycleEditable=5]="CycleEditable"}(KeyAction||(KeyAction={}));var _KeyboardHandler=function(){function _KeyboardHandler(e){this._kaTab=KeyAction.None;this._kaEnter=KeyAction.MoveDown;this._isHeadersHandled=!1;this._g=e;var t=e.hostElement;e.addEventListener(t,"keypress",this._keypress.bind(this));e.addEventListener(t,"keydown",this._keydownHeaders.bind(this));e.addEventListener(t,"keydown",this._keydown.bind(this))}_KeyboardHandler.prototype._keydownMetaHeaders=function(e){if(!e.defaultPrevented){var t=this._g,i=t._getKeyCode(e),o=e.ctrlKey||e.metaKey,n=(e.altKey,e.shiftKey),r=!1;switch(i){case Key.Left:case Key.Right:case Key.Up:case Key.Down:case Key.Enter:case Key.Delete:case Key.Back:case Key.F2:case Key.Home:case Key.End:r=!0;break;case Key.Space:(t.activePanelType!==CellType.ColumnHeader||o)&&(t.activePanelType!==CellType.RowHeader||n)?t.activePanelType===CellType.TopLeft&&(r=!0):r=!0}if(r){e.preventDefault();this._isHeadersHandled=!0}}};_KeyboardHandler.prototype._keydownHeaders=function(e){if(!e.defaultPrevented&&this._g.activePanelType!=CellType.Cell){var t=this._g,i=t.selection,o=e.ctrlKey||e.metaKey,n=e.shiftKey,r=e.altKey,l=e.target,s=(e.char||e.key,!1),a=t.activePanel,c=t.activePanelType,u=t._getKeyCode(e);if("INPUT"===l.tagName){var h=l.type;if("radio"!==h&&"checkbox"!==h)return}if(o||r||n)return this._keydownMetaHeaders(e);if(!s)switch(u){case Key.Left:if(c===CellType.ColumnHeader&&t.headersFocusability===HeadersFocusability.All&&t.headersVisibility===HeadersVisibility.All){var d=a.getNextVisibleColumn();if((t.getMergedRange(a,i.row,i.col)||new CellRange(i.row,i.col)).leftCol<=d){if((f=t._gpTL.getLastVisibleColumn())>=0){t.select(new CellRange(i.row,f),!0,t._gpTL);s=!0}}}if(!s){t._selHdl.moveSelectionWithinSelectedPanel(0,-1);s=!0}break;case Key.Right:if(c===CellType.RowHeader){var p=a.getLastVisibleColumn();if((t.getMergedRange(a,i.row,i.col)||new CellRange(i.row,i.col)).rightCol>=p){if((f=t._gpCells.getNextVisibleColumn())>=0){t.select(i.row,f);s=!0}}}else if(c===CellType.TopLeft&&t.headersVisibility&HeadersVisibility.Column){p=a.getLastVisibleColumn();if((t.getMergedRange(a,i.row,i.col)||new CellRange(i.row,i.col)).rightCol>=p){var f;if((f=t._gpCHdr.getNextVisibleColumn())>=0){t.select(i.row,f,t._gpCHdr);s=!0}}}if(!s){t._selHdl.moveSelectionWithinSelectedPanel(0,1);s=!0}break;case Key.Down:if(c===CellType.ColumnHeader){var g=a.getLastVisibleRow();if((t.getMergedRange(a,i.row,i.col)||new CellRange(i.row,i.col)).bottomRow>=g){if((m=t._gpCells.getNextVisibleRow())>=0){t.select(m,i.col);s=!0}}}else if(c===CellType.TopLeft&&t.headersVisibility&HeadersVisibility.Row){g=a.getLastVisibleRow();if((t.getMergedRange(a,i.row,i.col)||new CellRange(i.row,i.col)).bottomRow>=g){if((m=t._gpRHdr.getNextVisibleRow())>=0){t.select(m,i.col,t._gpRHdr);s=!0}}}if(!s){t._selHdl.moveSelectionWithinSelectedPanel(1,0);s=!0}break;case Key.Up:if(c===CellType.RowHeader&&t.headersFocusability===HeadersFocusability.All&&t.headersVisibility===HeadersVisibility.All){var _=a.getNextVisibleRow();if((t.getMergedRange(a,i.row,i.col)||new CellRange(i.row,i.col)).topRow<=_){var m;if((m=t._gpTL.getLastVisibleRow())>=0){t.select(new CellRange(m,i.col),!0,t._gpTL);s=!0}}}if(!s){t._selHdl.moveSelectionWithinSelectedPanel(-1,0);s=!0}break;case Key.Enter:case Key.Space:var w=a.getCellElement(i.row,i.col);if(w){var C=w.querySelector("button");if(C){C.click();s=!0}else{var v=w.querySelector('[role="button"]');if(v){v.click();s=!0}else{var y=w.querySelector("input");if(y&&!y.classList.contains("wj-column-selector")){y.click();s=!0}else if(!y&&c==CellType.ColumnHeader){w.click();s=!0}}}}s=!0;break;default:s=!0}if(s){e.preventDefault();this._isHeadersHandled=!0}}};_KeyboardHandler.prototype._keydown=function(e){if(this._isHeadersHandled)this._isHeadersHandled=!1;else{var t=this._g,i=t._edtHdl,o=t.selection,n=e.ctrlKey||e.metaKey,r=e.shiftKey,l=e.altKey,s=e.target,a=e.char||e.key,c=!0;if(!n&&!l&&a&&1==a.length&&closest(s,".wj-cell")&&s.firstElementChild&&(" "!=a||!r)){var u=s.querySelectorAll("."+CellFactory._WJC_RADIOMAP+" label input");if(u&&u.length){for(var h=-1,d=0;d<u.length;d++)if(u[d].checked){h=d;break}a=a.toLowerCase();for(d=0;d<u.length;d++){var p=u[(h+d+1)%u.length];if(" "==a||p.value.toLowerCase()[0]==a){p.click();break}}e.preventDefault();return}}if(!t._wantsInput(s)){var f=tryCast(t.rows[o.row],GroupRow),g=t.editableCollectionView,_=t._getKeyCode(e),m=SelMove,w=SelectionMode,C=e.defaultPrevented&&!(s instanceof HTMLInputElement);if((t.isRangeValid(o)&&!C||n&&65==_)&&(!t.activeEditor||!i._keydown(e)||t._isNativeCheckbox(t.activeEditor))){if(t.autoClipboard){if(n&&(67==_||45==_)){var v=new CellRangeEventArgs(t.cells,o);if(t.onCopying(v)){var y=HeadersVisibility,b=0!=(t.copyHeaders&y.Column),R=0!=(t.copyHeaders&y.Row),E=t.getClipString(null,!1,b,R);_isMacOS()||(E+="\r\n");t._eFocus.focus();Clipboard.copy(E);t.onCopied(v)}e.stopPropagation();return}if(n&&86==_||r&&45==_){t.isReadOnly||Clipboard.paste((function(e){t.setClipString(e)}));e.stopPropagation();return}}(r||n)&&"Space"==e.code&&(_=Key.Space);switch(_){case Key.Space:if(r&&o.isValid)switch(t.selectionMode){case w.CellRange:case w.MultiRange:case w.Row:case w.RowRange:case w.ListBox:t.select(new CellRange(o.row,0,o.row,t.columns.length-1),!1);var S=o.row-t.rowHeaders.viewRange.row,x=t.rowHeaders.hostElement.children[S].querySelector(".wj-column-selector");x&&!t.rows[o.row].isSelected&&x.click()}else if(n&&o.isValid)switch(t.selectionMode){case w.CellRange:case w.MultiRange:t.select(new CellRange(0,o.col,t.rows.length-1,o.col),!1)}else{(c=this._startEditing(!0,e))&&setTimeout((function(){var e=t.activeEditor;if(e)if(e.disabled||e.readOnly&&!closest(e,".wj-control"))t.finishEditing();else if("checkbox"==e.type){setChecked(e,e.indeterminate||!e.checked);t.finishEditing()}}));c=!0}break;case 65:if(n)switch(t.selectionMode){case w.None:case w.Cell:break;default:t.selectAll()}else c=!1;break;case Key.Left:if(n||l)c=!1;else{if(o.isValid&&0==o.leftCol&&f&&!f.isCollapsed&&f.hasChildren)f.isCollapsed=!0;else if(o.isValid&&o.isSingleCell&&t.headersFocusability&HeadersFocusability.Row&&t.headersVisibility&HeadersVisibility.Row){if(t.activePanel.getNextVisibleColumn()>=(t.getMergedRange(t.activePanel,o.row,o.col)||new CellRange(o.row,o.col)).leftCol){t.select(o.row,t._gpRHdr.columns.length-1,t._gpRHdr);e.preventDefault();return}}if(!n){if(t.selectionMode==w.None)return;this._moveSel(m.None,n?m.Home:m.Prev,r)}}break;case Key.Right:if(n||e.altKey)c=!1;else if(o.isValid&&0==o.leftCol&&f&&f.isCollapsed)f.isCollapsed=!1;else{if(t.selectionMode==w.None)return;this._moveSel(m.None,n?m.End:m.Next,r)}break;case Key.Up:if(n)c=!1;else if(o.isValid&&o.isSingleCell&&t.headersFocusability&HeadersFocusability.Column&&t.headersVisibility&HeadersVisibility.Column){var H=t.activePanel.getNextVisibleRow();if((t.getMergedRange(t.activePanel,o.row,o.col)||new CellRange(o.row,o.col)).topRow<=H){var z=t._gpCHdr.getLastVisibleRow();if(z>=0){t.select(z,o.col,t._gpCHdr);e.preventDefault();return}}}if(!n)if(e.altKey&&i._toggleListBox(e))c=!0;else{if(t.selectionMode==w.None)return;this._moveSel(m.Prev,m.None,r)}break;case Key.Down:if(n)c=!1;else if(e.altKey&&i._toggleListBox(e))c=!0;else{if(t.selectionMode==w.None)return;this._moveSel(m.Next,m.None,r)}break;case Key.PageUp:this._moveSel(e.altKey?m.Home:m.PrevPage,m.None,r);if(t.rows._frozenInternal&&t.rows.isFrozen(t.selection.row)){var F=t.scrollPosition;F.y&&(t.scrollPosition=new Point(F.x,0))}break;case Key.PageDown:this._moveSel(e.altKey?m.End:m.NextPage,m.None,r);break;case Key.Home:this._moveSel(n?m.Home:m.None,m.Home,r);break;case Key.End:this._moveSel(n?m.End:m.None,m.End,r);break;case Key.Tab:if(!(c=this._performKeyAction(t.keyActionTab,r))&&!t.activeCell){t.focus(!0);if(t.imeEnabled){var M=t._imeHdl;M&&M._resetTabIndex()}else{var I=this._getCustomEditor(t,o.row,o.col);I&&I._resetTabIndex()}}break;case Key.Enter:t.rows[o.row]instanceof _NewRowTemplate||(c=this._performKeyAction(t.keyActionEnter,r));this._getCustomEditor(t,o.row,o.col)||t.focus(!0);!r&&g&&null!=g.currentEditItem&&i._commitRowEdits();break;case Key.Escape:c=!1;if(g&&(g.currentAddItem||g.currentEditItem)){var T=new CellRangeEventArgs(t.cells,t.selection);T.cancel=!0;t.onRowEditEnding(T);g.currentAddItem&&g.cancelNew();g.currentEditItem&&g.cancelEdit();t.onRowEditEnded(T);c=!0}t._mouseHdl.resetMouseState();break;case Key.Delete:case Key.Back:c=this._deleteSel(e);break;case Key.F2:c=this._startEditing(!0,e);break;case Key.F4:c=i._toggleListBox(e);break;default:c=!1}if(c){t.containsFocus()||t.focus();e.preventDefault();e.stopPropagation()}}}}};_KeyboardHandler.prototype._performKeyAction=function(e,t){var i=KeyAction,o=SelMove;switch(e){case i.MoveDown:this._moveSel(t?o.Prev:o.Next,o.None,!1);return!0;case i.MoveAcross:this._moveSel(o.None,t?o.Prev:o.Next,!1);return!0;case i.Cycle:this._moveSel(o.None,t?o.PrevCell:o.NextCell,!1);return!0;case i.CycleEditable:this._moveSel(o.None,t?o.PrevEditableCell:o.NextEditableCell,!1);return!0;case i.CycleOut:var n=this._g.selection;this._moveSel(o.None,t?o.PrevCell:o.NextCell,!1);return!n.equals(this._g.selection)}return!1};_KeyboardHandler.prototype._keypress=function(e){var t=this,i=this._g;if(!i._wantsInput(e.target)&&!e.defaultPrevented){var o=i._edtHdl;if(i.activeEditor)o._keypress(e);else if(e.charCode>Key.Space&&"AltLeft"!=e.code&&"AltRight"!=e.code)if(this._startEditing(!1,e)&&i.activeEditor){var n=getActiveElement();if(n instanceof HTMLInputElement&&"checkbox"!=n.type||n instanceof HTMLTextAreaElement){var r=i._selHdl.selection,l=i.getCellData(r.row,r.col,!0),s=i.getCellData(r.row,r.col,!1),a=culture.Globalize.numberFormat["%"]||"%",c=String.fromCharCode(e.charCode),u=isNumber(s)&&l.indexOf(a)>-1||""==l&&n.value==a,h=!0,initEditor_1=function(){n.value=u?c+a:c;setSelectionRange(n,1);n.dispatchEvent(o._evtInput);o._keypress(e);o._edtValue=n.value!=l?n.value:null};if(i.imeEnabled){var d=this._getCustomEditor(i,r.row,r.col),p=d&&d.control;if(p&&!p._focus){var gotF_1=function(){p.gotFocus.removeHandler(gotF_1);h=!1;initEditor_1()};p.gotFocus.addHandler(gotF_1)}}h&&initEditor_1();e.preventDefault()}}else if(i.autoSearch){var f=!1;r=i._selHdl.selection;if(e.charCode>32||32==e.charCode&&this._search){e.preventDefault();this._search+=String.fromCharCode(e.charCode);this._toSearch&&clearTimeout(this._toSearch);this._toSearch=setTimeout((function(){t._toSearch=null;t._search=""}),Control._SEARCH_DELAY);var g=this._findNext(r.row,r.col);if(g<0&&this._search.length>1){this._search=this._search[this._search.length-1];g=this._findNext(r.row,r.col)}if(g>-1){f=!0;i.select(g,r.col)}}f||(this._search="")}}};_KeyboardHandler.prototype._getCustomEditor=function(e,t,i){var o=e._getBindingColumn(e.cells,t,e.columns[i]);return o&&o._edt};_KeyboardHandler.prototype._findNext=function(e,t){var i=this._g,o=i.rows.length;(e<0||1==this._search.length)&&e++;var n=this._search,r=i.caseSensitiveSearch;r||(n=n.toLowerCase());for(var l=i.columns[t].isContentHtml,s=0;s<o;s++){var a=(e+s)%o,c=i.getCellData(a,t,!0).trim();l&&(c=toPlainText(c));r||(c=c.toLowerCase());if(0==c.indexOf(n))return a}return-1};_KeyboardHandler.prototype._moveSel=function(e,t,i){var o=this._g,n=o.selectionMode,r=o._selHdl;if(n!=SelectionMode.None){n==SelectionMode.MultiRange&&r.extendedSelection.clear();r.moveSelection(e,t,i)}};_KeyboardHandler.prototype._deleteSel=function(e){var t=this,i=this._g,o=i.rows,n=i.editableCollectionView,r=i.selection,l=[],s=new CellRange,a=new CellEditEndingEventArgs(i.cells,s,e),c=SelectionMode;if(!i._edtHdl._allowEdit())return!1;if(i.allowDelete&&(null==n||n.canRemove&&!n.isAddingNew&&!n.isEditingItem)){if(0==(l=o.filter((function(e){return e.isSelected}))).length)switch(i.selectionMode){case c.CellRange:case c.MultiRange:var u=i._getDeleteColumnIndex();i.selectedRanges.forEach((function(e){if(e.leftCol==u&&e.rightCol==i.columns.length-1)for(var t=e.topRow;t>-1&&t<=e.bottomRow;t++){var n=o[t];l.indexOf(n)<0&&l.push(n)}}));break;case c.Row:r.topRow>-1&&l.push(o[r.topRow]);break;case c.RowRange:for(var h=r.topRow;h>-1&&h<=r.bottomRow;h++)l.push(o[h])}l=l.reduce((function(e,t){e.find((function(e){return e.dataItem===t.dataItem}))||e.push(t);return e}),[])}if(l.length>0){var d=0;i.deferUpdate((function(){n&&n.beginUpdate();for(var e=l.length-1;e>=0;e--){var t=l[e];if(!(t instanceof _NewRowTemplate)){s.setRange(t.index,-1);i.onDeletingRow(a);if(!a.cancel){n&&t.dataItem?n.remove(t.dataItem):i.rows.removeAt(t.index);d++;i.onDeletedRow(a)}}}n&&n.endUpdate(!1)}));if(d>0){var p=r.topRow;p=Math.min(p,i.rows.length-1);for(;p>0&&i.rows[p]instanceof _NewRowTemplate;)p--;r.row=r.row2=p;i.select(r,!1);i.rows._frozenInternal>0&&i.rows.length<=i.rows._frozenInternal&&(i._ptScrl=new Point(i._ptScrl.x,0));i.childItemsPath&&n&&n.refresh()}return!0}if(0==l.length){i.deferUpdate((function(){var s=i.scrollPosition,a=-1;l=o.filter((function(e){return e.isSelected}));switch(i.selectionMode){case c.Row:r.topRow>-1&&l.push(o[r.topRow]);break;case c.RowRange:for(var u=r.topRow;u>-1&&u<=r.bottomRow;u++)l.push(o[u])}var h=i.selectedRanges.length>1||l.length>1||r.isValid&&o[r.row].dataItem!=o[r.row2].dataItem;n&&n.beginUpdate();if(l.length){var d=new CellRange(0,0,0,i.columns.length-1);l.forEach((function(i){d.row=d.row2=i.index;t._deleteRange(e,d);a=d.bottomRow}))}else{t._deleteRange(e,r);a=r.bottomRow;i.selectionMode==c.MultiRange&&i._selHdl.extendedSelection.forEach((function(i){t._deleteRange(e,i);a=i.bottomRow}))}i.select(r,!1);i.scrollPosition=s;if(n){if(h&&n.currentEditItem){n.commitEdit();var p=new CellRangeEventArgs(i.cells,new CellRange(a,-1));i.onRowEditEnding(p);i.onRowEditEnded(p)}n.endUpdate(!1)}}));return!0}return!1};_KeyboardHandler.prototype._deleteRange=function(e,t){var i=this._g,o=i.editableCollectionView,n=new CellRange,r=new CellEditEndingEventArgs(i.cells,n,e),l=new CellRangeEventArgs(i.cells,new CellRange(t.topRow,-1));i._imeHdl&&i._imeHdl._suspendIME();for(var s=t.topRow;s<=t.bottomRow;s++){var a=i.rows[s];if(!a.isReadOnly)for(var c=t.leftCol;c<=t.rightCol;c++){var u=i._getBindingColumn(i.cells,s,i.columns[c]);if(!u.getIsRequired(a)&&!u.isReadOnly){var h=i.getCellData(s,c,!1);if(i.getCellData(s,c,!0)){n.setRange(s,c);r.cancel=!1;if(i.onBeginningEdit(r)){var d=a.dataItem,p=o?o.currentEditItem:null;if(p&&d!=p&&c===t.rightCol){i.onRowEditEnding(l);i.onRowEditEnded(l)}if(d!=p&&c===t.leftCol){l._rng.setRange(s,-1);i.onRowEditStarting(l);i.onRowEditStarted(l)}if(o){o.editItem(d);i._edtHdl._edItem=d}i.setCellData(s,c,"",!0,!1);r.previousData=h;i.onCellEditEnding(r);i.onCellEditEnded(r)}}}}}i._imeHdl&&i._imeHdl._resumeIME()};_KeyboardHandler.prototype._startEditing=function(e,t,i,o){return this._g._edtHdl.startEditing(e,i,o,!0,t)};return _KeyboardHandler}();export{_KeyboardHandler};var HitTestInfo=function(){function HitTestInfo(e,t){this._row=-1;this._col=-1;this._edge=0;this._clickChildGrid=!1;this._mergedRange=null;var i;if(t instanceof Element){if(closest(t,".wj-flexgrid")!=e.hostElement)return;e=t;this._target=t}if(!(e instanceof Element)||e instanceof FlexGrid){if(e instanceof FlexGrid){this._target=e.hostElement;i=this._g=e}else{if(!(e instanceof GridPanel))throw"First parameter should be a FlexGrid or GridPanel.";this._target=e.hostElement;this._p=e;i=this._g=this._p.grid}if(t instanceof MouseEvent){this._target=t.target;var o=closest(this._target,".wj-flexgrid");"mousedown"==t.type&&null!=o&&e instanceof FlexGrid&&o!=e.hostElement&&(this._clickChildGrid=!0);"mousedown"==t.type&&(i._rcBounds=null)}t=mouseToPage(t);this._pt=t.clone();var n=i.controlRect,r=i._szClient,l=i.topLeftCells,s=i._eTL,a=i.headersVisibility,c=HeadersVisibility,u=a&c.Row?l.columns.getTotalSize():0,h=a&c.Column?l.rows.getTotalSize():0,d=a&c.Column?h+s.offsetTop:0,p=i._eBL,f=p.offsetHeight,g=getComputedStyle(i.hostElement),_=g&&g.borderLeftWidth?parseFloat(g.borderLeftWidth):0,m=g&&g.borderTopWidth?parseFloat(g.borderTopWidth):0;t.x-=n.left-_;t.y-=n.top-m;i.rightToLeft&&(t.x=n.width-t.x);this._p||t.x>=0&&t.y>=s.offsetTop&&r&&t.x<=r.width+u&&t.y<=r.height+h&&(t.y<d?this._p=t.x<u?i.topLeftCells:i.columnHeaders:t.y<p.offsetTop?this._p=t.x<u?i.rowHeaders:i.cells:this._p=t.x<u?i.bottomLeftCells:i.columnFooters);if(null!=this._p){var w=this._p.rows,C=this._p.columns,v=this._p.cellType,y=CellType,b=this._p._getFrozenPos(),R=v==y.TopLeft||v==y.ColumnHeader?h:v==y.BottomLeft||v==y.ColumnFooter?f:w.getTotalSize(),E=v==y.TopLeft||v==y.BottomLeft||v==y.RowHeader?u:C.getTotalSize();if(v==y.RowHeader||v==y.Cell){t.y-=h;this._inBottomFrozenArea=this._g.rows._frozenInternal&&this._g.rows._frozenInternal<0&&this._g._szClient.height&&this._g.rows.lastFrozen&&t.y>=Math.min(this._g.rows.lastFrozen.pos,this._g._szClient.height+this._g.rows.lastFrozen._antipos);if(this._p.rows._frozenInternal>=0){if(t.y>b.y||b.y<=0){t.y-=i._ptScrl.y;t.y+=this._p._getOffsetY()}}else(t.y<b.y||b.y>=this._g._szClient.height)&&(t.y-=i._ptScrl.y)}else v!=y.BottomLeft&&v!=y.ColumnFooter||(t.y-=p.offsetTop);if(v==y.ColumnHeader||v==y.Cell||v==y.ColumnFooter){t.x-=u;this._inRightFrozenArea=this._g.columns._frozenInternal&&this._g.columns._frozenInternal<0&&this._g.columns.lastFrozen&&this._g._szClient.width&&t.x>=Math.min(this._g.columns.lastFrozen.pos,Math.min(this._g.columns.lastFrozen.pos,this._g._szClient.width+this._g.columns.lastFrozen._antipos));this._p.columns._frozenInternal>=0?(t.x>b.x||b.x<=0)&&(t.x-=i._ptScrl.x):(t.x<b.x||b.x>=this._g._szClient.width)&&(t.x-=i._ptScrl.x)}v!=y.ColumnHeader&&v!=y.TopLeft||(t.y-=d-h);this._edge=0;var S=HitTestInfo._SZEDGE[this._g.isTouching?1:0];if(this._g.isTouching){S=HitTestInfo._SZEDGE[1];t.x-=S/2}this._row=t.y>R?-1:w.getItemAt(t.y);this._col=t.x>E?-1:C.getItemAt(t.x);(this._g.columns._frozenInternal<0||this._g.rows._frozenInternal<0)&&this.correctionForNegativeFrozen(t);if(this._row<0||this._col<0){this._p=null;return}if(this._col>-1){var x=C[this._col],H=this.grid.columns._frozenInternal<0&&this.grid.columns.isFrozen(this._col)?Math.min(x.pos,i._szClient.width+x._antipos):x.pos;if(t.x-H<=S){this._edge|=1;t.x-H<=S/2&&(this._edge|=64)}var z=H+x.renderSize-t.x;if(z<=S){this._edge|=4;z<=S/2&&(this._edge|=16)}}if(this._row>-1){var F=w[this._row],M=this.grid.rows._frozenInternal<0&&this.grid.rows.isFrozen(this._row)?Math.min(F.pos,i._szClient.height+F._antipos):F.pos;if(t.y-M<=S){this._edge|=2;t.y-M<=S/2&&(this._edge|=128)}var I=M+F.renderSize-t.y;if(I<=S){this._edge|=8;I<=S/2&&(this._edge|=32)}}}this.panel&&(this._mergedRange=this.grid.getMergedRange(this.panel,this.row,this.col))}else{var T=closest(e,".wj-cell"),G=T?T[GridPanel._INDEX_KEY]:null;if(G){this._target=e;this._row=G.row;this._col=G.col;this._rng=G.rng;this._p=G.panel;this._g=G.panel.grid}}}Object.defineProperty(HitTestInfo.prototype,"point",{get:function(){return this._pt},enumerable:!0,configurable:!0});Object.defineProperty(HitTestInfo.prototype,"cellType",{get:function(){return this._p?this._p.cellType:CellType.None},enumerable:!0,configurable:!0});Object.defineProperty(HitTestInfo.prototype,"panel",{get:function(){return this._p},enumerable:!0,configurable:!0});Object.defineProperty(HitTestInfo.prototype,"grid",{get:function(){return this._p?this._p.grid:null},enumerable:!0,configurable:!0});Object.defineProperty(HitTestInfo.prototype,"row",{get:function(){return this._row},enumerable:!0,configurable:!0});Object.defineProperty(HitTestInfo.prototype,"mergedRange",{get:function(){return this._mergedRange},enumerable:!0,configurable:!0});HitTestInfo.prototype.getRow=function(){return this._p&&this._row>-1?this._p.rows[this._row]:null};Object.defineProperty(HitTestInfo.prototype,"col",{get:function(){return this._col},enumerable:!0,configurable:!0});HitTestInfo.prototype.getColumn=function(e){var t=this._p,i=t&&this._col>-1?t.columns[this._col]:null;if(i&&e){var o=t.grid;i=t.cellType===CellType.ColumnHeader&&o._hasColumnGroups()?o._getColumnGroup(this._row,this._col):o._getBindingColumn(t,this._row,i)}return i};Object.defineProperty(HitTestInfo.prototype,"range",{get:function(){this._rng||(this._rng=new CellRange(this._row,this._col));return this._rng},enumerable:!0,configurable:!0});Object.defineProperty(HitTestInfo.prototype,"edgeLeft",{get:function(){return this._considerMergedStatusOfCell(0!=(1&this._edge),"leftCol")},enumerable:!0,configurable:!0});Object.defineProperty(HitTestInfo.prototype,"edgeTop",{get:function(){return this._considerMergedStatusOfCell(0!=(2&this._edge),"topRow")},enumerable:!0,configurable:!0});Object.defineProperty(HitTestInfo.prototype,"edgeRight",{get:function(){return this._mergedRange&&this.panel.columns[this._mergedRange._col2].isVisible?this._considerMergedStatusOfCell(0!=(4&this._edge),"rightCol"):0!=(4&this._edge)},enumerable:!0,configurable:!0});Object.defineProperty(HitTestInfo.prototype,"edgeFarRight",{get:function(){return this._considerMergedStatusOfCell(0!=(16&this._edge),"rightCol")},enumerable:!0,configurable:!0});Object.defineProperty(HitTestInfo.prototype,"edgeBottom",{get:function(){return this._mergedRange&&this.panel.rows[this._mergedRange._row2]&&this.panel.rows[this._mergedRange._row2].isVisible?this._considerMergedStatusOfCell(0!=(8&this._edge),"bottomRow"):0!=(8&this._edge)},enumerable:!0,configurable:!0});Object.defineProperty(HitTestInfo.prototype,"edgeFarBottom",{get:function(){return this._considerMergedStatusOfCell(0!=(32&this._edge),"bottomRow")},enumerable:!0,configurable:!0});Object.defineProperty(HitTestInfo.prototype,"edgeFarLeft",{get:function(){return 0!=(64&this._edge)},enumerable:!0,configurable:!0});Object.defineProperty(HitTestInfo.prototype,"edgeFarTop",{get:function(){return 0!=(128&this._edge)},enumerable:!0,configurable:!0});Object.defineProperty(HitTestInfo.prototype,"target",{get:function(){return this._target},enumerable:!0,configurable:!0});HitTestInfo.prototype.correctionForNegativeFrozen=function(e){var t=this._g._szClient.width,i=this._g._szClient.height;if(this._inRightFrozenArea||this._inBottomFrozenArea){if(this._inRightFrozenArea){for(var o=this._g.columns._lastFrozen;o<this._g.columns.length;o++)this._g.columns[o].isVisible&&e.x>=Math.min(this._g.columns[o].pos,t+this._g.columns[o]._antipos)&&e.x<=Math.min(this._g.columns[o].pos+this._g.columns[o].width,t)&&(this._col=o);this._col<this._g.columns.length+this._g.columns._frozenInternal&&(this._col=-1)}if(this._inBottomFrozenArea){for(o=this._g.rows._lastFrozen;o<this._g.rows.length;o++)this._g.rows[o].isVisible&&e.y>=Math.min(this._g.rows[o].pos,i+this._g.rows[o]._antipos)&&e.y<=Math.min(this._g.rows[o].pos+this._g.rows[o].height,i)&&(this._row=o);this._row<this._g.rows.length+this._g.rows._frozenInternal&&(this._row=-1)}}};HitTestInfo.prototype._considerMergedStatusOfCell=function(e,t){return!(!e||!(this.mergedRange&&this.mergedRange[t]===this.range[t]||null===this.mergedRange))};HitTestInfo._SZEDGE=[6,30];return HitTestInfo}();export{HitTestInfo};var _LB_PAGE_SIZE=4,_EditHandler=function(){function _EditHandler(e){var t=this;this._rng=null;this._edt=null;this._edItem=null;this._edtCanceled=!1;this._list=null;this._mapSearch=null;this._fullEdit=!1;this._evtInput=null;this._evtChange=null;this._cstEdtValue=null;this._validating=!1;this._map=null;this._composing=!1;this._g=e;this._evtInput=document.createEvent("HTMLEvents");this._evtInput.initEvent("input",!0,!1);this._evtChange=document.createEvent("HTMLEvents");this._evtChange.initEvent("change",!0,!1);e.selectionChanging.addHandler((function(e,i){return t._selectionChanging(i)}));e.lostFocus.addHandler((function(){var e=getActiveElement();e&&"fixed"==getComputedStyle(e).position?t.finishEditing():t._commitRowEdits()}));var i=e.hostElement;e.addEventListener(i,"mousedown",(function(i){if(!i.defaultPrevented&&0==i.button&&!e._mouseHdl._szRowCol){var o=e.hitTest(i);o.cellType!=CellType.Cell&&o.cellType!=CellType.None&&(t.finishEditing()||t.finishEditing(!0))}}),!0);var o=this;e.addEventListener(i,"compositionend",(function(){o._composing=!1;o._keypress.call(o,arguments)}));e.addEventListener(i,"compositionstart",(function(i){var o=t._getCustomEditor(e),n=null!=i?closest(i.target,".wj-flexgrid"):null,r=Control.getControl(n),l=r&&r._edtHdl?null!=r._edtHdl.activeEditor:null!=t.activeEditor;if(!o||l||e.imeEnabled)t._composing=!0;else{var s=window.getSelection(),a=s.rangeCount>0?s.getRangeAt(0):null,c=document.activeElement;if(null!=c){c.blur();window.getSelection().removeAllRanges();setTimeout((function(){null!=a&&window.getSelection().addRange(a);c.focus()}),20)}}}))}_EditHandler.prototype.startEditing=function(e,t,i,o,n){void 0===e&&(e=!0);var r=this._g,l=r._selHdl.selection;t=asNumber(t,!0,!0);i=isString(i)?r.columns.indexOf(i):asNumber(i,!0,!0);null==t&&(t=l.row);null==i&&(i=l.col);null==o&&(o=!0);if(!this._allowEdit(t,i))return!1;var s=r.getMergedRange(r.cells,t,i,!1);s||(s=new CellRange(t,i));var a=r.rows[t].dataItem;r.scrollIntoView(s.row,s.col,!0);if(!r.select(s,!0))return!1;if(!r.rows[t]||a!=r.rows[t].dataItem)return!1;if(this.activeEditor){if(s.equals(this._rng))return!0;if(!this.finishEditing())return!1}var c=new CellRangeEventArgs(r.cells,s,n);if(!r.onBeginningEdit(c))return!1;var u=r.editableCollectionView,h=!1;if(u){(h=(a=r.rows[t].dataItem)!=u.currentEditItem)&&r.onRowEditStarting(c);u.editItem(a);if(h){r.onRowEditStarted(c);this._edItem=a}}var d=r.rows[t],p=r._getBindingColumn(r.cells,t,r.columns[i]),f=p.dataMap||d.dataMap,g=DataMapEditor.RadioButtons,_=d.dataMap&&d.dataMapEditor==g||p.dataMap&&p.dataMapEditor==g;this._fullEdit=asBoolean(e);this._rng=s;this._list=null;f&&(this._map=f);if(f&&!_&&!p.editor){var m=f.useFilter?f.getFilteredItems(a):f.getDisplayValues(a);(p.isContentHtml||d.isContentHtml)&&(m=m.map((function(e){return toPlainText(e)})));this._list=m;this._mapSearch=f.search}if(_){var w=r._activeCell||r.hostElement.querySelector(".wj-cell.wj-state-active");if(w){var C=n?n.target:null;C instanceof HTMLSpanElement&&(C=closest(C,"label"));C instanceof HTMLLabelElement&&(C=C.querySelector("input"));if(C instanceof HTMLInputElement)this._edt=C;else{var v=w.querySelectorAll("input[checked]");v.length>0?this._edt=v[0]:this._edt=w.querySelector("input")}this._updateRowHeaderCell(t)}}else s.isSingleCell?this._updateEditorCell(t,i,h):r.refresh(!1);var y=this._edt;if(y){if("checkbox"==y.type||"radio"==y.type||"menu"==y.type)this._fullEdit=!1;else if(o){var b=0,R=y.value.length,E=!1,S=culture.Globalize.numberFormat["%"]||"%",x=r.getCellData(t,i,!1);isNumber(x)?E=y.value.indexOf(S)>-1:null==x&&(E=/^p/i.test(p.format))&&y.value.indexOf(S)<0&&(y.value+=S);if(E){var H=y.value;b=0;R=H.length;for(;R>0&&(H[R-1]==S||" "==H[R-1]);)R--;for(;b<R&&H[b]==S;)b++}n&&"keydown"==n.type&&n.keyCode==Key.Space&&(b=R);this._setSelectionRange(y,b,R,!0,isEdge());isIE()&&"right"==y.style.textAlign&&(y.style.paddingRight="1px")}r.onPrepareCellForEdit(c)}o&&!r.containsFocus()&&r.focus();return null!=y&&!y.disabled&&!y.readOnly};_EditHandler.prototype.finishEditing=function(e){var t=this._edt;if(!t||null==this._rng){this._removeListBox();return!0}var i=this._g,o=this._rng,n=new CellEditEndingEventArgs(i.cells,o),r=i.containsFocus();if(!e){var l=i.hostElement.querySelector(".wj-control.wj-state-focused");if(l){var s=Control.getControl(l);s&&(s.containsFocus()||s._focus)&&s.onLostFocus(n)}}n.cancel=e;if(!e&&i.validateEdits){if(x=this._getValidationError()){n.cancel=!0;var a=i.cells.getCellElement(o.row,o.col);if(a){this._setCellError(a,x);n.stayInEditMode=!0}}}this._cstEdtValue=null;n.data=i.cells.getCellData(o.topRow,o.leftCol,!1);if(!i.onCellEditEnding(n)&&n.stayInEditMode){r?setTimeout((function(){t.select()})):t.select();this._fullEdit=!0;return!1}if(!n.cancel){var c=null,u=!1;if(null!=this._lbx_SelectedValue){c=this._lbx_SelectedValue;u=!0}else{var h=this._cstEdtValue,d=this._map,p=this._lbx,f=i.columns[o.col].dataMapEditor===DataMapEditor.RadioButtons;if(h&&void 0!==h.value)c=h.value;else if(f&&this._edt.getAttribute("data-idx")){var g=parseInt(this._edt.getAttribute("data-idx"));c=d._cv.items[g][d.selectedValuePath]}else if(t&&p){var _=i._selHdl.selection,m=i.rows[_.row],w=i._getBindingColumn(i.cells,_.row,i.columns[_.col]);(t.value==this._lbx.selectedValue||isString(this._lbx.selectedValue)&&0==this._lbx.selectedValue.indexOf(t.value))&&(this._lbx_SelectedValue=this._findKeyValue(m.dataMap||w.dataMap,w.isContentHtml||m.isContentHtml));c=this._lbx_SelectedValue}null==this._lbx_SelectedValue&&null==c&&(c=i.cellFactory.getEditorValue(i));u=null!=this._lbx_SelectedValue||f}for(var C=o.topRow;C<=o.bottomRow&&C<i.rows.length;C++)for(var v=o.leftCol;v<=o.rightCol&&v<i.columns.length;v++){w=i._getBindingColumn(i.cells,C,i.columns[v]),m=i.rows[C];var y=!(d=w&&w.dataMap||m&&m.dataMap)||d.serializeKeys;if(!u&&d){if(this.isEqualValue(d.getDisplayValue(n.data),c))continue;if(d.useFilter){for(var b=i.getRowDataItem(C,v),R=d.getFilteredItems(b),E=!1,S=0;S<R.length&&!(E=R[S][d._displayPath]==c);S++);if(!E)continue}}if(!i.cells.setCellData(C,v,c,y,!1,u)&&i.validateEdits){var x;if(x=this._getValidationError(!0)){n.cancel=!0;var H=i.cells.getCellElement(o.row,o.col);if(H){this._setCellError(H,x);n.stayInEditMode=!0}return!1}}}t.value==this._edtValue&&t.dispatchEvent(this._evtChange)}this._edt=null;this._rng=null;this._list=null;this._edtValue=null;this._edtCanceled=n.cancel;this._removeListBox();this._lbx_SelectedValue=null;var z=closest(t,".wj-cell");if(contains(z,getActiveElement())){i._setFocusNoScroll(z);i._isScrollingByWheel=!1}!n.cancel&&n.refresh&&i._refreshOnEdit?i.refresh(!1):this._updateEditorCell(o.row,o.col,!1);r&&i.focus();i.onCellEditEnded(n);return!0};_EditHandler.prototype._setSelectionRange=function(e,t,i,o,n){void 0===o&&(o=!0);void 0===n&&(n=!1);if(!n)return setSelectionRange(e,t,i,o);if(contains(document.body,e)&&!e.disabled&&e.offsetHeight){try{e.setSelectionRange(t,i,"backward")}catch(e){}if(o)try{this._g._setFocusNoScroll(e);return!0}catch(e){}}return!1};_EditHandler.prototype._setCustomEditorValue=function(e){this._cstEdtValue={value:e}};_EditHandler.prototype._getCustomEditor=function(e){var t=null,i=e.selection;if(null!=i){var o=e._getBindingColumn(e.cells,i.row,e.columns[i.col]);t=o&&o._edt}return t};_EditHandler.prototype._setCellError=function(e,t){var i=this._g;""==t&&(t=null);toggleClass(e,"wj-state-invalid",null!=t);var o=i.errorTip,n=i.activeEditor;if(o){o.setTooltip(e,t);n&&contains(e,n)&&setAttribute(n,"title","")}else setAttribute(e,"title",t);n&&e==i.activeCell&&!contains(e,n)&&o&&o.setTooltip(n,t)};Object.defineProperty(_EditHandler.prototype,"activeEditor",{get:function(){return this._edt},enumerable:!0,configurable:!0});Object.defineProperty(_EditHandler.prototype,"editRange",{get:function(){return this._rng},enumerable:!0,configurable:!0});_EditHandler.prototype.getClipString=function(e,t,i,o){var n,r=this,l=this._g,s=l.selectionMode,a=[],c=0!=(t&ClipStringOptions.CSV),u=c?"\r\n":"\n",h=c?",":"\t",d=0!=(t&ClipStringOptions.InvisibleRows),p=SelectionMode,f=null!=e;if(!e&&s!=p.ListBox)for(var g=l.rows,_=0;_<g.length;_++)if(g[_].isSelected){s=p.ListBox;break}if(!e){l._selHdl._expandSelection();e=l.selection;switch(s){case p.Row:case p.RowRange:case p.ListBox:e.col=0;e.col2=l.columns.length-1;break;case p.MultiRange:var m=l.selectedRanges;if(m.length>1){var w=this._sameCols(m),C=this._sameRows(m);if(w||C){(m=m.slice()).sort((function(e,t){var i=e.topRow-t.topRow;return i||e.leftCol-t.leftCol}));for(var v=0;v<m.length;v++)for(var y=m[v],b=v+1;b<m.length;b++)if(y.contains(m[b])){m.splice(b,1);b--}if(w){var R=[];m.forEach((function(e){R.push(r.getClipString(e,t,i,o));i=!1}));return R.join(u)}if(C){var E;m.forEach((function(e){var n=r.getClipString(e,t,i,o).split(u);if(null==E){E=n;o=!1}else n.forEach((function(e,t){E[t]+=h+e}))}));return E.join(u)}}}}}var S=e.col>-1&&e.col2>-1;i&&S&&(n=l.columnHeaders).rows.forEach((function(i,l){if(d||i.isVisible){var s=r._getRowClipString(n,l,e,t,o);a.push(s)}}));if(e.row>-1&&e.row2>-1){n=l.cells;if(s!=p.ListBox||f){assert(e.bottomRow<n.rows.length,"Row index must be less than the number of rows.");for(v=e.topRow;v<=e.bottomRow;v++)if(d||n.rows[v].isVisible){var x=this._getRowClipString(n,v,e,t,o);a.push(x)}}else n.rows.forEach((function(i,l){if(i.isSelected&&(d||i.isVisible)){var s=r._getRowClipString(n,l,e,t,o);a.push(s)}}))}return a.join(u)};_EditHandler.prototype._getRowClipString=function(e,t,i,o,n){var r=[],l=e.rows[t],s=ClipStringOptions,a=0!=(o&s.CSV),c=0!=(o&s.InvisibleColumns),u=0==(o&s.Unformatted),h=0!=(o&s.SkipMerged);if(l.isVisible){if(n)for(var d=e.cellType==CellType.ColumnHeader?e.grid.topLeftCells:e.grid.rowHeaders,p=0;p<d.columns.length;p++)if(c||d.columns[p].isVisible){var f=d.getCellData(t,p,!0);h&&this._skipMergedCell(e,null,t,p)&&(f="");r.push(this._getCellClipString(f,o))}var g=l instanceof GroupRow?l:null,_=(!!g&&g.isSummary,e.grid),m=g&&(_.groupSummaryPosition===GroupSummaryPosition.Bottom||_.groupSummaryPosition===GroupSummaryPosition.Auto&&!g.isCollapsed),w=g&&!g.isSummary&&m;if(i.col>-1&&i.col2>-1){assert(i.rightCol<e.columns.length,"Column index must be less than the number of columns.");for(p=i.leftCol;p<=i.rightCol;p++)if(c||e.columns[p].isVisible){f=e.getCellData(t,p,u);w&&p!=e.columns.firstVisibleIndex&&(f=null);!f&&l instanceof GroupRow&&p==e.columns.firstVisibleIndex&&(f=toPlainText(l.getGroupHeader()));h&&this._skipMergedCell(e,null,t,p)&&(f="");r.push(this._getCellClipString(f,o))}}}return r.join(a?",":"\t")};_EditHandler.prototype._skipMergedCell=function(e,t,i,o){var n=e.grid.getMergedRange(e,i,o,!1);if(n){if(t){n.row=Math.max(t.topRow,n.row);n.col=Math.max(t.leftCol,n.col)}if(n.row!=i||n.col!=o)return!0}return!1};_EditHandler.prototype._getCellClipString=function(e,t){isString(e)||(e=isDate(e)?e.toJSON():null!=e?e.toString():"");e=e.replace(/\t/g," ");var i=0!=(t&ClipStringOptions.QuoteAll);(i=i||/\n|^"|"$/.test(e))||0==(t&ClipStringOptions.CSV)||(i=e.indexOf(",")>-1);i&&(e='"'+(e=e.replace(/"/g,'""'))+'"');return e};_EditHandler.prototype._sameRows=function(e){for(var t=e[0],i=1;i<e.length;i++)if(e[i].topRow!=t.topRow||e[i].bottomRow!=t.bottomRow)return!1;return!0};_EditHandler.prototype._sameCols=function(e){for(var t=e[0],i=1;i<e.length;i++)if(e[i].leftCol!=t.leftCol||e[i].rightCol!=t.rightCol)return!1;return!0};_EditHandler.prototype.setClipString=function(e,t){var i,o,n=this,r=this._g,l=r.editableCollectionView,s=this._parseClipString(asString(e)),a=r._getRowsPerItem(),c=r.selection,u=!1,h=s.length;t&&(c=t);i=r.rows[c.topRow]instanceof _NewRowTemplate&&r.newRowAtTop;o=c.rowSpan>1&&1===a||c.rowSpan-a!=0&&a>1;if(i&&o){u=!0;r.select(new CellRange(c.topRow,c.leftCol,c.topRow,c.rightCol))}var d=null==t,p=SelectionMode;if(d){r._selHdl._expandSelection();t=r.selection;switch(r.selectionMode){case p.Row:case p.RowRange:case p.ListBox:t.col=0;t.col2=r.columns.length-1;break;case p.MultiRange:var f=r.selectedRanges;if(f.length>1){l&&l.beginUpdate();f.forEach((function(t){r.setClipString(e,t)}));l&&l.endUpdate();r.selectedRanges=f;return}}}t=asType(t,CellRange);this._expandClipRows(s,t);u||(h=s.length);var g=0;if(s.length)for(var _=t.leftCol,m=r.columns.length,w=0;w<s[0].length;w++)for(var C=_+w+g;C<m&&!r.columns[C].visible;){g++;C++}var v=d?new CellRange(t.topRow,t.leftCol,Math.min(t.topRow+s.length-1,r.rows.length-1),Math.min(t.leftCol+s[0].length-1+g,r.columns.length-1)):t,y=new CellRangeEventArgs(r.cells,v,e);if(!r.onPasting(y))return!1;v=new CellRange(t.topRow,t.leftCol);var b=new CellRangeEventArgs(r.cells,new CellRange(t.topRow,-1)),R=!1,E=0,S=t.topRow,x=r.rows,H=r.columns,z=s.length>a,F=this._deferPaste(t,s.length);assert(a>=1,"Invalid RPI value = "+a);r.deferUpdate((function(){var e=-1;if(l&&F){e=l.currentPosition;l.beginUpdate()}for(var i=0;i<h&&S<x.length;i++,S++){var o=x[S];if(o.isVisible){if(!z||!o.isReadOnly){var c=o.dataItem,u=l?l.currentEditItem:null;if(u&&c!=u){r.onRowEditEnding(b);r.onRowEditEnded(b)}if(o instanceof _NewRowTemplate&&l){if(F){o.dataItem=l.addNew();b._rng.setRange(r.newRowAtTop?0:S,-1);if(!r.onRowEditStarting(b)){S--;l.cancelNew();continue}r.onRowEditStarted(b)}else if(1==a||(S+1)%a==1||0==i){b._rng.setRange(r.newRowAtTop?S%a:S,-1);if(!r.onRowEditStarting(b)){S--;continue}r.onRowEditStarted(b)}}else if(c!=u){b._rng.setRange(S,-1);r.onRowEditStarting(b);r.onRowEditStarted(b)}for(var d=s[i],p=t.leftCol,f=0;f<d.length&&p<H.length;f++,p++){var g=H[p];if(g.isVisible){if(!z||!g.isReadOnly){var _=r.getMergedRange(r.cells,S,p,!1);if(!(_&&(_.leftCol!=p||_.topRow!=S))&&n._allowEdit(S,p)){var m=d[f],w=m.length;w>1&&'"'==m[0]&&'"'==m[w-1]&&m.indexOf("\n")>-1&&(m=m.substr(1,w-2));var C=g.maxLength||o.maxLength;C&&(m=m.substr(0,C));var y=new CellRangeEventArgs(r.cells,new CellRange(S+E,p),m);if(r.onPastingCell(y)){if(l){l.editItem(c);n._edItem=l.currentEditItem}var M=r.getCellData(S,p,!1),I=y.data,T=softInput();if(T){var G=r._getBindingColumn(r.cells,S,r.columns[p]),P=G.editor,A=null,D=null;if(P instanceof T.InputNumber){A=P.clamp.bind(P);D=DataType.Number}else if(P instanceof T.InputDate||P instanceof T.InputTime){A=P._clamp.bind(P);D=DataType.Date}if(A){I=changeType(I,D,G.format,M);getType(I)==D&&(I=A(I))}}if((r.pasteEmptyCells||""!==I)&&r.setCellData(S,p,I)){y.data=M;r.onPastedCell(y);R=!0}}v.row2=Math.max(v.row2,S+E);v.col2=Math.max(v.col2,p)}}}else f--}if(n._edItem&&l instanceof CollectionView){var L=new NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Change,n._edItem,S);l.onCollectionChanged(L,l._edtClone)}if(o instanceof _NewRowTemplate&&l)if(F){o.dataItem=null;if(R){b._rng.setRange(r.newRowAtTop?0:S,-1);r.onRowEditEnding(b);r.onRowEditEnded(b);S--;E++;l.commitNew()}else l.cancelNew()}else if(z&&a>1&&(S+1)%a==0&&R){b._rng.setRange(r.newRowAtTop?S%a:S,-1);r.onRowEditEnding(b);r.onRowEditEnded(b);S-=a;E++}}}else i--}if(l)if(F){if(l.currentEditItem){l.commitEdit();r.onRowEditEnding(b);r.onRowEditEnded(b)}l.moveCurrentToPosition(e);l.endUpdate(!0)}else{var O=l.currentAddItem;!O&&0==t.row&&r.newRowAtTop&&x[0]instanceof _NewRowTemplate&&x[0].dataItem&&"{}"!=JSON.stringify(x[0].dataItem)&&(O=x[0].dataItem);if(O){l.editItem(O);n._edItem=O}else x[0]instanceof _NewRowTemplate&&x[0].dataItem&&(x[0].dataItem=null)}v.rowSpan>1&&0==v.topRow&&x[0]instanceof _NewRowTemplate&&(v.row=v.row2=0);r.select(v)}));r.onPasted(y);if(R&&closest(r.hostElement,"form")){var M=document.createEvent("HTMLEvents"),I=createElement("<input>",r.hostElement);M.initEvent("change",!0,!1);I.dispatchEvent(M);removeChild(I)}};_EditHandler.prototype._deferPaste=function(e,t){var i=this._g.rows,o=i.length;if(t>1){if(o>1&&i[0].dataItem!=i[1].dataItem)return!0;if(1==o&&i[0]instanceof _NewRowTemplate)return!0}return!1};_EditHandler.prototype._parseClipString=function(e){var t=[],i=(e=(e=e.replace(/\r\n/g,"\n").replace(/\r/g,"\n")).replace(/\n$/,"")).length,isTabOrNewLineChar=function(e){return"\n"===e||"\t"===e},o=0,n=0;for(o=0;o<i;o++){var r=!1,l=!1,s=!1;if('"'===e[o]){for(var a=!1,c=!1,u=o+1;u<i;u++){var h=e[u];if('"'===h){var d=u+1;if(d<i){isTabOrNewLineChar(e[d])&&(c=!0)}else c=!0}else!a&&isTabOrNewLineChar(h)&&(a=!0);if(c)break}c&&a&&(r=!0)}for(n=o;n<i&&!s;n++){var p=e[n];if('"'===p)r&&(l=!l);else if(isTabOrNewLineChar(p)&&!l){this._parseClipCell(t,e,o,n,"\n"==p);o=n;n==i-1&&(o=n+1);s=!0}}if(n==i){this._parseClipCell(t,e,o,n,!1);break}}0==t.length&&t.push([""]);return t};_EditHandler.prototype._parseClipCell=function(e,t,i,o,n){e.length||e.push([]);var r=t.substr(i,o-i),l=r.length;if(l>2&&'"'==r[0]&&'"'==r[l-1]){var s=r.substr(1,l-2),unquotedStringHasChar=function(e){return s.indexOf(e)>-1};(unquotedStringHasChar('""')||unquotedStringHasChar("\t")||unquotedStringHasChar("\n"))&&(r=s.replace(/""/g,'"'))}else"\t"==r&&(r="");e[e.length-1].push(r);n&&e.push([])};_EditHandler.prototype._expandClipRows=function(e,t){for(var i=e.length,o=0,n=0;n<i;n++)o=Math.max(o,e[n].length);for(var r=this._g,l=0,s=0,a=t.topRow;a<=t.bottomRow;a++)r.rows[a].isVisible&&l++;for(var c=t.leftCol;c<=t.rightCol;c++)r.columns[c].isVisible&&s++;if(l>1||s>1){1==l&&(l=i);1==s&&(s=o);if(s%o==0&&l%i==0){for(c=o;c<s;c++)for(a=0;a<i;a++)e[a].push(e[a%i][c%o]);for(a=i;a<l;a++)e.push(e[a%i])}}};_EditHandler.prototype._updateEditorCell=function(e,t,i){var o=this._g;if(o._useFrozenDiv()&&(o.rows.isFrozen(e)||o.columns.isFrozen(t))||o.columns._frozenInternal<0||o._hasPendingUpdates())o.refresh(!1);else{var n=o.cells.getCellElement(e,t);if(n&&o.onUpdatingView(new CancelEventArgs)){this._updateCell(n);(i||o._getHasValidation())&&this._updateRowHeaderCell(e);o.onUpdatedView()}}};_EditHandler.prototype._updateRowHeaderCell=function(e){var t=this._g;if(t.headersVisibility&HeadersVisibility.Row){var i=t.rowHeaders,o=t._getEditColumnIndex(),n=i.getCellElement(e,o);n&&this._updateCell(n)}};_EditHandler.prototype._updateCell=function(e){var t=new HitTestInfo(e,null),i=FlexGrid._WJS_UPDATING;if(t.panel){addClass(e,i);t.grid.cellFactory.updateCell(t.panel,t.row,t.col,e,t.range);removeClass(e,i)}};_EditHandler.prototype._getValidationError=function(e){var t=this,i=this._g,o="";if(i&&this._rng&&!this._validating){var n=this._rng.row,r=this._rng.col,l=i.activeEditor,s=i.cellFactory.getEditorValue(i),a=i.getCellData(n,r,!1);e&&(o=i._getError(i.cells,n,r,!0));if(!o&&i._getHasValidation()){l&&(o=l.validationMessage);if(!o){var c=i.columns[r],u=i.rows[n];!i._getBindingColumn(i.cells,n,c).getIsRequired(u)||null!=s&&""!==s||(o=this._getRequiredMsg())}if(!o&&i.setCellData(n,r,s,!0,!1)){o=i._getError(i.cells,n,r,!1);i.setCellData(n,r,a,!1,!1)}}if(!o){var h=Control.getControl(closest(l,".wj-control"));h==i&&hasClass(l,"wj-grid-ime")&&null!=i.activeCell&&(h=i.activeCell.firstChild["$WJ-CTRL"]);if(h&&h!=i&&h.invalidInput.hasHandlers){var invInputHandler=function(e,l){if(l.cancel){o=i._getError(i.cells,n,r,!0)||t._getBadInputMsg();l.cancel=""!=o}};this._validating=!0;var d=l.value;h.invalidInput.addHandler(invInputHandler);if(h._containsFocus()){var p=closest(h.hostElement,".wj-cell");p&&p.focus()}var f=h.isDroppedDown;h.onLostFocus();h.invalidInput.removeHandler(invInputHandler);l.value=d;if(o)l.select();else if(f){h.isDroppedDown=!0;l.select()}this._validating=!1}}}return o};Object.defineProperty(_EditHandler.prototype,"validate",{get:function(){return!this._getValidationError()},enumerable:!0,configurable:!0});_EditHandler.prototype._getRequiredMsg=function(){if(!_EditHandler._msgRequired){var e=document.createElement("input");e.required=!0;_EditHandler._msgRequired=e.validationMessage}return _EditHandler._msgRequired};_EditHandler.prototype._getBadInputMsg=function(){if(!_EditHandler._msgBadInput){var e=document.createElement("input");e.pattern="x";e.value="a";_EditHandler._msgBadInput=e.validationMessage||"Bad Input"}return _EditHandler._msgBadInput};_EditHandler.prototype._allowEdit=function(e,t){var i=this._g;if(i.isReadOnly||i.selectionMode==SelectionMode.None)return!1;if(i.collectionView&&!i.editableCollectionView)return!1;if(null!=e){if(e<0||e>=i.rows.length)return!1;var o=i.rows[e];if(!o||o.isReadOnly||!o.isVisible)return!1}if(null!=t){if(t<0||t>=i.columns.length)return!1;var n=i._getBindingColumn(i.cells,e,i.columns[t]);if(!n||n.isReadOnly||!n.isVisible)return!1}return!0};_EditHandler.prototype._commitRowEdits=function(){var e=this._g;if(this.finishEditing()&&this._edItem){var t=e.editableCollectionView;if(t&&(t.currentEditItem||t.currentAddItem)){var i=new CellRangeEventArgs(e.cells,e.selection);e.onRowEditEnding(i);t.commitEdit();e.onRowEditEnded(i)}this._edItem=null}};_EditHandler.prototype._keydown=function(e){var t=this._edt;switch(e.keyCode){case Key.F2:this._fullEdit=!this._fullEdit;e.preventDefault();return!0;case Key.F4:this._toggleListBox(e);e.preventDefault();return!0;case Key.Space:if(t&&"checkbox"==t.type&&!t.disabled&&!t.readOnly){setChecked(t,t.indeterminate||!t.checked);this.finishEditing();e.preventDefault()}return!0;case Key.Enter:e.preventDefault();if(t&&e.altKey){var i=e.target;if(i instanceof HTMLTextAreaElement&&"soft"==i.wrap){if(this._composing){i.blur();i.focus()}i.style.setProperty("ime-mode","auto","important");var o=i.value,n=i.selectionStart,r=i.selectionEnd;i.value=o.substr(0,n)+"\n"+o.substr(r);setSelectionRange(i,n+1);i.blur();i.focus();i.style.imeMode=""}return!0}if(t&&this._lbx){var l=this._g,s=l._selHdl.selection,a=l.rows[s.row],c=l._getBindingColumn(l.cells,s.row,l.columns[s.col]);null!=t.value&&(t.value!=this._lbx.selectedValue&&0!=(isString(this._lbx.selectedValue)&&this._lbx.selectedValue.indexOf(t.value))||(this._lbx_SelectedValue=this._findKeyValue(a.dataMap||c.dataMap,c.isContentHtml||a.isContentHtml)));this._toggleListBox(e);this.finishEditing();return!0}return!this.finishEditing();case Key.Tab:e.preventDefault();return!this.finishEditing();case Key.Escape:e.preventDefault();this.finishEditing(!0);return!0;case Key.Up:case Key.Down:case Key.Left:case Key.Right:case Key.PageUp:case Key.PageDown:case Key.Home:case Key.End:if(this._lbx)return this._keydownListBox(e);if(e.altKey)switch(e.keyCode){case Key.Up:case Key.Down:this._toggleListBox(e);e.preventDefault();return!0}if(this._fullEdit)switch(e.keyCode){case Key.PageUp:case Key.PageDown:e.preventDefault()}else if(this.finishEditing())return!1}return!0};_EditHandler.prototype._keydownListBox=function(e){var t=!0;if(this._lbx)switch(e.keyCode){case Key.Up:e.altKey?this._toggleListBox(e):this._lbx.selectedIndex>0&&this._lbx.selectedIndex--;break;case Key.Down:e.altKey?this._toggleListBox(e):this._lbx.selectedIndex++;break;case Key.Home:case Key.PageUp:this._lbx.selectedIndex=0;break;case Key.End:case Key.PageDown:this._lbx.selectedIndex=this._lbx.collectionView.items.length-1;break;default:t=!1}if(t){e.preventDefault();return!0}return!1};_EditHandler.prototype._keypress=function(e){if("AltLeft"!=e.code&&"AltRight"!=e.code){var t=this._edt,i=e.charCode||32,o=this._list;if(isEdge()){var n=t;n&&(1==n.value.length||0==n.selectionStart&&n.selectionEnd==n.value.length)&&(Control.sharedState.InvalidScroll=!0)}if(t&&"checkbox"!=t.type&&getActiveElement()==t&&o&&o.length>0&&i>=32){var r=t.selectionStart,l=t.value.substr(0,r);if(e.target==t&&e.charCode){l+=String.fromCharCode(e.charCode);r++}var s=this._mapSearch,a=-1,c=this._map;if(s)for(var u=0;u<o.length;u++){var h=o[u];if(s(null==h?h:h.toString(),l)){a=u;break}}else c&&c.useFilter?(a=this._findStringInObjArray(o,c.displayMemberPath,l,!0))<0&&!this._g.caseSensitiveSearch&&(a=this._findStringInObjArray(o,c.displayMemberPath,l,!1)):(a=this._findString(o,l,!0))<0&&!this._g.caseSensitiveSearch&&(a=this._findString(o,l,!1));if(a>-1){var d=this._lbx;d&&(d.selectedIndex=a);var p=null;p=c&&c.useFilter?o[a][c.displayMemberPath]:o[a];t.value=p;setSelectionRange(t,r,t.value.length);t.dispatchEvent(this._evtInput);e.preventDefault&&e.preventDefault()}else this._lbx&&(this._lbx_SelectedValue=null)}}else e.preventDefault()};_EditHandler.prototype._findString=function(e,t,i){i||(t=t.toLowerCase());for(var o=0;o<e.length;o++){var n=e[o];if(null!=n){n=n.toString();i||(n=n.toLowerCase());if(0==n.indexOf(t))return o}}return-1};_EditHandler.prototype._findStringInObjArray=function(e,t,i,o){o||(i=i.toLowerCase());for(var n=0;n<e.length;n++){var r=e[n];if(null!=r){r=r[t].toString();o||(r=r.toLowerCase());if(0==r.indexOf(i))return n}}return-1};_EditHandler.prototype._toggleListBox=function(e,t){var i=this._g,o=i._selHdl.selection,n=i.isTouching;t||(t=o);if(this._lbx){this._removeListBox();if(o.intersects(t)){i.activeEditor?i.activeEditor.focus():i.containsFocus()||i.focus();return!0}}if(!t.isValid)return!1;var r=i.rows[t.row],l=i._getBindingColumn(i.cells,t.row,i.columns[t.col]),s=r.dataMap||l.dataMap,a=i._getMapEditor(r,l);if(!s||a!=DataMapEditor.DropDownList&&a!=DataMapEditor.Menu||!softInput())return!1;if(null!=l.editor)return!1;if(!t.intersects(i.editRange)&&!this.startEditing(!0,t.row,t.col,!n,e))return!1;var c=this._lbx=this._createListBox();requestAnimationFrame((function(){return c.showSelection()}));n&&c.focus();return!0};_EditHandler.prototype._createListBox=function(){var e=this,t=this._g,i=t.activeEditor,o=this._rng,n=t.rows[o.row],r=t._getBindingColumn(t.cells,o.row,t.columns[o.col]),l=r.isContentHtml||n.isContentHtml,s=r.dataMap||n.dataMap,a=r.dropDownCssClass||n.dropDownCssClass,c=document.createElement("div");this._removeListBox();addClass(c,"wj-dropdown-panel wj-grid-listbox");addClass(c,a);var u=i?i.value:t.getCellData(o.row,o.col,!0),h=new mInput.ListBox(c,{maxHeight:n.renderHeight*_LB_PAGE_SIZE,isContentHtml:l}),d=t.getRowDataItem(o.row,o.col);if(s.useFilter){h.itemsSource=s.getFilteredItems(d);h.displayMemberPath=s._displayPath;h.selectedValuePath=s._keyPath}else h.itemsSource=s.getDisplayValues(d);if(s._displayPath==s._keyPath)h.selectedValue=u;else{var p=t.getCellData(o.row,o.col,!1),f=-1,g=this._findDuplicateValues(s,u,l),_=s._cv.items.findIndex((function(t){return e.isEqualValue(t[s._keyPath],p,l)}));if(_>-1){var m=s._cv.items[_][s._displayPath];if(this.isEqualValue(u,m,l))if(1==g.length)f=_>=h.itemsSource.length||!this.isEqualValue(this._getListBoxItemField(h,s.useFilter,_),u,l)?h.itemsSource.findIndex((function(t){return e.isEqualValue(m,s.useFilter?t[h.displayMemberPath]:t,l)})):_;else for(var w=-1,C=0;C<h.itemsSource.length;C++)if(this.isEqualValue(this._getListBoxItemField(h,s.useFilter,C),m,l)){w++;if(this.isEqualValue(g[w],p,l)){f=C;break}}}f<0&&(f=h.itemsSource.findIndex((function(t){return e.isEqualValue(u,s.useFilter?t[h.displayMemberPath]:t,l)})));f>=0?h.selectedIndex=f:h.selectedValue=null}h.addEventListener(c,"keydown",(function(i){switch(i.keyCode){case Key.Enter:case Key.Escape:e._removeListBox();t.focus()}}));h.addEventListener(c,"click",(function(){e._lbx&&(e._lbx_SelectedValue=e._findKeyValue(s,l));e._removeListBox();t.focus();e.finishEditing()}));h.gotFocus.addHandler((function(){h.containsFocus()&&i&&!isEdge()&&i.focus()}));h.selectedIndexChanged.addHandler((function(){var i=t.activeEditor;if(i){i.value=void 0===e._list[h.selectedIndex]?"":e._list[h.selectedIndex];i.dispatchEvent(e._evtInput);setSelectionRange(i,0,i.value.length)}}));var v=t.cells.getCellElement(o.row,o.col);if(v){showPopup(c,v,!1,!1,!1);var y=v.querySelector("."+CellFactory._WJC_DROPDOWN);setAttribute(y,"aria-expanded",!0)}else{showPopup(c,t.getCellBoundingRect(o.row,o.col));c[Control._OWNR_KEY]=t.hostElement}return h};_EditHandler.prototype._getListBoxItemField=function(e,t,i){return i>=e.itemsSource.length?null:t?e.itemsSource[i][e.displayMemberPath]:e.itemsSource[i]};_EditHandler.prototype._findKeyValue=function(e,t){void 0===t&&(t=!1);if(e.useFilter){if(this._lbx.selectedValue)return this._lbx.selectedValue;if(this._lbx.selectedItem&&this._lbx.selectedValuePath)return this._lbx.selectedItem[this._lbx.selectedValuePath]}var i=this._lbx.selectedValue,o=this._findDuplicateValues(e,i,t),n=e.getKeyValue(i);if(this._lbx.selectedIndex>0&&o.length>1){for(var r=-1,l=0;l<=this._lbx.selectedIndex;l++)this.isEqualValue(this._lbx.itemsSource[l],i,t)&&r++;r>=0&&(n=o[r])}return n};_EditHandler.prototype._findDuplicateValues=function(e,t,i){void 0===i&&(i=!1);for(var o=[],n=e.getKeyValues(),r=0;r<n.length;r++)this.isEqualValue(e.getDisplayValue(n[r]),t,i)&&o.push(n[r]);return o};_EditHandler.prototype._removeListBox=function(){var e=this._lbx;if(e){this._lbx=null;hidePopup(e.hostElement,(function(){e.dispose()}))}};_EditHandler.prototype.isEqualValue=function(e,t,i){void 0===i&&(i=!1);if(e instanceof Date&&t instanceof Date)return e.getTime()==t.getTime();null!=e&&null!=e||(e="");null!=t&&null!=t||(t="");Number.isNaN(e)&&(e="NaN");Number.isNaN(t)&&(t="NaN");if(i){isString(e)&&e.indexOf("<")>-1&&(e=toPlainText(e));isString(t)&&t.indexOf("<")>-1&&(t=toPlainText(t))}return e.toString()==t.toString()};_EditHandler.prototype._selectionChanging=function(e){var t=this;if(!this._g.isReadOnly)if(this.finishEditing()){var i=this._g._selHdl.selection.row;if(i!=e.row){var o=this._g.rows.length;if((i>-1&&i<o?this._g.rows[i].dataItem:null)!=(e.row>-1&&e.row<o?this._g.rows[e.row].dataItem:null)){this._commitRowEdits();if(this._g._getHasValidation()&&this._g.validateEdits){var n=!this._g.rows[i]||this._g.rows[i]&&Object.getPrototypeOf(this._g.rows[i])!==Row.prototype?null:this._g.getEmptyRequiredCell(i);null!==n&&setTimeout((function(){t._g.select(new CellRange(i,n));t.startEditing(!0,i,n,!0,e)}))}}}}else e.cancel=!0};_EditHandler._msgRequired="";_EditHandler._msgBadInput="";return _EditHandler}();export{_EditHandler};var _AR_ALLCELLS=4,_WJC_DRAGSRC="wj-state-dragsrc",_WJC_FLEXGRID="wj-flexgrid";export var AllowResizing;!function(e){e[e.None=0]="None";e[e.Columns=1]="Columns";e[e.Rows=2]="Rows";e[e.Both=3]="Both";e[e.ColumnsAllCells=e.Columns|_AR_ALLCELLS]="ColumnsAllCells";e[e.RowsAllCells=e.Rows|_AR_ALLCELLS]="RowsAllCells";e[e.BothAllCells=e.Both|_AR_ALLCELLS]="BothAllCells"}(AllowResizing||(AllowResizing={}));export var AutoSizeMode;!function(e){e[e.None=0]="None";e[e.Headers=1]="Headers";e[e.Cells=2]="Cells";e[e.Both=3]="Both"}(AutoSizeMode||(AutoSizeMode={}));export var AllowDragging;!function(e){e[e.None=0]="None";e[e.Columns=1]="Columns";e[e.Rows=2]="Rows";e[e.Both=3]="Both"}(AllowDragging||(AllowDragging={}));var _MouseHandler=function(){function _MouseHandler(e){var t=this;this._wasAllRowColHidden=!1;this._scrollbarStatusAtMouseDown=null;var i=e.hostElement,o=e.addEventListener.bind(e),n=e.removeEventListener.bind(e);this._g=e;this._dvMarker=createElement('<div class="wj-marker">&nbsp;</div>');o(i,"mousedown",(function(i){e._rcBounds=null;var r=i.target,l=closestClass(r,_WJC_FLEXGRID),s=i.defaultPrevented&&null!=closestClass(r,CellFactory._WJC_DROPDOWN);if(s&&null==(l=closestClass(document.activeElement,_WJC_FLEXGRID))){var a=Control.getControl(document.activeElement),c=null;a.hostElement&&(a.hostElement["$WJ-OWNR"]&&a.hostElement["$WJ-OWNR"]["$WJ-CTRL"]?c=a.hostElement["$WJ-OWNR"]["$WJ-CTRL"].inputElement:a.hostElement.parentElement&&a.hostElement.parentElement["$WJ-OWNR"]&&a.hostElement.parentElement["$WJ-OWNR"]["$WJ-CTRL"]&&(c=a.hostElement.parentElement["$WJ-OWNR"]["$WJ-CTRL"].inputElement));l=closestClass(c,_WJC_FLEXGRID)}var u=l&&l!=e.hostElement,h=u&&(l[Control._CTRL_KEY]._imeHdl||e.imeEnabled);if((!i.defaultPrevented||h||s)&&0==i.button){if(!i.defaultPrevented){var d=t._g.activeCell;if(!e.containsFocus()||!d||d.classList.contains("wj-state-selected")){var p=r instanceof HTMLElement&&r.tabIndex>-1?r:e._eFocus;e._setFocusNoScroll(p)}setTimeout((function(){i.defaultPrevented||e.focus()}))}var f=e.hitTest(i),g=CellType;if(u||!e.activeEditor&&e._isInputElement(r)&&!t._hasRadioMap(i)&&!e._isNativeCheckbox(r)||s){switch(f.cellType){case g.Cell:if(u&&s||u||!e.activeEditor&&e._isInputElement(r)&&!t._hasRadioMap(i)&&!e._isNativeCheckbox(r)){var _=e.getMergedRange(f.panel,f.row,f.col,!1);e.select(null!=_?_:f.range,!1)}!i.defaultPrevented&&r instanceof HTMLElement&&"root"!=r.getAttribute("wj-part")&&r.focus();break;case g.ColumnHeader:case g.ColumnFooter:e.scrollIntoView(-1,f.col);break;case g.RowHeader:e.scrollIntoView(f.row,-1)}!i.defaultPrevented&&isIE()&&f.cellType!=g.Cell&&e._isInputElement(r)&&r.focus();return}if(e._isNativeCheckbox(r)&&hasClass(r,"wj-column-selector")&&(f.cellType===g.RowHeader||f.cellType===g.ColumnHeader))return;var m=document;n(m,"mousemove");n(m,"mouseup");o(m,"mousemove",mouseMove);o(m,"mouseup",mouseUp);t._isDown=!0;t._mousedown(i)}}));var mouseMove=function(e){t._mousemove(e)},mouseUp=function(e){t._isDown=!1;n(document,"mousemove");n(document,"mouseup");t._mouseup(e)};o(i,"mouseenter",(function(t){e._rcBounds=null}));o(i,"mousemove",this._hover.bind(this));o(i,"dblclick",this._dblclick.bind(this));o(i,"click",this._click.bind(this));o(i,"selectstart",(function(t){e._isInputElement(t.target)||t.preventDefault()}));isSafari()&&o(i,"mousewheel",(function(t){t.defaultPrevented||!t.wheelDeltaY||t.ctrlKey||t.metaKey||(e._isScrollingByWheel=!0)}));o(i,"wheel",(function(i){if(!i.defaultPrevented&&i.deltaY&&!i.ctrlKey&&!i.metaKey){var o=e._root,n=i.deltaY;if((i.shiftKey?o.scrollWidth>o.clientWidth:o.scrollHeight>o.clientHeight)&&closestClass(i.target,_WJC_FLEXGRID)==e.hostElement){switch(i.deltaMode){case 1:n=e.rows.defaultSize*(n<0?-1:1);break;case 2:n=(i.shiftKey?o.clientWidth:o.clientHeight)*(n<0?-1:1);break;case 0:default:isSafari()&&(n=clamp(n,-150,150))}e._isScrollingByWheel=!0;isEdge()&&(Control.sharedState.InvalidScroll=!1);e.finishEditing(!1)&&(i.shiftKey?o.scrollLeft+=n:o.scrollTop+=n);clearTimeout(t.mouseWhellTimer);t.mouseWhellTimer=setTimeout((function(){e._isScrollingByWheel=!1}),1);i.preventDefault();i.stopImmediatePropagation()}}}));o(i,"dragstart",this._dragstart.bind(this));o(i,"dragover",this._dragover.bind(this));o(i,"dragleave",this._dragleave.bind(this));o(i,"drop",this._drop.bind(this));o(i,"dragend",this._dragend.bind(this))}_MouseHandler.prototype.resetMouseState=function(){var e=this._g,t=e.hostElement;if(this._updating){this._updating=!1;e.endUpdate()}this._dragSrc&&removeClass(this._dragSrc,_WJC_DRAGSRC);this._showDragMarker(null);t&&(t.style.cursor="");isSafari()&&this._szRowCol&&e.invalidate();e.removeEventListener(document,"mousemove");e.removeEventListener(document,"mouseup");this._eMouse=null;this._isDown=null;this._htDown=null;this._scrollbarStatusAtMouseDown=null;this._lbSelState=null;this._lbSelStateRows={};this._lbSel=null;this._szRowCol=null;this._szArgs=null;e._rcBounds=null;this._anchorCol=-1};_MouseHandler.prototype._mousedown=function(e){var t=this._g,i=e.target,o=t.hitTest(e),n=o.cellType,r=CellType,l=e.ctrlKey||e.metaKey;this._selDown=t.selection;this._selPanelType=t.activePanelType;this._ignoreClick=!1;if(null==o.panel&&null==t.cells||o.panel&&t.cells&&o.panel._uid==t.cells._uid){if(closestClass(i,CellFactory._WJC_DROPDOWN)){var s=t.hitTest(i);t._edtHdl._toggleListBox(e,s.range);e.preventDefault();this._ignoreClick=!0;return}var a=t.editRange;if(a&&a.contains(o.range)){Control.sharedState.InvalidScroll=isEdge();return}}var c=getActiveElement();if(i!=c||!t._isInputElement(i))if(n!=r.None){this._htDown=o;this._eMouse=e;this._anchorCol=o.col;this._scrollbarStatusAtMouseDown={row:t._hasScroll(t.rows),col:t._hasScroll(t.columns)};if(o.panel){var u={height:t._root.clientHeight,width:t._root.clientWidth},h={height:t.cells.hostElement.clientHeight,width:t.cells.hostElement.clientWidth};this._szInitial={row:o.getRow().renderHeight,col:o.getColumn().renderWidth,canHaveHScrl:u.width-t.rowHeaders.columns.getTotalSize()-h.width!=0,canHaveVScrl:u.height-t.columnHeaders.rows.getTotalSize()-h.height!=0}}else this._szInitial=null;if(null==this._szRowCol){var d=t.allowResizing,p=AllowResizing;if((n==r.RowHeader||n==r.TopLeft)&&(o.edgeTop||o.edgeBottom)&&d&p.Rows&&this._getResizeRowHt(o))this._ignoreClick=!0;else if((n==r.ColumnHeader||n==r.TopLeft)&&(o.edgeLeft||o.edgeRight)&&d&p.Columns&&this._getResizeColHt(o))this._ignoreClick=!0;else{var f=t.allowDragging,g=AllowDragging;switch(n){case r.Cell:case r.RowHeader:if(l&&t.selectionMode==SelectionMode.ListBox){this._lbSelState=t.rows[o.row].isSelected;closest(i,".wj-elem-collapse")&&(this._lbSelState=!1)}this._mouseSelect(e,e.shiftKey);if(n==r.RowHeader&&!(f&g.Rows)){e.preventDefault();t.focus()}break;case r.ColumnHeader:t.allowSorting||f&g.Columns||closest(i,"button")||this._mouseSelect(e,e.shiftKey)}}}else{var _=t._eFocus;if(c!=_){_.tabIndex=0;_.focus()}this._ignoreClick=!0;this._handleResizing(e)}}else{t.finishEditing();i!=t._root&&i!=t._fCt&&t._edtHdl._commitRowEdits()}};_MouseHandler.prototype._mousemove=function(e){null==this._htDown&&isEdge()&&(Control.sharedState.InvalidScroll=!1);if(this._htDown&&!e.defaultPrevented){if(0==e.buttons&&this._eMouse&&e.timeStamp-this._eMouse.timeStamp>600){this.resetMouseState();return}this._eMouse=e;if(this._szRowCol)this._handleResizing(e);else{var t=this._g,i=t.allowDragging,o=AllowDragging,n=CellType;switch(this._htDown.cellType){case n.Cell:this._mouseSelect(e,!0);break;case n.RowHeader:i&o.Rows||this._mouseSelect(e,!0);break;case n.ColumnHeader:i&o.Columns||t.allowSorting||this._mouseSelect(e,!0)}}}};_MouseHandler.prototype._mouseup=function(e){var t=this._g;if(!t.isTouching||!(this._dragSrc||e.target instanceof HTMLHtmlElement)){var i=t.hitTest(e),o=this._htDown;if(o&&!e.defaultPrevented){this._szArgs&&this._finishResizing(e,t._getRangesToResize(e,!1));if(!this._szArgs&&(null==i.panel&&null==o.panel||i.panel&&o.panel&&i.panel._uid==o.panel._uid)&&i.row==o.row&&i.col==o.col){var n=i.getColumn();if(n){if(!(n._getFlag(RowColFlags.HasTemplate)&&!n.cellTemplate)){var r=i.target;if(r!=o.target&&r instanceof HTMLElement){if(o.target instanceof HTMLInputElement){var l=i.point,s=o.point;Math.abs(l.x-s.x)+Math.abs(l.y-s.y)<10&&(r=r.querySelector("input")||r)}var a=document.createEvent("Event");a.initEvent("click",!0,!0);for(var c in e)/Key$|X$|Y$|^button|^(x|y|which)$/.test(c)&&(a[c]=e[c]);r.dispatchEvent(a)}}}}}this.resetMouseState()}};_MouseHandler.prototype._click=function(e){if(this._ignoreClick){this._ignoreClick=!1;e.preventDefault()}if(!e.defaultPrevented){var t=this._g,i=e.target,o=t.hitTest(i),n=tryCast(i,HTMLInputElement),r="input."+CellFactory._WJC_CHECKBOX;if(!n){var l=closest(i,"label");l&&(n=l.querySelector(r))}!n&&t.bigCheckboxes&&(n=i.querySelector(r));if(n!=t.activeEditor&&t._isNativeCheckbox(n)){if(null==o.panel&&null==t.cells||o.panel&&t.cells&&o.panel._uid==t.cells._uid){var s=t.getCellData(o.row,o.col,!1);if(t.startEditing(!1,o.row,o.col,!1,e)){t.activeEditor.checked=!s;t.finishEditing();t.focus()}else"boolean"!=typeof s&&null!=s||(n.checked=s)}return}if(this._hasRadioMap(e)){this._handleClick(e);return}var a=e.ctrlKey||e.metaKey;if(t.rows.maxGroupLevel>-1&&closestClass(i,CellFactory._WJC_COLLAPSE)){var c=t.rows[o.row];if(null==o.panel&&null==t.cells||o.panel&&t.cells&&o.panel._uid==t.cells._uid&&c instanceof GroupRow){a?t.collapseGroupsToLevel(c.isCollapsed?c.level+1:c.level):c.isCollapsed=!c.isCollapsed;t.scrollIntoView(o.row,-1);return}}if(!(a||e.shiftKey||t.activeEditor||t.activePanelType!==CellType.Cell||t._isInputElement(i))&&(null==o.panel&&null==t.cells||o.panel&&t.cells&&o.panel._uid==t.cells._uid)){var u=t._selHdl.selection;if(u.equals(this._selDown)&&this._selPanelType===CellType.Cell&&o.range.contains(u)){t.startEditing(!0,null,null,!0,e);return}}this._handleClick(e)}};_MouseHandler.prototype._handleClick=function(e){var t=this._g,i=e.target,o=t.hitTest(i),n=e.ctrlKey||e.metaKey,r=o.panel;if(!e.defaultPrevented&&o.grid&&t&&o.grid._uid==t._uid){if(r&&t.cells&&r._uid==t.cells._uid&&this._hasRadioMap(e)){var l=t._getBindingColumn(o.panel,o.row,o.getColumn()),s=closest(i,"label"),a=s&&s.querySelector("input"),c=a&&parseInt(a.getAttribute("data-idx")),u=o.getColumn().dataMap||l&&l.dataMap||o.getRow().dataMap,h=void 0;null!=c&&(h=u._cv.items[c][u.selectedValuePath]);a&&!a.disabled&&t.startEditing(!1,o.row,o.col,!1,e)&&t.finishEditing()&&(t._edtHdl._edtCanceled?e.preventDefault():t.cells.setCellData(o.row,o.col,void 0!==h?h:s.textContent,!0,t.refreshOnEdit,void 0!==h));return}if(!t._isInputElement(i)){if(r&&t.topLeftCells&&r._uid==t.topLeftCells._uid){var d=SelectionMode;switch(t.selectionMode){case d.None:case d.Cell:break;default:t.selectAll()}return}if(r&&t.columnHeaders&&r._uid==t.columnHeaders._uid){if(t.allowPinning&&closestClass(i,CellFactory._WJC_PIN))this._clickPin(e,o);else if(!t._isTransposed()&&closestClass(e.target,CellFactory._WJC_COLLAPSE)){if(m=t._getColumnGroup(o.row,o.col))if(n){for(var p=m.isCollapsed,f=m.level,g=[],_=0;_<t.columns.length;_++)if((m=t._getColumnGroup(o.row,_))&&m.collapseTo&&m.level==f&&g.indexOf(m)<0){g.push(m);m.isCollapsed=!p}}else m.isCollapsed=!m.isCollapsed;t.scrollIntoView(-1,o.col)}else{i instanceof HTMLSpanElement&&i.parentElement instanceof HTMLLabelElement&&(i=i.parentElement.querySelector("input"));i instanceof HTMLInputElement||this._clickSort(e,o);t.focus();t.scrollIntoView(-1,o.col)}return}if(r&&t.rowHeaders&&r._uid==t.rowHeaders._uid){if(t._isTransposed()&&closestClass(e.target,CellFactory._WJC_COLLAPSE)){var m;if(m=t._getColumnGroup(o.row,o.col))if(n){p=m.isCollapsed,f=m.level,g=[];for(var w=0;w<t.rows.length;w++)if((m=t._getColumnGroup(w,o.col))&&m.collapseTo&&m.level==f&&g.indexOf(m)<0){g.push(m);m.isCollapsed=!p}}else m.isCollapsed=!m.isCollapsed}return}if(r&&t.cells&&r._uid==t.cells._uid){if(o.row<0){this._clickSort(e,o);return}if(closestClass(i,CellFactory._WJC_COLLAPSE)){var C=t.rows[o.row];C instanceof GroupRow&&(n?t.collapseGroupsToLevel(C.isCollapsed?C.level+1:C.level):C.isCollapsed=!C.isCollapsed);return}closestClass(i,CellFactory._WJC_DROPDOWN)&&t._edtHdl._toggleListBox(e,o.range)}}}};_MouseHandler.prototype._hasRadioMap=function(e){var t=e.target;if(closest(t,"label")){var i=closestClass(t,CellFactory._WJC_RADIOMAP);return closestClass(i,_WJC_FLEXGRID)==this._g.hostElement}return!1};_MouseHandler.prototype._clickSort=function(e,t){var i=this._g,o=i.allowSorting,n=i.collectionView,r=n?n.sortDescriptions:null,l=e.ctrlKey||e.metaKey,s=e.shiftKey;if(n&&n.canSort&&o!=AllowSorting.None){var a=t.panel.columns[t.col],c=i._getBindingColumn(t.panel,t.row,a),u=c?c._getBindingSort():null;if(c.allowSorting&&u){if(a&&c&&a._uid==c._uid){var h=i.getMergedRange(t.panel,t.row,t.col,!1);if(h&&h.columnSpan>1)return}var d=new CellRangeEventArgs(t.panel,t.range,e);if(i.onSortingColumn(d)){i._edtHdl._commitRowEdits();for(var p=-1,f=null,g=0;g<r.length;g++)if(r[g].property==u){p=g;f=r[g];break}r.deferUpdate((function(){if(l&&s)r.clear();else if(f){var e=l;!e&&i.isTouching&&(e=0==f.ascending);e?r.removeAt(p):r[p]=new SortDescription(u,!f.ascending)}else{o!=AllowSorting.MultiColumn&&r.clear();var t=new SortDescription(u,!0);r.push(t)}}));i.onSortedColumn(d)}}}};_MouseHandler.prototype._clickPin=function(e,t){var i=this._g,o=i.columns,n=o._frozenInternal,r=i.allowPinning;r==AllowPinning.Both&&(r=e.shiftKey?AllowPinning.ColumnRange:AllowPinning.SingleColumn);var l=!o.isFrozen(t.col),s=n>=0?n:o._lastFrozen-1,a=n>=0?1:-1,c=l?t.col===s:t.col===s-a,u=new CellRangeEventArgs(i.cells,t.range);if(i.onPinningColumn(u)){var h=o._frozenInternal>=0?new Set(o.slice(0,o._frozenInternal).map((function(e,t){return t}))):new Set(o.slice(o.length+o._frozenInternal).map((function(e,t){return t+o.length+o._frozenInternal})));if(r==AllowPinning.SingleColumn){h.has(t.col)?h.delete(t.col):h.add(t.col);this._resizeColumns(h);if(c)o._frozenInternal=l?o._frozenInternal+a:o._frozenInternal-a;else if(i._hasColumnGroups()){var d=i._getColumnGroup(t.row,t.col);i._canMoveColumnGroup(t.row,t.col,0,s)||d&&d._ownerList&&d._ownerList.owner&&d._ownerList.owner.collapseTo&&(d._ownerList.owner.collapseTo="");var p=d._ownerList.length>1?t.row:Math.max(t.row-1,0);if(o.isFrozen(t.col)){if(!p||!c||p&&i._getColumnGroup(t.row-1,t.col)!=i._getColumnGroup(t.row-1,t.col+1)){var f=n>=0?n:o._lastFrozen;i._moveColumnGroup(p,t.col,0,f,!1)}o._frozenInternal-=a}else{i._moveColumnGroup(p,t.col,0,s,!1);o._frozenInternal+=a}}else if(o.isFrozen(t.col)){o.moveElement(t.col,s-a,!1);o._frozenInternal-=a}else{o.moveElement(t.col,s,!1);o._frozenInternal+=a}}if(r==AllowPinning.ColumnRange){if(o._frozenInternal>=0)for(var g=0;g<=t.col;g++)h.add(g);else if(o._frozenInternal<0)for(g=t.col;g<o.length;g++)h.add(g);this._resizeColumns(h);t.col+1!=n&&o._frozenInternal>=0?o.frozen=t.col+1:-(o.length-t.col)!=n&&o._frozenInternal<0?o._frozenInternal=-(o.length-t.col):o._frozenInternal=0}i._updateLayoutOnPin();i.onPinnedColumn(u)}};_MouseHandler.prototype._dblclick=function(e){if(!e.defaultPrevented){var t,i=this._g,o=i.hitTest(e),n=e.ctrlKey||e.metaKey,r=o.range,l=o.cellType,s=CellType,a=i.allowResizing,c=AllowResizing,u=o._inRightFrozenArea&&i._hasScroll(i.columns),h=i._getRangesToResize(e,!0);h||(h=[i.selection]);if((o.edgeRight&&!u||o.edgeLeft&&u)&&a&c.Columns){if(l==s.TopLeft){if(o.panel.columns[o.col].allowResizing){t=new CellRangeEventArgs(o.panel,new CellRange(-1,o.col));if(i.onAutoSizingColumn(t)&&i.onResizingColumn(t)){this._ignoreClick=!0;i.autoSizeColumn(o.col,!0);i.onAutoSizedColumn(t);i.onResizedColumn(t);e.preventDefault()}}}else if(l==s.ColumnHeader||a&_AR_ALLCELLS){l==s.ColumnHeader&&(n||i._canResizeAllCellsWithoutCtrl())||(h=[r]);for(var d=0;d<h.length;d++)for(var p=h[d],f=l==s.RowHeader||l==s.BottomLeft,g=p.leftCol;g<=p.rightCol;g++)if(o.panel.columns[g].allowResizing){t=new CellRangeEventArgs(o.panel,new CellRange(-1,g));if(i.onAutoSizingColumn(t)&&i.onResizingColumn(t)){this._ignoreClick=!0;i.autoSizeColumn(g,f);i.onResizedColumn(t);i.onAutoSizedColumn(t);e.preventDefault()}}}this.resetMouseState()}else{var _=o._inBottomFrozenArea&&i._hasScroll(i.rows);if((o.edgeBottom&&!_||o.edgeTop&&_)&&a&c.Rows){if(l==s.TopLeft||l==s.BottomLeft){if(o.getRow().allowResizing){f=l==s.TopLeft||null;t=new CellRangeEventArgs(o.panel,new CellRange(o.row,-1));if(i.onAutoSizingRow(t)&&i.onResizingRow(t)){this._ignoreClick=!0;i.autoSizeRow(o.row,f);i.onResizedRow(t);i.onAutoSizedRow(t);e.preventDefault()}}}else if(l==s.RowHeader||a&_AR_ALLCELLS){var m=o.panel;f=m==i.columnHeaders||m==i.columnFooters&&null;(n||i._canResizeAllCellsWithoutCtrl())&&m&&i.cells||(h=[r]);for(d=0;d<h.length;d++)for(var w=h[d],C=w.topRow;C<=w.bottomRow;C++)if(m.rows[C].allowResizing){t=new CellRangeEventArgs(m,new CellRange(C,-1));if(i.onAutoSizingRow(t)&&i.onResizingRow(t)){this._ignoreClick=!0;i.autoSizeRow(C,f);i.onResizedRow(t);i.onAutoSizedRow(t);e.preventDefault()}}}this.resetMouseState()}else;}}};_MouseHandler.prototype._hover=function(e){if(!this._isDown){var t=this._g,i=t.hitTest(e),o="";this._szRowCol=this._getResizeColHt(i)||this._getResizeRowHt(i);if(this._szRowCol instanceof Column){o="col-resize";this._wasAllRowColHidden=0===t.columns.visibleLength}else if(this._szRowCol instanceof Row){o="row-resize";this._wasAllRowColHidden=0===t.rows.visibleLength}this._szStart=this._szRowCol?this._szRowCol.renderSize:0;t.hostElement.style.cursor=o;return i}return null};_MouseHandler.prototype._getResizeColHt=function(e){var t,i=this._g,o=i.allowResizing,n=e.cellType,r=CellType;if(o&AllowResizing.Columns&&(n==r.ColumnHeader||n==r.TopLeft||o&_AR_ALLCELLS)){if(e._inRightFrozenArea&&i._hasScroll(i.columns)){e.edgeLeft&&(t=e.getColumn());e.edgeFarLeft&&(t=this._getResizeCol(e.panel,e.col,!0)||e.getColumn());e.edgeRight&&(t=this._getResizeCol(e.panel,e.col)||t)}else{e.edgeRight&&(t=e.getColumn());e.edgeFarRight&&(t=this._getResizeCol(e.panel,e.col)||e.getColumn());e.edgeLeft&&(t=this._getResizeCol(e.panel,e.col,!0)||t)}}return t&&t.allowResizing?t:null};_MouseHandler.prototype._getResizeRowHt=function(e){var t,i=this._g,o=i.allowResizing,n=AllowResizing,r=e.cellType,l=CellType;if(o&n.Rows&&(r==l.RowHeader||r==l.TopLeft||o&_AR_ALLCELLS)){if(e._inBottomFrozenArea&&i._hasScroll(i.rows)){e.edgeTop&&(t=e.getRow());e.edgeFarTop&&(t=this._getResizeRow(e.panel,e.row,!0)||e.getRow());e.edgeBottom&&(t=this._getResizeRow(e.panel,e.row)||t)}else{e.edgeBottom&&(t=e.getRow());e.edgeFarBottom&&(t=this._getResizeRow(e.panel,e.row)||e.getRow());e.edgeTop&&(t=this._getResizeRow(e.panel,e.row,!0)||t)}}return t&&t.allowResizing?t:null};_MouseHandler.prototype._getResizeCol=function(e,t,i){void 0===i&&(i=!1);var o=this._g,n=e.columns;if(i){for(var r=t-1;r>=0;r--){if((l=n[r]).isVisible)return this._asResizable(l)}if(n==o.columns&&0!=(o.headersVisibility&HeadersVisibility.Row))for(r=(n=o.rowHeaders.columns).length-1;r>=0;r--){if((l=n[r]).isVisible)return this._asResizable(l)}return null}for(r=t+1;r<n.length;r++){if((l=n[r]).isVisible)return this._asResizable(l)}if(t==n.length-1&&n==o.rowHeaders.columns){n=o.columns;for(r=0;r<n.length;r++){var l;if((l=n[r]).isVisible)return this._asResizable(l)}}return null};_MouseHandler.prototype._getResizeRow=function(e,t,i){void 0===i&&(i=!1);var o=this._g,n=e.rows;if(i){for(var r=t-1;r>=0;r--){if((l=n[r]).isVisible)return this._asResizable(l)}if(n==o.rows&&0!=(o.headersVisibility&HeadersVisibility.Column))for(r=(n=o.columnHeaders.rows).length-1;r>=0;r--){if((l=n[r]).isVisible)return this._asResizable(l)}return null}for(r=t+1;r<n.length;r++){if((l=n[r]).isVisible)return this._asResizable(l)}if(t==n.length-1&&n==o.columnHeaders.rows){n=o.rows;for(r=0;r<n.length;r++){var l;if((l=n[r]).isVisible)return this._asResizable(l)}}return null};_MouseHandler.prototype._asResizable=function(e){return 0==e.renderSize&&e.allowResizing?e:null};_MouseHandler.prototype._mouseSelect=function(e,t){var i=this,o=this._g;if(e&&this._htDown&&this._htDown.panel&&o.selectionMode!=SelectionMode.None){var n=new HitTestInfo(this._htDown.panel,e);this._handleSelection(n,t);!isIE9()&&e.button>=0&&e.target!=o._root&&((n=new HitTestInfo(o,e)).panel||setTimeout((function(){i._isDown&&i._eMouse&&i._mouseSelect(i._eMouse,t)}),100))}};_MouseHandler.prototype._handleResizing=function(e){"mousedown"==e.type&&(isSafari()?setAttribute(e.target,"draggable",null):e.preventDefault());var t=this._szRowCol,i=this._g,o=this._g.controlRect,n=i._szClientSB.width-i._szClient.width+FlexGrid._RESIZE_SCRL_GAP,r=i._szClientSB.height-i._szClient.height+FlexGrid._RESIZE_SCRL_GAP;if(t instanceof Column){var l=this._scrollbarStatusAtMouseDown?this._scrollbarStatusAtMouseDown.col:i._hasScroll(i.columns),s=mouseToPage(e).x,a=i.columns._frozenInternal&&i.columns._frozenInternal<0&&i.columns.isFrozen(t.index),c=Math.round(Math.max(_MouseHandler._SZ_MIN,this._szStart+(s-this._htDown.point.x)*(a&&l?-1:1)*(i.rightToLeft?-1:1))),u=(m=Math.round(o.left))+o.width;i.rightToLeft?m+=n:u-=n;var h=i.columns._frozenInternal<0&&i.columns.isFrozen(t.index),d=i.rightToLeft?-1:1;d=h?-d:d;var p=Math.abs(t.renderWidth-(this._szInitial?this._szInitial.col:0));if(s>u&&(!this._szInitial||this._szInitial.canHaveHScrl)){var f=Math.abs(Math.abs(this._htDown.point.x-u)-p)*d;c=Math.max(t.renderWidth+f,0)}else if(s<m){f=Math.abs(Math.abs(m-this._htDown.point.x)-p)*d;c=Math.max(t.renderWidth-f,0)}if(t.renderSize!=c){if(null==this._szArgs){var g=i.rowHeaders.columns.indexOf(t)>-1?i.rowHeaders:i.cells;this._szArgs=new CellRangeEventArgs(g,new CellRange(-1,t.index))}this._szArgs.data={newSize:c,isPrimaryDragged:!0};this._szArgs.cancel=!1;if(i.onResizingColumn(this._szArgs)){this._szArgs.data.maxSize&&(c=this._szArgs.data.maxSize);i.deferResizing?this._showResizeMarker(c):t.width=c}}}var _=this._szRowCol;if(_ instanceof Row){l=this._scrollbarStatusAtMouseDown?this._scrollbarStatusAtMouseDown.row:i._hasScroll(i.rows);var m,w=mouseToPage(e).y,C=i.rows._frozenInternal&&i.rows._frozenInternal<0&&i.rows.isFrozen(_.index);c=Math.round(Math.max(_MouseHandler._SZ_MIN,this._szStart+(w-this._htDown.point.y)*(C&&l?-1:1))),u=(m=Math.round(o.top))+o.height-r-i.columnFooters.rows.getTotalSize(),d=i.rows._frozenInternal<0&&i.rows.isFrozen(_.index)?-1:1,p=Math.abs(_.renderHeight-(this._szInitial?this._szInitial.row:0));if(w>u&&(!this._szInitial||this._szInitial.canHaveVScrl)){var v=Math.abs(Math.abs(this._htDown.point.y-u)-p)*d;c=Math.max(_.renderHeight+v,0)}else if(w<m){v=Math.abs(Math.abs(m-this._htDown.point.y)-p)*d;c=Math.max(_.renderHeight-v,0)}if(_.renderSize!=c){if(null==this._szArgs){g=i.columnHeaders.rows.indexOf(_)>-1?i.columnHeaders:i.columnFooters.rows.indexOf(_)>-1?i.columnFooters:i.cells;this._szArgs=new CellRangeEventArgs(g,new CellRange(_.index,-1))}this._szArgs.data={newSize:c,isPrimaryDragged:!0};this._szArgs.cancel=!1;if(i.onResizingRow(this._szArgs)){this._szArgs.data.maxSize&&(c=this._szArgs.data.maxSize);i.deferResizing?this._showResizeMarker(c):_.height=c}}}this._szArgs&&e.preventDefault()};_MouseHandler.prototype._dragstart=function(e){var t=this._g,i=this._htDown,o=AllowDragging,n=CellType;if(i){this._dragSrc=null;this._htDrag=null;this._chldColGrpMarker=!1;if(!this._szRowCol){var r=new CellRangeEventArgs(i.panel,i.range),l=t.allowDragging,s=i.cellType,a=i.panel.rows,c=i.getColumn(!0);c&&c.allowDragging&&(s==n.ColumnHeader||s==n.TopLeft)&&l&o.Columns&&(t.onDraggingColumn(r)?this._dragSrc=e.target:e.preventDefault());if(!this._dragSrc&&i.row>-1&&a[i.row].allowDragging){var u=a[i.row];u instanceof GroupRow||u instanceof _NewRowTemplate||s==n.RowHeader&&l&o.Rows&&(t.onDraggingRow(r)?this._dragSrc=e.target:e.preventDefault())}}if(this._dragSrc&&e.dataTransfer&&!e.defaultPrevented){this._htDrag=i;_startDrag(e.dataTransfer,"move");e.stopPropagation();addClass(this._dragSrc,_WJC_DRAGSRC);t.beginUpdate();this._updating=!0}}};_MouseHandler.prototype._dragend=function(e){this._dragSrc=null;this._htDrag=null;this.resetMouseState()};_MouseHandler.prototype._dragover=function(e){var t=this._g,i=this._hitTest(e),o=this._dragSrc?this._htDrag:null,n=CellType,r=!1;this._htDown&&(i.row>this._htDown.row?this.isDetailRow(i.row+1)&&(i._row+=1):i.row<this._htDown.row&&this.isDetailRow(i.row)&&(i._row-=1));if(o&&i.cellType==o.cellType){var l=new CellRangeEventArgs(i.panel,i.range,o);if(i.cellType==n.ColumnHeader&&t._hasColumnGroups()){l.cancel=!t._canMoveColumnGroup(o.row,o.col,i.row,i.col);r=t.onDraggingColumnOver(l)}else if(i.cellType==n.ColumnHeader){l.cancel=!t.columns.canMoveElement(o.col,i.col);r=t.onDraggingColumnOver(l)}else if(i.cellType==n.RowHeader){l.cancel=!t.rows.canMoveElement(o.row,i.row);r=t.onDraggingRowOver(l)}else if(i.cellType==n.TopLeft){l.cancel=!t.topLeftCells.columns.canMoveElement(o.col,i.col);r=t.onDraggingColumnOver(l)}}if(r){e.dataTransfer.dropEffect="move";e.preventDefault();e.stopPropagation();this._showDragMarker(i)}else this._showDragMarker(null);if(o&&t.autoScroll){var s=t.controlRect,a=t.scrollPosition,c=Control._DRAG_SCROLL_EDGE,u=Control._DRAG_SCROLL_STEP;if(o.panel==t.columnHeaders){e.pageX-s.left<c&&(a.x+=u);s.right-e.pageX<c&&(a.x-=u)}else if(o.panel==t.rowHeaders){e.pageY-s.top<c&&(a.y+=u);s.bottom-e.pageY<c&&(a.y-=u)}if(!a.equals(t._ptScrl)){t.scrollPosition=a;t._rcBounds=null}}};_MouseHandler.prototype._dragleave=function(e){this._showDragMarker(null)};_MouseHandler.prototype._drop=function(e){var t=this._g,i=this._hitTest(e),o=this._dragSrc?this._htDrag:null,n=CellType;if(o&&i.cellType==o.cellType){var r=t.selection,l=new CellRangeEventArgs(i.panel,i.range,o);if(i.cellType==n.ColumnHeader&&t._hasColumnGroups()){var s=t._getColumnGroup(o.row,o.col).columns.length,a=s>0?s:1,c=t.columns._frozenInternal;t._moveColumnGroup(o.row,o.col,i.row,i.col,this._chldColGrpMarker);c>=0?o.col<c&&i.col>=c?t.columns._frozenInternal-=a:o.col>=c&&i.col<c&&(t.columns._frozenInternal+=a):o.col<t.columns.length+c&&i.col>=t.columns.length+c?t.columns._frozenInternal-=a:o.col>=t.columns.length+c&&i.col<t.columns.length+c&&(t.columns._frozenInternal+=a);t.activePanelType===CellType.ColumnHeader||t.activePanelType===CellType.TopLeft?t.select(r.row,i.col,t.columnHeaders):t.select(r.row,i.col);t.onDraggedColumn(l)}else if(i.cellType==n.ColumnHeader){t.columns.moveElement(o.col,i.col);t.activePanelType===CellType.ColumnHeader||t.activePanelType===CellType.TopLeft?t.select(r.row,i.col,t.columnHeaders):t.select(r.row,i.col);t.onDraggedColumn(l)}else if(i.cellType==n.RowHeader){var u=i.row;i.row>this._htDown.row&&this.isDetailRow(i.row+1)?u+=1:i.row<this._htDown.row&&this.isDetailRow(i.row)&&(u-=1);this.isDetailRow(o.row)?this.moveDetailRow(o.row-1,u):this.isDetailRow(o.row+1)?this.moveDetailRow(o.row,u):t.rows.moveElement(o.row,u);t.select(i.row,r.col);t.onDraggedRow(l)}else if(i.cellType==n.TopLeft){t.topLeftCells.columns.moveElement(o.col,i.col);t.onDraggedColumn(l)}}this.resetMouseState()};_MouseHandler.prototype._hitTest=function(e){var t=this._g;t._rcBounds=null;return t.hitTest(e)};_MouseHandler.prototype._showResizeMarker=function(e){var t,i=this._g,o=i._ptScrl,n=this._szArgs.panel.cellType,r=CellType,l=this._dvMarker,s=i.cells.hostElement;l.parentElement!=s&&s.appendChild(l);if(this._szRowCol instanceof Column){t={left:this._szRowCol.pos+e-1,top:-1e3,right:"",bottom:0,width:3,height:""};n!=r.TopLeft&&n!=r.RowHeader||(t.left-=i._eTL.offsetWidth+o.x);n==r.Cell&&i.columns._frozenInternal>0&&i.columns.isFrozen(this._szRowCol.index)&&(t.left-=o.x);n==r.Cell&&i.columns._frozenInternal<0&&i.columns.isFrozen(this._szRowCol.index)&&(t.left=Math.min(this._szRowCol.pos,this._g._szClient.width+this._szRowCol._antipos)-e+this._szRowCol.renderWidth+1);i.rightToLeft&&(t.left=s.clientWidth-t.left-t.width)}else if(this._szRowCol instanceof Row){t={left:-1e3,top:this._szRowCol.pos+e-1,right:0,bottom:"",width:"",height:3};n!=r.TopLeft&&n!=r.ColumnHeader||(t.top-=i._eTL.offsetHeight+o.y);n==r.Cell&&i.rows._frozenInternal>0&&i.rows.isFrozen(this._szRowCol.index)&&(t.top-=o.y);n==r.Cell&&i.rows._frozenInternal<0&&i.rows.isFrozen(this._szRowCol.index)&&(t.top=Math.min(this._szRowCol.pos,this._g._szClient.height+this._szRowCol._antipos)-e+this._szRowCol.renderHeight+1)}setCss(l,t)};_MouseHandler.prototype._showDragMarker=function(e){var t=this._dvMarker;if(e&&e.panel){if(!e.range.equals(this._rngTarget)){this._rngTarget=e.range;var i=e.panel.hostElement;t.parentElement!=i&&i.appendChild(t);var o=this._g,n=o._ptScrl,r=CellType,l={left:0,top:0,width:6,height:6,right:"",bottom:""};switch(e.cellType){case r.ColumnHeader:var s=o._getColumnGroup(e.row,e.col);if(s){var a=s._rng,c=e.panel.rows,u=e.panel.columns;if(s.isEmpty&&null===s.binding){var h=c[a.bottomRow],d=u[a.leftCol],p=o.rightToLeft,f=p?t.parentElement.clientWidth-e.point.x:e.point.x,g=Math.max(d.renderWidth/5,_MouseHandler._SZ_MAX_COLGRP_EDGE),_=d.pos+g,m=d.pos+d.renderWidth-g,w=this._htDown&&e.col>this._htDown.col;if(!w&&f>_||w&&f<m){l.top=h.pos-l.height/2+h.renderHeight;l.left=p?t.parentElement.clientWidth-d.pos-d.renderWidth:d.pos;l.width=d.renderWidth;this._chldColGrpMarker=!0;break}}this._chldColGrpMarker=!1;l.top=0;l.height=0;for(var C=0;C<a.topRow;C++)l.top+=c[C].renderHeight;for(C=a.topRow;C<=a.bottomRow;C++)l.height+=c[C].renderHeight;l.left=0;if(this._htDown&&e.col>this._htDown.col){var v=u[a.rightCol];l.left=v.pos-l.width/2+v.renderWidth}else{var y=u[a.leftCol];l.left=y.pos-l.width/2}o.rightToLeft&&(l.left=t.parentElement.clientWidth-l.left-l.width);break}case r.TopLeft:case r.ColumnHeader:var b=e.panel.columns[e.col],R=o.columns._frozenInternal<0&&o.columns.isFrozen(e.col)?Math.min(b.pos,o._szClient.width+b._antipos):b.pos;l.left=R-l.width/2;l.height=e.panel.height;this._htDown&&e.col>this._htDown.col&&(l.left+=b.renderWidth);e.cellType==r.ColumnHeader&&o.columns.isFrozen(e.col)&&(l.left-=n.x);o.rightToLeft&&(l.left=t.parentElement.clientWidth-l.left-l.width);break;case r.RowHeader:var E=e.getRow(),S=o.rows._frozenInternal<0&&o.rows.isFrozen(e.row)?Math.min(E.pos,o._szClient.height+E._antipos):E.pos;l.top=S-l.height/2;l.width=e.panel.width;e.row>this._htDown.row&&(l.top+=E.renderHeight);o.rows.isFrozen(e.row)&&(l.top-=n.y)}setCss(t,l)}}else{removeChild(t);this._rngTarget=null}};_MouseHandler.prototype._finishResizing=function(e,t){var i=this._g,o=i.selection,n=this._szArgs,r=this._eMouse,l=r&&(r.ctrlKey||r.metaKey),s=CellType,a=this._wasAllRowColHidden&&this._htDown.cellType===s.TopLeft&&n.panel.cellType===s.Cell;if(n&&(!n.cancel||n.data&&n.data.internalCancel)){var c=n.data||{};t||(t=[i.selection]);var u=this._g.controlRect,h=i._szClientSB.width-i._szClient.width+FlexGrid._RESIZE_SCRL_GAP,d=i._szClientSB.height-i._szClient.height+FlexGrid._RESIZE_SCRL_GAP,p=mouseToPage(e),f=Math.round(u.left),g=f+u.width;i.rightToLeft?f+=h:g-=h;var _=Math.round(u.top),m=_+u.height-d-i.columnFooters.rows.getTotalSize(),w=p.y>=_&&p.y<m,C=p.x>=f&&p.x<g;if(n.col>-1&&this._szRowCol instanceof Column){var v=this._scrollbarStatusAtMouseDown?this._scrollbarStatusAtMouseDown.col:i._hasScroll(i.columns),y=n.col,b=mouseToPage(e).x,R=this._szRowCol,E=i.columns._frozenInternal&&i.columns._frozenInternal<0&&i.columns.isFrozen(R.index),S=Math.round(Math.max(_MouseHandler._SZ_MIN,this._szStart+(b-this._htDown.point.x)*(E&&v?-1:1)*(this._g.rightToLeft?-1:1)));this._htDown.cellType,s.TopLeft;if(C)n.panel.columns[y].width=Math.round(S);else if(i.deferResizing){var x=i.columns._frozenInternal<0&&i.columns.isFrozen(y),H=i.rightToLeft?-1:1;H=x?-H:H;if(p.x>g){var z=Math.abs(this._htDown.point.x-g)*H;S=Math.max(n.panel.columns[y].renderWidth+z,0)}else if(p.x<f){z=Math.abs(f-this._htDown.point.x)*H;S=Math.max(n.panel.columns[y].renderWidth-z,0)}n.panel.columns[y].width=Math.round(S)}i.onResizedColumn(n);for(var F=0;F<t.length;F++){o=t[F];if((l||i._canResizeAllCellsWithoutCtrl())&&(this._htDown.cellType==s.ColumnHeader||a)){for(var M=i.columns[y].size,I=o.leftCol;I<=o.rightCol;I++)if(i.columns[I].allowResizing&&I!=y){(n=new CellRangeEventArgs(i.cells,new CellRange(-1,I))).data=__assign({},c,{isPrimaryDragged:!1});if(i.onResizingColumn(n)){i.columns[I].size=M;i.onResizedColumn(n)}}i.columns.isFrozen(y)&&(i.columns[y].size=M)}}e.preventDefault()}if(n.row>-1&&this._szRowCol instanceof Row){v=this._scrollbarStatusAtMouseDown?this._scrollbarStatusAtMouseDown.row:i._hasScroll(i.rows);var T=n.row,G=mouseToPage(e).y,P=this._szRowCol,A=i.rows._frozenInternal&&i.rows._frozenInternal<0&&i.rows.isFrozen(P.index);S=Math.round(Math.max(_MouseHandler._SZ_MIN,this._szStart+(G-this._htDown.point.y)*(A&&v?-1:1))),this._htDown.cellType,s.TopLeft;if(w){n.getRow().height=Math.round(S);if("setHeights"in i){(L=i).setHeights(Array.from(L.rows).map((function(e){return e.height})))}}else if(i.deferResizing){H=i.rows._frozenInternal<0&&i.rows.isFrozen(n.row)?-1:1;if(p.y>m){var D=Math.abs(this._htDown.point.y-m)*H;S=Math.max(n.getRow().renderHeight+D-i.columnFooters.rows.getTotalSize(),0)}else if(p.y<_){D=Math.abs(f-this._htDown.point.y)*H;S=Math.max(n.getRow().renderHeight-D-i.columnFooters.rows.getTotalSize(),0)}n.getRow().height=Math.round(S);if("setHeights"in i){var L;(L=i).setHeights(Array.from(L.rows).map((function(e){return e.height})))}}i.onResizedRow(n);for(F=0;F<t.length;F++){o=t[F];if((l||i._canResizeAllCellsWithoutCtrl())&&(this._htDown.cellType==s.RowHeader||a)){for(var O=i.rows[T].size,V=o.topRow;V<=o.bottomRow;V++)if(i.rows[V].allowResizing&&V!=T){(n=new CellRangeEventArgs(i.cells,new CellRange(V,-1))).data=__assign({},c,{isPrimaryDragged:!1});if(i.onResizingRow(n)){i.rows[V].size=O;i.rows[V].resizedManually=!0;i.onResizedRow(n)}}i.rows.isFrozen(T)&&(i.rows[T].size=O)}}i.rows[T].resizedManually=!0;e.preventDefault()}}};_MouseHandler.prototype._limitSizeByFrozen=function(e,t,i){void 0===i&&(i=5);var o=this._g;if(e instanceof Column){var n=o.columns._frozenInternal>0?o.columns.slice(0,o.columns._frozenInternal).reduce((function(e,t){return e+t.renderSize}),0):o.columns.slice(o.columns.length+o.columns._frozenInternal,o.columns.length).reduce((function(e,t){return e+t.renderSize}),0),r=n-e.renderSize+t,l=!o._hasScroll(o.columns)&&o.columns._frozenInternal<0?o._szClient.width-i-o.columns.lastFrozen.pos:o._szClient.width-i;r>=l&&(t=l-n+e.renderSize)}else if(e instanceof Row){var s=o.rows._frozenInternal>0?o.rows.slice(0,o.rows._frozenInternal).reduce((function(e,t){return e+t.renderSize}),0):o.rows.slice(o.rows.length+o.rows._frozenInternal,o.rows.length).reduce((function(e,t){return e+t.renderSize}),0),a=s-e.renderSize+t,c=!o._hasScroll(o.rows)&&o.rows._frozenInternal<0?o._szClient.height-i-o.rows.lastFrozen.pos:o._szClient.height-i;a>=c&&(t=c-s+e.renderSize)}return t};_MouseHandler.prototype._handleSelection=function(e,t){var i=this._g,o=i._selHdl.selection,n=new CellRange(e.row,e.col),r=CellType,l=SelectionMode,s=null,a=this._eMouse&&(this._eMouse.ctrlKey||this._eMouse.metaKey),c=!1,u=e.col>=this._anchorCol;if(n.isValid)if(null==this._lbSelState){e.cellType!=r.ColumnHeader&&i._clearAnchorCell();switch(e.cellType){case r.RowHeader:n.col=0;n.col2=i.columns.length-1;break;case r.ColumnHeader:switch(i.selectionMode){case l.Row:case l.Cell:n.row=n.row2=o.row;t=!1;break;default:n.row=0;n.row2=i.rows.length-1;if(null!=(s=i._getColumnGroup(e.row,e.col))){if(i.anchorCursor){s._rng.col<=this._anchorCol&&this._anchorCol<=s._rng.col2&&(this._anchorCol=s._rng.col2);i._setAnchorCell(0,this._anchorCol)}else s._rng.col<this._anchorCol&&this._anchorCol<=s._rng.col2&&(this._anchorCol=s._rng.col);if(u){n.col=s._rng.col2;n.col2=s._rng.col}else{n.col=s._rng.col;n.col2=s._rng.col2;o.col2<n.col2&&(o.col2=n.col2)}}}}if(t){if(e.cellType==r.ColumnHeader){i.anchorCursor?null==i._getAnchorCell()&&i.selectionMode!=SelectionMode.Row&&i.selectionMode!=SelectionMode.Cell&&i._setAnchorCell(o.row,o.col):i._clearAnchorCell();n.row2=o.row2;!u&&o.col>o.col2?n.col2=o.col:n.col2=o.col2;null!=s&&u&&n.col2>s._rng.col&&(n.col2=s._rng.col)}else if(i.anchorCursor){n.row=o.row;n.col=o.col}else{n.row2=o.row2;n.col2=o.col2}if(!n.isValid){var h=this._htDown;h&&(n=new CellRange(h.row,h.col))}}if(closestClass(this._eMouse.target,CellFactory._WJC_COLLAPSE)){a=!1;c=!0}if(i.selectionMode==SelectionMode.MultiRange){var d=i._selHdl,p=d.selection,f=d.extendedSelection,g=e.panel!=i.cells,_=d.cellRangeEventArgs;if(a){if(!t&&d._deselectRange(n)){d.selection.isValid&&(n=null);if(i._getProductInfo().indexOf("MultiRow")>-1){var m=[];for(x=0;x<f.length;x++){p.contains(f[x])&&m.push(x);_&&_.range.contains(f[x])&&!m.includes(x)&&m.push(x)}if(m.length>0){for(var w=m.length-1;w>=0;w--)f.splice(m[w],1);m=[]}}}else if(p.isValid&&(g||!p.intersects(n)))if(i._getProductInfo().indexOf("MultiRow")>-1){var C=!1;m=[];p=d.selection.clone();for(x=0;x<f.length&&!C;x++){f[x].equals(p)&&(C=!0);p.contains(f[x])&&m.push(x);_&&_.range.contains(f[x])&&!m.includes(x)&&m.push(x)}if(m.length>0){for(w=m.length-1;w>=0;w--)f.splice(m[w],1);m=[]}C||f.push(p)}else{var v=d.selection;(g?this._splitRange(v):[v.clone()]).forEach((function(e){for(var t=!1,i=0;i<f.length&&!t;i++)f[i].equals(e)&&(t=!0);t||f.push(e)}))}}else f.clear()}if(n){i.select(n,!1);if(!c)switch(e.cellType){case r.RowHeader:i.scrollIntoView(e.row,-1);break;case r.ColumnHeader:i.scrollIntoView(-1,e.col);break;default:i.scrollIntoView(e.row,e.col)}}else{var y=new CellRangeEventArgs(i.cells,new CellRange(e.row,e.col));i.onSelectionChanging(y);i.onSelectionChanged(y);i.invalidate()}}else{var b=this._htDown.row,R=e.row,E=this._lbSel;if(b>R){R=b;b=e.row}var S=this._lbSelStateRows||{};if(this._lbSel)for(var x=E.row;x<=E.row2;x++)(x<b||x>R)&&(i.rows[x].isSelected=S[x]);for(var x=b;x<=R;x++){S.hasOwnProperty(x)||(S[x]=i.rows[x].isSelected);i.rows[x].isSelected=!this._lbSelState}this._lbSel=new CellRange(b,0,R,0);i.scrollIntoView(e.row,e.col)}};_MouseHandler.prototype._splitRange=function(e){var t=this._g,i=t.columns.length,o=t.rows.length,n=[];if(e.columnSpan==i)for(var r=e.topRow;r<=e.bottomRow;r++)n.push(new CellRange(r,0,r,i-1));else if(e.rowSpan==o)for(var l=e.leftCol;l<=e.rightCol;l++)n.push(new CellRange(0,l,o-1,l));else n.push(e.clone());return n};_MouseHandler.prototype.isDetailRow=function(e){var t=this._g.rows[e];return!!t&&"DetailRow"===t.constructor.name};_MouseHandler.prototype.moveDetailRow=function(e,t){var i=this._g,o=i.rows[e],n=i.rows[e+1];if(e>t){i.rows.splice(e,2);i.rows.splice(t,0,o,n)}else if(e<t){i.rows.splice(e,2);i.rows.splice(t-1,0,o,n)}};_MouseHandler.prototype._resizeColumns=function(e){var t=this._g,i=t.columns;if(Array.from(e).reduce((function(e,t){return e+i[t].renderSize}),0)+5>t._szClient.width){var o=Array.from(e).sort((function(e,t){return e-t})),n=t._szClient.width-5*o.length;t.columns.length<=e.size&&(n=t._szClient.width);var r=Math.round(n/o.length);o.forEach((function(e){i[e].width=r}))}t.invalidate()};_MouseHandler._SZ_MIN=0;_MouseHandler._SZ_MAX_COLGRP_EDGE=50;return _MouseHandler}();export{_MouseHandler};_registerModule("wijmo.grid",selfModule);